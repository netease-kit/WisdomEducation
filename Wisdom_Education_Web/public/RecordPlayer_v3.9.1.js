/*!
 * 
 *     VERSION: 3.9.1
 *     Git Hash: 4d3382dc2fa5b38f39f4ee49f3d10746de8f7cf7
 * 
 *     Create At: 2022/9/16 下午3:22:32
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RecordPlayer=t():e.RecordPlayer=t()}(window,(function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=494)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var a,r=n(105),i=(a=r)&&a.__esModule?a:{default:a};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,i.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}()},function(e,t,n){e.exports={default:n(205),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var a,r=n(27),i=(a=r)&&a.__esModule?a:{default:a};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){"use strict";t.__esModule=!0;var a=o(n(156)),r=o(n(131)),i=o(n(27));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,r.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(a.default?(0,a.default)(e,t):e.__proto__=t)}},function(e,t,n){e.exports={default:n(165),__esModule:!0}},function(e,t,n){!function(){"use strict";function t(e,t){var n,a,r,i,o=A;for(i=arguments.length;i-- >2;)N.push(arguments[i]);for(t&&null!=t.children&&(N.length||N.push(t.children),delete t.children);N.length;)if((a=N.pop())&&void 0!==a.pop)for(i=a.length;i--;)N.push(a[i]);else"boolean"==typeof a&&(a=null),(r="function"!=typeof e)&&(null==a?a="":"number"==typeof a?a+="":"string"!=typeof a&&(r=!1)),r&&n?o[o.length-1]+=a:o===A?o=[a]:o.push(a),n=r;var s=new _;return s.nodeName=e,s.children=o,s.attributes=null==t?void 0:t,s.key=null==t?void 0:t.key,void 0!==C.vnode&&C.vnode(s),s}function n(e,t){for(var n in t)e[n]=t[n];return e}function a(e,t){e&&("function"==typeof e?e(t):e.current=t)}function r(e){!e.__d&&(e.__d=!0)&&1==D.push(e)&&(C.debounceRendering||P)(i)}function i(){for(var e;e=D.pop();)e.__d&&I(e)}function o(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&s(e,t.nodeName):n||e._componentConstructor===t.nodeName}function s(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function u(e){var t=n({},e.attributes);t.children=e.children;var a=e.nodeName.defaultProps;if(void 0!==a)for(var r in a)void 0===t[r]&&(t[r]=a[r]);return t}function l(e){var t=e.parentNode;t&&t.removeChild(e)}function c(e,t,n,r,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)a(n,null),a(r,e);else if("class"!==t||i)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var o in n)o in r||(e.style[o]="");for(var o in r)e.style[o]="number"==typeof r[o]&&!1===O.test(o)?r[o]+"px":r[o]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,d,s):e.removeEventListener(t,d,s),(e.__l||(e.__l={}))[t]=r}else if("list"!==t&&"type"!==t&&!i&&t in e){try{e[t]=null==r?"":r}catch(e){}null!=r&&!1!==r||"spellcheck"==t||e.removeAttribute(t)}else{var u=i&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?u?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(u?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function d(e){return this.__l[e.type](C.event&&C.event(e)||e)}function p(){for(var e;e=S.shift();)C.afterMount&&C.afterMount(e),e.componentDidMount&&e.componentDidMount()}function h(e,t,n,a,r,i){E++||(j=null!=r&&void 0!==r.ownerSVGElement,L=null!=e&&!("__preactattr_"in e));var o=f(e,t,n,a,i);return r&&o.parentNode!==r&&r.appendChild(o),--E||(L=!1,i||p()),o}function f(e,t,n,a,r){var i=e,o=j;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0))),i.__preactattr_=!0,i;var u=t.nodeName;if("function"==typeof u)return b(e,t,n,a);if(j="svg"===u||"foreignObject"!==u&&j,u+="",(!e||!s(e,u))&&(i=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.__n=e,n}(u,j),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0)}var l=i.firstChild,c=i.__preactattr_,d=t.children;if(null==c){c=i.__preactattr_={};for(var p=i.attributes,h=p.length;h--;)c[p[h].name]=p[h].value}return!L&&d&&1===d.length&&"string"==typeof d[0]&&null!=l&&void 0!==l.splitText&&null==l.nextSibling?l.nodeValue!=d[0]&&(l.nodeValue=d[0]):(d&&d.length||null!=l)&&g(i,d,n,a,L||null!=c.dangerouslySetInnerHTML),m(i,t.attributes,c),j=o,i}function g(e,t,n,a,r){var i,s,u,c,d,p=e.childNodes,h=[],g={},y=0,m=0,M=p.length,x=0,w=t?t.length:0;if(0!==M)for(var I=0;I<M;I++){var b=p[I],k=b.__preactattr_;null!=(T=w&&k?b._component?b._component.__k:k.key:null)?(y++,g[T]=b):(k||(void 0!==b.splitText?!r||b.nodeValue.trim():r))&&(h[x++]=b)}if(0!==w)for(I=0;I<w;I++){var T;if(d=null,null!=(T=(c=t[I]).key))y&&void 0!==g[T]&&(d=g[T],g[T]=void 0,y--);else if(m<x)for(i=m;i<x;i++)if(void 0!==h[i]&&o(s=h[i],c,r)){d=s,h[i]=void 0,i===x-1&&x--,i===m&&m++;break}d=f(d,c,n,a),u=p[I],d&&d!==e&&d!==u&&(null==u?e.appendChild(d):d===u.nextSibling?l(u):e.insertBefore(d,u))}if(y)for(var I in g)void 0!==g[I]&&v(g[I],!1);for(;m<=x;)void 0!==(d=h[x--])&&v(d,!1)}function v(e,t){var n=e._component;n?k(n):(null!=e.__preactattr_&&a(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||l(e),y(e))}function y(e){for(e=e.lastChild;e;){var t=e.previousSibling;v(e,!0),e=t}}function m(e,t,n){var a;for(a in n)t&&null!=t[a]||null==n[a]||c(e,a,n[a],n[a]=void 0,j);for(a in t)"children"===a||"innerHTML"===a||a in n&&t[a]===("value"===a||"checked"===a?e[a]:n[a])||c(e,a,n[a],n[a]=t[a],j)}function M(e,t,n){var a,r=z.length;for(e.prototype&&e.prototype.render?(a=new e(t,n),T.call(a,t,n)):((a=new T(t,n)).constructor=e,a.render=x);r--;)if(z[r].constructor===e)return a.__b=z[r].__b,z.splice(r,1),a;return a}function x(e,t,n){return this.constructor(e,n)}function w(e,t,n,i,o){e.__x||(e.__x=!0,e.__r=t.ref,e.__k=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i)),i&&i!==e.context&&(e.__c||(e.__c=e.context),e.context=i),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&!1===C.syncComponentUpdates&&e.base?r(e):I(e,1,o)),a(e.__r,e))}function I(e,t,a,r){if(!e.__x){var i,o,s,l=e.props,c=e.state,d=e.context,f=e.__p||l,g=e.__s||c,y=e.__c||d,m=e.base,x=e.__b,b=m||x,T=e._component,_=!1,N=y;if(e.constructor.getDerivedStateFromProps&&(c=n(n({},c),e.constructor.getDerivedStateFromProps(l,c)),e.state=c),m&&(e.props=f,e.state=g,e.context=y,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(l,c,d)?_=!0:e.componentWillUpdate&&e.componentWillUpdate(l,c,d),e.props=l,e.state=c,e.context=d),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!_){i=e.render(l,c,d),e.getChildContext&&(d=n(n({},d),e.getChildContext())),m&&e.getSnapshotBeforeUpdate&&(N=e.getSnapshotBeforeUpdate(f,g));var A,P,O=i&&i.nodeName;if("function"==typeof O){var D=u(i);(o=T)&&o.constructor===O&&D.key==o.__k?w(o,D,1,d,!1):(A=o,e._component=o=M(O,D,d),o.__b=o.__b||x,o.__u=e,w(o,D,0,d,!1),I(o,1,a,!0)),P=o.base}else s=b,(A=T)&&(s=e._component=null),(b||1===t)&&(s&&(s._component=null),P=h(s,i,d,a||!m,b&&b.parentNode,!0));if(b&&P!==b&&o!==T){var j=b.parentNode;j&&P!==j&&(j.replaceChild(P,b),A||(b._component=null,v(b,!1)))}if(A&&k(A),e.base=P,P&&!r){for(var L=e,z=e;z=z.__u;)(L=z).base=P;P._component=L,P._componentConstructor=L.constructor}}for(!m||a?S.push(e):_||(e.componentDidUpdate&&e.componentDidUpdate(f,g,N),C.afterUpdate&&C.afterUpdate(e));e.__h.length;)e.__h.pop().call(e);E||r||p()}}function b(e,t,n,a){for(var r=e&&e._component,i=r,o=e,s=r&&e._componentConstructor===t.nodeName,l=s,c=u(t);r&&!l&&(r=r.__u);)l=r.constructor===t.nodeName;return r&&l&&(!a||r._component)?(w(r,c,3,n,a),e=r.base):(i&&!s&&(k(i),e=o=null),r=M(t.nodeName,c,n),e&&!r.__b&&(r.__b=e,o=null),w(r,c,1,n,a),e=r.base,o&&e!==o&&(o._component=null,v(o,!1))),e}function k(e){C.beforeUnmount&&C.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?k(n):t&&(null!=t.__preactattr_&&a(t.__preactattr_.ref,null),e.__b=t,l(t),z.push(e),y(t)),a(e.__r,null)}function T(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{},this.__h=[]}var _=function(){},C={},N=[],A=[],P="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,O=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,D=[],S=[],E=0,j=!1,L=!1,z=[];n(T.prototype,{setState:function(e,t){this.__s||(this.__s=this.state),this.state=n(n({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this.__h.push(t),r(this)},forceUpdate:function(e){e&&this.__h.push(e),I(this,2)},render:function(){}});var R={h:t,createElement:t,cloneElement:function(e,a){return t(e.nodeName,n(n({},e.attributes),a),arguments.length>2?[].slice.call(arguments,2):e.children)},createRef:function(){return{}},Component:T,render:function(e,t,n){return h(n,e,{},!1,t,!1)},rerender:i,options:C};e.exports=R}()},function(e,t,n){e.exports={default:n(190),__esModule:!0}},function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(14)),r=c(n(5)),i=c(n(0)),o=c(n(1)),s=c(n(27)),u=n(45),l=n(160);function c(e){return e&&e.__esModule?e:{default:e}}var d=void 0,p={type:"",boardName:"whiteboard",pageIndex:"0",dependOn:void 0,timestamp:0},h=!1;function f(e,t,n,a){var r=!1;return p.pageIndex!==n||p.boardName!==a?r=!0:p.inProgress?(e!==p.type||(void 0===t?"undefined":(0,s.default)(t))!==(0,s.default)(p.dependOn)||"string"==typeof t&&t!==p.dependOn||Array.isArray(t)&&Array.isArray(p.dependOn)&&t.join(",")!==p.dependOn.join(",")||h||-1!==["undo","redo","image"].indexOf(e))&&(r=!0):r=!0,r}var g=function(){function e(t){(0,i.default)(this,e),this.type="base",this.app=t,this.opsManager=t.opsManager,this.registerHooks()}return(0,o.default)(e,[{key:"registerHooks",value:function(){}},{key:"eventsToListen",value:function(){return{exec:{value:!1,information:{args:"",message:"执行"+this.type+"事件"}},activate:{value:!1,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"execCommand",value:function(){console.warn("DEV--\x3e","若设置了exec为true，请继承execCommand函数，并作出对应的处理。")}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"opIdForseen",value:function(e,t){return f(e,t,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName)?this.opsManager.currPage.getNextOpId():this.opsManager.currPage.getOpId()}},{key:"dispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments[2];if(e.hasOwnProperty("type")){if(u.globalSnapshotTypes.indexOf(e.type)>-1)return this.dispatchGlobalAction(e);if("page"===e.type)return this.dispatchPageAction(e);if("board"===e.type||"transDoc"===e.type)return this.dispatchBoardAction(e);var a=this.app.room.currBoard,i=this.app.room.currBoard.currPage,o=Date.now()+this.app.ntpTimeDiff,s=void 0;if(e.reuseOpType)s=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType;else if(n)s=n,p={type:e.type,dependOn:e.dependOn,timestamp:o,pageIndex:this.opsManager.currPage.pageIndex,boardName:this.opsManager.currPage.boardName,inProgress:e.inProgress};else{var l=f(e.type,e.dependOn,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName);h=!1,p={type:e.type,dependOn:e.dependOn,timestamp:o,pageIndex:this.opsManager.currPage.pageIndex,boardName:this.opsManager.currPage.boardName,inProgress:e.inProgress},l&&this.opsManager.currPage.prepareNewOpId(),s=this.opsManager.currPage.getOpId()}var c={category:"inPageOp",board:this.app.room.currIndex,page:a.currIndex,time:o,uid:this.app.account,opId:s,data:e},d=200,g=Array.isArray(e.dependOn)&&e.dependOn.length>d;if(e.inProgress&&g)i.setLocalOp(c.data.type,c,!0);else if(g){i.setLocalOp(c.data.type,void 0,!0);for(var v=0;v<e.dependOn.length;v+=d)s=this.opsManager.currPage.getNextOpId(!0),this.app.room.dispatch((0,r.default)((0,r.default)({},c),{opId:s,data:(0,r.default)((0,r.default)({},c.data),{dependOn:e.dependOn.slice(v,v+d)})}),!0)}else this.app.room.dispatch(c,t);return s}var y=n||this.opsManager.currPage.getOpId(),m={opId:y,data:e};return this.app.room.dispatch(m,t),y}},{key:"getLocalSnapshot",value:function(e){return{category:"inPageOp",board:this.app.room.currIndex,page:this.app.room.currBoard.currIndex,time:Date.now(),uid:this.app.account,opId:e.reuseOpType||e.type,data:e}}},{key:"dispatchFromPage",value:function(e,t){var n=Date.now()+this.app.ntpTimeDiff;t.prepareNewOpId();var a={category:"inPageOp",board:t.boardName,page:Number(t.pageIndex),time:n,uid:this.app.account,opId:t.getOpId(),data:e};p={type:e.type,dependOn:e.dependOn,timestamp:n,pageIndex:t.pageIndex,boardName:t.boardName,inProgress:e.inProgress},this.app.room.dispatch(a)}},{key:"dispatchPageAction",value:function(e){var t=Date.now()+this.app.ntpTimeDiff,n=(0,l.v4)(),a={category:"pageOp",board:this.app.room.currIndex,time:t,uid:this.app.account,opId:n,data:e};return this.app.room.dispatch(a),n}},{key:"dispatchBoardAction",value:function(e){var t=Date.now()+this.app.ntpTimeDiff,n=(0,l.v4)(),a={category:"boardOp",time:t,uid:this.app.account,opId:n,data:e};return this.app.room.dispatch(a),n}},{key:"dispatchGlobalAction",value:function(e){var t=void 0,n=Date.now()+this.app.ntpTimeDiff;e.reuseOpType?(t=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType):(d&&!h||(d=(0,l.v4)(),h=!1),t=d);var a={category:"globalOp",time:n,uid:this.app.account,opId:t,data:e};return this.app.room.dispatch(a),t}},{key:"emit",value:function(e){for(var t,n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];(t=this.app.dispatcher).emit.apply(t,[e].concat(a))}},{key:"draw",value:function(e,t,n){console.warn("DEV--\x3e","请实现"+this.type+"子类中draw函数。")}},{key:"intepSnap",value:function(e){return e}},{key:"preview",value:function(e,t,n){this.draw(e,t,n)}},{key:"hide",value:function(e,t,n){}},{key:"waitTilReady",value:function(e){return a.default.resolve()}},{key:"mergePartial",value:function(e,t){return t.hasOwnProperty("category")?t.time>=e.time?t:e:(0,r.default)((0,r.default)({},e),{data:(0,r.default)((0,r.default)({},e.data),t.data)})}},{key:"beginBatch",value:function(){h=!0}},{key:"isKeyDown",value:function(e){return this.app.container.isKeyDown(e)}},{key:"getOpTypeByOpId",value:function(e){return this.opsManager.drawOpsOfPage.hasOwnProperty(e)?this.opsManager.drawOpsOfPage[e].data.type:void 0}},{key:"isMouseDown",get:function(){return this.app.container.isMouseDown}},{key:"isMouseMoved",get:function(){return this.app.container.isMouseMoved}},{key:"logger",get:function(){return this.app.logger}},{key:"opsOfPage",get:function(){return this.opsManager.currPage.opQueue}},{key:"drawOpsOfPage",get:function(){return this.opsManager.drawOpsOfPage}},{key:"localOps",get:function(){return this.app.room.currBoard.currPage.localDrawQueue}}]),e}();t.default=g},function(e,t,n){var a=n(15),r=n(8),i=n(32),o=n(35),s=n(42),u=function(e,t,n){var l,c,d,p=e&u.F,h=e&u.G,f=e&u.S,g=e&u.P,v=e&u.B,y=e&u.W,m=h?r:r[t]||(r[t]={}),M=m.prototype,x=h?a:f?a[t]:(a[t]||{}).prototype;for(l in h&&(n=t),n)(c=!p&&x&&void 0!==x[l])&&s(m,l)||(d=c?x[l]:n[l],m[l]=h&&"function"!=typeof x[l]?n[l]:v&&c?i(d,a):y&&x[l]==d?function(e){var t=function(t,n,a){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,a)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):g&&"function"==typeof d?i(Function.call,d):d,g&&((m.virtual||(m.virtual={}))[l]=d,e&u.R&&M&&!M[l]&&o(M,l,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var r=(o=a,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),i=a.sources.map((function(e){return"/*# sourceURL="+a.sourceRoot+e+" */"}));return[n].concat(i).concat([r]).join("\n")}var o;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var a={},r=0;r<this.length;r++){var i=this[r][0];null!=i&&(a[i]=!0)}for(r=0;r<e.length;r++){var o=e[r];null!=o[0]&&a[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var a,r,i={},o=(a=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=a.apply(this,arguments)),r}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},u=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var a=s.call(this,e,n);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}}(),l=null,c=0,d=[],p=n(223);function h(e,t){for(var n=0;n<e.length;n++){var a=e[n],r=i[a.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](a.parts[o]);for(;o<a.parts.length;o++)r.parts.push(M(a.parts[o],t))}else{var s=[];for(o=0;o<a.parts.length;o++)s.push(M(a.parts[o],t));i[a.id]={id:a.id,refs:1,parts:s}}}}function f(e,t){for(var n=[],a={},r=0;r<e.length;r++){var i=e[r],o=t.base?i[0]+t.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};a[o]?a[o].parts.push(s):n.push(a[o]={id:o,parts:[s]})}return n}function g(e,t){var n=u(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var a=d[d.length-1];if("top"===e.insertAt)a?a.nextSibling?n.insertBefore(t,a.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=u(e.insertAt.before,n);n.insertBefore(t,r)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function y(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var a=function(){0;return n.nc}();a&&(e.attrs.nonce=a)}return m(t,e.attrs),g(e,t),t}function m(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function M(e,t){var n,a,r,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var o=c++;n=l||(l=y(t)),a=I.bind(null,n,o,!1),r=I.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),g(e,t),t}(t),a=k.bind(null,n,t),r=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=y(t),a=b.bind(null,n),r=function(){v(n)});return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else r()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=f(e,t);return h(n,t),function(e){for(var a=[],r=0;r<n.length;r++){var o=n[r];(s=i[o.id]).refs--,a.push(s)}e&&h(f(e,t),t);for(r=0;r<a.length;r++){var s;if(0===(s=a[r]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete i[s.id]}}}};var x,w=(x=[],function(e,t){return x[e]=t,x.filter(Boolean).join("\n")});function I(e,t,n,a){var r=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=w(t,r);else{var i=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function b(e,t){var n=t.css,a=t.media;if(a&&e.setAttribute("media",a),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function k(e,t,n){var a=n.css,r=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&r;(t.convertToAbsoluteUrls||i)&&(a=p(a)),r&&(a+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([a],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVecAngle=t.getAngleByDir=t.getPointAftPad=t.getScaleCursor=t.getLineFromPointsY=t.getVerticalLineY=t.getXFromCoefAndOffset=t.getLineCoef=t.getArrowPointsByAngle=t.getArrowPoints=void 0;var a,r=n(7),i=(a=r)&&a.__esModule?a:{default:a};t.distSqrt=l,t.dist=c,t.rectCollide=function(e,t){var n=[t.sx,t.sy];return!(e.sx>n[0]+t.w||e.sx+e.w<n[0]||e.sy>n[1]+t.h||e.sy+e.h<n[1])},t.pointCollideWithPoint=function(e,t,n){return l(e,t)<=n*n},t.pointCollideWithLine=function(e,t,n,a){return c(e,t)+c(e,n)-c(t,n)<=a},t.pointInRect=function(e,t,n){return n[0]>e.sx-t&&n[0]<e.sx+e.w+t&&n[1]>e.sy-t&&n[1]<e.sy+e.h+t},t.pointInVertices=d,t.polygonContain=function(e,t){var n=!0,a=!1,r=void 0;try{for(var o,s=(0,i.default)(e);!(n=(o=s.next()).done);n=!0){var u=o.value;if(!d(t,u))return!1}}catch(e){a=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw r}}return!0},t.polygonIntersect=function(e,t){var n=[e,t],a=void 0,r=void 0,i=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0;for(o=0;o<n.length;o++){var d=n[o];for(s=0;s<d.length;s++){var p=(s+1)%d.length,h=d[s],f=d[p],g={x:f[1]-h[1],y:h[0]-f[0]};for(a=r=void 0,u=0;u<e.length;u++)i=g.x*e[u][0]+g.y*e[u][1],(void 0===a||i<a)&&(a=i),(void 0===r||i>r)&&(r=i);for(l=c=void 0,u=0;u<t.length;u++)i=g.x*t[u][0]+g.y*t[u][1],(void 0===l||i<l)&&(l=i),(void 0===c||i>c)&&(c=i);if(r<l||c<a)return!1}}return!0},t.getTransformedBoundary=function(e,t){var n=t.boundary,a=t.mat,r=t.pad,i=void 0===r?0:r,o=(0,s.getTransPoint)([n.sx-i,n.sy-i],a),l=(0,s.getTransPoint)([n.sx+n.w+2*i,n.sy-i],a),c=(0,s.getTransPoint)([n.sx+n.w+2*i,n.sy+n.h+2*i],a),d=(0,s.getTransPoint)([n.sx-i,n.sy+n.h+2*i],a),p=(0,u.min)(o[0],l[0],c[0],d[0]),h=(0,u.min)(o[1],l[1],c[1],d[1]),f=(0,u.max)(o[0],l[0],c[0],d[0]),g=(0,u.max)(o[1],l[1],c[1],d[1]),v=f-p,y=g-h;n.fixRealWorldHeight&&e&&(y=n.fixRealWorldHeight/e);return{sx:p,sy:h,w:v,h:y}},t.getTransformedSize=function(e){var t=e.boundary,n=e.xFactor,a=void 0===n?1:n,r=e.yFactor,i=void 0===r?1:r;return{w:Math.abs(t.w*a),h:Math.abs(t.h*i)}},t.getTransformedVertices=function(e){var t=e.boundary,n=e.mat,a=(0,s.getTransPoint)([t.sx,t.sy],n),r=(0,s.getTransPoint)([t.sx+t.w,t.sy],n),i=(0,s.getTransPoint)([t.sx+t.w,t.sy+t.h],n),o=(0,s.getTransPoint)([t.sx,t.sy+t.h],n);return[a,r,i,o]},t.combineBoundary=function(e,t){var n=(0,u.min)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),a=(0,u.min)(e.sy,t.sy,e.sy+e.h,t.sy+t.h),r=(0,u.max)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),i=(0,u.max)(e.sy,t.sy,e.sy+e.h,t.sy+t.h);return{sx:n,sy:a,w:r-n,h:i-a}},t.getPointAftRotate=function(e,t,n){if(!n)return e;var a=[e[0]-t[0],e[1]-t[1]],r=[Math.cos(n)*a[0]-Math.sin(n)*a[1],Math.sin(n)*a[0]+Math.cos(n)*a[1]];return[r[0]+t[0],r[1]+t[1]]},t.getBoundaryBoxFromTwoPoints=function(e,t){var n=(0,u.min)(e[0],t[0]),a=(0,u.max)(e[0],t[0]),r=(0,u.min)(e[1],t[1]),i=(0,u.max)(e[1],t[1]);return{sx:n,sy:r,w:a-n,h:i-r}};var o=n(29),s=n(30),u=n(135);function l(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function c(e,t){return Math.sqrt(l(e,t))}function d(e,t){for(var n=!1,a=0,r=e.length-1;a<e.length;r=a++)e[a][1]>t[1]!=e[r][1]>t[1]&&t[0]<(e[r][0]-e[a][0])*(t[1]-e[a][1])/(e[r][1]-e[a][1])+e[a][0]&&(n=!n);return n}t.getArrowPoints=function(e,t){var n=5*e,a=2*e,r=p(t),i=t[1][0]-t[0][0]>0?h(t[1],r,n):2*t[1][0]-h(t[1],r,n),o=t[1][0]-t[0][0]==0?t[1][1]+(t[1][1]-t[0][1]>0?n:-n):g(t,i),s=h(t[1],-1/r,a),u=t[1][1]-t[0][1]==0?t[1][1]-a:f(t[1],r,s),l=2*t[1][0]-h(t[1],-1/r,a);return[[i,o],[s,u],[l,t[1][1]-t[0][1]==0?t[1][1]+a:f(t[1],r,l)]]},t.getArrowPointsByAngle=function(e,t,n,a){var r=Math.PI/6+t+Math.PI,i=-Math.PI/6+t+Math.PI;return[[n+Math.cos(t)*e,a+Math.sin(t)*e],[n+5*Math.cos(r)*e,a+5*Math.sin(r)*e],[n+5*Math.cos(i)*e,a+5*Math.sin(i)*e]]};var p=t.getLineCoef=function(e){return(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0},h=t.getXFromCoefAndOffset=function(e,t,n){return Math.sqrt(Math.pow(n,2)/(Math.pow(t,2)+1))+e[0]},f=t.getVerticalLineY=function(e,t,n){return(e[0]-n)/t+e[1]},g=t.getLineFromPointsY=function(e,t){return Math.max(-1e6,(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0)*(t-e[0][0])+e[0][1]};t.getScaleCursor=function(e){var t=Math.floor(16*e/(2*Math.PI));return["ew-resize","nwse-resize","ns-resize","nesw-resize"][t=Math.floor((t+16+1)%8/2)]},t.getPointAftPad=function(e,t,n,a,r,i){return 0===a?[e[0]+t*(-Math.cos(n)*r+Math.sin(n)*i),e[1]+t*(-Math.sin(n)*r-Math.cos(n)*i)]:1===a?[e[0]+t*(Math.cos(n)*r+Math.sin(n)*i),e[1]+t*(Math.sin(n)*r-Math.cos(n)*i)]:2===a?[e[0]+t*(Math.cos(n)*r-Math.sin(n)*i),e[1]+t*(Math.sin(n)*r+Math.cos(n)*i)]:[e[0]+t*(-Math.cos(n)*r-Math.sin(n)*i),e[1]+t*(-Math.sin(n)*r+Math.cos(n)*i)]},t.getAngleByDir=function(e){switch(e){case o.DIRECTION.LEFT:return 0;case o.DIRECTION.RIGHT:return Math.PI;case o.DIRECTION.UP:return Math.PI/2;case o.DIRECTION.DOWN:return-Math.PI/2}},t.getVecAngle=function(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])}},function(e,t,n){e.exports={default:n(180),__esModule:!0}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.linkSelectOnly=t.padPt=t.extendCameraToSnap=t.convertWinTxtToUnixTxt=t.getAuxSensitivity=t.getSortedDrawOpIds=t.getVecAngle=t.updateDocClipPath=t.getElementPartOutOfContainer=t.filterNonMediaOpIds=t.transformPropertyOverwriteOp=t.drawUserName=t.roundRect=t.arrayDeduce=t.idsChanged=t.snapshotSelectable=t.findOpsUnderMouse=t.findOpsUnderRect=void 0;var a=d(n(18)),r=d(n(5)),i=d(n(7)),o=d(n(38)),s=n(13),u=n(225),l=n(64),c=n(45);function d(e){return e&&e.__esModule?e:{default:e}}t.findOpsUnderRect=function(e,t,n,a){if(0===t.length)return[];var r=(0,s.getBoundaryBoxFromTwoPoints)(t[0],t[t.length-1]),i=[];for(var o in n){var u=n[o];if("link"===u.data.type)(0,l.isUnderRect)({data:u.data,rect:r,selectMode:a})&&i.push(o);else if(u.data.boundary&&h(u)){var c=(0,s.getTransformedVertices)(u.data);("intersect"===a?(0,s.polygonIntersect)(c,[[r.sx,r.sy],[r.sx,r.sy+r.h],[r.sx+r.w,r.sy+r.h],[r.sx+r.w,r.sy]]):(0,s.polygonContain)(c,[[r.sx,r.sy],[r.sx,r.sy+r.h],[r.sx+r.w,r.sy+r.h],[r.sx+r.w,r.sy]]))&&i.push(o)}}return i},t.findOpsUnderMouse=function(e,t,n,a,r){if(0===n.length)return[];for(var i=(0,s.getBoundaryBoxFromTwoPoints)(n[0],n[n.length-1]),u=(0,o.default)(n[n.length-1],2),d=u[0],p=u[1],f=v(a),g=f.length-1;g>=0;g--){var y=a[f[g]],m=r.opMap[y.data.type];if("link"===y.data.type){var M=e.opsManager.linkOp;if((0,l.isUnderPoint)({data:y.data,p:[d,p],op:M}))return[f[g]]}else if(y.data.boundary&&h(y)){var x=void 0;if(-1!==c.nonRotateTypes.indexOf(y.data.type)){var w=(0,s.getTransformedBoundary)(t,y.data);x=(0,s.rectCollide)(w,i)}else{var I=(0,s.getTransformedVertices)(y.data);x=(0,s.polygonIntersect)(I,[[i.sx,i.sy],[i.sx,i.sy+i.h],[i.sx+i.w,i.sy+i.h],[i.sx+i.w,i.sy]])}if(x){if(!m||!("ifMouseOnOp"in m))return[f[g]];if(m.ifMouseOnOp(y,d,p))return[f[g]]}}}return[]};var p=["mouse-pointer","eraser"],h=t.snapshotSelectable=function(e){return!(-1!==p.indexOf(e.data.type)||e.data.locked)},f=(t.idsChanged=function(e,t){if(e.length!==t.length)return!0;var n=!0,a=!1,r=void 0;try{for(var o,s=(0,i.default)(e);!(n=(o=s.next()).done);n=!0){var u=o.value;if(-1===t.indexOf(u))return!0}}catch(e){a=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw r}}return!1},t.arrayDeduce=function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var s,u=(0,i.default)(e);!(a=(s=u.next()).done);a=!0){var l=s.value;-1===t.indexOf(l)&&n.push(l)}}catch(e){r=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw o}}return n},t.roundRect=function(e,t,n,a,r,i,o){e.beginPath(),e.moveTo(t+i,n),e.lineTo(t+a-i,n),e.quadraticCurveTo(t+a,n,t+a,n+i),e.lineTo(t+a,n+r-i),e.quadraticCurveTo(t+a,n+r,t+a-i,n+r),e.lineTo(t+i,n+r),e.quadraticCurveTo(t,n+r,t,n+r-i),e.lineTo(t,n+i),e.quadraticCurveTo(t,n,t+i,n),e.closePath(),"stroke"===o?e.stroke():e.fill()}),g=(t.drawUserName=function(e){var t=e.ctx,n=e.account,a=e.scale,r=e.px,i=e.py,o=e.bgColor,s=e.fontSize,u=void 0===s?24:s,l=e.textPadding,c=void 0===l?15:l,d=e.rectMarginBottom,p=void 0===d?15:d,h=e.radius,g=void 0===h?10:h,v=(u+12)/a;c/=a,p/=a,u/=a,g/=a;var y="white"===o||"rgb(255,255,255)"===o||"#ffffff"===o||"#fff"===o?"black":"white";t.beginPath(),t.font=u+"px Arial";var m=t.measureText(n).width;t.fillStyle=o,f(t,r-m/2-c,i-p-v,m+2*c,v,g,"fill"),t.fillStyle=y,t.textAlign="left",t.textBaseline="middle",t.fillText(n,r-m/2,i-p-v/2)},t.transformPropertyOverwriteOp=function(e,t){var n=(0,r.default)({},e.data);for(var a in t)"dependOn"!==a&&(n[a]=t[a]);return"text"===e.data.type&&(n.dx=0,n.dy=0,n.scaleX={coordinate:0,factor:1},n.scaleY={coordinate:0,factor:1},n.xFactor=1,n.yFactor=1,n.mat=void 0),(0,r.default)({},e,{data:n})},t.filterNonMediaOpIds=function(e,t){return t.filter((function(t){if(e.drawOpsOfPage.hasOwnProperty(t)){var n=e.drawOpsOfPage[t];if("audio"!==n.data.type&&"video"!==n.data.type)return!0}return!1}))},t.getElementPartOutOfContainer=function(e,t){var n=e.sx,a=e.sy,r=n+e.w,i=a+e.h,o=t.getContainerWorldRect(),s=Math.max(0,o.centerX-o.width/2-n),u=Math.max(0,r-(o.centerX+o.width/2)),l=Math.max(0,o.centerY-o.height/2-a),c=Math.max(0,i-(o.centerY+o.height/2));return s>0||u>0||l>0||c>0?{left:s,right:u,top:l,bottom:c}:null}),v=(t.updateDocClipPath=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e=(0,s.getTransformedBoundary)(t.scale,{boundary:e});var r=g(e,t);r&&n?n.style.clipPath="inset("+r.top/a+"px "+r.right/a+"px "+r.bottom/a+"px "+r.left/a+"px)":n&&(n.style.clipPath="none")},t.getVecAngle=function(e,t,n){var a=[e[0]-n[0],e[1]-n[1]],r=[t[0]-n[0],t[1]-n[1]],i=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=Math.sqrt(r[0]*r[0]+r[1]*r[1]),s=a[0]*r[1]-a[1]*r[0],u=Math.acos((a[0]*r[0]+a[1]*r[1])/i/o);return s>0?u:2*Math.PI-u},t.getSortedDrawOpIds=function(e){var t=(0,a.default)(e);return t=t.sort((function(t,n){var a="audio"===e[t].data.type||"video"===e[t].data.type,r="audio"===e[n].data.type||"video"===e[n].data.type;if(a&&e[t].data.layer)return e[t].data.layer>0?1:-1;if(r&&e[n].data.layer)return e[n].data.layer>0?-1:1;var i=u.LayerOrder[e[t].data.type]||0,o=u.LayerOrder[e[n].data.type]||0;return i!==o?i-o:(e[t].data.layer||e[t].time)-(e[n].data.layer||e[n].time)}))});t.getAuxSensitivity=function(e){return e<1?1:1+Math.log(e)/1.38},t.convertWinTxtToUnixTxt=function(e){return(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},t.extendCameraToSnap=function(e){var t=e.app,n=e.boundary,a=e.pad,r=void 0===a?20:a,i=t.getCameraBound(),o={sx:i.centerX-i.width/2,sy:i.centerY-i.height/2,ex:i.centerX+i.width/2,ey:i.centerY+i.height/2},s=!1;return n.sx<o.sx&&(s=!0,o.sx=n.sx-r),n.sy<o.sy&&(s=!0,o.sy=n.sy-r),n.sx+n.w>o.ex&&(s=!0,o.ex=n.sx+n.w+r),n.sy+n.h>o.ey&&(s=!0,o.ey=n.sy+n.h+r),{needAdjust:s,camera:{centerX:o.sx/2+o.ex/2,centerY:o.sy/2+o.ey/2,width:o.ex-o.sx,height:o.ey-o.sy}}},t.padPt=function(e,t){return e},t.linkSelectOnly=function(e,t){var n,a;return 1===e.length&&"link"===(null===(a=null===(n=t[e[0]])||void 0===n?void 0:n.data)||void 0===a?void 0:a.type)}},function(e,t,n){var a=n(83)("wks"),r=n(69),i=n(15).Symbol,o="function"==typeof i;(e.exports=function(e){return a[e]||(a[e]=o&&i[e]||(o?i:r)("Symbol."+e))}).store=a},function(e,t,n){e.exports={default:n(188),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var a,r=n(72),i=(a=r)&&a.__esModule?a:{default:a};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(36)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){e.exports={default:n(161),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultFont=void 0;var a=s(n(7)),r=s(n(0)),i=s(n(1)),o=n(29);function s(e){return e&&e.__esModule?e:{default:e}}var u=t.DefaultFont="Helvetica",l=new(function(){function e(){(0,r.default)(this,e),this.pointsPerBatch=1,this.linkDef={dash:o.IDashType.Solid,linkType:o.ILinkType.Segment,text:{stroke:"black",fontSize:16,fontFamily:u},stroke:"black",lineWidth:1,startArrow:o.IArrowType.None,endArrow:o.IArrowType.Arrow},this.shapeDef={lineWidth:1,stroke:"rgb(0, 0, 0)",fill:void 0,text:{fontSize:16,fontFamily:u,stroke:"rgb(0, 0, 0)",fill:void 0,textAlign:"center",verticalAlign:"middle"},dash:o.IDashType.Solid},this.penDef={lineWidth:5,stroke:"rgb(0, 0, 0)"},this.textDef={fontSize:16,fontFamily:u,stroke:"rgb(0, 0, 0)",fill:void 0,textAlign:"left"}}return(0,i.default)(e,[{key:"init",value:function(){this.linkDef={dash:o.IDashType.Solid,linkType:o.ILinkType.Segment,text:{stroke:"black",fontSize:16,fontFamily:u},stroke:"black",lineWidth:1,startArrow:o.IArrowType.None,endArrow:o.IArrowType.Arrow},this.shapeDef={lineWidth:1,stroke:"rgb(0, 0, 0)",fill:void 0,text:{fontSize:16,fontFamily:u,stroke:"rgb(0, 0, 0)",fill:void 0,textAlign:"center",verticalAlign:"middle"},dash:o.IDashType.Solid},this.penDef={lineWidth:5,stroke:"rgb(0, 0, 0)"},this.textDef={fontSize:16,fontFamily:u,stroke:"rgb(0, 0, 0)",fill:void 0,textAlign:"left"}}},{key:"updateDefAttr",value:function(e,t,n){var r=this,i=function(e,t){var n,i,o,s=void 0,l=e.data,c="shape"===l.type||"link"===l.type,d=["pen","pen-arrow","line","line-arrow"];"shape"===e.data.type?s={lineWidth:l.lineWidth,stroke:l.stroke,fill:l.fill,dash:l.dash,text:l.text}:"text"===e.data.type?s={fontSize:l.fontSize,fontFamily:l.fontFamily,stroke:l.stroke,fill:l.fill,textAlign:l.textAlign}:-1!==d.indexOf(e.data.type)?s={lineWidth:l.lineWidth,stroke:l.stroke}:"link"===e.data.type&&(s={dash:l.dash,linkType:l.linkType,text:{stroke:(null===(n=l.text)||void 0===n?void 0:n.stroke)||"black",fontSize:(null===(i=l.text)||void 0===i?void 0:i.fontSize)||16,fontFamily:(null===(o=l.text)||void 0===o?void 0:o.fontFamily)||u},stroke:l.stroke,lineWidth:l.lineWidth,startArrow:l.start.aType,endArrow:l.end.aType});var p=!0,h=!1,f=void 0;try{for(var g,v=(0,a.default)(t);!(p=(g=v.next()).done);p=!0){var y=g.value;-1!==["fontStroke","fontFill","textAlign","verticalAlign","fontSize","fontFamily"].indexOf(y.k)&&c?-1!==["fontStroke","fontFill"].indexOf(y.k)?s.text[y.k.slice(4).toLowerCase()]=y.v:s.text[y.k]=y.v:"link"===e.data.type&&"start"===y.k&&y.v.hasOwnProperty("aType")?s.startArrow=y.v.aType:"link"===e.data.type&&"end"===y.k&&y.v.hasOwnProperty("aType")?s.endArrow=y.v.aType:-1!==["fontStroke","fontFill"].indexOf(y.k)?s[y.k.slice(4).toLowerCase()]=y.v:s[y.k]=y.v}}catch(e){h=!0,f=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw f}}"shape"===e.data.type?r.shapeDef=s:"text"===e.data.type?r.textDef=s:-1!==d.indexOf(e.data.type)?r.penDef=s:"link"===e.data.type&&(r.linkDef=s)},o=!0,s=!1,l=void 0;try{for(var c,d=(0,a.default)(t);!(o=(c=d.next()).done);o=!0){i(c.value,n)}}catch(e){s=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw l}}this.notify(e)}},{key:"notify",value:function(e){e.emit("event:appState:change","styleUpdate",this.getDefStyles())}},{key:"getDefStyles",value:function(){return{pen:this.penDef,link:this.linkDef,shape:this.shapeDef,text:this.textDef}}},{key:"updateFontFamily",value:function(e,t){this.textDef.fontFamily=t,this.linkDef.text.fontFamily=t,this.shapeDef.text.fontFamily=t,this.notify(e)}}]),e}());t.default=l},function(e,t,n){var a=n(26),r=n(109),i=n(78),o=Object.defineProperty;t.f=n(21)?Object.defineProperty:function(e,t,n){if(a(e),t=i(t,!0),a(n),r)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";t.__esModule=!0;var a=i(n(2)),r=i(n(290));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function e(t,n,i){null===t&&(t=Function.prototype);var o=(0,r.default)(t,n);if(void 0===o){var s=(0,a.default)(t);return null===s?void 0:e(s,n,i)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(i):void 0}},function(e,t,n){var a=n(20);e.exports=function(e){if(!a(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";t.__esModule=!0;var a=o(n(152)),r=o(n(115)),i="function"==typeof r.default&&"symbol"==typeof a.default?function(e){return typeof e}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof r.default&&"symbol"===i(a.default)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof r.default&&e.constructor===r.default&&e!==r.default.prototype?"symbol":void 0===e?"undefined":i(e)}},function(e,t,n){e.exports=n(267)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.exLinkTypes=["link","audio"];var a=t.ILinkType=void 0;!function(e){e[e.Line=0]="Line",e[e.Curve=1]="Curve",e[e.Segment=2]="Segment"}(a||(t.ILinkType=a={}));var r=t.IDashType=void 0;!function(e){e[e.Solid=0]="Solid",e[e.Dashed=1]="Dashed"}(r||(t.IDashType=r={}));var i=t.IConnPointType=void 0;!function(e){e[e.Split=0]="Split",e[e.Anchor=1]="Anchor"}(i||(t.IConnPointType=i={}));var o=t.IArrowType=void 0;!function(e){e[e.None=0]="None",e[e.Arrow=1]="Arrow"}(o||(t.IArrowType=o={}));var s=t.DIRECTION=void 0;!function(e){e[e.RIGHT=0]="RIGHT",e[e.DOWN=1]="DOWN",e[e.UP=2]="UP",e[e.LEFT=3]="LEFT"}(s||(t.DIRECTION=s={}));var u=t.IEndPointType=void 0;!function(e){e[e.COORD=0]="COORD",e[e.ATTACH=1]="ATTACH",e[e.FLEX=2]="FLEX"}(u||(t.IEndPointType=u={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.rotateMat=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[1,0,0],[0,1,0],[0,0,1]],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{angle:0,x:0,y:0},n=t.angle,i=t.x,o=t.y;if(0===n)return e;var s=a(e,-i,-o);return s=r([[Math.cos(n),-Math.sin(n),0],[Math.sin(n),Math.cos(n),0],[0,0,1]],s),s=a(s,i,o)};var a=t.panMat=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[1,0,0],[0,1,0],[0,0,1]],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r([[1,0,t],[0,1,n],[0,0,1]],e)},r=(t.scaleMat=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[1,0,0],[0,1,0],[0,0,1]],t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{coordinate:0,factor:1},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{coordinate:0,factor:1},o=e;return o=a(o,-n.coordinate,-i.coordinate),t&&(o=r([[Math.cos(t),Math.sin(t),0],[-Math.sin(t),Math.cos(t),0],[0,0,1]],o)),o=r([[n.factor,0,0],[0,i.factor,0],[0,0,1]],o),t&&(o=r([[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]],o)),o=a(o,n.coordinate,i.coordinate)},t.matProd=function(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1],e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2]],[e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1],e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2]],[e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0],e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1],e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]]]});t.getTransPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[[1,0,0],[0,1,0],[0,0,1]];return[t[0][0]*e[0]+t[0][1]*e[1]+t[0][2],t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]]}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeToastIntercept=exports.interceptShowToast=exports.hideToast=exports.showToast=void 0;var _typeof2=__webpack_require__(27),_typeof3=_interopRequireDefault(_typeof2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_stringify=__webpack_require__(22),_stringify2=_interopRequireDefault(_stringify),_classCallCheck2=__webpack_require__(0),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_toastCtrl=__webpack_require__(219),_toastCtrl2=_interopRequireDefault(_toastCtrl);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var ToastClass=function ToastClass(){var _this=this;(0,_classCallCheck3.default)(this,ToastClass),this.show=function(e){var t=e.msg,n=e.time,a=void 0===n?2:n,r=e.type,i=void 0===r?"info":r,o=e.top,s=void 0===o?30:o,u={msgType:e.msgType,args:e.args,msg:t.constructor===String?t:(0,_stringify2.default)(t),time:a,type:i,top:s};if("function"==typeof _this.interceptShowFn){var l=_this.interceptShowFn((0,_assign2.default)({},u));if(!l)return;"object"===(void 0===l?"undefined":(0,_typeof3.default)(l))&&(u=l)}u&&_toastCtrl2.default.show(u)},this.hide=function(){if("function"==typeof _this.interceptHideFn&&!_this.interceptHideFn())return;_toastCtrl2.default.hide()},this.interceptShow=function(fn){if("string"==typeof fn)try{fn=eval(fn)}catch(e){return console.error(e),void console.error("interceptShowToast如果参数为string，该string需要能够被eval解析: "+fn)}"function"!=typeof fn?console.error("interceptShowToast的参数必须为函数"):_this.interceptShowFn=fn},this.interceptHide=function(e){"function"!=typeof e?console.error("Toast.interceptHide的参数必须为函数"):_this.interceptHideFn=e},this.removeIntercept=function(){_this.interceptShowFn=void 0,_this.interceptHideFn=void 0}};window.__newb__=window.__newb__||{},window.__newb__.Toast||(window.__newb__.Toast=new ToastClass);var showToast=exports.showToast=window.__newb__.Toast.show,hideToast=exports.hideToast=window.__newb__.Toast.hide,interceptShowToast=exports.interceptShowToast=window.__newb__.Toast.interceptShow,removeToastIntercept=exports.removeToastIntercept=window.__newb__.Toast.removeIntercept},function(e,t,n){var a=n(48);e.exports=function(e,t,n){if(a(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,r){return e.call(t,n,a,r)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={SYNCHRONIZING:"SYNCHRONIZING",ON_CONNECTED:"ON_CONNECTED",ON_WILL_RECONNECT:"ON_WILL_RECONNECT",ON_DISCONNECTED:"ON_DISCONNECTED",NETWORK_INSTABLE:"NETWORK_INSTABLE",SYNC_FAIL:"SYNC_FAIL",DELAY_DISPATCH_WHILE_NETWORK_INSTABLE:"DELAY_DISPATCH_WHILE_NETWORK_INSTABLE",START_BROADCAST:"START_BROADCAST",STOP_BROADCAST:"STOP_BROADCAST",SWITCH_TO_FOLLOWER:"SWITCH_TO_FOLLOWER",SWITCH_TO_FREE_OBSERVER:"SWITCH_TO_FREE_OBSERVER",NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER:"NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER",NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER:"NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER",RECEIVE_STOP_BROADCAST:"RECEIVE_STOP_BROADCAST",RECEIVE_START_BROADCAST:"RECEIVE_START_BROADCAST",CURRENT_USER_IS_BROADCASTER:"CURRENT_USER_IS_BROADCASTER",CURRENT_USER_IS_FOLLOWER:"CURRENT_USER_IS_FOLLOWER",CURRENT_USER_IS_FREE_OBSERVER:"CURRENT_USER_IS_FREE_OBSERVER",FILE_IS_EMPTY:"FILE_IS_EMPTY",FILE_SIZE_EXCEED_LIMIT:"FILE_SIZE_EXCEED_LIMIT",FILE_ACCEPTED_TYPE_LIMIT:"FILE_ACCEPTED_TYPE_LIMIT",FILE_UPLOAD_FAIL:"FILE_UPLOAD_FAIL",FILE_IS_UPLOADING:"FILE_IS_UPLOADING",FILE_TRANSCODE_SUCCEED:"FILE_TRANSCODE_SUCCEED",FILE_TRANSCODE_FAIL:"FILE_TRANSCODE_FAIL",VIDEO_UPLOAD_FAIL:"VIDEO_UPLOAD_FAIL",AUDIO_UPLOAD_FAIL:"AUDIO_UPLOAD_FAIL",VIDEO_TYPE_NOT_ALLOWED:"VIDEO_TYPE_NOT_ALLOWED",AUDIO_TYPE_NOT_ALLOWED:"AUDIO_TYPE_NOT_ALLOWED",PIC_UPLOAD_FAIL:"PIC_UPLOAD_FAIL",LOG_FILE_UPLOAD_THROTTLE:"LOG_FILE_UPLOAD_THROTTLE",LOG_FILE_IS_UPLOADING:"LOG_FILE_IS_UPLOADING",LOG_FILE_UPLOAD_SUCCEED:"LOG_FILE_UPLOAD_SUCCEED",LOG_FILE_UPLOAD_FAIL:"LOG_FILE_UPLOAD_FAIL",ONE_MEDIA_LIMIT:"ONE_MEDIA_LIMIT",IOS_NOT_SUPPORT_TEXT:"IOS_NOT_SUPPORT_TEXT",PASTE_IMG_UPLOAD_ERROR:"PASTE_IMG_UPLOAD_ERROR",PASTE_IMG_UPLOAD_WAIT:"PASTE_IMG_UPLOAD_WAIT"}},,function(e,t,n){var a=n(24),r=n(53);e.exports=n(21)?function(e,t,n){return a.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){e.exports={default:n(192),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var a=i(n(269)),r=i(n(7));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,a.default)(Object(e)))return function(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var s,u=(0,r.default)(e);!(a=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShapeDataFromExist=t.mergeIntervals=t.getDistDivideByDir=t.isConnAllHV=t.getConnH=t.getDirAftRotate=t.getLinkNewTextPer=t.bezierMinMax=t.isCurveSegIntersect=t.getLinkBoundary=t.getCurveLinkBoundary=t.getNewShape=t.deepCopySnapBeforeMove=t.getPosAftMove=t.findEndPoint=t.findAttachPer=t.projOnSeg=t.pDist=t.getDirInShape=t.getPosInShape=t.getInitDir=t.selectShapeForLink=t.moveNonSegConnPoint=t.getControlPoints=t.getEndPointInfo=t.isSegInRect=t.isPInsideRect=t.getExtP=t.isPExtentFrom=t.pointAtExtendDir=t.getLinkEndPos=void 0;var a=m(n(27)),r=m(n(19)),i=m(n(38)),o=m(n(7)),s=m(n(5)),u=m(n(37)),l=n(13),c=n(30),d=n(138),p=m(n(23)),h=n(29),f=m(n(141)),g=n(65),v=n(16),y=n(76);function m(e){return e&&e.__esModule?e:{default:e}}var M=new u.default,x=(t.getLinkEndPos=function(e,t,n,a){if(t.type===h.IEndPointType.COORD)return{x:t.x,y:t.y,dir:t.dir};var r=n.localOps[t.id]||n.drawOpsOfPage[t.id];return!r&&a&&(r=null==a?void 0:a.drawOpQueue[t.id]),r?(0,s.default)((0,s.default)({},T(e,r.data,t.per)),{dir:t.dir}):(M.has(t.id)||(e.logger.error("link attached element id: "+t.id+" not found"),M.add(t.id),e.dataReportUtil("v3_run_error",{error:{code:y.DataReportRunError.Link_Id_Miss,message:"link attached element id: "+t.id+" not found"}})),null)},t.pointAtExtendDir=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];switch(n){case h.DIRECTION.UP:return t.y<=e.y&&(!r||Math.abs(e.x-t.x)<g.POINT_EXTEND_THRES/a);case h.DIRECTION.DOWN:return t.y>=e.y&&(!r||Math.abs(e.x-t.x)<g.POINT_EXTEND_THRES/a);case h.DIRECTION.RIGHT:return t.x>=e.x&&(!r||Math.abs(e.y-t.y)<g.POINT_EXTEND_THRES/a);case h.DIRECTION.LEFT:return t.x<=e.x&&(!r||Math.abs(e.y-t.y)<g.POINT_EXTEND_THRES/a)}return!0},t.isPExtentFrom=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.dir===h.DIRECTION.RIGHT?t.x>=e.x-n:e.dir===h.DIRECTION.LEFT?t.x<=e.x+n:e.dir===h.DIRECTION.UP?t.y<=e.y+n:e.dir===h.DIRECTION.DOWN&&t.y>=e.y-n},t.getExtP=function(e,t,n){if(e.dir===h.DIRECTION.RIGHT)return{x:Math.max(e.x+t,n.sx+n.w),y:e.y,dir:e.dir};if(e.dir===h.DIRECTION.LEFT)return{x:Math.min(e.x-t,n.sx),y:e.y,dir:e.dir};if(e.dir===h.DIRECTION.UP)return{x:e.x,y:Math.min(e.y-t,n.sy),dir:e.dir};if(e.dir===h.DIRECTION.DOWN)return{x:e.x,y:Math.max(e.y+t,n.sy+n.h),dir:e.dir};throw new Error("未知的方向: "+e.dir)},t.isPInsideRect=function(e,t){return!w(e,t)},t.isSegInRect=function(e,t,n){var a=w(e,n),r=w(t,n);return!a||!r||!(a&r)&&(I(e,t,[n.sx,n.sy],[n.sx+n.w,n.sy])||I(e,t,[n.sx+n.w,n.sy],[n.sx+n.w,n.sy+n.h])||I(e,t,[n.sx,n.sy+n.h],[n.sx+n.w,n.sy+n.h])||I(e,t,[n.sx,n.sy],[n.sx,n.sy+n.h]))}),w=function(e,t){var n=0;return e[0]<t.sx?n|=1:e[0]>t.sx+t.w&&(n|=2),e[1]>t.sy+t.h?n|=4:e[1]<t.sy&&(n|=8),n},I=function(e,t,n,a){var r=k(e,t,n),i=k(e,t,a),o=k(n,a,e),s=k(n,a,t);return r!==i&&o!==s||(!(0!==r||!b(e,n,t))||(!(0!==i||!b(e,n,a))||(!(0!==o||!b(n,e,a))||!(0!==s||!b(n,e,a)))))},b=function(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])},k=function(e,t,n){var a=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===a?0:a>0?1:2},T=t.getEndPointInfo=function(e,t,n){n-=Math.floor(n);var a=C(e,t.shape,n,(0,l.getTransformedSize)(t)),r=t.boundary,i=[r.sx+r.w*a[0],r.sy+r.h*a[1]],o=(0,c.getTransPoint)(i,t.mat);return{x:o[0],y:o[1]}},_=(t.getControlPoints=function(e,t,n,a,r,i,o){var s=Math.sqrt(Math.pow(n-e,2)+Math.pow(a-t,2)),u=o*s/(s+Math.sqrt(Math.pow(r-n,2)+Math.pow(i-a,2))),l=o-u,c=n+u*(e-r),d=a+u*(t-i),p=n-l*(e-r),h=a-l*(t-i);return isNaN(c)||isNaN(d)||isNaN(p)||isNaN(h)?[[e,t],[r,i]]:[[c,d],[p,h]]},t.moveNonSegConnPoint=function(e){var t=e.startPos,n=e.endPos,a=e.connPs,r=e.index,i=e.x,o=e.y,u=((a=a.map((function(e){return(0,s.default)({},e)})))[r],a.slice());if(a[r].type===h.IConnPointType.Split){u.splice(r,1);var l=a[r-1]||t,c=a[r+1]||n;u.splice(r,0,{type:h.IConnPointType.Split,x:i/2+l.x/2,y:o/2+l.y/2},{type:h.IConnPointType.Anchor,x:i,y:o},{type:h.IConnPointType.Split,x:i/2+c.x/2,y:o/2+c.y/2})}else{var d=a[r-2]||t,p=a[r+2]||n;u[r-1]=(0,s.default)((0,s.default)({},u[r-1]),{x:i/2+d.x/2,y:o/2+d.y/2}),u[r]=(0,s.default)((0,s.default)({},u[r]),{x:i,y:o}),u[r+1]=(0,s.default)((0,s.default)({},u[r+1]),{x:i/2+p.x/2,y:o/2+p.y/2})}return{connPs:u,start:t,end:n}},t.selectShapeForLink=function(e){var t=e.linkData,n=e.linkId,a=e.app,r=e.op,i=e.where,o="start"===i?t.start:t.end;if(o.type===h.IEndPointType.COORD){var s=a.camera.convertWorldPointInContainer(o.x,o.y);a.shapeSelector.showPopup({x:s[0],y:s[1],onSelect:function(e){var o="start"===i?t.start:t.end,s=_(o.dir),u=S(a,{shapeType:e,link:t,where:i,drawOpQueue:r.drawOpsOfPage,scale:a.scale,per:s}),l=r.dispatch(u);r.dispatch(r.opsManager.modifyOp.getSnapshot([n],[{k:i,v:{type:h.IEndPointType.ATTACH,id:l,per:s,dir:o.dir,aType:o.aType,reset:!0}}],!1));var c=(0,v.extendCameraToSnap)({app:a,boundary:u.boundary}),d=c.needAdjust,p=c.camera;d&&a.setCameraBound(p,!0),"text"===e&&r.opsManager.textOp.enterEdit({snap:{opId:l,data:u}})}})}},function(e){switch(e){case h.DIRECTION.LEFT:return 7/8;case h.DIRECTION.RIGHT:return 3/8;case h.DIRECTION.UP:return 1/8;default:return 5/8}}),C=(t.getInitDir=function(e,t){var n=t.x-e.x,a=t.y-e.y;if(0===a)return n>=0?h.DIRECTION.LEFT:h.DIRECTION.RIGHT;var r=n/a;return Math.abs(r)>1?n>=0?h.DIRECTION.LEFT:h.DIRECTION.RIGHT:a>=0?h.DIRECTION.UP:h.DIRECTION.DOWN},t.getPosInShape=function(e,t,n,a){var r=e.ShapeDesc[t],i=r?r.path:e.ShapeDesc.rect.path;i="function"==typeof i?i(a.w,a.h):i,n-=Math.floor(n);var s=!0,u=!1,l=void 0;try{for(var c,d=(0,o.default)(i);!(s=(c=d.next()).done);s=!0){var p=c.value,h=n<=p.per[1]&&n>=p.per[0];if(p.per[0]<0&&(h=h||n>=p.per[0]+1),h){var f=void 0;if(f=n<=p.per[1]?(n-p.per[0])/(p.per[1]-p.per[0]):(n-1-p.per[0])/(p.per[1]-p.per[0]),"l"===p.t){var g=p.pos;return[g[0][0]*(1-f)+g[1][0]*f,g[0][1]*(1-f)+g[1][1]*f]}if("b"===p.t){var v=p.pos;if(4===v.length)return[v[0][0]*(1-f)*(1-f)*(1-f)+3*v[1][0]*(1-f)*(1-f)*f+3*v[2][0]*(1-f)*f*f+v[3][0]*f*f*f,v[0][1]*(1-f)*(1-f)*(1-f)+3*v[1][1]*(1-f)*(1-f)*f+3*v[2][1]*(1-f)*f*f+v[3][1]*f*f*f];if(3===v.length)return[v[0][0]*(1-f)*(1-f)+2*v[1][0]*(1-f)*f+v[2][0]*f*f,v[0][1]*(1-f)*(1-f)+2*v[1][1]*(1-f)*f+v[2][1]*f*f]}}}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}return[0,0]}),N=t.getDirInShape=function(e,t,n){var a=e.ShapeDesc[t],r=a?a.dir:e.ShapeDesc.rect.dir;n-=Math.floor(n);var i=!0,s=!1,u=void 0;try{for(var l,c=(0,o.default)(r);!(i=(l=c.next()).done);i=!0){var d=l.value,p=n<=d.per[1]&&n>=d.per[0];if(d.per[0]<0&&(p=p||n>=d.per[0]+1),p)return d.angle}}catch(e){s=!0,u=e}finally{try{!i&&c.return&&c.return()}finally{if(s)throw u}}return h.DIRECTION.RIGHT},A=t.pDist=function(e,t,n){var a,r,o=(0,i.default)(e,2),s=o[0],u=o[1],l=(0,i.default)(t,2),c=l[0],d=l[1],p=(0,i.default)(n,2),h=p[0],f=p[1],g=h-c,v=f-d,y=g*g+v*v,m=-1;0!=y&&(m=((s-c)*g+(u-d)*v)/y),m<0?(a=c,r=d):m>1?(a=h,r=f):(a=c+m*g,r=d+m*v);var M=s-a,x=u-r;return Math.sqrt(M*M+x*x)},P=t.projOnSeg=function(e,t,n,a){var r=[n[0]-t[0],n[1]-t[1]],i=[e[0]-t[0],e[1]-t[1]],o=(r[0]*i[0]+r[1]*i[1])/(r[0]*r[0]+r[1]*r[1]);return a?Math.min(Math.max(o,0),1):o},O=t.findAttachPer=function(e,t){var n=t.scale,a=t.data,r=t.mx,i=t.my,s=e.ShapeDesc[a.shape]||e.ShapeDesc.rect,u=(0,l.getTransformedSize)(a),d="function"==typeof s.path?s.path(u.w,u.h):s.path,p=a.boundary,h=g.ATTCH_THRES/n,f=-1,v=!0,y=!1,m=void 0;try{for(var M,x=(0,o.default)(d);!(v=(M=x.next()).done);v=!0){var w=M.value,I=void 0,b=void 0,k=void 0;if("l"===w.t){if(b=(0,c.getTransPoint)([p.sx+p.w*w.pos[0][0],p.sy+p.h*w.pos[0][1]],a.mat),k=(0,c.getTransPoint)([p.sx+p.w*w.pos[1][0],p.sy+p.h*w.pos[1][1]],a.mat),(I=A([r,i],b,k))<h){h=I;var T=P([r,i],b,k,!0);(f=w.per[0]+T*(w.per[1]-w.per[0]))<1&&(f+=1)}}else{var _=w.pos[w.pos.length-1];if(b=(0,c.getTransPoint)([p.sx+p.w*w.pos[0][0],p.sy+p.h*w.pos[0][1]],a.mat),k=(0,c.getTransPoint)([p.sx+p.w*_[0],p.sy+p.h*_[1]],a.mat),(I=A([r,i],b,k))<10*g.ATTCH_THRES/n)for(var C=w.pos[0],N=1;N<=10;N++){var O=N/10,D=[w.pos[0][0]*(1-O)*(1-O)*(1-O)+3*w.pos[1][0]*(1-O)*(1-O)*O+3*w.pos[2][0]*(1-O)*O*O+_[0]*O*O*O,w.pos[0][1]*(1-O)*(1-O)*(1-O)+3*w.pos[1][1]*(1-O)*(1-O)*O+3*w.pos[2][1]*(1-O)*O*O+_[1]*O*O*O];if(b=(0,c.getTransPoint)([p.sx+p.w*C[0],p.sy+p.h*C[1]],a.mat),k=(0,c.getTransPoint)([p.sx+p.w*D[0],p.sy+p.h*D[1]],a.mat),I=A([r,i],b,k),C=D,I<h){h=I;var S=P([r,i],b,k,!0);(f=w.per[0]+(w.per[1]-w.per[0])*((N-1)/10+S/10))<0&&(f+=1)}}}}}catch(e){y=!0,m=e}finally{try{!v&&x.return&&x.return()}finally{if(y)throw m}}return f>0?f:void 0},D=(t.findEndPoint=function(e,t){var n=t.scale,a=t.drawOps,r=t.mx,i=t.my;for(var o in a){var s=a[o],u=s.data;if(-1===h.exLinkTypes.indexOf(s.data.type)){var l=O(e,{scale:n,data:s.data,mx:r,my:i});if(void 0!==l){l=D(l);var c=N(e,s.data.shape,l);return{opId:o,per:l,dir:L(c,u.rAngle,u.xFactor,u.yFactor)}}}}},function(e){var t=(8*e-1)/2;return Math.abs(t-Math.round(t))<.025?(2*Math.round(t)+1)/8:e}),S=(t.getPosAftMove=function(e,t){if("move"===t.type)return[e[0]+t.ep[0]-t.sp[0],e[1]+t.ep[1]-t.sp[1]];if("scale"===t.type){var n=t.scaleInfo,a=(0,c.scaleMat)(void 0,0,n.scaleX,n.scaleY);return(0,c.getTransPoint)(e,a)}var r=t.rotate,i=(0,c.rotateMat)(void 0,r);return(0,c.getTransPoint)(e,i)},t.deepCopySnapBeforeMove=function(e,t){var n={},a=!0,r=!1,i=void 0;try{for(var s,u=(0,o.default)(e);!(a=(s=u.next()).done);a=!0){var l=s.value;n[l]=(0,f.default)(t[l])}}catch(e){r=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw i}}var c=[];for(var d in t)if("link"===t[d].data.type){var p=t[d].data.start.id,h=t[d].data.end.id;-1===e.indexOf(d)&&-1===e.indexOf(p)&&-1===e.indexOf(h)||c.push(d)}var g=!0,v=!1,y=void 0;try{for(var m,M=(0,o.default)(c);!(g=(m=M.next()).done);g=!0){var x=m.value,w=t[x].data,I=w.start.id,b=w.end.id;t[I]&&t[b]?(n.hasOwnProperty(x)||(n[x]=(0,f.default)(t[x])),I&&!n.hasOwnProperty(I)&&(n[I]=(0,f.default)(t[I])),b&&!n.hasOwnProperty(b)&&(n[b]=(0,f.default)(t[b]))):delete n[x]}}catch(e){v=!0,y=e}finally{try{!g&&M.return&&M.return()}finally{if(v)throw y}}return n},t.getNewShape=function(e,t){var n="start"===t.where?t.link.start:t.link.end,a="start"===t.where?t.link.end:t.link.start,r=a.id?t.drawOpQueue[a.id]:void 0,i=r&&"text"===r.data.type?r.data:void 0,o=void 0,s=void 0;if(r&&"text"!==t.shapeType){var u=(0,l.getTransformedSize)(r.data);o=u.w,s=u.h}else if("text"===t.shapeType){var c=e.opsManager.textOp.getTextSize({text:d.DefaultText,fontSize:i?i.fontSize:p.default.textDef.fontSize,fontFamily:i?i.fontFamily:p.default.textDef.fontFamily});o=c.w,s=c.h}else o=100,s=100;var h=C(e,t.shapeType,t.per,{w:o,h:s}),f=n.x-o*h[0],g=n.y-s*h[1];return z({sx:f,sy:g,w:o,h:s,shapeType:t.shapeType,another:null==r?void 0:r.data})}),E=(t.getCurveLinkBoundary=function(e){var t=e.points,n=e.textBoundaries,a=[].concat((0,r.default)(e.startArrow||[]),(0,r.default)(e.endArrow||[])),i=Math.min(t[0][0],t[1][0]),s=Math.min(t[0][1],t[1][1]),u=Math.max(t[0][0],t[1][0]),l=Math.max(t[0][1],t[1][1]),c=!0,d=!1,p=void 0;try{for(var h,f=(0,o.default)(a);!(c=(h=f.next()).done);c=!0){var g=h.value;i=Math.min(i,g[0]),u=Math.max(u,g[0]),s=Math.min(s,g[1]),l=Math.max(l,g[1])}}catch(e){d=!0,p=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw p}}if((t.length-1)%3==0)for(var v=0;v<t.length-3;v+=3){var y=j(t[v],t[v+1],t[v+2],t[v+3]);i=Math.min(i,y.min.x),s=Math.min(s,y.min.y),u=Math.max(u,y.max.x),l=Math.max(l,y.max.y)}var m=!0,M=!1,x=void 0;try{for(var w,I=(0,o.default)(n);!(m=(w=I.next()).done);m=!0){var b=w.value;i=Math.min(i,b.sx),u=Math.max(u,b.sx+b.w),s=Math.min(s,b.sy),l=Math.max(l,b.sy+b.h)}}catch(e){M=!0,x=e}finally{try{!m&&I.return&&I.return()}finally{if(M)throw x}}return{sx:i,sy:s,w:Math.max(u-i,1),h:Math.max(l-s,1)}},t.getLinkBoundary=function(e){var t=e.start,n=e.end,a=e.connPs,i=e.textBoundaries,s=[].concat((0,r.default)(e.startArrow||[]),(0,r.default)(e.endArrow||[])),u=t.x,l=t.y,c=t.x,d=t.y,p=!0,h=!1,f=void 0;try{for(var g,v=(0,o.default)(a);!(p=(g=v.next()).done);p=!0){var y=g.value;u=Math.min(u,y.x),c=Math.max(c,y.x),l=Math.min(l,y.y),d=Math.max(d,y.y)}}catch(e){h=!0,f=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw f}}var m=!0,M=!1,x=void 0;try{for(var w,I=(0,o.default)(s);!(m=(w=I.next()).done);m=!0){var b=w.value;u=Math.min(u,b[0]),c=Math.max(c,b[0]),l=Math.min(l,b[1]),d=Math.max(d,b[1])}}catch(e){M=!0,x=e}finally{try{!m&&I.return&&I.return()}finally{if(M)throw x}}var k=!0,T=!1,_=void 0;try{for(var C,N=(0,o.default)(i);!(k=(C=N.next()).done);k=!0){var A=C.value;u=Math.min(u,A.sx),c=Math.max(c,A.sx+A.w),l=Math.min(l,A.sy),d=Math.max(d,A.sy+A.h)}}catch(e){T=!0,_=e}finally{try{!k&&N.return&&N.return()}finally{if(T)throw _}}return u=Math.min(u,n.x),c=Math.max(c,n.x),l=Math.min(l,n.y),d=Math.max(d,n.y),{sx:u,sy:l,w:Math.max(c-u,1),h:Math.max(d-l,1)}},t.isCurveSegIntersect=function(e){var t=e.curve,n=e.seg,a=E.apply(void 0,(0,r.default)(e.curve));if(x(n[0],n[1],{sx:a.min.x,sy:a.min.y,w:a.max.x-a.min.x,h:a.max.y-a.min.y})){for(var i=t[0],o=1;o<=20;o++){var s=o/20,u=[t[0][0]*(1-s)*(1-s)*(1-s)+3*t[1][0]*s*(1-s)*(1-s)+3*t[2][0]*s*s*(1-s)+t[3][0]*s*s*s,t[0][1]*(1-s)*(1-s)*(1-s)+3*t[1][1]*s*(1-s)*(1-s)+3*t[2][1]*s*s*(1-s)+t[3][1]*s*s*s];if(I(i,u,n[0],n[1]))return!0;i=u}return!1}return!1},function(e,t,n,a){return{min:{x:Math.min(e[0],t[0],n[0],a[0]),y:Math.min(e[1],t[1],n[1],a[1])},max:{x:Math.max(e[0],t[0],n[0],a[0]),y:Math.max(e[1],t[1],n[1],a[1])}}}),j=t.bezierMinMax=function(e,t,n,a){for(var r=[],i=[],o=[],s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,p=void 0,h=void 0,f=void 0,g=0;g<2;++g)if(0==g?(u=6*e[0]-12*t[0]+6*n[0],s=-3*e[0]+9*t[0]-9*n[0]+3*a[0],l=3*t[0]-3*e[0]):(u=6*e[1]-12*t[1]+6*n[1],s=-3*e[1]+9*t[1]-9*n[1]+3*a[1],l=3*t[1]-3*e[1]),Math.abs(s)<1e-12){if(Math.abs(u)<1e-12)continue;0<(c=-l/u)&&c<1&&r.push(c)}else(h=u*u-4*l*s)<0?Math.abs(h)<1e-12&&0<(c=-u/(2*s))&&c<1&&r.push(c):(0<(d=(-u+(f=Math.sqrt(h)))/(2*s))&&d<1&&r.push(d),0<(p=(-u-f)/(2*s))&&p<1&&r.push(p));for(var v,y=r.length;y--;)v=1-(c=r[y]),i[y]=v*v*v*e[0]+3*v*v*c*t[0]+3*v*c*c*n[0]+c*c*c*a[0],o[y]=v*v*v*e[1]+3*v*v*c*t[1]+3*v*c*c*n[1]+c*c*c*a[1];return i.push(e[0],a[0]),o.push(e[1],a[1]),{min:{x:Math.min.apply(0,i),y:Math.min.apply(0,o)},max:{x:Math.max.apply(0,i),y:Math.max.apply(0,o)}}},L=(t.getLinkNewTextPer=function(e){for(var t=0,n=0,a=1,r=0,i=e.map((function(e){return e.per})).sort(),o=0;o<=i.length;o++){var s=o<i.length?i[o]:1;t<=s-r&&(t=s-r,n=r,a=s),r=s}return n/2+a/2},t.getDirAftRotate=function(e,t,n,a){a=void 0===a?1:a,(n=void 0===n?1:n)<0&&(e===h.DIRECTION.LEFT||e===h.DIRECTION.RIGHT)&&(e=3-e),a<0&&(e===h.DIRECTION.UP||e===h.DIRECTION.DOWN)&&(e=3-e);var r=0;switch(t=t||0,e){case h.DIRECTION.UP:r=Math.PI/2*3;break;case h.DIRECTION.DOWN:r=Math.PI/2;break;case h.DIRECTION.LEFT:r=Math.PI}return r+=t,r/=Math.PI/2,(r%=4)>=.5&&r<1.5?h.DIRECTION.DOWN:r>=1.5&&r<2.5?h.DIRECTION.LEFT:r>=2.5&&r<3.5?h.DIRECTION.UP:h.DIRECTION.RIGHT}),z=(t.getConnH=function(e,t){return((e===h.DIRECTION.LEFT||e===h.DIRECTION.RIGHT?0:1)+t)%2==0},t.isConnAllHV=function(e,t){if(e.length<=1)return!1;for(var n=5/t,a=void 0,r=0;r<e.length-1;r++){var i=e[r],o=e[r+1],s=Math.abs(i.y-o.y)<n,u=Math.abs(i.x-o.x)<n;if(s&&u)return!1;if(!s&&!u)return!1;if(void 0===a)a=s?"h":"v";else{if("h"===a&&s)return!1;if("v"===a&&u)return!1;a=s?"h":"v"}}return!0},t.getDistDivideByDir=function(e,t,n){var a=void 0,r=void 0;return n===h.DIRECTION.LEFT||n===h.DIRECTION.RIGHT?(a=n===h.DIRECTION.LEFT?t[0]-e[0]:e[0]-t[0],r=e[1]-t[1]):(a=n===h.DIRECTION.UP?t[1]-e[1]:e[1]-t[1],r=e[0]-t[0]),{v1:a,v2:r}},t.mergeIntervals=function(e){e=e.sort((function(e,t){return e[0]-t[0]}));for(var t=0,n=1;n<e.length;n++)e[t][1]>=e[n][0]?e[t][1]=Math.max(e[t][1],e[n][1]):e[++t]=e[n];return e.slice(0,t+1)},t.getShapeDataFromExist=function(e){var t=e.sx,n=e.sy,r=e.w,i=e.h,o=e.another,u=e.shapeType;return"text"!==u?(0,s.default)((0,s.default)({type:"shape",shape:u,boundary:{sx:t,sy:n,w:r,h:i},inProgress:!1},"shape"===(null==o?void 0:o.type)?{stroke:o.stroke,fill:o.fill,lineWidth:o.lineWidth,dash:o.dash}:{stroke:p.default.shapeDef.stroke,fill:p.default.shapeDef.fill,lineWidth:p.default.shapeDef.lineWidth,dash:p.default.shapeDef.dash}),{text:"object"===(0,a.default)(null==o?void 0:o.text)&&null!==(null==o?void 0:o.text)?(0,s.default)((0,s.default)({},o.text),{value:""}):"text"===o.type?{value:"",stroke:o.stroke,fill:o.fill,textAlign:o.textAlign,verticalAlign:p.default.shapeDef.text.verticalAlign,fontSize:o.fontSize,fontFamily:o.fontFamily}:{value:"",stroke:p.default.shapeDef.text.stroke,fill:p.default.shapeDef.text.fill,textAlign:p.default.shapeDef.text.textAlign,verticalAlign:p.default.shapeDef.text.verticalAlign,fontSize:p.default.shapeDef.text.fontSize,fontFamily:p.default.shapeDef.text.fontFamily}}):(0,s.default)({type:"text",boundary:{sx:t,sy:n,w:r,h:i},inProgress:!1},"text"===(null==o?void 0:o.type)?{fontSize:o.fontSize,fontFamily:o.fontFamily,stroke:o.stroke,fill:o.fill,textAlign:o.textAlign}:"object"===(0,a.default)(null==o?void 0:o.text)&&null!==(null==o?void 0:o.text)?{stroke:o.text.stroke,fill:o.text.fill,textAlign:o.text.textAlign,verticalAlign:o.text.verticalAlign,fontSize:o.text.fontSize,fontFamily:o.text.fontFamily}:{fontSize:p.default.textDef.fontSize,fontFamily:p.default.textDef.fontFamily,stroke:p.default.textDef.stroke,fill:p.default.textDef.fill,textAlign:p.default.textDef.textAlign})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;var a=y(n(18)),r=y(n(5)),i=y(n(19)),o=y(n(2)),s=y(n(0)),u=y(n(1)),l=y(n(3)),c=y(n(25)),d=y(n(4)),p=y(n(37)),h=y(n(6)),f=n(248),g=n(380),v=y(n(383));function y(e){return e&&e.__esModule?e:{default:e}}n(384);var m=new p.default;window.addEventListener("pointerdown",(function(){m.forEach((function(e){e()}))}),{capture:!0});t.Item=function(e){function t(){(0,s.default)(this,t);var e=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.state={isHover:!1},e.throttleId=null,e.cancelHoverHandler=function(){e.isHover=!1},e}return(0,d.default)(t,e),(0,u.default)(t,[{key:"propsFilter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=["className","style","toolName","value","text","icon","hint","disabled","children"].concat((0,i.default)(e)),n=(0,r.default)({toolName:"NoNameTool",value:"NoValue",icon:v.default},n),(0,c.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"propsFilter",this).call(this,e,(0,r.default)({disabled:!1},n))}},{key:"componentDidMount",value:function(){m.add(this.cancelHoverHandler)}},{key:"componentWillUnmount",value:function(){m.delete(this.cancelHoverHandler)}},{key:"isHover",set:function(e){this.setState({isHover:e})},get:function(){var e;return null!==(e=this.state.isHover)&&void 0!==e&&e}},{key:"hoverProps",get:function(){var e=this;return this.pickedProps.hint?{onPointerEnter:function(t){var n,a;clearTimeout(e.throttleId),null===(a=(n=e.nativeProps).onPointerEnter)||void 0===a||a.call(n,t),e.throttleId=setTimeout((function(){e.isHover=!0}),100)},onPointerLeave:function(t){var n,a;null===(a=(n=e.nativeProps).onPointerLeave)||void 0===a||a.call(n,t),clearTimeout(e.throttleId),e.throttleId=setTimeout((function(){e.isHover=!1}),100)}}:{}}},{key:"defaultClassNames",get:function(){var e=this.pickedProps.disabled;return["item"].concat((0,i.default)(e?["item-disabled"]:[]))}},{key:"className",get:function(){var e=this.pickedProps.className;return[].concat((0,i.default)(this.defaultClassNames),[e]).join(" ")}},{key:"defaultStyle",get:function(){return{position:"relative"}}},{key:"style",get:function(){var e=this.pickedProps.style;return(0,r.default)((0,r.default)({},e),this.defaultStyle)}},{key:"isTextFirst",get:function(){var e=(0,a.default)(this.props);return e.indexOf("text")<e.indexOf("icon")}},{key:"Hint",get:function(){var e=this.pickedProps.hint;return e?h.default.createElement(g.Hint,{isShow:this.isHover,hint:e}):null}},{key:"itemChildren",get:function(){var e=this.props.children,t=null!=e?e:[];t=t instanceof Array?[].concat((0,i.default)(t)):[t];var n=this.pickedProps,a=n.text,r=n.icon,o=a?h.default.createElement("span",{className:"text",style:{pointerEvents:"none"}},a):null,s=r?"string"==typeof r?h.default.createElement("i",{className:"icon",style:{maskImage:"url("+r+")",webkitMaskImage:"url("+r+")",width:"1em",height:"1em",pointerEvents:"none"}}):r:null;return t.length?[].concat((0,i.default)(t),[this.Hint]):this.isTextFirst?[this.Hint,o,s]:[this.Hint,s,o]}}]),t}(f.FloatComponent)},function(e,t,n){var a=n(79),r=n(80);e.exports=function(e){return a(r(e))}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var a=n(80);e.exports=function(e){return Object(a(e))}},function(e,t,n){"use strict";var a=n(171)(!0);n(86)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=a(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.snapshotOutOfNormalFlowTypes=["background","pan","zoom","mouse-pointer","select","select-hover","laser","camera-bound"],t.globalSnapshotTypes=["camera-bound"],t.cameraSnapshotTypes=["pan","zoom","camera-bound","reset-camera","fit-to-content","fit-to-doc","resize-camera"],t.nonRotateTypes=["audio","video","pagePlugin","star","triangle","link"]},function(e,t,n){"use strict";var a=d(n(73)),r=d(n(37)),i=d(n(131)),o=d(n(7)),s=d(n(5)),u=d(n(27)),l=d(n(0)),c=d(n(1));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){(0,l.default)(this,e),Array.isArray(t)||(t=[]),this._args=t,this.taps=[],this.interceptors=[],this.call=this._call,this.promise=this._promise,this.callAsync=this._callAsync,this._x=void 0}return(0,c.default)(e,[{key:"compile",value:function(e){throw new Error("Abstract: should be overriden")}},{key:"_createCall",value:function(e){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:e})}},{key:"tap",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tap(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"sync",fn:t},e)).name||""===e.name)throw new Error("Missing name for tap");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapAsync",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapAsync(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"async",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapAsync");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapPromise",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapPromise(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"promise",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapPromise");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"_runRegisterInterceptors",value:function(e){var t=!0,n=!1,a=void 0;try{for(var r,i=(0,o.default)(this.interceptors);!(t=(r=i.next()).done);t=!0){var s=r.value;if(s.register){var u=s.register(e);void 0!==u&&(e=u)}}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}return e}},{key:"withOptions",value:function(e){var t=function(t){return(0,s.default)({},e,"string"==typeof t?{name:t}:t)};e=(0,s.default)({},e,this._withOptions);var n=this._withOptionsBase||this,a=(0,i.default)(n);return a.tapAsync=function(e,a){return n.tapAsync(t(e),a)},a.tap=function(e,a){return n.tap(t(e),a)},a.tapPromise=function(e,a){return n.tapPromise(t(e),a)},a._withOptions=e,a._withOptionsBase=n,a}},{key:"isUsed",value:function(){return this.taps.length>0||this.interceptors.length>0}},{key:"intercept",value:function(e){if(this._resetCompilation(),this.interceptors.push((0,s.default)({},e)),e.register)for(var t=0;t<this.taps.length;t++)this.taps[t]=e.register(this.taps[t])}},{key:"_resetCompilation",value:function(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}},{key:"_insert",value:function(e){this._resetCompilation();var t=void 0;"string"==typeof e.before?t=new r.default([e.before]):Array.isArray(e.before)&&(t=new r.default(e.before));var n=0;"number"==typeof e.stage&&(n=e.stage);for(var a=this.taps.length;a>0;){a--;var i=this.taps[a];this.taps[a+1]=i;var o=i.stage||0;if(t){if(t.has(i.name)){t.delete(i.name);continue}if(t.size>0)continue}if(!(o>n)){a++;break}}this.taps[a]=e}}]),e}();function h(e,t){return function(){return this[e]=this._createCall(t),this[e].apply(this,arguments)}}(0,a.default)(p.prototype,{_call:{value:h("call","sync"),configurable:!0,writable:!0},_promise:{value:h("promise","promise"),configurable:!0,writable:!0},_callAsync:{value:h("callAsync","async"),configurable:!0,writable:!0}}),e.exports=p},function(e,t){!function(n){"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=n()}((function(){return function e(t,n,a){function r(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return r(t[o][1][e]||e)}),c,c.exports,e,t,n,a)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<a.length;o++)r(a[o]);return r}({1:[function(e,t,n){"use strict";var a=Object.prototype.hasOwnProperty,r="~";function i(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,a,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new o(n,a||e,i),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)a.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var a=0,i=n.length,o=new Array(i);a<i;a++)o[a]=n[a].fn;return o},l.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,a,i,o){var s=r?r+e:e;if(!this._events[s])return!1;var u,l=this._events[s],c=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,a),!0;case 5:return l.fn.call(l.context,t,n,a,i),!0;case 6:return l.fn.call(l.context,t,n,a,i,o),!0}for(h=1,u=new Array(c-1);h<c;h++)u[h-1]=arguments[h];l.fn.apply(l.context,u)}else for(var d,p=l.length,h=0;h<p;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),c){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,n);break;case 4:l[h].fn.call(l[h].context,t,n,a);break;default:if(!u)for(d=1,u=new Array(c-1);d<c;d++)u[d-1]=arguments[d];l[h].fn.apply(l[h].context,u)}return!0},l.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,a){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||a&&!o.once||n&&o.context!==n||u(this,i);else{for(var s=0,l=[],c=o.length;s<c;s++)(o[s].fn!==t||a&&!o[s].once||n&&o[s].context!==n)&&l.push(o[s]);l.length?this._events[i]=1===l.length?l[0]:l:u(this,i)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,void 0!==t&&(t.exports=l)},{}]},{},[1])(1)}))},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var a=n(110),r=n(84);e.exports=Object.keys||function(e){return a(e,r)}},function(e,t){e.exports={}},function(e,t,n){n(173);for(var a=n(15),r=n(35),i=n(50),o=n(17)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<s.length;u++){var l=s[u],c=a[l],d=c&&c.prototype;d&&!d[o]&&r(d,o,l),i[l]=i.Array}},function(e,t,n){"use strict";var a=o(n(7)),r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,r.default)(this,e),this.config=t,this.options=void 0,this._args=void 0}return(0,i.default)(e,[{key:"create",value:function(e){this.init(e);var t=void 0;switch(this.options.type){case"sync":t=new Function(this.args(),'"use strict";\n'+this.header()+this.content({onError:function(e){return"throw "+e+";\n"},onResult:function(e){return"return "+e+";\n"},resultReturns:!0,onDone:function(){return""},rethrowIfPossible:!0}));break;case"async":t=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.content({onError:function(e){return"_callback("+e+");\n"},onResult:function(e){return"_callback(null, "+e+");\n"},onDone:function(){return"_callback();\n"}}));break;case"promise":var n=!1,a=this.content({onError:function(e){return n=!0,"_error("+e+");\n"},onResult:function(e){return"_resolve("+e+");\n"},onDone:function(){return"_resolve();\n"}}),r="";r+='"use strict";\n',r+="return new Promise((_resolve, _reject) => {\n",n&&(r+="var _sync = true;\n",r+="function _error(_err) {\n",r+="if(_sync)\n",r+="_resolve(Promise.resolve().then(() => { throw _err; }));\n",r+="else\n",r+="_reject(_err);\n",r+="};\n"),r+=this.header(),r+=a,n&&(r+="_sync = false;\n"),r+="});\n",t=new Function(this.args(),r)}return this.deinit(),t}},{key:"setup",value:function(e,t){e._x=t.taps.map((function(e){return e.fn}))}},{key:"init",value:function(e){this.options=e,this._args=e.args.slice()}},{key:"deinit",value:function(){this.options=void 0,this._args=void 0}},{key:"header",value:function(){var e="";this.needContext()?e+="var _context = {};\n":e+="var _context;\n",e+="var _x = this._x;\n",this.options.interceptors.length>0&&(e+="var _taps = this.taps;\n",e+="var _interceptors = this.interceptors;\n");for(var t=0;t<this.options.interceptors.length;t++){var n=this.options.interceptors[t];n.call&&(e+=this.getInterceptor(t)+".call("+this.args({before:n.context?"_context":void 0})+");\n")}return e}},{key:"needContext",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this.options.taps);!(e=(r=i.next()).done);e=!0){if(r.value.context)return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"callTap",value:function(e,t){for(var n=t.onError,a=t.onResult,r=t.onDone,i=t.rethrowIfPossible,o="",s=!1,u=0;u<this.options.interceptors.length;u++){var l=this.options.interceptors[u];l.tap&&(s||(o+="var _tap"+e+" = "+this.getTap(e)+";\n",s=!0),o+=this.getInterceptor(u)+".tap("+(l.context?"_context, ":"")+"_tap"+e+");\n")}o+="var _fn"+e+" = "+this.getTapFn(e)+";\n";var c=this.options.taps[e];switch(c.type){case"sync":i||(o+="var _hasError"+e+" = false;\n",o+="try {\n"),o+=a?"var _result"+e+" = _fn"+e+"("+this.args({before:c.context?"_context":void 0})+");\n":"_fn"+e+"("+this.args({before:c.context?"_context":void 0})+");\n",i||(o+="} catch(_err) {\n",o+="_hasError"+e+" = true;\n",o+=n("_err"),o+="}\n",o+="if(!_hasError"+e+") {\n"),a&&(o+=a("_result"+e)),r&&(o+=r()),i||(o+="}\n");break;case"async":var d="";d+=a?"(_err"+e+", _result"+e+") => {\n":"_err"+e+" => {\n",d+="if(_err"+e+") {\n",d+=n("_err"+e),d+="} else {\n",a&&(d+=a("_result"+e)),r&&(d+=r()),d+="}\n",d+="}",o+="_fn"+e+"("+this.args({before:c.context?"_context":void 0,after:d})+");\n";break;case"promise":o+="var _hasResult"+e+" = false;\n",o+="var _promise"+e+" = _fn"+e+"("+this.args({before:c.context?"_context":void 0})+");\n",o+="if (!_promise"+e+" || !_promise"+e+".then)\n",o+="  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise"+e+" + ')');\n",o+="_promise"+e+".then(_result"+e+" => {\n",o+="_hasResult"+e+" = true;\n",a&&(o+=a("_result"+e)),r&&(o+=r()),o+="}, _err"+e+" => {\n",o+="if(_hasResult"+e+") throw _err"+e+";\n",o+=n("_err"+e),o+="});\n"}return o}},{key:"callTapsSeries",value:function(e){var t=this,n=e.onError,a=e.onResult,r=e.resultReturns,i=e.onDone,o=e.doneReturns,s=e.rethrowIfPossible;if(0===this.options.taps.length)return i();for(var u=this.options.taps.findIndex((function(e){return"sync"!==e.type})),l=r||o||!1,c="",d=i,p=function(e){var r=e;d!==i&&"sync"!==t.options.taps[r].type&&(c+="function _next"+r+"() {\n",c+=d(),c+="}\n",d=function(){return(l?"return ":"")+"_next"+r+"();\n"});var o=d,p=function(e){return e?"":i()},h=t.callTap(r,{onError:function(e){return n(r,e,o,p)},onResult:a&&function(e){return a(r,e,o,p)},onDone:!a&&o,rethrowIfPossible:s&&(u<0||r<u)});d=function(){return h}},h=this.options.taps.length-1;h>=0;h--)p(h);return c+=d()}},{key:"callTapsLooping",value:function(e){var t=e.onError,n=e.onDone,a=e.rethrowIfPossible;if(0===this.options.taps.length)return n();var r=this.options.taps.every((function(e){return"sync"===e.type})),i="";r||(i+="var _looper = () => {\n",i+="var _loopAsync = false;\n"),i+="var _loop;\n",i+="do {\n",i+="_loop = false;\n";for(var o=0;o<this.options.interceptors.length;o++){var s=this.options.interceptors[o];s.loop&&(i+=this.getInterceptor(o)+".loop("+this.args({before:s.context?"_context":void 0})+");\n")}return i+=this.callTapsSeries({onError:t,onResult:function(e,t,n,a){var i="";return i+="if("+t+" !== undefined) {\n",i+="_loop = true;\n",r||(i+="if(_loopAsync) _looper();\n"),i+=a(!0),i+="} else {\n",i+=n(),i+="}\n"},onDone:n&&function(){var e="";return e+="if(!_loop) {\n",e+=n(),e+="}\n"},rethrowIfPossible:a&&r}),i+="} while(_loop);\n",r||(i+="_loopAsync = true;\n",i+="};\n",i+="_looper();\n"),i}},{key:"callTapsParallel",value:function(e){var t=this,n=e.onError,a=e.onResult,r=e.onDone,i=e.rethrowIfPossible,o=e.onTap,s=void 0===o?function(e,t){return t()}:o;if(this.options.taps.length<=1)return this.callTapsSeries({onError:n,onResult:a,onDone:r,rethrowIfPossible:i});var u="";u+="do {\n",u+="var _counter = "+this.options.taps.length+";\n",r&&(u+="var _done = () => {\n",u+=r(),u+="};\n");for(var l=function(e){var o=function(){return r?"if(--_counter === 0) _done();\n":"--_counter;"},l=function(e){return e||!r?"_counter = 0;\n":"_counter = 0;\n_done();\n"};u+="if(_counter <= 0) break;\n",u+=s(e,(function(){return t.callTap(e,{onError:function(t){var a="";return a+="if(_counter > 0) {\n",a+=n(e,t,o,l),a+="}\n"},onResult:a&&function(t){var n="";return n+="if(_counter > 0) {\n",n+=a(e,t,o,l),n+="}\n"},onDone:!a&&function(){return o()},rethrowIfPossible:i})}),o,l)},c=0;c<this.options.taps.length;c++)l(c);return u+="} while(false);\n"}},{key:"args",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.before,n=e.after,a=this._args;return t&&(a=[t].concat(a)),n&&(a=a.concat(n)),0===a.length?"":a.join(", ")}},{key:"getTapFn",value:function(e){return"_x["+e+"]"}},{key:"getTap",value:function(e){return"_taps["+e+"]"}},{key:"getInterceptor",value:function(e){return"_interceptors["+e+"]"}}]),e}();e.exports=s},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=!0},function(e,t,n){var a=n(24).f,r=n(42),i=n(17)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,i)&&a(e,i,{configurable:!0,value:t})}},function(e,t,n){var a=n(32),r=n(118),i=n(119),o=n(26),s=n(68),u=n(91),l={},c={};(t=e.exports=function(e,t,n,d,p){var h,f,g,v,y=p?function(){return e}:u(e),m=a(n,d,t?2:1),M=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(i(y)){for(h=s(e.length);h>M;M++)if((v=t?m(o(f=e[M])[0],f[1]):m(e[M]))===l||v===c)return v}else for(g=y.call(e);!(f=g.next()).done;)if((v=r(g,m,f.value,t))===l||v===c)return v}).BREAK=l,t.RETURN=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SELECT_PAD=void 0;var a=x(n(38)),r=x(n(5)),i=x(n(72)),o=x(n(2)),s=x(n(0)),u=x(n(1)),l=x(n(3)),c=x(n(4)),d=n(45),p=n(13),h=x(n(227)),f=x(n(23)),g=n(16),v=n(228),y=n(30),m=n(29),M=n(65);function x(e){return e&&e.__esModule?e:{default:e}}var w=t.SELECT_PAD=0,I="rgba(53, 128, 250)",b=function(e){function t(){(0,s.default)(this,t);var e=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="select",e.activate=!1,e.selectedOpIds=[],e.description="选择工具",e}return(0,c.default)(t,e),(0,u.default)(t,[{key:"getSelectedIds",value:function(){return this.selectedOpIds.slice()}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"select:filterType":{value:this.filterEles.bind(this),information:{args:"types: Array<string>",message:""}}}}},{key:"filterEles",value:function(e){var t=this,n=this.selectedOpIds.filter((function(n){var a=t.drawOpsOfPage[n];if(a&&-1!==e.indexOf(a.data.type))return!0}));this.dispatch(this.getSnapshot(n))}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this)),this.opsManager.hooks.pageChange.tap("pageChange",this.handlePageChange.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){if("a"===e.key.toLocaleLowerCase()&&this.app.container.isCtrlPressed()){e.preventDefault();var t=[];for(var n in this.drawOpsOfPage)this.drawOpsOfPage[n].data.hidden||this.drawOpsOfPage[n].data.deleted||t.push(n);t.length>0&&(this.dispatch(this.getSnapshot(t)),this.opsManager.setCurrOp("select"))}}},{key:"handlePageChange",value:function(e){e.uid===this.app.account&&this.selectedOpIds.length>0&&this.dispatch(this.getSnapshot([]))}},{key:"handleOpChange",value:function(e){var t;"select"!==e&&"select"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&this.dispatch(this.getSnapshot([]))}},{key:"postMouseUp",value:function(e){this.dispatch(this.getSnapshot(e))}},{key:"postClick",value:function(e){if(0===e.length&&Date.now()-this.opsManager.opMap.text.blurAt<100)return;(0,g.idsChanged)(e,this.selectedOpIds)&&this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return{type:"select",sp:this.sp,ep:this.ep,inProgress:!1,selectedOpIds:e.slice(),reuseOpType:"select",skipUndo:!0,color:f.default.penDef.stroke,nickname:this.app.nickname}}},{key:"preview",value:function(e,t,n){e.page.toString()===n.page.pageIndex&&this.draw(e,t)}},{key:"draw",value:function(e,t){var n,a,o=this,s=e.data,u=s.selectedOpIds.filter((function(e){return o.drawOpsOfPage[e]})),l=this.opsManager.opMap.text;if(e.uid===this.app.account&&-1===e.opId.indexOf("select-hover")&&(this.selectInfo=void 0),e.uid===this.app.account&&1===u.length){var c=this.drawOpsOfPage[u[0]];if(l.isTextBeingEdit(u[0])||!0===(null===(a=null===(n=null==c?void 0:c.data)||void 0===n?void 0:n.crop)||void 0===a?void 0:a.inProgress)){var p=this.opsManager.drawOpsOfPage[u[0]],h=p.data.boundary,f=(0,y.getTransPoint)([h.sx,h.sy],p.data.mat),g=(0,y.getTransPoint)([h.sx+h.w,h.sy],p.data.mat),v=(0,y.getTransPoint)([h.sx+h.w,h.sy+h.h],p.data.mat),m=(0,y.getTransPoint)([h.sx,h.sy+h.h],p.data.mat),x=M.HINT_BORDER_PAD/this.app.scale/Math.abs(p.data.xFactor||1),I=M.HINT_BORDER_PAD/this.app.scale/Math.abs(p.data.yFactor||1),b=(0,y.getTransPoint)([h.sx+h.w/2,h.sy-I],p.data.mat),k=(0,y.getTransPoint)([h.sx+h.w+x,h.sy+h.h/2],p.data.mat),T=(0,y.getTransPoint)([h.sx+h.w/2,h.sy+h.h+I],p.data.mat),_=(0,y.getTransPoint)([h.sx-x,h.sy+h.h/2],p.data.mat),C=(0,y.getTransPoint)([h.sx+h.w/2,h.sy],p.data.mat),N=(0,y.getTransPoint)([h.sx+h.w,h.sy+h.h/2],p.data.mat),A=(0,y.getTransPoint)([h.sx+h.w/2,h.sy+h.h],p.data.mat),P=(0,y.getTransPoint)([h.sx,h.sy+h.h/2],p.data.mat);return void(this.selectInfo={pad:w,boundary:{isCombined:!1,p1:f,p2:g,p3:v,p4:m},rotateIcon:void 0,hintPos:{id:p.opId,p1:b,p2:k,p3:T,p4:_,sp1:C,sp2:N,sp3:A,sp4:P}})}var O=this.opsManager.currPage.idToGroup.get(u[0]);if(O){var D=this.opsManager.currPage.groups.get(O);if(D&&D.size>1&&!s.inProgress){var S=this.getCombineBox((0,i.default)(D)),E=4/this.app.scale;S&&(S={sx:S.sx-E,sy:S.sy-E,w:S.w+2*E,h:S.h+2*E},this.drawCombineBox(S,t,!1))}}}if(e.uid===this.app.account||1!==u.length||!l.isTextBeingEdit(u[0])){s.inProgress&&e.uid===this.app.account&&s.sp&&s.ep&&s.sp[0]!==s.ep[0]&&s.sp[1]!==s.ep[1]&&this.drawMask(s,t);var j=void 0,L=void 0;s.inProgress||(j=this.getCombineBox(s.selectedOpIds),u.length>1&&!s.inProgress&&j&&this.drawCombineBox(j,t,e.uid===this.app.account)),(s.inProgress||1===u.length)&&(L=this.drawIndiBox(s,t,e.uid===this.app.account));var z=void 0;1===u.length&&e.uid===this.app.account&&(z=this.drawLinkDot(s,t));var R=void 0;if(!s.inProgress&&1===u.length&&e.uid===this.app.account){var B=this.drawOpsOfPage[u[0]];-1===d.nonRotateTypes.indexOf(B.data.type)&&(R=this.drawRotateIcon(s,t))}s.inProgress||e.uid!==this.app.account||-1!==e.opId.indexOf("select-hover")||(1===u.length&&Array.isArray(L)&&L.length>0?this.selectInfo={pad:w,boundary:{isCombined:!1,p1:L[0][0],p2:L[0][1],p3:L[0][2],p4:L[0][3]},rotateIcon:R,hintPos:z}:u.length>1&&j&&(this.selectInfo={pad:w,boundary:(0,r.default)({isCombined:!0},j),rotateIcon:void 0,hintPos:void 0})),this.drawUserName(e,t,j)}}},{key:"getCombineBox",value:function(e){var t=this;if(0!==(e=e.filter((function(e){return t.drawOpsOfPage[e]}))).length){var n=e.map((function(e){var n=t.drawOpsOfPage[e];return(0,p.getTransformedBoundary)(t.app.scale,n.data)}));return 1===n.length?n[0]:n.reduce((function(e,t){return(0,p.combineBoundary)(e,t)}))}}},{key:"drawUserName",value:function(e,t,n){if(!e.data.inProgress&&e.uid!==this.app.account&&n){var a=n.sx+n.w/2,r=n.sy;if(!this.app.appConfig.showSelectNickname)return;(0,g.drawUserName)({ctx:t,account:e.data.nickname?e.data.nickname:e.uid,scale:this.app.scale,px:a,py:r,bgColor:e.data.color?e.data.color:"rgb(0,0,0)",fontSize:16,textPadding:8,radius:6})}}},{key:"drawMask",value:function(e,t){var n=void 0,a=void 0;if(Array.isArray(e.points)&&e.points.length>=2?(n=e.points[0],a=e.points[e.points.length-1]):e.sp&&e.ep&&(e.sp[0]===e.ep[0]&&e.sp[1]===e.ep[1]||(n=e.sp,a=e.ep)),n&&a){var r=(0,p.getBoundaryBoxFromTwoPoints)(n,a),i=r.sx,o=r.sy,s=r.w,u=r.h;t.beginPath(),t.fillStyle="rgba(132, 176, 245, .4)",t.fillRect(i,o,s,u),t.strokeStyle=I,t.strokeRect(i,o,s,u)}}},{key:"drawCombineBox",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.lineWidth=1/this.app.scale;var a=5/this.app.scale,r=w;return t.beginPath(),t.strokeStyle=I,t.strokeRect(e.sx-r,e.sy-r,e.w+2*r,e.h+2*r),n&&this.drawCornerDot({ctx:t,dotSize:a,p1:[e.sx-r,e.sy-r],p2:[e.sx+e.w+r,e.sy-r],p3:[e.sx+e.w+r,e.sy+e.h+r],p4:[e.sx-r,e.sy+e.h+r]}),[e]}},{key:"drawRotateIcon",value:function(e,t){var n=e.selectedOpIds,r=this.opsManager.drawOpsOfPage[n[0]];t.save(),t.beginPath();var i=(0,v.getTransIconPos)(r,w,this.app.scale),o=(0,a.default)(i,2),s=o[0],u=o[1],l=v.ROTATE_TEST_RADIUS/this.app.scale;return t.arc(s,u,l,.5*-Math.PI,Math.PI),t.lineWidth=1/this.app.scale,t.strokeStyle="rgba(0,0,0,.8)",t.stroke(),t.beginPath(),t.moveTo(s-1.3*l,u),t.lineTo(s-.7*l,u),t.lineTo(s-l,u-.3*l),t.closePath(),t.fillStyle="rgba(0,0,0,.8)",t.fill(),t.restore(),{x:s,y:u,angle:r.data.rAngle||0}}},{key:"drawLinkDot",value:function(e,t){var n=this,a=e.selectedOpIds.filter((function(e){return n.drawOpsOfPage[e]})),r=this.opsManager.drawOpsOfPage[a[0]];if(-1===m.exLinkTypes.indexOf(r.data.type)){var i=M.HINT_BORDER_PAD/this.app.scale/Math.abs(r.data.xFactor||1),o=M.HINT_BORDER_PAD/this.app.scale/Math.abs(r.data.yFactor||1),s=M.HINT_RADIUS/this.app.scale,u=r.data.boundary,l=(0,y.getTransPoint)([u.sx+u.w/2,u.sy-o],r.data.mat),c=(0,y.getTransPoint)([u.sx+u.w+i,u.sy+u.h/2],r.data.mat),d=(0,y.getTransPoint)([u.sx+u.w/2,u.sy+u.h+o],r.data.mat),p=(0,y.getTransPoint)([u.sx-i,u.sy+u.h/2],r.data.mat),h=(0,y.getTransPoint)([u.sx+u.w/2,u.sy],r.data.mat),f=(0,y.getTransPoint)([u.sx+u.w,u.sy+u.h/2],r.data.mat),g=(0,y.getTransPoint)([u.sx+u.w/2,u.sy+u.h],r.data.mat),v=(0,y.getTransPoint)([u.sx,u.sy+u.h/2],r.data.mat);return t.fillStyle="rgba(53, 128, 250, .6)",t.beginPath(),t.moveTo(l[0]+s,l[1]),t.arc(l[0],l[1],s,0,2*Math.PI),t.moveTo(c[0]+s,c[1]),t.arc(c[0],c[1],s,0,2*Math.PI),t.moveTo(d[0]+s,d[1]),t.arc(d[0],d[1],s,0,2*Math.PI),t.moveTo(p[0]+s,p[1]),t.arc(p[0],p[1],s,0,2*Math.PI),t.fill(),{p1:l,p2:c,p3:d,p4:p,id:a[0],sp1:h,sp2:f,sp3:g,sp4:v}}}},{key:"drawIndiBox",value:function(e,n,a){for(var r=this,i=e.selectedOpIds.filter((function(e){return r.drawOpsOfPage[e]})),o=5/this.app.scale,s=w,u=[],l=0;l<i.length;l++){var c=this.opsManager.drawOpsOfPage[i[l]];if("link"!==c.data.type){var d=c.data.boundary,h=c.data.rAngle||0,f=("number"==typeof c.data.xFactor&&c.data.xFactor)<0?-1:1,g=("number"==typeof c.data.yFactor&&c.data.yFactor)<0?-1:1,v=void 0,m=void 0,M=void 0,x=void 0;if(c.data.boundary.fixRealWorldHeight){var b=(0,p.getTransformedBoundary)(this.app.scale,c.data);v=[b.sx,b.sy],m=[b.sx+b.w,b.sy],M=[b.sx+b.w,b.sy+b.h],x=[b.sx,b.sy+b.h]}else v=(0,y.getTransPoint)([d.sx,d.sy],c.data.mat),m=(0,y.getTransPoint)([d.sx+d.w,d.sy],c.data.mat),M=(0,y.getTransPoint)([d.sx+d.w,d.sy+d.h],c.data.mat),x=(0,y.getTransPoint)([d.sx,d.sy+d.h],c.data.mat);if(u.push([v,m,M,x]),v=(0,p.getPointAftPad)(v,s,h,0,f,g),m=(0,p.getPointAftPad)(m,s,h,1,f,g),M=(0,p.getPointAftPad)(M,s,h,2,f,g),x=(0,p.getPointAftPad)(x,s,h,3,f,g),n.beginPath(),n.moveTo(v[0],v[1]),n.lineTo(m[0],m[1]),n.lineTo(M[0],M[1]),n.lineTo(x[0],x[1]),n.closePath(),n.lineWidth=1/this.app.scale,n.strokeStyle=I,n.stroke(),!e.inProgress&&this.opsManager.currOp instanceof t&&a&&this.drawCornerDot({ctx:n,dotSize:o,p1:v,p2:m,p3:M,p4:x}),1===i.length&&"shape"===c.data.type)if(!this.opsManager.opMap.shape.isTxtContained(c)){n.beginPath();var k=void 0,T=void 0,_=void 0,C=void 0,N=void 0,A=o/Math.abs(c.data.yFactor||1),P=o/Math.abs(c.data.xFactor||1);c.data.yFactor<0?(k=v,T=m,_=(0,y.getTransPoint)([d.sx+d.w/2-P,d.sy+.5*A],c.data.mat),C=(0,y.getTransPoint)([d.sx+d.w/2,d.sy-.8*A],c.data.mat),N=(0,y.getTransPoint)([d.sx+d.w/2+P,d.sy+.5*A],c.data.mat)):(k=M,T=x,_=(0,y.getTransPoint)([d.sx+d.w/2-P,d.sy-.5*A+d.h],c.data.mat),C=(0,y.getTransPoint)([d.sx+d.w/2,d.sy+.9*A+d.h],c.data.mat),N=(0,y.getTransPoint)([d.sx+d.w/2+P,d.sy-.5*A+d.h],c.data.mat)),n.arc(k[0]/2+T[0]/2,k[1]/2+T[1]/2,3*o,0,2*Math.PI),n.fillStyle="white",n.fill(),n.beginPath(),n.moveTo(_[0],_[1]),n.lineTo(C[0],C[1]),n.lineTo(N[0],N[1]),n.strokeStyle="black",n.lineWidth=2,n.stroke()}}else{this.opsManager.linkOp.drawSelectedLink(n,c);var O=c.data.boundary;O&&u.push([[O.sx,O.sy],[O.sx+O.w,O.sy],[O.sx+O.w,O.sy+O.h],[O.sx,O.sy+O.h]])}}return u}},{key:"drawCornerDot",value:function(e){var t=e.ctx,n=e.p1,a=e.p2,r=e.p3,i=e.p4,o=e.dotSize;t.fillStyle="rgb(255, 255, 255)",t.strokeStyle="rgb(100, 100, 100)",t.beginPath(),t.moveTo(n[0]+o,n[1]),t.arc(n[0],n[1],o,0,2*Math.PI),t.moveTo(a[0]+o,a[1]),t.arc(a[0],a[1],o,0,2*Math.PI),t.moveTo(r[0]+o,r[1]),t.arc(r[0],r[1],o,0,2*Math.PI),t.moveTo(i[0]+o,i[1]),t.arc(i[0],i[1],o,0,2*Math.PI),t.fill(),t.stroke(),t.closePath()}},{key:"setSelectedOpIds",value:function(e){this.selectedOpIds.join(",")!==e.join(",")&&(this.emit("event:appState:change","selectChange",this.selectedOpIds.slice(),e.slice(),(0,g.filterNonMediaOpIds)(this,e)),this.opsManager.hooks.selectChange.call(this.selectedOpIds.slice(),e.slice()),this.selectedOpIds=e,this.dispatch(this.getSnapshot(e.slice())))}}]),t}(h.default);t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClickItem=void 0;var a=p(n(5)),r=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(25)),l=p(n(4)),c=p(n(6)),d=n(40);function p(e){return e&&e.__esModule?e:{default:e}}n(386);t.ClickItem=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.clickHandler=function(t){var n=e.pickedProps,a=n.onClick,r=n.toolName,i=n.value;null==a||a({type:t.type,target:t.target,toolName:r,value:i}),e.isHover=!1},e}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onClick"])}},{key:"defaultClassNames",get:function(){return(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"defaultClassNames",this).concat("click-item")}},{key:"children",get:function(){var e=this.pickedProps,t=e.value,n=e.disabled;return c.default.createElement("button",(0,a.default)({className:this.className,style:this.style,value:t,disabled:n},this.nativeProps,this.hoverProps,{onClick:this.clickHandler}),this.itemChildren)}}]),t}(d.Item)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubsPanel=void 0;var a=d(n(5)),r=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),l=d(n(107)),c=d(n(6));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof l.default){var r=0;for(a=(0,l.default)(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};t.SubsPanel=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.left=0,e.top=0,e.ref=c.default.createRef(),e._componentDidUpdate=function(){var t=e.props,n=t.isShow,r=t.offset,i=t.tbAlign;if(n){var o=e.ref.current;if(o){var s=o.parentElement;if(s){var u=(0,a.default)({x:0,y:0},r),l=u.x,c=u.y,d=s.getBoundingClientRect(),p=o.getBoundingClientRect(),h=window.innerWidth,f=window.innerHeight,g=d.bottom,v=d.left+.5*(d.width-p.width),y=!1;if("down"===i&&g+p.height+c<=f?g+=c:"down"===i&&d.top-c-p.height>0||d.top-c-p.height>0?g=d.top-c-p.height:g+p.height+c<=f?g+=c:(y=!0,g=f<p.height?0:p.height>f-d.top+c?f-p.height:d.top-c),y)if(d.right+l+p.width<h)v=d.right+l;else if(d.left-l-p.width>0)v=d.left-l-p.width;else{v=d.left+.5*d.width<.5*h?h-p.width:0}else h<p.width||v<0?v=0:v+p.width>h&&(v=h-p.width);e.ref.current.style.top=g+"px",e.ref.current.style.left=v+"px"}}}},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"componentDidUpdate",value:function(e){clearTimeout(this.timer),e.isShow?this.timer=setTimeout(this._componentDidUpdate,0):this._componentDidUpdate()}},{key:"render",value:function(){var e=this.props,t=e.isShow,n=e.style,r=e.children,i=(e.offset,p(e,["isShow","style","children","offset"]));return t?c.default.createElement("div",(0,a.default)({},i,{style:(0,a.default)((0,a.default)({},n),{position:"fixed"}),ref:this.ref}),r):null}}]),t}(c.default.Component)},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";e.exports=function(e,t){return"string"!=typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)||t?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e)}},function(e,t,n){var a=n(26),r=n(133),i=n(84),o=n(82)("IE_PROTO"),s=function(){},u=function(){var e,t=n(77)("iframe"),a=i.length;for(t.style.display="none",n(112).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;a--;)delete u.prototype[i[a]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=a(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:r(n,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLinkTextPos=t.getArrowPts=t.graphFromAnchors=t.tidyGraph=t.getNearestLinkInfo=t.getLinkPosByPer=t.graphAftEndM=t.graphAftConnM=t.graphAftConnD=t.graphAftTypeM=t.drawLink=t.patchLink=t.isUnderPoint=t.isUnderRect=t.graphInit=t.getEndAngle=void 0;var a=c(n(7)),r=n(29),i=c(n(226)),o=c(n(142)),s=c(n(137)),u=n(39),l=n(13);function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e,t,n){switch(e){case r.ILinkType.Line:return i.default[t](n);case r.ILinkType.Curve:return o.default[t](n);case r.ILinkType.Segment:return s.default[t](n)}},p=t.getEndAngle=function(e){return d(e.data.linkType,"getEndAngle",e)},h=(t.graphInit=function(e){return d(e.linkType,"graphInit",e)},t.isUnderRect=function(e){return d(e.data.linkType,"isUnderRect",e)},t.isUnderPoint=function(e){return d(e.data.linkType,"isUnderPoint",e)},t.patchLink=function(e){return d(e.data.linkType,"patchLink",e)},t.drawLink=function(e){return d(e.data.linkType,"drawLink",e)},t.graphAftTypeM=function(e){var t=e.data,n=e.type,a=e.op;if(t.linkType!==n){if(0===t.connPs.filter((function(e){return e.type===r.IConnPointType.Anchor})).length){var i=(0,u.getLinkEndPos)(a.app,t.start,a),o=(0,u.getLinkEndPos)(a.app,t.end,a);return d(n,"graphInit",{start:i,end:o,op:a,linkType:n})}return d(e.data.linkType,"graphAftTypeM",e)}},t.graphAftConnD=function(e){return d(e.data.linkType,"graphAftConnD",e)},t.graphAftConnM=function(e){return d(e.linkType,"graphAftConnM",e)},t.graphAftEndM=function(e){return d(e.linkType,"graphAftEndM",e)},t.getLinkPosByPer=function(e){return d(e.data.linkType,"getLinkPosByPer",e)});t.getNearestLinkInfo=function(e){return d(e.data.linkType,"getNearestLinkInfo",e)},t.tidyGraph=function(e){return d(e.linkType,"tidyGraph",e)},t.graphFromAnchors=function(e){return d(e.linkType,"graphFromAnchors",e)},t.getArrowPts=function(e){var t=e.data,n=e.op,a=e.startPos,r=e.endPos,i=p({data:t,op:n}),o=Number(t.lineWidth);return o=isNaN(o)?1:o,o=Math.max(o,3),{start:(0,l.getArrowPointsByAngle)(o,i[0],a.x,a.y),end:(0,l.getArrowPointsByAngle)(o,i[1],r.x,r.y)}},t.getLinkTextPos=function(e){var t=e.data,n=e.op,r=e.page,i=e.data.text||[],o=[],s=!0,u=!1,l=void 0;try{for(var c,d=(0,a.default)(i.arr);!(s=(c=d.next()).done);s=!0){var p=c.value,f=h({per:p.per,data:t,op:n,page:r});o.push({sx:f[0]-p.w/2,sy:f[1]-p.h/2,w:p.w,h:p.h})}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}return o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_LINK_TXT_LEN=t.MAX_TXT_LEN=t.MAX_SHAPE_TXT_LEN=t.SUGGEST_SHAPE_GAP=t.SUGGEST_SHAPE_DIST=t.ATTCH_THRES=t.POINT_EXTEND_THRES=t.SEG_UNDER_POINT_THRES=t.SEG_MERGE_THRES=t.CONN_DISP_THRES=t.TEXT_REMOVE_THRES=t.CONN_TEST_RADIUS=t.END_POINT_TEST_RADIUS=t.HINT_TEST_RADIUS=t.HINT_RADIUS=t.HINT_BORDER_PAD=void 0;var a=(0,n(66).deviceOS)(),r=a.isMobile||a.isTablet;t.HINT_BORDER_PAD=20,t.HINT_RADIUS=3,t.HINT_TEST_RADIUS=r?35:5,t.END_POINT_TEST_RADIUS=r?35:15,t.CONN_TEST_RADIUS=r?35:15,t.TEXT_REMOVE_THRES=50,t.CONN_DISP_THRES=10,t.SEG_MERGE_THRES=1,t.SEG_UNDER_POINT_THRES=5,t.POINT_EXTEND_THRES=3,t.ATTCH_THRES=r?30:20,t.SUGGEST_SHAPE_DIST=240,t.SUGGEST_SHAPE_GAP=10,t.MAX_SHAPE_TXT_LEN=1200,t.MAX_TXT_LEN=1200,t.MAX_LINK_TXT_LEN=80},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.isIosDevice=function(){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},t.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t.deviceOS=function(){var e=navigator.userAgent,t=!1,n=!1,a=!1;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?n=!0:/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?t=!0:a=!0,{isMobile:t,isTablet:n,isDesktop:a}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertToCameraBoundSnapshot=void 0;var a=h(n(2)),r=h(n(0)),i=h(n(1)),o=h(n(3)),s=h(n(25)),u=h(n(4)),l=h(n(22)),c=n(235),d=h(n(9)),p=n(16);function h(e){return e&&e.__esModule?e:{default:e}}t.convertToCameraBoundSnapshot=function(e,t){var n=e.getNextCameraBound(t);return(n.width>1e5||n.height>1e5)&&(n.width>n.height?(n.height=1e5*n.height/n.width,n.width=1e5):(n.width=1e5*n.width/n.height,n.height=1e5)),!n.width||!n.height||n.width<0||n.height<0?(e.app.logger.warn("[白板] boundary计算结果不可用，这次camera bound转换返回原值",(0,l.default)(n)),e.app.logger.warn("[白板] container宽高为",e.app.container.width,e.app.container.height),e.app.logger.warn("[白板] 快照类型",t.type),{type:"camera-bound",boundary:{centerX:e.centerX,centerY:e.centerY,width:e.width,height:e.height},skipUndo:!0,animate:!1,reuseOpType:"camera-bound"}):{type:"camera-bound",boundary:n,skipUndo:!0,animate:t.animate,reuseOpType:"camera-bound"}};var f=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="camera-bound",e.description="视角位置",e}return(0,u.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){(0,s.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"registerHooks",this).call(this),this.opsManager.hooks.opAdd.tap("OpAdd",this.onOpAdded.bind(this))}},{key:"eventsToListen",value:function(){return{"camera-bound:send":{value:this.sendCameraBound.bind(this),information:{args:"boundary: {centerX: number, centerY: number, width: number, width: number}, animate: boolean",message:"发送当前用户的camera-bound，常用于主播同步自己的camera-bound"}}}}},{key:"onOpAdded",value:function(e){var t=e.data;if(("video"===t.type||"audio"===t.type)&&!1===t.skipUndo&&t.boundary&&"follower"!==this.app.vision.mode){var n="video"===t.type?this.app.appConfig.videoFitStrategy:this.app.appConfig.audioFitStrategy;if(n&&n.type===c.MediaFitStrategy.Contain||e.uid===this.app.account&&!this.app.isRecordPlayer){var a=(0,p.extendCameraToSnap)({app:this.app,boundary:t.boundary,pad:0});a.needAdjust&&this.sendCameraBound(a.camera,!0)}else if(n&&n.type===c.MediaFitStrategy.FitPercentange){var r=t.boundary.w,i=t.boundary.h;r/i>this.app.container.width/this.app.container.height?i=r/this.app.container.width*this.app.container.height:r=i/this.app.container.height*this.app.container.width,this.sendCameraBound({centerX:t.boundary.sx+t.boundary.w/2,centerY:t.boundary.sy+t.boundary.h/2,width:r/n.value,height:i/n.value},!0)}}}},{key:"sendCameraBound",value:function(e,t){this.dispatch({type:"camera-bound",boundary:e,skipUndo:!0,animate:t,reuseOpType:"camera-bound"})}}]),t}(d.default);t.default=f},function(e,t,n){var a=n(81),r=Math.min;e.exports=function(e){return e>0?r(a(e),9007199254740991):0}},function(e,t){var n=0,a=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+a).toString(36))}},function(e,t){},function(e,t,n){var a=n(54),r=n(17)("toStringTag"),i="Arguments"==a(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),r))?n:i?a(t):"Object"==(o=a(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,n){e.exports={default:n(201),__esModule:!0}},function(e,t,n){e.exports={default:n(278),__esModule:!0}},function(e,t,n){e.exports={default:n(212),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=g(n(7)),r=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(4)),l=n(135),c=g(n(9)),d=n(136),p=g(d),h=g(n(23)),f=n(29);function g(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="",e.shouldSaniteEp=!1,e.points=[],e.sampleSeq=0,e.inProgressId="",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("PageChange",this.handlePageChange.bind(this))}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handlePageChange",value:function(){this.beginBatch(),this.sampleSeq=0,this.points=[]}},{key:"handleMouseMove",value:function(e,t,a){if(this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(224)+") 0 17, auto":document.body.style.cursor="auto",this.isMouseDown){t=Number(t.toFixed(1)),a=Number(a.toFixed(1)),this.points.push([t,a]);try{this.inProgressId?this.dispatch(this.getSnapshot(!0),!1,this.inProgressId):this.inProgressId=this.dispatch(this.getSnapshot(!0))}catch(e){this.logger.warn("[白板] MouseMoveDrawOp MouseMove Error: "+e)}this.sampleSeq+=1}}},{key:"handleMouseDown",value:function(e,t,n,a,r){this.beginBatch(),t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.points=[[t,n]],this.sampleSeq=0,this.inProgressId=""}},{key:"handleMouseUp",value:function(e,t,n,a,r){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(i||this.isMouseDown&&this.isMouseMoved){t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.points.push([t,n]);try{this.inProgressId?this.dispatch(this.getSnapshot(!1),!1,this.inProgressId):this.dispatch(this.getSnapshot(!1)),this.inProgressId=""}catch(e){this.logger.warn("[白板] MouseMoveDrawOp MouseUp Error: "+e)}this.points=[]}else i||!this.isMouseDown||this.isMouseMoved||this.dispatchClickSnap(e,t,n)}},{key:"handleClick",value:function(e,t,n,a,r){!this.dispatchClickSnap(e,t,n)&&this.opsManager.selectOp.selectedOpIds.length>0&&this.dispatch(this.opsManager.selectOp.getSnapshot([]))}},{key:"dispatchClickSnap",value:function(e,t,n){return!1}},{key:"getTwoPointShapeCommonProperty",value:function(e){return{type:this.type,boundary:this.getBoundaryRectOfLine(),sp:this.sp,ep:this.ep,lineWidth:h.default.penDef.lineWidth,stroke:h.default.penDef.stroke,inProgress:e.inProgress}}},{key:"getFreeDrawCommonProperty",value:function(e){return{type:this.type,boundary:this.getBoundaryRectOfFreeDraw(),lineWidth:h.default.penDef.lineWidth,stroke:h.default.penDef.stroke,inProgress:e.inProgress}}},{key:"getBoundaryRectOfFreeDraw",value:function(){var e=this.points.filter((function(e){return e}));if(0===e.length)throw this.logger.warn("[白板] 涂鸦没有记录任何数据"),new Error("涂鸦没有记录任何数据");var t=e[0][0],n=e[0][1],r=t,i=n,o=!0,s=!1,u=void 0;try{for(var c,d=(0,a.default)(e);!(o=(c=d.next()).done);o=!0){var p=c.value;t=(0,l.min)(p[0],t),n=(0,l.min)(p[1],n),r=(0,l.max)(p[0],r),i=(0,l.max)(p[1],i)}}catch(e){s=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw u}}return{sx:t,sy:n,w:Number((r-t).toFixed(2)),h:Number((i-n).toFixed(2))}}},{key:"getBoundaryRectOfLine",value:function(){var e=(0,l.min)(this.sp[0],this.ep[0]),t=(0,l.min)(this.sp[1],this.ep[1]),n=(0,l.max)(this.sp[0],this.ep[0]),a=(0,l.max)(this.sp[1],this.ep[1]);return{sx:e,sy:t,w:Number((n-e).toFixed(2)),h:Number((a-t).toFixed(2))}}},{key:"strokeOrFill",value:function(e,t){if(e.save(),t.dash===f.IDashType.Dashed){var n=2/this.app.scale;e.lineCap="butt",e.lineWidth=1/this.app.scale,e.setLineDash([n,2*n])}else e.lineWidth=t.lineWidth;if("number"==typeof t.opacity&&(e.globalAlpha=Number(t.opacity)),t.isShape&&t.dash!==f.IDashType.Dashed){var a=Number(e.lineWidth);e.lineWidth=0,e.clip(),e.lineWidth=2*a}t.fill&&(e.fillStyle=t.fill,e.fill()),t.stroke&&(t.fill&&-1!==t.stroke.indexOf("rgba")&&(e.strokeStyle=this.app.appConfig.canvasBgColor,e.stroke()),e.strokeStyle=t.stroke,e.stroke()),e.restore()}},{key:"sanityEp",value:function(e){return e[0]-this.sp[0]>=0&&e[0]-this.sp[0]<1&&(e[0]=this.sp[0]+1),e[1]-this.sp[1]>=0&&e[1]-this.sp[1]<1&&(e[1]=this.sp[1]+1),e}},{key:"intepSnap",value:function(e){return"pen"===this.type?p.default.getSmootherSnapshot({app:this.app,snapshot:e,now:Date.now()+this.app.ntpTimeDiff,interpolateFn:d.pointsIntepFn}):e}},{key:"sp",get:function(){return this.points[0]}},{key:"ep",get:function(){var e=this.points[this.points.length-1];return this.shouldSaniteEp&&(e=this.sanityEp(e)),e}}]),t}(c.default);t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataReportConnError=t.DataReportRunError=void 0;var a=o(n(95)),r=o(n(5)),i=o(n(22));function o(e){return e&&e.__esModule?e:{default:e}}t.DataReportRunError={Board_Lost:3,Page_Lost:4,Link_Id_Miss:5},t.DataReportConnError={Get_Channel_Error:1,IM_Join_Channel_Error:2,IM_Create_Channel_Error:3,Socket_Conn_Closed:4,HeartBeat_Timeout:5,Socket_Closed:6,Sync_Timeout:7,Resend_Count_Exceed_Max:8};t.default=function(e,t,n,o){fetch(e,{method:"post",headers:{"content-type":"application/json"},body:(0,i.default)({common:{device_id:"",session_id:n,sdk_type:"whiteboard",ver:"2.0"},event:(0,a.default)({},t,(0,r.default)((0,r.default)({},o),{sdkVersion:"3.9.1",userAgent:navigator.userAgent}))})})}},function(e,t,n){var a=n(20),r=n(15).document,i=a(r)&&a(r.createElement);e.exports=function(e){return i?r.createElement(e):{}}},function(e,t,n){var a=n(20);e.exports=function(e,t){if(!a(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!a(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!a(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!a(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var a=n(54);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==a(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,a=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?a:n)(e)}},function(e,t,n){var a=n(83)("keys"),r=n(69);e.exports=function(e){return a[e]||(a[e]=r(e))}},function(e,t,n){var a=n(8),r=n(15),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:a.version,mode:n(55)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){"use strict";var a=n(55),r=n(10),i=n(111),o=n(35),s=n(50),u=n(172),l=n(56),c=n(113),d=n(17)("iterator"),p=!([].keys&&"next"in[].keys()),h=function(){return this};e.exports=function(e,t,n,f,g,v,y){u(n,t,f);var m,M,x,w=function(e){if(!p&&e in T)return T[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},I=t+" Iterator",b="values"==g,k=!1,T=e.prototype,_=T[d]||T["@@iterator"]||g&&T[g],C=_||w(g),N=g?b?w("entries"):C:void 0,A="Array"==t&&T.entries||_;if(A&&(x=c(A.call(new e)))!==Object.prototype&&x.next&&(l(x,I,!0),a||"function"==typeof x[d]||o(x,d,h)),b&&_&&"values"!==_.name&&(k=!0,C=function(){return _.call(this)}),a&&!y||!p&&!k&&T[d]||o(T,d,C),s[t]=C,s[I]=h,g)if(m={values:b?C:w("values"),keys:v?C:w("keys"),entries:N},y)for(M in m)M in T||i(T,M,m[M]);else r(r.P+r.F*(p||k),t,m);return m}},function(e,t,n){t.f=n(17)},function(e,t,n){var a=n(69)("meta"),r=n(20),i=n(42),o=n(24).f,s=0,u=Object.isExtensible||function(){return!0},l=!n(36)((function(){return u(Object.preventExtensions({}))})),c=function(e){o(e,a,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:a,NEED:!1,fastKey:function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,a)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[a].i},getWeak:function(e,t){if(!i(e,a)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[a].w},onFreeze:function(e){return l&&d.NEED&&u(e)&&!i(e,a)&&c(e),e}}},function(e,t,n){var a=n(15),r=n(8),i=n(55),o=n(87),s=n(24).f;e.exports=function(e){var t=r.Symbol||(r.Symbol=i?{}:a.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t){e.exports=function(e,t,n,a){if(!(e instanceof t)||void 0!==a&&a in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var a=n(71),r=n(17)("iterator"),i=n(50);e.exports=n(8).getIteratorMethod=function(e){if(null!=e)return e[r]||e["@@iterator"]||i[a(e)]}},function(e,t,n){"use strict";var a=n(48);function r(e){var t,n;this.promise=new e((function(e,a){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=a})),this.resolve=a(t),this.reject=a(n)}e.exports.f=function(e){return new r(e)}},function(e,t,n){var a=n(35);e.exports=function(e,t,n){for(var r in t)n&&e[r]?e[r]=t[r]:a(e,r,t[r]);return e}},function(e,t,n){var a=n(20);e.exports=function(e,t){if(!a(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){"use strict";t.__esModule=!0;var a,r=n(105),i=(a=r)&&a.__esModule?a:{default:a};t.default=function(e,t,n){return t in e?(0,i.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.transformOp=function(e,t,n){var a=e.opsManager.opMap[n.data.type];if(!a)return t;try{return a&&"transformOp"in a?a.transformOp(t,n.data):t}catch(n){return e.logger.warn("transform op error"),e.logger.warn(t),e.logger.warn(n),t}},t.patchOp=function(e,t){var n=e.opsManager.opMap[t.data.type];try{n&&"patchOp"in n&&!t.data.hidden&&n.patchOp(t)}catch(n){e.logger.warn("patch op error"),e.logger.warn(t),e.logger.warn(n)}},t.opNeedRefresh=function(e,t){return(!(-1!==["select","laser","text"].indexOf(t.data.type)||-1!==e.opsManager.drawOpTypes.indexOf(t.data.type))||!t.data.inProgress)&&"mouse-pointer"!==t.data.type},t.getSelectedOpIds=function(e){var t=[],n=e.lastSelectOfUser[e.app.account];return n&&(t=n.data.selectedOpIds.slice()),t=t.filter((function(t){return e.drawOpQueue.hasOwnProperty(t)&&!e.drawOpQueue[t].data.locked}))},t.clearCtx=function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)},t.fillCtx=function(e){e.fillRect(0,0,e.canvas.width,e.canvas.height)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PlatformArray=["android","ios","pc","mac","pad","web"],t.TouchPlatformArray=["android","ios","pad"],t.overwritableTypes=["select","select-hover","camera-bound","mouse-pointer","laser"];var a=t.PluginType=void 0;!function(e){e[e.OneMotion=0]="OneMotion"}(a||(t.PluginType=a={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTextRange=t.inputHandler=t.beforeInputHandler=t.htmlToText=t.preventOverLen=void 0;var a,r=n(7),i=(a=r)&&a.__esModule?a:{default:a};t.setEditorTxt=h,t.getEditorPos=function(e,t){var n=t.xFactor,a=void 0===n?1:n,r=t.yFactor,i=void 0===r?1:r,o=t.boundary,u=t.mat,l=t.rAngle,c=t.shape,d=[[0,0],[1,1]];c&&e.ShapeDesc[c]&&(d=e.ShapeDesc[c].textB);var p=(0,s.getTransPoint)([o.sx+o.w*d[0][0]+0,o.sy+o.h*d[0][1]+0],u),h=(0,s.getTransPoint)([o.sx+o.w*d[1][0]-0,o.sy+o.h*d[0][1]+0],u),f=(0,s.getTransPoint)([o.sx+o.w*d[1][0]-0,o.sy+o.h*d[1][1]-0],u),g=(0,s.getTransPoint)([o.sx+o.w*d[0][0]+0,o.sy+o.h*d[1][1]-0],u),v=(o.w*(d[1][0]-d[0][0])-0)*Math.abs(a||1),y=(o.h*(d[1][1]-d[0][1])-0)*Math.abs(i||1),m=p[0],M=p[1];a<0&&i<0?(m=f[0],M=f[1]):a<0?(m=h[0],M=h[1]):i<0&&(m=g[0],M=g[1]);return{sx:m,sy:M,w:v,h:y,angle:l||0}};var o=n(31),s=n(30),u=n(16);t.preventOverLen=function(e,t){var n=t;if("paste"===e.type){var a=(e.clipboardData||window.clipboardData).getData("Text")||"";a=(0,u.convertWinTxtToUnixTxt)(a);var r=l(e.target);e.preventDefault(),e.stopPropagation(),a.length+r.length>n?(0,o.showToast)({msg:"文本输入超出最大限制",time:1,type:"warn"}):(document.execCommand("insertText",!1,a),(0,o.hideToast)())}else{if(e.ctrlKey||e.metaKey)return(0,o.hideToast)();if("Tab"===e.key)return e.preventDefault(),e.returnValue=!1,!1;if(-1!==["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Backspace","Delete","Tab","Escape","ContextMenu","Control","Shift","Alt","Meta","Home","End","PageUp","PageDown","Clear","Help","NumLock","Insert"].indexOf(e.key))return(0,o.hideToast)();var i=l(e.target),s=window.getSelection?window.getSelection().toString().length:0;i.length>=n+s?((0,o.showToast)({msg:"文本输入超出最大限制",time:1,type:"warn"}),e.preventDefault()):(0,o.hideToast)()}};var l=t.htmlToText=function e(t){var n="",a=t.childNodes;if(0===a.length)return t.tagName&&"br"===t.tagName.toLowerCase()?"\n":t.textContent;var r=!0,o=!1,s=void 0;try{for(var u,l=(0,i.default)(a);!(r=(u=l.next()).done);r=!0){var c=u.value;c.tagName&&"div"===c.tagName.toLowerCase()&&!n.endsWith("\n")&&(n+="\n"),n+=e(c,!1)}}catch(e){o=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw s}}return n},c={};t.beforeInputHandler=function(e){var t=e.target.dataset.editorId;c[t]=e.target.innerHTML},t.inputHandler=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=l(e.target);a&&(r="\n"===r?"":r);var i=e.target.dataset.editorId,s=n;r.length>s?((0,o.showToast)({msg:"文本输入超出最大限制",time:1,type:"warn"}),h(e.target,c[i],!1),delete c[i],t(l(e.target,!0))):(t(r,!0),delete c[i])};function d(e,t,n,a){if(a.done)return a;var r=null;if(0==e.childNodes.length)a.pos+=e.textContent.length;else for(var i=0;i<e.childNodes.length&&!a.done;i++){if((r=e.childNodes[i])===t)return a.pos+=n,a.done=!0,a;d(r,t,n,a)}return a}function p(e,t,n){if(n.done)return t;if(0==e.childNodes.length)e.textContent.length>=n.pos?(t.setStart(e,n.pos),n.done=!0):n.pos=n.pos-e.textContent.length;else for(var a=0;a<e.childNodes.length&&!n.done;a++)p(e.childNodes[a],t,n);return n.done?t:null}t.setTextRange=function(e,t){var n=void 0,a=void 0;window.getSelection&&document.createRange&&((a=document.createRange()).selectNodeContents(e),"start"===t?a.collapse(!0):("end"===t||0===a.toString().length)&&a.collapse(!1),(n=window.getSelection()).removeAllRanges(),n.addRange(a))};function h(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(l(e)!==t){var a=window.getSelection(),r=void 0;if(a){var i=a.focusNode,o=a.focusOffset;r=d(e,i,o,{pos:0,done:!1})}if(n?e.innerText=t:e.innerHTML=t,a&&r){a.removeAllRanges();var s=p(e,document.createRange(),{pos:r.pos,done:!1});s||(s=document.createRange()).selectNodeContents(e),s.collapse(!1),a.addRange(s)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.shouldDispatch=function(e){var t=e.vision.mode;return!("broadcaster"!==t&&"freeObserver"!==t&&!e.isRecordPlayer)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadioItem=void 0;var a=h(n(5)),r=h(n(19)),i=h(n(2)),o=h(n(0)),s=h(n(1)),u=h(n(3)),l=h(n(25)),c=h(n(4)),d=h(n(6)),p=n(40);function h(e){return e&&e.__esModule?e:{default:e}}n(396);t.RadioItem=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.changeHandler=function(t){var n=e.pickedProps,a=n.onChange,r=n.toolName,i=n.value;null==a||a({type:t.type,target:t.target,toolName:r,value:i,checked:t.target.checked}),e.forceUpdate()},e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"propsFilter",value:function(){(0,l.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"propsFilter",this).call(this,["onChange","checked"])}},{key:"defaultClassNames",get:function(){var e,n=this.pickedProps.checked;return(e=(0,l.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"defaultClassNames",this)).concat.apply(e,(0,r.default)(n?["radio-item","radio-item-checked"]:["radio-item"]))}},{key:"defaultStyle",get:function(){return(0,a.default)((0,a.default)({},(0,l.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"defaultStyle",this)),{pointerEvents:"none"})}},{key:"inputStyle",get:function(){return{position:"absolute",left:0,right:0,top:0,bottom:0,width:"100%",height:"100%",appearance:"none",pointerEvents:"all"}}},{key:"children",get:function(){var e=this.pickedProps,t=e.value,n=e.checked,r=e.disabled;return d.default.createElement("label",(0,a.default)({className:this.className,style:this.style},this.hoverProps),d.default.createElement("input",(0,a.default)({type:"radio",value:t,style:this.inputStyle},void 0!==n?{checked:n}:{},{disabled:r},this.nativeProps,{onChange:this.changeHandler})),this.itemChildren)}}]),t}(p.Item)},function(e,t,n){var a=n(61),r=n(53),i=n(41),o=n(78),s=n(42),u=n(109),l=Object.getOwnPropertyDescriptor;t.f=n(21)?l:function(e,t){if(e=i(e),t=o(t,!0),u)try{return l(e,t)}catch(e){}if(s(e,t))return r(!a.f.call(e,t),e[t])}},function(e,t,n){var a=n(10),r=n(8),i=n(36);e.exports=function(e,t){var n=(r.Object||{})[e]||Object[e],o={};o[e]=t(n),a(a.S+a.F*i((function(){n(1)})),"Object",o)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=!0;t.LOG=a,t.setLOG=function(e){t.LOG=a=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(262),i=(a=r)&&a.__esModule?a:{default:a};var o={mouse:(0,i.default)("mouse"),h5:(0,i.default)("h5"),package:(0,i.default)("package"),shape:(0,i.default)("shape"),user:(0,i.default)("user"),command:(0,i.default)("command"),image:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new Image;n.onload=function(){var a=["font-size: 14px;","padding: "+n.height/2+"px "+n.width/2+"px;","background: url("+e+") no-repeat;","background-size: contain;"].join(" ");console.log(t+"%c ",a)},n.src=e},m:{adapter:(0,i.default)("adapter"),worker:(0,i.default)("worker"),containermanager:(0,i.default)("containermanager"),shapemanager:(0,i.default)("shapemanager"),usermanager:(0,i.default)("usermanager"),syncmanager:(0,i.default)("syncmanager")},log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)};t.default=o},function(e,t,n){e.exports={default:n(186),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DPI=void 0;var a=p(n(5)),r=p(n(108)),i=p(n(38)),o=p(n(19)),s=p(n(7)),u=p(n(0)),l=p(n(1)),c=n(154),d=n(272);function p(e){return e&&e.__esModule?e:{default:e}}var h=t.DPI=window.devicePixelRatio||1,f=0,g=void 0,v=function(){function e(n){var l=this;(0,u.default)(this,e),this.elInitW=1920,this.elInitH=1080,this.mounted=!1,this.interactionEnabled=!0,this.streamFixedWidth=0,this.isLandscape=!1,this.elesToResize=[],this.top=0,this.left=0,this.focus=!1,this.keyPressed={},this.maybeClick=!1,this.mouseEventCache=[],this.isMouseDown=!1,this.isMouseMoved=!1,this.sx=0,this.sy=0,this.scx=0,this.scy=0,this.lastMx=0,this.lastMy=0,this.lastClientX=0,this.lastClientY=0,this.mouseSpeed=0,this.lastMouseT=0,this.lastTPos=[],this.lastSingleTPos=[],this.histScaleP=.5,this.currTC=0,this.inPan=!1,this.lastClickAt={x:0,y:0,t:0},this.onDPIChange=function(){t.DPI=h=window.devicePixelRatio,l.app.room.refresh()},this._delayedResize=function(e){if(e&&"scroll"===e.type){var t=l.el.getBoundingClientRect();if(t.left===l.left&&t.top===l.top)return}clearTimeout(g),g=setTimeout((function(){l._resize(!0)}),30)},this._resize=function(e){var t,n=l.el.getBoundingClientRect();l.containerRect=n,l.app.ifDeviceSupportOrientation&&(l.isLandscape=n.width>n.height);var a=!0,r=!1,i=void 0;try{for(var o,u=(0,s.default)(l.elesToResize);!(a=(o=u.next()).done);a=!0){var c=o.value;c.style.width=(0,d.evenify)(n.width)+"px",c.style.height=(0,d.evenify)(n.height)+"px",l.streamFixedWidth>0&&c===l.streamCanvas?(c.width=(0,d.evenify)(l.streamFixedWidth),c.height=(0,d.evenify)(c.width*n.height/n.width)):c instanceof HTMLCanvasElement&&(c!==l.streamCanvas||l.keepStreamDPI?(c.width=(0,d.evenify)(n.width*h),c.height=(0,d.evenify)(n.height*h)):(c.width=(0,d.evenify)(n.width),c.height=(0,d.evenify)(n.height)))}}catch(e){r=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw i}}l.top=n.top,l.left=n.left,l.setElePosition(l.h5El,"fixed"),l.setElePosition(l.domEl,"fixed"),l.ctx.lineCap="round",l.ctx.lineJoin="round",l.frontCtx.lineCap="round",l.frontCtx.lineJoin="round",l.localCtx.lineCap="round",l.localCtx.lineJoin="round",l.laserCtx.lineCap="round",l.laserCtx.lineJoin="round",l.streamCtx&&(l.streamCtx.lineCap="round",l.streamCtx.lineJoin="round"),e&&(null===(t=l.opsManager)||void 0===t||t.resize(e,n.width,n.height)),l.streamCanvas&&l.dispatcher.emit("event:appState:change","streamSize",{width:l.streamCanvas.width,height:l.streamCanvas.height}),l.dispatcher.emit("container:resize"),l.app.room.refresh()},this.unbindEvents=function(){var e;window.ResizeObserver&&(null===(e=l._ro)||void 0===e||e.disconnect()),window.removeEventListener("scroll",l._delayedResize,!0),window.removeEventListener("resize",l._delayedResize),window.removeEventListener("orientationchange",l._delayedResize),window.removeEventListener("mousewheel",l._mousewheel,{capture:!1}),window.removeEventListener("wheel",l._mousewheel,{capture:!1}),document.removeEventListener("gesturestart",l._zoom),document.removeEventListener("gesturechange",l._zoom),document.removeEventListener("gestureend",l._zoom),(0,c.off)(l.el,"mousedown",l.mousedown),(0,c.off)(l.el,"mouseleave",l._mouseleave),(0,c.off)(l.el,"focus",l.elFocus),(0,c.off)(l.el,"blur",l.elBlur),(0,c.off)(window.document,"mousemove",l.mousemove),(0,c.off)(window.document,"mouseup",l.mouseup,!0),(0,c.off)(l.el,"touchstart",l._touchdown),(0,c.off)(l.el,"touchmove",l._touchmove),(0,c.off)(l.el,"touchend",l._touchup),(0,c.off)(window.document,"keyup",l._keyup),(0,c.off)(window.document,"keydown",l._keydown),(0,c.off)(l.el,"contextmenu",l._contextmenu)},this.getEventClientPos=function(e){var t=void 0,n=void 0;return e.touches&&e.touches.length>0?(t=e.touches[0].clientX,n=e.touches[0].clientY):(t=e.clientX,n=e.clientY),t-=l.left,n-=l.top,[].concat((0,o.default)(l.app.camera.convertToPointInWorld(t,n)),[t,n])},this.getTouchEventClientPos=function(e){for(var t=[],n=0;n<e.touches.length;n++)t.push(e.touches[n].clientX),t.push(e.touches[n].clientY);return t},this._copy=function(e){l.focus&&l.app.opsManager.dupOp.copy(e)},this._paste=function(e){l.focus&&l.app.opsManager.dupOp.paste({event:e,fromWb:!1,mx:l.lastMx,my:l.lastMy})},this._contextmenu=function(e){e.preventDefault()},this._touchdown=function(e){l.mouseEmitTimer=clearTimeout(l.mouseEmitTimer),l.mouseEventCache=[];var t=e.touches.length;l.inPan=!1,l.currTC=t,l.lastAction=void 0,l.histScaleP=.5,1===t?l.mousedown(e):(l.mouseup(e),2===t&&(l.lastTPos=l.getTouchEventClientPos(e)))},this.elFocus=function(){l.focus=!0,l.keyPressed={}},this.elBlur=function(){l.focus=!1,l.keyPressed={}},this._touchmove=function(e){var t,n,a,r,i,o=e.touches.length;if(1===o&&l.inPan){var s=l.getTouchEventClientPos(e);l.lastSingleTPos.length>0&&(null===(t=l.opsManager)||void 0===t||t.pan(e,s[0]-l.lastSingleTPos[0],s[1]-l.lastSingleTPos[1])),l.lastSingleTPos=s}else if(1===o)l.mousemove(e);else if(2===o){var u=l.getTouchEventClientPos(e),c=(0,d.deltaXY)(l.lastTPos,u),p=(0,d.pinchScale)(l.lastTPos,u),h=(0,d.fingerDiff)(l.lastTPos,u);l.lastTPos=u;var f=Math.abs(c[0])/2+Math.abs(c[1])/2,g=Math.abs(1-p),v=(0,d.scaleProb)(h,f,g);v+l.histScaleP<.75&&f>.5?(null===(n=l.opsManager)||void 0===n||n.pan(e,c[0],c[1]),l.lastAction="pan"):v+l.histScaleP>=1.25&&g>.007?(p=Math.max(Math.min(p,1.2),.8),null===(a=l.opsManager)||void 0===a||a.scale(e,p,u[0]/2+u[2]/2,u[1]/2+u[3]/2),l.lastAction="scale"):"pan"===l.lastAction?null===(r=l.opsManager)||void 0===r||r.pan(e,c[0],c[1]):"move"===l.lastAction&&(null===(i=l.opsManager)||void 0===i||i.scale(e,p,u[0]/2+u[2]/2,u[1]/2+u[3]/2)),l.histScaleP=.8*l.histScaleP+.2*v}},this._touchup=function(e){var t=e.touches.length;l.lastSingleTPos=[],0===t?(l.mouseup(e,!1,!0),l.inPan=!1):1===t&&l.currTC>1?l.inPan=!0:l.inPan=!1,l.currTC=t},this.mousedown=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((l.interactionEnabled||t)&&!l.isMouseDown){l.isMouseMoved=!1,l.app.emit("event:mousedown");var n=l.getEventClientPos(e),a=(0,i.default)(n,4),r=a[0],o=a[1],s=a[2],u=a[3];l.lastMx=r,l.lastMy=o,l.lastClientX=s,l.lastClientY=u,l.isMouseDown=!0,l.maybeClick=!0,l.sx=r,l.sy=o,l.scx=s,l.scy=u,l.mouseEventCache.push({type:"mousedown",args:[e,l.sx,l.sy,s,u]}),l.mouseEmitTimer=setTimeout((function(){l.maybeClick=!1,l._emitMouseEvents()}),150)}},this.mousemove=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l.interactionEnabled||n){var a=l.getEventClientPos(e),r=(0,i.default)(a,4),o=r[0],s=r[1],u=r[2],c=r[3];if(l.lastMx=o,l.lastMy=s,l.lastClientX>0){var d=Date.now(),p=d-l.lastMouseT,h=l.lastClientX-u,f=l.lastClientY-c,g=Math.abs(Math.round(h/p*100)),v=Math.abs(Math.round(f/p*100));l.lastMouseT=d,l.mouseSpeed=g+v}l.lastClientX=u,l.lastClientY=c,l.isMouseMoved=!0,l.maybeClick=!1,l.mouseEmitTimer&&(l.mouseEmitTimer=clearTimeout(l.mouseEmitTimer),l._emitMouseEvents()),null===(t=l.opsManager)||void 0===t||t.mousemove(e,o,s,u,c)}},this.mouseup=function(e){var t,n,a,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((l.interactionEnabled||r)&&l.isMouseDown){l.app.emit("event:mouseup");var o=[l.lastMx,l.lastMy,l.lastClientX,l.lastClientY],s=o[0],u=o[1],c=o[2],d=o[3];if(l.maybeClick){l.mouseEmitTimer=clearTimeout(l.mouseEmitTimer),l.mouseEventCache=[],l.maybeClick=!1,i||null===(n=l.opsManager)||void 0===n||n.click(e,s,u,c,d);var p=Date.now();Math.abs(c-l.lastClickAt.x)<2&&Math.abs(d-l.lastClickAt.y)<2&&p-l.lastClickAt.t<250?(null===(a=l.opsManager)||void 0===a||a.dblClick(e,s,u,c,d),l.lastClickAt.t=0):i||(l.lastClickAt.x=c,l.lastClickAt.y=d,l.lastClickAt.t=p)}else l.mouseEmitTimer&&(l.mouseEmitTimer=clearTimeout(l.mouseEmitTimer),l._emitMouseEvents()),l.mouseEventCache=[],null===(t=l.opsManager)||void 0===t||t.mouseup(e,s,u,c,d);l.isMouseDown=!1}},this._mouseleave=function(e){var t,n=l.getEventClientPos(e),a=(0,i.default)(n,4),r=a[0],o=a[1],s=a[2],u=a[3];null===(t=l.opsManager)||void 0===t||t.mouseleave(e,r,o,s,u)},this._zoom=function(e){var t;if(l.isTargetOnContainer(e.target)){var n=l.getEventClientPos(e),a=(0,i.default)(n,4),r=a[0],o=a[1],s=a[2],u=a[3];return null===(t=l.opsManager)||void 0===t||t.mousewheel(e,r,o,s,u),e.preventDefault()}},this._mousewheel=function(e){var t,n;if(l.isTargetOnContainer(e.target)){var a=navigator.platform.toUpperCase().indexOf("MAC")>=0,o=navigator.userAgent.toUpperCase().indexOf("FIREFOX")>=0;if(a&&!o&&(0,r.default)(e.deltaX)&&(0,r.default)(e.deltaY)){if((f+=1)>2){var s=Math.max(Math.abs(e.deltaX),Math.abs(e.deltaY))/50,u=1.5*e.deltaX,c=1.5*e.deltaY;s>1&&(u/=s,c/=s),null===(t=l.opsManager)||void 0===t||t.pan(e,-u,-c)}}else{var d=l.getEventClientPos(e),p=(0,i.default)(d,4),h=p[0],g=p[1],v=p[2],y=p[3];null===(n=l.opsManager)||void 0===n||n.mousewheel(e,h,g,v,y),f=0}e.preventDefault()}},this._keyup=function(e){var t;if(e&&e.key&&l.focus){var n=e.key.toLocaleLowerCase();null===(t=l.opsManager)||void 0===t||t.keyup(e),l.keyPressed[n]=!1}},this._keydown=function(e){var t;if(e&&e.key&&l.focus){var n=e.key.toLocaleLowerCase();l.keyPressed[n]=!0,null===(t=l.opsManager)||void 0===t||t.keydown(e)}},this.isCtrlPressed=function(){return l.isKeyDown("control")||l.isKeyDown("meta")},this.app=n,this.dispatcher=n.dispatcher,this.el=document.createElement("div"),(0,a.default)(this.el.style,{userSelect:"none",webkitUserSelect:"none",position:"relative",width:"100%",height:"100%",outline:"none"}),this.el.id="yunxin-whiteboard",this.el.tabIndex=0,this.setBackgroundColor();var p=this.setupCanvasElement("bg-canvas");if(this.bgCanvas=p.canvas,this.bgCtx=p.ctx,this.h5El=this.setupDivElement("h5-el"),this.bottomEl=this.setupDivElement("bottom-el"),p=this.setupCanvasElement("anchor-canvas"),this.canvas=p.canvas,this.canvas.style["-webkit-font-smoothing"]="antialiased",this.ctx=p.ctx,p=this.setupCanvasElement("inc-canvas"),this.frontCanvas=p.canvas,this.frontCtx=p.ctx,p=this.setupCanvasElement("local-canvas"),this.localCanvas=p.canvas,this.localCtx=p.ctx,this.domEl=this.setupDivElement("dom-el"),this.topEl=this.setupDivElement("top-el"),p=this.setupCanvasElement("laser-canvas"),this.laserCanvas=p.canvas,this.laserCtx=p.ctx,"function"==typeof matchMedia){var v=matchMedia("(resolution: "+window.devicePixelRatio+"dppx)");"function"==typeof v.addEventListener?v.addEventListener("change",this.onDPIChange,{once:!0}):"function"==typeof v.addListener&&v.addListener(this.onDPIChange)}}return(0,l.default)(e,[{key:"disableInteraction",value:function(){this.interactionEnabled=!1}},{key:"enableInteraction",value:function(){this.interactionEnabled=!0}},{key:"setBackgroundColor",value:function(){this.el.style.backgroundColor=this.app.appConfig.canvasBgColor}},{key:"getStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.el.getBoundingClientRect();this.streamFixedWidth=e.width?e.width:0;var a=!e.hasOwnProperty("keepDPI")||e.keepDPI;this.keepStreamDPI=a;var r=e.width?e.width:a?n.width*h:n.width,i=r*n.height/n.width;if(r=(0,d.evenify)(r),i=(0,d.evenify)(i),!this.streamCanvas){var o=this.setupCanvasElement("stream-canvas");this.streamCanvas=o.canvas,this.streamCanvas.style.visibility="hidden",this.streamCtx=o.ctx}return this.streamCanvas.width=r,this.streamCanvas.height=i,this.streamCanvas.style.width=n.width+"px",this.streamCanvas.style.height=n.height+"px",this.streamCtx&&(this.streamCtx.lineCap="round",this.streamCtx.lineJoin="round"),this.streamCanvas&&this.dispatcher.emit("event:appState:change","streamSize",{width:this.streamCanvas.width,height:this.streamCanvas.height}),t||!this.stream?(this.stopStream(),this.stream=this.streamCanvas.captureStream(),this.stream):this.stream}},{key:"stopStream",value:function(){if(this.stream){var e=this.stream.getTracks(),t=!0,n=!1,a=void 0;try{for(var r,i=(0,s.default)(e);!(t=(r=i.next()).done);t=!0){r.value.stop()}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}this.stream=void 0}}},{key:"appendTo",value:function(e){this.mounted=!0,e.style.overflow="hidden",e.appendChild(this.el),this._resize(),this._bindEvents(e)}},{key:"addOpsManager",value:function(e){this.opsManager=e}},{key:"isKeyDown",value:function(e){return this.keyPressed.hasOwnProperty(e)&&this.keyPressed[e]}},{key:"resize",value:function(){this._resize()}},{key:"isTargetOnContainer",value:function(e){for(;e;){if(e===this.el)return!0;e=e.parentNode}return!1}},{key:"setupDivElement",value:function(e){var t=document.createElement("div");return t.style.pointerEvents="none",t.style.transformOrigin="left top",t.className=e,this.el.appendChild(t),t}},{key:"setupCanvasElement",value:function(e){var t=document.createElement("canvas");this.setElePosition(t),t.className=e,t.style.imageRendering="pixelated",t.style.pointerEvents="none";var n=t.getContext("2d");return this.el.appendChild(t),this.elesToResize.push(t),{canvas:t,ctx:n}}},{key:"_bindEvents",value:function(e){var t,n=this;this.unbindEvents(),window.ResizeObserver&&(this._ro=new window.ResizeObserver((function(e,t){n._delayedResize()})),null===(t=this._ro)||void 0===t||t.observe(e)),window.addEventListener("scroll",this._delayedResize,!0),window.addEventListener("resize",this._delayedResize),window.addEventListener("orientationchange",this._delayedResize),(0,c.on)(this.el,"mousedown",this.mousedown),(0,c.on)(this.el,"mouseleave",this._mouseleave),(0,c.on)(this.el,"focus",this.elFocus),(0,c.on)(this.el,"blur",this.elBlur),(0,c.on)(window.document,"mousemove",this.mousemove),(0,c.on)(window.document,"mouseup",this.mouseup,!0),window.addEventListener("wheel",this._mousewheel,{passive:!1,capture:!1}),window.addEventListener("mousewheel",this._mousewheel,{passive:!1,capture:!1}),document.addEventListener("gesturestart",this._zoom),document.addEventListener("gesturechange",this._zoom),document.addEventListener("gestureend",this._zoom),(0,c.on)(this.el,"touchstart",this._touchdown),(0,c.on)(this.el,"touchmove",this._touchmove),(0,c.on)(this.el,"touchend",this._touchup),(0,c.on)(window.document,"keyup",this._keyup),(0,c.on)(window.document,"keydown",this._keydown),(0,c.on)(this.el,"contextmenu",this._contextmenu),window.addEventListener("copy",this._copy),window.addEventListener("paste",this._paste)}},{key:"destroy",value:function(){this.unbindEvents(),this.stopStream(),this.el&&(this.el.innerHTML="")}},{key:"setElePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"absolute";"absolute"===t?(e.style.position=t,e.style.left="0px",e.style.right="0px",e.style.top="0px",e.style.bottom="0px"):(e.style.position="fixed",e.style.left=this.left+"px",e.style.width=this.width+"px",e.style.top=this.top+"px",e.style.height=this.height+"px")}},{key:"_emitMouseEvents",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,r=(0,s.default)(this.mouseEventCache);!(e=(a=r.next()).done);e=!0){var i,u=a.value;(i=this.opsManager)[u.type].apply(i,(0,o.default)(u.args))}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}this.mouseEventCache=[]}},{key:"width",get:function(){return this.containerRect?this.containerRect.width:this.canvas.width}},{key:"height",get:function(){return this.containerRect?this.containerRect.height:this.canvas.height}}]),e}();t.default=v},function(e,t,n){e.exports={default:n(374),__esModule:!0}},function(e,t,n){e.exports={default:n(162),__esModule:!0}},function(e,t,n){e.exports=!n(21)&&!n(36)((function(){return 7!=Object.defineProperty(n(77)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var a=n(42),r=n(41),i=n(168)(!1),o=n(82)("IE_PROTO");e.exports=function(e,t){var n,s=r(e),u=0,l=[];for(n in s)n!=o&&a(s,n)&&l.push(n);for(;t.length>u;)a(s,n=t[u++])&&(~i(l,n)||l.push(n));return l}},function(e,t,n){e.exports=n(35)},function(e,t,n){var a=n(15).document;e.exports=a&&a.documentElement},function(e,t,n){var a=n(42),r=n(43),i=n(82)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),a(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){e.exports={default:n(175),__esModule:!0}},function(e,t,n){var a=n(54);e.exports=Array.isArray||function(e){return"Array"==a(e)}},function(e,t,n){var a=n(110),r=n(84).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return a(e,r)}},function(e,t,n){var a=n(26);e.exports=function(e,t,n,r){try{return r?t(a(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&a(i.call(e)),t}}},function(e,t,n){var a=n(50),r=n(17)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(a.Array===e||i[r]===e)}},function(e,t,n){var a=n(26),r=n(48),i=n(17)("species");e.exports=function(e,t){var n,o=a(e).constructor;return void 0===o||null==(n=a(o)[i])?t:r(n)}},function(e,t,n){var a,r,i,o=n(32),s=n(153),u=n(112),l=n(77),c=n(15),d=c.process,p=c.setImmediate,h=c.clearImmediate,f=c.MessageChannel,g=c.Dispatch,v=0,y={},m=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},M=function(e){m.call(e.data)};p&&h||(p=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++v]=function(){s("function"==typeof e?e:Function(e),t)},a(v),v},h=function(e){delete y[e]},"process"==n(54)(d)?a=function(e){d.nextTick(o(m,e,1))}:g&&g.now?a=function(e){g.now(o(m,e,1))}:f?(i=(r=new f).port2,r.port1.onmessage=M,a=o(i.postMessage,i,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(a=function(e){c.postMessage(e+"","*")},c.addEventListener("message",M,!1)):a="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),m.call(e)}}:function(e){setTimeout(o(m,e,1),0)}),e.exports={set:p,clear:h}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var a=n(26),r=n(20),i=n(92);e.exports=function(e,t){if(a(e),r(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var a=n(15),r=n(8),i=n(24),o=n(21),s=n(17)("species");e.exports=function(e){var t="function"==typeof r[e]?r[e]:a[e];o&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var a=n(17)("iterator"),r=!1;try{var i=[7][a]();i.return=function(){r=!0},Array.from(i,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var i=[7],o=i[a]();o.next=function(){return{done:n=!0}},i[a]=function(){return o},e(i)}catch(e){}return n}},function(e,t,n){"use strict";var a=n(24).f,r=n(63),i=n(93),o=n(32),s=n(90),u=n(57),l=n(86),c=n(114),d=n(124),p=n(21),h=n(88).fastKey,f=n(94),g=p?"_s":"size",v=function(e,t){var n,a=h(t);if("F"!==a)return e._i[a];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,l){var c=e((function(e,a){s(e,c,t,"_i"),e._t=t,e._i=r(null),e._f=void 0,e._l=void 0,e[g]=0,null!=a&&u(a,n,e[l],e)}));return i(c.prototype,{clear:function(){for(var e=f(this,t),n=e._i,a=e._f;a;a=a.n)a.r=!0,a.p&&(a.p=a.p.n=void 0),delete n[a.i];e._f=e._l=void 0,e[g]=0},delete:function(e){var n=f(this,t),a=v(n,e);if(a){var r=a.n,i=a.p;delete n._i[a.i],a.r=!0,i&&(i.n=r),r&&(r.p=i),n._f==a&&(n._f=r),n._l==a&&(n._l=i),n[g]--}return!!a},forEach:function(e){f(this,t);for(var n,a=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(a(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!v(f(this,t),e)}}),p&&a(c.prototype,"size",{get:function(){return f(this,t)[g]}}),c},def:function(e,t,n){var a,r,i=v(e,t);return i?i.v=n:(e._l=i={i:r=h(t,!0),k:t,v:n,p:a=e._l,n:void 0,r:!1},e._f||(e._f=i),a&&(a.n=i),e[g]++,"F"!==r&&(e._i[r]=i)),e},getEntry:v,setStrong:function(e,t,n){l(e,t,(function(e,n){this._t=f(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?c(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,c(1))}),n?"entries":"values",!n,!0),d(t)}}},function(e,t,n){"use strict";var a=n(15),r=n(10),i=n(88),o=n(36),s=n(35),u=n(93),l=n(57),c=n(90),d=n(20),p=n(56),h=n(24).f,f=n(194)(0),g=n(21);e.exports=function(e,t,n,v,y,m){var M=a[e],x=M,w=y?"set":"add",I=x&&x.prototype,b={};return g&&"function"==typeof x&&(m||I.forEach&&!o((function(){(new x).entries().next()})))?(x=t((function(t,n){c(t,x,e,"_c"),t._c=new M,null!=n&&l(n,y,t[w],t)})),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in I)||m&&"clear"==e||s(x.prototype,e,(function(n,a){if(c(this,x,e),!t&&m&&!d(n))return"get"==e&&void 0;var r=this._c[e](0===n?0:n,a);return t?this:r}))})),m||h(x.prototype,"size",{get:function(){return this._c.size}})):(x=v.getConstructor(t,e,y,w),u(x.prototype,n),i.NEED=!0),p(x,e),b[e]=x,r(r.G+r.W+r.F,b),m||v.setStrong(x,e,y),x}},function(e,t,n){var a=n(71),r=n(198);e.exports=function(e){return function(){if(a(this)!=e)throw TypeError(e+"#toJSON isn't generic");return r(this)}}},function(e,t,n){"use strict";var a=n(10);e.exports=function(e){a(a.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var a=n(10),r=n(48),i=n(32),o=n(57);e.exports=function(e){a(a.S,e,{from:function(e){var t,n,a,s,u=arguments[1];return r(this),(t=void 0!==u)&&r(u),null==e?new this:(n=[],t?(a=0,s=i(u,arguments[2],2),o(e,!1,(function(e){n.push(s(e,a++))}))):o(e,!1,n.push,n),new this(n))}})}},function(e,t,n){e.exports={default:n(210),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0,r=void 0;void 0!==document.hidden?(a="hidden",r="visibilitychange"):void 0!==document.msHidden?(a="msHidden",r="msvisibilitychange"):void 0!==document.webkitHidden&&(a="webkitHidden",r="webkitvisibilitychange");t.registerVisibleChangeHandler=function(e,t){function n(){document[a]?t():e()}return document.addEventListener(r,n,!1),function(){document.removeEventListener(r,n)}}},function(e,t,n){var a=n(24),r=n(26),i=n(49);e.exports=n(21)?Object.defineProperties:function(e,t){r(e);for(var n,o=i(t),s=o.length,u=0;s>u;)a.f(e,n=o[u++],t[n]);return e}},function(e,t,n){"use strict";var a=n(15),r=n(42),i=n(21),o=n(10),s=n(111),u=n(88).KEY,l=n(36),c=n(83),d=n(56),p=n(69),h=n(17),f=n(87),g=n(89),v=n(176),y=n(116),m=n(26),M=n(20),x=n(43),w=n(41),I=n(78),b=n(53),k=n(63),T=n(177),_=n(101),C=n(85),N=n(24),A=n(49),P=_.f,O=N.f,D=T.f,S=a.Symbol,E=a.JSON,j=E&&E.stringify,L=h("_hidden"),z=h("toPrimitive"),R={}.propertyIsEnumerable,B=c("symbol-registry"),F=c("symbols"),Y=c("op-symbols"),U=Object.prototype,W="function"==typeof S&&!!C.f,H=a.QObject,Q=!H||!H.prototype||!H.prototype.findChild,Z=i&&l((function(){return 7!=k(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a}))?function(e,t,n){var a=P(U,t);a&&delete U[t],O(e,t,n),a&&e!==U&&O(U,t,a)}:O,G=function(e){var t=F[e]=k(S.prototype);return t._k=e,t},V=W&&"symbol"==typeof S.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof S},X=function(e,t,n){return e===U&&X(Y,t,n),m(e),t=I(t,!0),m(n),r(F,t)?(n.enumerable?(r(e,L)&&e[L][t]&&(e[L][t]=!1),n=k(n,{enumerable:b(0,!1)})):(r(e,L)||O(e,L,b(1,{})),e[L][t]=!0),Z(e,t,n)):O(e,t,n)},J=function(e,t){m(e);for(var n,a=v(t=w(t)),r=0,i=a.length;i>r;)X(e,n=a[r++],t[n]);return e},K=function(e){var t=R.call(this,e=I(e,!0));return!(this===U&&r(F,e)&&!r(Y,e))&&(!(t||!r(this,e)||!r(F,e)||r(this,L)&&this[L][e])||t)},q=function(e,t){if(e=w(e),t=I(t,!0),e!==U||!r(F,t)||r(Y,t)){var n=P(e,t);return!n||!r(F,t)||r(e,L)&&e[L][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=D(w(e)),a=[],i=0;n.length>i;)r(F,t=n[i++])||t==L||t==u||a.push(t);return a},ee=function(e){for(var t,n=e===U,a=D(n?Y:w(e)),i=[],o=0;a.length>o;)!r(F,t=a[o++])||n&&!r(U,t)||i.push(F[t]);return i};W||(s((S=function(){if(this instanceof S)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(n){this===U&&t.call(Y,n),r(this,L)&&r(this[L],e)&&(this[L][e]=!1),Z(this,e,b(1,n))};return i&&Q&&Z(U,e,{configurable:!0,set:t}),G(e)}).prototype,"toString",(function(){return this._k})),_.f=q,N.f=X,n(117).f=T.f=$,n(61).f=K,C.f=ee,i&&!n(55)&&s(U,"propertyIsEnumerable",K,!0),f.f=function(e){return G(h(e))}),o(o.G+o.W+o.F*!W,{Symbol:S});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)h(te[ne++]);for(var ae=A(h.store),re=0;ae.length>re;)g(ae[re++]);o(o.S+o.F*!W,"Symbol",{for:function(e){return r(B,e+="")?B[e]:B[e]=S(e)},keyFor:function(e){if(!V(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){Q=!0},useSimple:function(){Q=!1}}),o(o.S+o.F*!W,"Object",{create:function(e,t){return void 0===t?k(e):J(k(e),t)},defineProperty:X,defineProperties:J,getOwnPropertyDescriptor:q,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var ie=l((function(){C.f(1)}));o(o.S+o.F*ie,"Object",{getOwnPropertySymbols:function(e){return C.f(x(e))}}),E&&o(o.S+o.F*(!W||l((function(){var e=S();return"[null]"!=j([e])||"{}"!=j({a:e})||"{}"!=j(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,a=[e],r=1;arguments.length>r;)a.push(arguments[r++]);if(n=t=a[1],(M(t)||void 0!==e)&&!V(e))return y(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!V(t))return t}),a[1]=t,j.apply(E,a)}}),S.prototype[z]||n(35)(S.prototype,z,S.prototype.valueOf),d(S,"Symbol"),d(Math,"Math",!0),d(a.JSON,"JSON",!0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.min=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.min(e,t)}))},t.max=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.max(e,t)}))},t.copyImgToClipBoard=function(e,t){try{var n=function(e,t){e=e.replace(/^data:image\/png;base64,/,"");for(var n=window.atob(e),a=new ArrayBuffer(n.length),r=new Uint8Array(a),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return new Blob([a],{type:t})}(e,"image/png"),a=new ClipboardItem({"image/png":n});navigator.clipboard.write([a]),t(!0)}catch(e){console.error("拷贝图片至剪切板失败",e),t(!1)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pointInterpFn=t.pointsIntepFn=void 0;var a=u(n(95)),r=u(n(5)),i=u(n(0)),o=u(n(1)),s=n(218);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,i.default)(this,e),this.info={}}return(0,o.default)(e,[{key:"getSmootherSnapshot",value:function(e){var t=e.snapshot,n=e.now,a=e.maxDiff,r=void 0===a?300:a,i=e.interpolateFn,o=e.app;if(o.isRecordPlayer)return t;var u=s.MINIMUM_BROADCAST_GAP_PER_DATATYPE>=25?s.MINIMUM_BROADCAST_GAP_PER_DATATYPE:70,l=n-t.time;if(t.uid===o.account)return t;var c=t.opId;if(!t.data.inProgress)return delete this.info[c],t;if(!this.info.hasOwnProperty(c)){if(l>r)return t;this.info[c]={p:{t:n-u,d:void 0},c:{t:n,d:t},lastP:0}}var d=this.info[c];d.c.d!==t&&(d.p={t:d.c.t,d:i(d.p.d,d.c.d,d.lastP)},d.c={t:n,d:t}),d.p.t=Math.max(d.p.t,d.c.t-r);var p=n-d.c.t,h=d.c.t-d.p.t;p>h&&(d.p=d.c,d.lastP=1);var f=Math.min(1,Math.max(0,p/h));return d.lastP=f,1===f?t:(o.room.pageToIncRefresh=o.room.currBoard.currPage,i(d.p.d,d.c.d,f))}}]),e}(),c=(t.pointsIntepFn=function(e,t,n){var a=e?e.data.points.length:0,i=t.data.points.length;if(i<=a)return t;var o=Math.floor(i*n+a*(1-n));return(0,r.default)((0,r.default)({},t),{data:(0,r.default)((0,r.default)({},t.data),{points:t.data.points.slice(0,o)})})},t.pointInterpFn=function(e,t){return function(n,i,o){return n||t?!n&&t?(0,r.default)((0,r.default)({},i),{data:(0,r.default)((0,r.default)({},i.data),(0,a.default)({},e,[i.data[e][0]*o+i.data[t][0]*(1-o),i.data[e][1]*o+i.data[t][1]*(1-o)]))}):(0,r.default)((0,r.default)({},i),{data:(0,r.default)((0,r.default)({},i.data),(0,a.default)({},e,[i.data[e][0]*o+n.data[e][0]*(1-o),i.data[e][1]*o+n.data[e][1]*(1-o)]))}):i}},new l);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(5)),r=h(n(19)),i=h(n(7)),o=n(29),s=n(39),u=h(n(142)),l=n(13),c=n(65),d=n(64),p=n(16);function h(e){return e&&e.__esModule?e:{default:e}}var f={graphInit:function(e){var t=e.start,n=e.end,a=e.op,r=e.data,i=t.dir,u=n.dir,d={sx:t.x,sy:t.y,w:1,h:1},p={sx:n.x,sy:n.y,w:1,h:1},h={sx:t.x,sy:t.y,w:1,h:1},f={sx:n.x,sy:n.y,w:1,h:1};if(r&&r.start.type!==o.IEndPointType.COORD){var g=a.drawOpsOfPage[r.start.id];g&&(d=(0,l.getTransformedBoundary)(a.app.scale,{mat:g.data.mat,boundary:g.data.boundary,pad:12}),h=(0,l.getTransformedBoundary)(a.app.scale,{mat:g.data.mat,boundary:g.data.boundary,pad:0}),i=(0,s.getDirInShape)(a.app,g.data.shape,r.start.per||0),i=(0,s.getDirAftRotate)(i,g.data.rAngle,g.data.xFactor,g.data.yFactor))}if(r&&r.end.type!==o.IEndPointType.COORD){var v=a.drawOpsOfPage[r.end.id];v&&(p=(0,l.getTransformedBoundary)(a.app.scale,{mat:v.data.mat,boundary:v.data.boundary,pad:12}),f=(0,l.getTransformedBoundary)(a.app.scale,{mat:v.data.mat,boundary:v.data.boundary,pad:0}),u=(0,s.getDirInShape)(a.app,v.data.shape,r.end.per||0),u=(0,s.getDirAftRotate)(u,v.data.rAngle,v.data.xFactor,v.data.yFactor))}t.dir=i,n.dir=u;var y=(0,s.getExtP)(t,25,d),m=(0,s.getExtP)(n,25,p),M=(0,s.isPExtentFrom)(y,m),x=(0,s.isPExtentFrom)(m,y),w=(0,s.isPExtentFrom)(t,n),I=t.dir===o.DIRECTION.LEFT||t.dir===o.DIRECTION.RIGHT,b=n.dir===o.DIRECTION.LEFT||n.dir===o.DIRECTION.RIGHT,k=Math.max(d.sx+d.w,p.sx+p.w)+6,T=Math.max(d.sy+d.h,p.sy+p.h)+6,_=Math.min(d.sx,p.sx)-6,C=Math.min(d.sy,p.sy)-6,N=(0,l.dist)([y.x,y.y],[m.x,m.y])<30,A=(0,s.isPInsideRect)([y.x,y.y],f),P=(0,s.isPInsideRect)([m.x,m.y],h);if(I===b&&t.dir!==n.dir){if(w||A||P){var O={x:t.x/2+n.x/2,y:t.y/2+n.y/2,type:o.IConnPointType.Split};return(I?Math.abs(n.y-t.y):Math.abs(t.x-n.x))<c.SEG_MERGE_THRES/a.app.scale?{start:t,end:n,connPs:[O]}:{start:t,end:n,connPs:[{x:I?t.x/2+O.x/2:t.x,y:I?t.y:t.y/2+O.y/2,type:o.IConnPointType.Split},O,{x:I?n.x/2+O.x/2:n.x,y:I?n.y:n.y/2+O.y/2,type:o.IConnPointType.Split}]}}if(I){var D=void 0;return d.sy>p.sy+p.h+12?D=(p.sy+p.h)/2+d.sy/2:d.sy+d.h+12<p.sy?D=(d.sy+d.h)/2+p.sy/2:(D=t.y>n.y?T:C,(0,s.isSegInRect)([m.x,m.y],[m.x,D],d)&&(m.x=n.dir===o.DIRECTION.RIGHT?k:_)),{start:t,end:n,connPs:[{x:t.x/2+y.x/2,y:t.y,type:o.IConnPointType.Split},{x:y.x,y:y.y/2+D/2,type:o.IConnPointType.Split},{x:y.x/2+m.x/2,y:D,type:o.IConnPointType.Split},{x:m.x,y:m.y/2+D/2,type:o.IConnPointType.Split},{x:n.x/2+m.x/2,y:n.y,type:o.IConnPointType.Split}]}}var S=void 0;return d.sx>p.sx+p.w+12?S=(p.sx+p.w)/2+d.sx/2:d.sx+d.w+12<p.sx?S=(d.sx+d.w)/2+p.sx/2:(S=t.x>n.x?k:_,(0,s.isSegInRect)([m.x,m.y],[S,m.y],d)&&(m.y=n.dir===o.DIRECTION.DOWN?T:C)),{start:t,end:n,connPs:[{x:t.x,y:t.y/2+y.y/2,type:o.IConnPointType.Split},{x:y.x/2+S/2,y:y.y,type:o.IConnPointType.Split},{x:S,y:y.y/2+m.y/2,type:o.IConnPointType.Split},{x:m.x/2+S/2,y:m.y,type:o.IConnPointType.Split},{x:n.x,y:n.y/2+m.y/2,type:o.IConnPointType.Split}]}}if(I===b){var E=t.dir===o.DIRECTION.LEFT&&n.x>t.x||t.dir===o.DIRECTION.RIGHT&&n.x<t.x||t.dir===o.DIRECTION.UP&&n.y>t.y||t.dir===o.DIRECTION.DOWN&&n.y<t.y,j=I?E?{x:y.x,y:m.y}:{x:m.x,y:y.y}:E?{x:m.x,y:y.y}:{x:y.x,y:m.y},L=E?m:y,z=E?h:f,R=E?d:p;return A||P||!(0,s.isSegInRect)([j.x,j.y],[L.x,L.y],z)?I?{start:t,end:n,connPs:[{x:t.x/2+j.x/2,y:t.y,type:o.IConnPointType.Split},{x:j.x,y:t.y/2+n.y/2,type:o.IConnPointType.Split},{x:n.x/2+j.x/2,y:n.y,type:o.IConnPointType.Split}]}:{start:t,end:n,connPs:[{x:t.x,y:t.y/2+j.y/2,type:o.IConnPointType.Split},{x:t.x/2+n.x/2,y:j.y,type:o.IConnPointType.Split},{x:n.x,y:n.y/2+j.y/2,type:o.IConnPointType.Split}]}:I?(j.y=R.sy+R.h+12,{start:t,end:n,connPs:[{x:t.x/2+y.x/2,y:t.y,type:o.IConnPointType.Split},{x:y.x,y:y.y/2+j.y/2,type:o.IConnPointType.Split},{x:y.x/2+m.x/2,y:j.y,type:o.IConnPointType.Split},{x:m.x,y:m.y/2+j.y/2,type:o.IConnPointType.Split},{x:n.x/2+m.x/2,y:n.y,type:o.IConnPointType.Split}]}):(j.x=R.sx+R.w+12,{start:t,end:n,connPs:[{x:t.x,y:t.y/2+y.y/2,type:o.IConnPointType.Split},{x:y.x/2+j.x/2,y:y.y,type:o.IConnPointType.Split},{x:j.x,y:y.y/2+m.y/2,type:o.IConnPointType.Split},{x:m.x/2+j.x/2,y:m.y,type:o.IConnPointType.Split},{x:n.x,y:n.y/2+m.y/2,type:o.IConnPointType.Split}]})}if(M&&x||N||A||P)return{start:t,end:n,connPs:[{x:I?t.x/2+n.x/2:t.x,y:I?t.y:t.y/2+n.y/2,type:o.IConnPointType.Split},{x:I?n.x:t.x/2+n.x/2,y:I?n.y/2+t.y/2:n.y,type:o.IConnPointType.Split}]};var B=I?{x:y.x,y:m.y}:{x:m.x,y:y.y};return(0,s.isSegInRect)([y.x,y.y],[B.x,B.y],f)?(0,s.isPInsideRect)([B.x,B.y],f)||(t.dir===o.DIRECTION.RIGHT?B.x=k:t.dir===o.DIRECTION.LEFT?B.x=_:t.dir===o.DIRECTION.UP?B.y=C:t.dir===o.DIRECTION.DOWN&&(B.y=T)):(0,s.isSegInRect)([m.x,m.y],[B.x,B.y],h)&&((0,s.isPInsideRect)([B.x,B.y],h)||(n.dir===o.DIRECTION.RIGHT?B.x=k:n.dir===o.DIRECTION.LEFT?B.x=_:n.dir===o.DIRECTION.UP?B.y=C:n.dir===o.DIRECTION.DOWN&&(B.y=T))),{start:t,end:n,connPs:[{x:I?t.x/2+B.x/2:t.x,y:I?t.y:t.y/2+B.y/2,type:o.IConnPointType.Split},{x:I?B.x:t.x/2+B.x/2,y:I?B.y/2+t.y/2:B.y,type:o.IConnPointType.Split},{x:I?B.x/2+n.x/2:B.x,y:I?B.y:B.y/2+n.y/2,type:o.IConnPointType.Split},{x:I?n.x:n.x/2+B.x/2,y:I?n.y/2+B.y/2:n.y,type:o.IConnPointType.Split}]}},graphFromAnchors:function(e){var t=e.start,n=e.end,a=e.anchors,i=e.op;if(0===a.length)return f.graphInit(e);var s=t.dir===o.DIRECTION.LEFT||t.dir===o.DIRECTION.RIGHT,u={x:s?t.x/2+a[0].x/2:t.x,y:s?t.y:t.y/2+a[0].y/2,type:o.IConnPointType.Split},l=a.length%2==1?s:!s,c={x:l?n.x/2+a[a.length-1].x/2:n.x,y:l?n.y:n.y/2+a[a.length-1].y/2,type:o.IConnPointType.Split};return f.tidyGraph({start:t,end:n,op:i,connPs:[u].concat((0,r.default)(a),[c])})},getEndAngle:function(e){var t=e.data,n=(e.op,t._points||[]);return n.length<2?[(0,l.getAngleByDir)(t.start.dir),(0,l.getAngleByDir)(t.end.dir)]:[(0,l.getVecAngle)(n[1],n[0]),(0,l.getVecAngle)(n[n.length-2],n[n.length-1])]},isUnderRect:function(e){var t=e.data,n=e.rect,a=e.selectMode,r=t._points,i=void 0===r?[]:r;if("intersect"===a){for(var o=1;o<i.length;o++)if((0,s.isSegInRect)(i[o-1],i[o],n))return!0;return!1}for(var u=1;u<i.length;u++)if(!(0,l.polygonContain)([i[u-1],i[u]],[[n.sx,n.sy],[n.sx+n.w,n.sy],[n.sx+n.w,n.sy+n.h],[n.sx,n.sy+n.h]]))return!1;return!0},isUnderPoint:function(e){for(var t=e.data,n=e.p,a=e.op,r=t._points,i=void 0===r?[]:r,o=1;o<i.length;o++)if((0,s.pDist)(n,i[o-1],i[o])<c.SEG_UNDER_POINT_THRES/a.app.scale)return!0;return!1},patchLink:function(e){var t=e.data,n=e.page,r=e.op,u=t.start,l=t.end,c=t.connPs,p=(0,s.getLinkEndPos)(r.app,u,e.op,n),h=(0,s.getLinkEndPos)(r.app,l,e.op,n);if(p&&h){t._points=function(e){var t=e.start,n=e.end,a=e.connPs,r=[];r.push([t.x,t.y]);var s=t.dir===o.DIRECTION.LEFT||t.dir===o.DIRECTION.RIGHT?0:1,u=t,l=!0,c=!1,d=void 0;try{for(var p,h=(0,i.default)(a.slice(1));!(l=(p=h.next()).done);l=!0){var f=p.value;s%2==0?r.push([f.x,u.y]):r.push([u.x,f.y]),s++,u=f}}catch(e){c=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw d}}return r.push([n.x,n.y]),r}({connPs:c,start:p,end:h});var f=(0,d.getArrowPts)({data:t,op:r,startPos:p,endPos:h}),g=(0,d.getLinkTextPos)({data:t,op:r,page:n});t.boundary=(0,s.getLinkBoundary)((0,a.default)((0,a.default)((0,a.default)({start:p,end:h,connPs:c},t.start.aType===o.IArrowType.Arrow?{startArrow:f.start}:{}),t.end.aType===o.IArrowType.Arrow?{endArrow:f.end}:{}),{textBoundaries:g}))}},drawLink:function(e){var t=e.data,n=e.ctx,a=e.op.app.scale,r=(t._points||[]).map((function(e){return(0,p.padPt)(e,a)}));if(n.beginPath(),r.length>=2){n.moveTo(r[0][0],r[0][1]);for(var i=1;i<r.length;i++)n.lineTo(r[i][0],r[i][1])}n.stroke()},graphAftTypeM:function(e){var t=e.data,n=e.type,a=e.op,r=(0,s.getLinkEndPos)(a.app,t.start,a),i=(0,s.getLinkEndPos)(a.app,t.end,a);if(r&&i&&n!==o.ILinkType.Segment&&(n===o.ILinkType.Curve||n===o.ILinkType.Line)){var l=t.connPs.filter((function(e){return e.type===o.IConnPointType.Anchor}));if(n===o.ILinkType.Curve&&0===l.length)return u.default.graphInit({start:r,end:i,op:a});for(var c=[],d=t._points||[],p=1;p<d.length;p++)c.push({x:d[p][0]/2+d[p-1][0]/2,y:d[p][1]/2+d[p-1][1]/2,type:o.IConnPointType.Split}),p!==d.length-1&&c.push({x:d[p][0],y:d[p][1],type:o.IConnPointType.Anchor});return n===o.ILinkType.Curve?u.default.tidyGraph({connPs:c,start:r,end:i,op:a}):{connPs:c,start:r,end:i}}},graphAftConnD:function(e){var t=e.start,n=e.end,r=e.data,i=e.index,u=e.op,l=r.connPs;if(0===i||i===l.length-1)return{start:t,end:n,connPs:l};var c=l.slice(),d=c[i],p=(0,s.getConnH)(t.dir,i);if(l.length<=3)c[i]=(0,a.default)((0,a.default)({},c[i]),{type:o.IConnPointType.Split,x:p?(l[i-1].x+l[i+1].x)/2:d.x,y:p?d.y:(l[i-1].y+l[i+1].y)/2});else if(1===i){var h=l[i+2]||n;c[i-1]={x:p?t.x:t.x/2+h.x/2,y:p?t.y/2+ +h.y/2:t.y,type:o.IConnPointType.Split};var g=l[i+3]||n;c[i+2]=(0,a.default)((0,a.default)({},l[i+2]),{x:p?(t.x+g.x)/2:h.x,y:p?h.y:(t.y+g.y)/2}),c.splice(i,2)}else if(i===l.length-2){var v=l[i-2]||t,y=l[i-3]||t;c[i+1]={x:p?n.x:n.x/2+v.x/2,y:p?n.y/2+v.y/2:n.y,type:o.IConnPointType.Split},c[i-2]=(0,a.default)((0,a.default)({},l[i-2]),{x:p?(n.x+y.x)/2:v.x,y:p?v.y:(n.y+y.y)/2}),c.splice(i-1,2)}else{if(Math.abs(p?l[i-2].y-l[i].y:l[i-2].x-l[i].x)<Math.abs(p?l[i+2].y-l[i].y:l[i+2].x-l[i].x)){var m=l[i-3]||t,M=l[i+2]||n;c[i-2]=(0,a.default)((0,a.default)({},c[i-2]),{x:p?(m.x+l[i+1].x)/2:c[i-2].x,y:p?c[i-2].y:(m.y+l[i+1].y)/2}),c[i+1]=(0,a.default)((0,a.default)({},c[i+1]),{x:p?c[i+1].x:(M.x+l[i-2].x)/2,y:p?(M.y+l[i-2].y)/2:c[i+1].y}),c.splice(i-1,2)}else{var x=l[i-2]||t,w=l[i+3]||n;c[i+2]=(0,a.default)((0,a.default)({},c[i+2]),{x:p?(w.x+l[i-1].x)/2:c[i+2].x,y:p?c[i+2].y:(w.y+l[i-1].y)/2}),c[i-1]=(0,a.default)((0,a.default)({},c[i-1]),{x:p?c[i-1].x:(x.x+l[i+2].x)/2,y:p?(x.y+l[i+2].y)/2:c[i-1].y}),c.splice(i,2)}}return f.tidyGraph({start:t,end:n,connPs:c,op:u,data:r})},isConnValid:function(e){var t=e.start,n=e.end,a=e.connPs,r=e.op;if(0===a.length)return!0;var i=a[0],o=a[a.length-1];return(0,s.pointAtExtendDir)({x:t.x,y:t.y},{x:i.x,y:i.y},t.dir,r.app.scale,!0)&&(0,s.pointAtExtendDir)({x:n.x,y:n.y},{x:o.x,y:o.y},n.dir,r.app.scale,!0)},graphAftConnM:function(e){var t=e.startPos,n=e.endPos,r=e.connPs,i=e.index,u=e.x,l=e.y,c=e.op,d=(r=r.map((function(e){return(0,a.default)({},e)})))[i],p=r.slice(),h=(0,s.getConnH)(t.dir,i);if(t=(0,a.default)({},t),0===i&&(t.dir===o.DIRECTION.LEFT||t.dir===o.DIRECTION.RIGHT?t.dir=l>t.y?o.DIRECTION.DOWN:o.DIRECTION.UP:t.dir=u>t.x?o.DIRECTION.RIGHT:o.DIRECTION.LEFT),0===i&&i===p.length-1)p.unshift({x:h?t.x:t.x/2+u/2,y:h?l/2+t.y/2:t.y,type:o.IConnPointType.Split}),p.push({x:h?n.x:n.x/2+u/2,y:h?l/2+n.y/2:n.y,type:o.IConnPointType.Split}),d.x=h?t.x/2+n.x/2:u,d.y=h?l:t.y/2+n.y/2;else if(0===i){p.unshift({x:h?t.x:t.x/2+u/2,y:h?l/2+t.y/2:t.y,type:o.IConnPointType.Split});var g=r[i+1],v=r[i+2]||n;d.x=h?t.x/2+g.x/2:u,d.y=h?l:t.y/2+g.y/2,g.x=h?g.x:u/2+v.x/2,g.y=h?l/2+v.y/2:g.y}else if(i===p.length-1){p.push({x:h?n.x:n.x/2+u/2,y:h?l/2+n.y/2:n.y,type:o.IConnPointType.Split});var y=r[i-1],m=r[i-2]||t;d.x=h?n.x/2+y.x/2:u,d.y=h?l:n.y/2+y.y/2,y.x=h?y.x:u/2+m.x/2,y.y=h?l/2+m.y/2:y.y}else{var M=r[i-2]||t,x=r[i+2]||n;p[i]=(0,a.default)((0,a.default)({},p[i]),{x:h?p[i].x:u,y:h?l:p[i].y}),p[i-1]=(0,a.default)((0,a.default)({},p[i-1]),{x:h?p[i-1].x:u/2+M.x/2,y:h?l/2+M.y/2:p[i-1].y}),p[i+1]=(0,a.default)((0,a.default)({},p[i+1]),{x:h?p[i+1].x:u/2+x.x/2,y:h?l/2+x.y/2:p[i+1].y})}for(var w=1;w<p.length-1;w++)p[w].type=o.IConnPointType.Anchor;return f.tidyGraph({start:t,end:n,connPs:p,op:c})},tidyGraph:function(e){var t=e.start,n=e.end,a=e.connPs,r=e.op.app.scale;if(0===a.filter((function(e){return e.type===o.IConnPointType.Anchor})).length)return this.graphInit(e);if(1===a.length)return{start:t,connPs:a,end:n};for(var i={x:t.x,y:t.y},u=[],l=0;l<a.length;l++){for(var d=(0,s.getConnH)(t.dir,l),p={prevX:i.x,prevY:i.y,x:a[l].x,y:a[l].y,h:d},h=l+2;h<=a.length;){var f=h===a.length?n:a[h];if(p.h&&Math.abs(a[l].y-f.y)<c.SEG_MERGE_THRES/r)h+=2;else{if(p.h||!(Math.abs(a[l].x-f.x)<c.SEG_MERGE_THRES/r))break;h+=2}}var g=h-2,v=a[g+1]||n,y=0===l?t:a[g]||n;u.push({type:o.IConnPointType.Anchor,x:p.h?p.prevX/2+v.x/2:h>l+2?y.x:p.x,y:p.h?h>l+2?y.y:p.y:p.prevY/2+v.y/2}),h>l+2&&(l=g),i=a[l]}return u[0].type=o.IConnPointType.Split,u[u.length-1].type=o.IConnPointType.Split,{connPs:u,end:n,start:t}},graphAftEndM:function(e){var t=e.sTo,n=e.eTo,r=e.connPs,i=e.op,u=e.data;if(r.filter((function(e){return e.type===o.IConnPointType.Anchor})).length<=0)return f.graphInit({data:u,start:t,end:n,op:i});var l=r.slice(),c=(0,s.getConnH)(t.dir,0);l[0]=(0,a.default)((0,a.default)({},l[0]),{x:c?(t.x+r[1].x)/2:t.x,y:c?t.y:(t.y+r[1].y)/2});var d=l[2]||n;l[1]=(0,a.default)((0,a.default)({},l[1]),{x:c?r[1].x:(l[0].x+d.x)/2,y:c?(l[0].y+d.y)/2:r[1].y}),c=(0,s.getConnH)(t.dir,l.length-1),l[r.length-1]=(0,a.default)((0,a.default)({},l[r.length-1]),{x:c?(l[r.length-2].x+n.x)/2:n.x,y:c?n.y:(l[r.length-2].y+n.y)/2});var p=l[r.length-3]||t;return l[r.length-2]=(0,a.default)((0,a.default)({},l[r.length-2]),{x:c?l[r.length-2].x:(l[r.length-1].x+p.x)/2,y:c?(l[r.length-1].y+p.y)/2:l[r.length-2].y}),f.tidyGraph({start:t,end:n,connPs:l,op:i})},getLinkPosByPer:function(e){for(var t=e.per,n=e.data,a=e.op,r=e.page,i=(0,s.getLinkEndPos)(a.app,n.start,a,r),o=(0,s.getLinkEndPos)(a.app,n.end,a,r),u=n._points||[[i.x,i.y],[o.x,o.y]],c=0,d=[0],p=1;p<u.length;p++){c+=(0,l.dist)([u[p-1][0],u[p-1][1]],[u[p][0],u[p][1]]),d.push(c)}for(var h=1;h<d.length;h++)if(d[h]/c>=t){var f=(t-d[h-1]/c)/(d[h]/c-d[h-1]/c);return[u[h-1][0]*(1-f)+u[h][0]*f,u[h-1][1]*(1-f)+u[h][1]*f]}return[u[u.length-1][0],u[u.length-1][1]]},getNearestLinkInfo:function(e){for(var t=e.mx,n=e.my,a=e.data._points||[],r=0,i=[0],o=Number.MAX_VALUE,u=0,c=0,d=1;d<a.length;d++){var p=(0,l.dist)([a[d-1][0],a[d-1][1]],[a[d][0],a[d][1]]);if(r+=p,i.push(r),!(p<.1)){var h=(0,s.pDist)([t,n],[a[d-1][0],a[d-1][1]],[a[d][0],a[d][1]]);h<o&&(o=h,u=d,c=(0,s.projOnSeg)([t,n],[a[d-1][0],a[d-1][1]],[a[d][0],a[d][1]],!0))}}return{per:i[u-1]/r+c*(i[u]-i[u-1])/r,dist:o}}};t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultText=void 0;var a=T(n(19)),r=T(n(5)),i=T(n(2)),o=T(n(0)),s=T(n(1)),u=T(n(3)),l=T(n(4)),c=T(n(9)),d=n(13),p=T(n(58)),h=n(16),f=n(66),g=n(31),v=T(n(33)),y=n(229),m=n(140),M=n(23),x=T(M),w=n(65),I=n(39),b=n(98),k=n(139);function T(e){return e&&e.__esModule?e:{default:e}}var _=t.DefaultText="Type Here",C=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="text",e.isEditNew=!1,e.currText="",e.currOpId=void 0,e.blurAt=0,e.activateOpId="",e.snapsBeenChanged={},e.enterEdit=function(t){if("snap"in t){var n=t.snap;e.isEditNew=!1,e.currOpId=n.opId,e.activateOpId=e.opsManager.currPage.getNextOpId(!0),e.snapsBeenChanged=(0,I.deepCopySnapBeforeMove)([n.opId],e.drawOpsOfPage),e.currText=n.data.text;var a=(0,b.getEditorPos)(e.app,n.data);e.currEditor=(0,y.setupTextEditor)(e.app,(0,r.default)((0,r.default)({},n.data),{maxTxtLen:w.MAX_TXT_LEN}),(0,r.default)((0,r.default)({},a),n.data.fixW?{fixW:n.data.fixW}:{}),{onchange:function(t){return e.handleTextChange(t,!0)},onblur:e.handleTextBlur.bind(e),container:e.app.container.domEl}),e.dispatch(e.opsManager.selectOp.getSnapshot([n.opId]))}else e.beginBatch(),e.isEditNew=!0,e.currOpId="",e.activateOpId="",e.currText="",e.currEditor=(0,y.setupTextEditor)(e.app,{text:"",stroke:x.default.textDef.stroke,fill:x.default.textDef.fill,fontSize:x.default.textDef.fontSize,fontFamily:x.default.textDef.fontFamily,textAlign:x.default.textDef.textAlign,maxTxtLen:w.MAX_TXT_LEN},{sx:t.mx,sy:t.my,angle:0},{onchange:function(t){return e.handleTextChange(t,!0)},onblur:e.handleTextBlur.bind(e),container:e.app.container.domEl}),e.handleTextChange("",!0),e.opsManager.setCurrOp("select")},e.handleTextChange=function(t,n){e.currText=t;var a=e.opsManager.modifyOp;if(e.isEditNew){var i=0===t.length,o=e.getSnapshot(n,n||i);e.currOpId?e.dispatch(o,!1,e.currOpId):e.currOpId=e.dispatch(o)}else if("string"==typeof e.currOpId){var s=e.snapsBeenChanged[e.currOpId],u=e.getUpdatedTxtBoundary((0,r.default)((0,r.default)({},s.data),{text:e.currText}),{});e.opsManager.graphOp.handleElePosChange(e.snapsBeenChanged,a.getSnapshot([e.currOpId],[{k:"text",v:e.currText},{k:"boundary",v:u}],n),e.activateOpId,e.activateOpId+"_text")}},e.handleTextBlur=function(t,n){(n||e.isEditNew)&&e.handleTextChange(t,!1),e.currEditor=null,e.currText="",e.isEditNew=!1,e.blurAt=Date.now(),e.opsManager.setCurrOp("select");var a=e.currOpId;e.currOpId="",e.activateOpId="",a&&e.opsManager.selectOp.dispatch(e.opsManager.selectOp.getSnapshot([a]))},e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.click.tap("ClickPlugin",this.handleClickHook.bind(this))}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:""}}}}},{key:"isTextBeingEdit",value:function(e){return this.currOpId===e}},{key:"handleClickHook",value:function(e,t,n){if((0,f.isIosDevice)())return!1;if(this.opsManager.currOp instanceof p.default&&1===this.opsManager.selectedOpIds.length){var a=this.detectIfClickOnText(t,n);if((null==a?void 0:a.opId)===this.opsManager.selectedOpIds[0])return this.enterEdit({snap:a}),!0}}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.handleClick(e,t,n)}},{key:"handleMouseMove",value:function(e){this.currEditor?document.body.style.cursor="auto":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="text":document.body.style.cursor="auto"}},{key:"handleClick",value:function(e,t,n){if((0,f.isIosDevice)())return(0,g.showToast)({msg:"iOS设备暂不支持添加文本",time:3,type:"warn",msgType:v.default.IOS_NOT_SUPPORT_TEXT});this.currOpId||this.enterEdit({mx:t,my:n})}},{key:"getSnapshot",value:function(e,t){return{type:this.type,boundary:this.getBoundaryRect({text:this.currText||_,fontSize:x.default.textDef.fontSize,fontFamily:x.default.textDef.fontFamily}),stroke:x.default.textDef.stroke,textAlign:x.default.textDef.textAlign,fill:x.default.textDef.fill,text:this.currText,fontSize:x.default.textDef.fontSize,fontFamily:x.default.textDef.fontFamily||M.DefaultFont,inProgress:e,skipUndo:t}}},{key:"getBoundaryRect",value:function(e){var t=e.text,n=e.fontSize,a=e.fontFamily,r=this.currEditor.container.getBoundingClientRect(),i=r.x-this.app.container.left,o=r.y-this.app.container.top,s=this.app.camera.convertToPointInWorld(i,o),u=this.getTextSize({text:t,fontSize:n,fontFamily:a});return{sx:s[0],sy:s[1],w:u.w,h:u.h}}},{key:"hide",value:function(e){this.currOpId===e.opId&&this.currEditor&&((0,y.removeEditor)(this.currEditor),this.currEditor=null,this.currText="",this.currOpId="")}},{key:"draw",value:function(e,t){if(this.isTextBeingEdit(e.opId)){var n=(0,b.getEditorPos)(this.app,e.data);(0,y.updateEditor)((0,r.default)({sx:n.sx,sy:n.sy,angle:n.angle},e.data.fixW?{width:n.w}:{}),this.currEditor,e.data,_)}else this.preview(e,t)}},{key:"preview",value:function(e,t){var n=e.data,r=(0,b.getEditorPos)(this.app,n),i=r.sx,o=r.sy,s=r.w,u=r.h,l=r.angle,c=!!n.fixW;t.save(),t.translate(i,o),t.rotate(l);var d=n.fill,p=n.stroke||"rgb(0, 0, 0)";(null==n?void 0:n.text)||(t.globalAlpha=.3,d="",p="rgb(0, 0, 0)");var h=(0,m.getTextLines)({ctx:t,txt:n.text||_,fontSize:n.fontSize||32,w:s,wrap:c,fontFamily:n.fontFamily});if(h.length>0&&!n.fixW){var f=Math.max.apply(Math,(0,a.default)(h.map((function(e){return e.w}))))/Math.abs(n.xFactor||1);e.data.xFactor<0&&(e.data.boundary.sx=e.data.boundary.sx-f+e.data.boundary.w),e.data.boundary.w=f}(0,m.drawText)({ctx:t,textArr:h,fontSize:n.fontSize||32,fontFamily:n.fontFamily,lineHeightF:1.25,w:s,h:u,fill:d,stroke:p,clip:!1,align:n.textAlign||"left",vAlign:"top"}),t.restore()}},{key:"detectIfClickOnText",value:function(e,t){for(var n in this.drawOpsOfPage)if("text"===this.drawOpsOfPage[n].data.type){var a=this.drawOpsOfPage[n].data,r=(0,d.getTransformedVertices)(a);if((0,d.pointInVertices)(r,[e,t]))return this.drawOpsOfPage[n]}}},{key:"transformOp",value:function(e,t){return(0,h.transformPropertyOverwriteOp)(e,t)}},{key:"getUpdatedTxtBoundary",value:function(e,t){var n=e.boundary,a=(0,d.getTransformedSize)(e),i=this.opsManager.textOp.getTextSize((0,r.default)({text:e.text||_,fontSize:t.fontSize||e.fontSize,fontFamily:t.fontFamily||e.fontFamily},e.fixW?{width:a.w}:{})),o=i.h/Math.abs(e.yFactor||1),s=i.w/Math.abs(e.xFactor||1);return{sx:n.sx,sy:n.sy,w:s,h:o}}},{key:"getTextSize",value:function(e){var t=e.text,n=e.fontSize,r=e.fontFamily,i=e.width,o=(0,m.getTextLines)({ctx:this.app.container.ctx,txt:t,fontSize:n,w:i,wrap:"number"==typeof i,fontFamily:r}),s=o.length>0?Math.max.apply(Math,(0,a.default)(o.map((function(e){return e.w})))):k.MIN_TXT_W;return i&&(s=i),{w:s,h:o.length*n*1.25}}},{key:"getTextActualBound",value:function(e){var t=e.boundary;if(e.fixW){var n=e.text?e.text.trim():e.text;n=n||_;var a=this.getTextSize({text:n,fontSize:e.fontSize/Math.abs(e.xFactor||1),fontFamily:e.fontFamily}),r=Math.min(a.w,t.w);return{sx:"left"===e.textAlign?t.sx:"center"===e.textAlign?t.sx+t.w/2-r/2:t.sx+t.w-r,sy:t.sy,w:r,h:t.h}}return t}}]),t}(c.default);t.default=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MIN_TXT_W=15},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawTextOnCanvas=t.getTextWidth=t.getTextLines=t.drawText=void 0;var a=o(n(95)),r=o(n(7)),i=n(98);function o(e){return e&&e.__esModule?e:{default:e}}var s=t.drawText=function(e){var t=e.textArr,n=e.ctx,a=e.align,i=e.vAlign,o=e.fontSize,s=e.fontFamily,l=e.lineHeightF,c=e.w,d=e.h,p=e.clip,f=e.stroke,g=e.fill;n.save(),h(n,o,s),n.textAlign="left",n.textBaseline="top",p&&(n.beginPath(),n.rect(0,0,c,d),n.clip());var v=o*l,y=u(t.length,d,v,i)+(v-o)/2,m=void 0;if(g){m=y,n.fillStyle=g;var M=!0,x=!1,w=void 0;try{for(var I,b=(0,r.default)(t);!(M=(I=b.next()).done);M=!0){var k=I.value,T=0;"center"===a?T=(c-k.w)/2:"right"===a&&(T=c-k.w),n.fillRect(T,m-(v-o)/2,k.w,v),m+=v}}catch(e){x=!0,w=e}finally{try{!M&&b.return&&b.return()}finally{if(x)throw w}}}m=y,n.fillStyle=f;var _=!0,C=!1,N=void 0;try{for(var A,P=(0,r.default)(t);!(_=(A=P.next()).done);_=!0){var O=A.value,D=0;"center"===a?D=(c-O.w)/2:"right"===a&&(D=c-O.w),n.fillText(O.txt,D,m),m+=v}}catch(e){C=!0,N=e}finally{try{!_&&P.return&&P.return()}finally{if(C)throw N}}n.restore()},u=function(e,t,n,a){if("top"===a)return 0;var r=e*n;return"middle"===a?(t-r)/2:"bottom"===a?t-r:0},l=function(e){return-1!==[" ","\n"].indexOf(e)},c=t.getTextLines=function(e){var t=[],n=e.ctx,a=e.txt,i=e.w,o=e.fontSize,s=e.wrap,u=void 0===s||s,c=e.fontFamily;h(n,50,c);var d=o/50;i=i?i/d:i;var f="",g=0,v="",y=0,m="",M=0;function x(e){if(m)t.push({txt:m,w:M*d}),m="",M=0,f=v,g=y;else{var n=e,a=f[f.length-1];e=l(a)?0:e,a=l(a)?"":a;var r=f.slice(0,f.length-1);t.push({txt:r,w:(g-n)*d}),m="",M=0,f=a,v=a,y=e,g=e}}var w=!0,I=!1,b=void 0;try{for(var k,T=(0,r.default)(a);!(w=(k=T.next()).done);w=!0){var _=k.value,C=p(n,_,c);f+=_,g+=C,v+=_,y+=C,"\n"!==_?i&&g-i>1e-4&&u?x(C):" "===_&&(m+=v,M+=y,v="",y=0):(m+=v,M+=y,v="",y=0,x(0))}}catch(e){I=!0,b=e}finally{try{!w&&T.return&&T.return()}finally{if(I)throw b}}return f&&t.push({txt:f,w:g*d}),t},d={default:{}},p=function(e,t,n){if("\n"===t)return 0;if(d[n]&&!d[n][t])d[n][t]=e.measureText(t).width;else if(!d[n]){var r=e.measureText(t).width,i=void 0;if(d.default[t]?i=d.default[t]:(h(e,50,"NULL"),i=e.measureText(t).width,h(e,50,n)),r===i)return d.default[t]=i,d.default[t];d[n]=(0,a.default)({},t,r)}return d[n][t]},h=(t.getTextWidth=function(e,t,n,a){h(e,50,a);var i=0;return t.forEach((function(t){var o=0,s=!0,u=!1,l=void 0;try{for(var c,d=(0,r.default)(t);!(s=(c=d.next()).done);s=!0){var h=c.value;o+=p(e,h,a)*n/50}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}i=Math.max(i,o)})),i},function(e,t,n){e.font=t+"px "+n});t.drawTextOnCanvas=function(e,t,n,a){var r,o=n.text;if(o){var u=(0,i.getEditorPos)(e,n),l=u.sx,d=u.sy,p=u.w,h=u.h,f=u.angle;t.save(),t.translate(l,d),t.rotate(f);var g=c({ctx:t,txt:(null===(r=n.text)||void 0===r?void 0:r.value)||"",fontSize:o.fontSize||32,w:p,fontFamily:o.fontFamily});s({ctx:t,textArr:g,fontSize:o.fontSize||32,fontFamily:o.fontFamily,lineHeightF:1.25,w:p,h:h,fill:o.fill,stroke:o.stroke||"rgb(0,0,0)",clip:!0,align:o.textAlign||"left",vAlign:o.verticalAlign||"top"}),t.restore()}}},function(e,t,n){(function(e,n){var a="[object Arguments]",r="[object Function]",i="[object GeneratorFunction]",o="[object Map]",s="[object Set]",u=/\w*$/,l=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,d={};d[a]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[o]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[s]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[r]=d["[object WeakMap]"]=!1;var p="object"==typeof e&&e&&e.Object===Object&&e,h="object"==typeof self&&self&&self.Object===Object&&self,f=p||h||Function("return this")(),g=t&&!t.nodeType&&t,v=g&&"object"==typeof n&&n&&!n.nodeType&&n,y=v&&v.exports===g;function m(e,t){return e.set(t[0],t[1]),e}function M(e,t){return e.add(t),e}function x(e,t,n,a){var r=-1,i=e?e.length:0;for(a&&i&&(n=e[++r]);++r<i;)n=t(n,e[r],r,e);return n}function w(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function I(e){var t=-1,n=Array(e.size);return e.forEach((function(e,a){n[++t]=[a,e]})),n}function b(e,t){return function(n){return e(t(n))}}function k(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var T,_=Array.prototype,C=Function.prototype,N=Object.prototype,A=f["__core-js_shared__"],P=(T=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"",O=C.toString,D=N.hasOwnProperty,S=N.toString,E=RegExp("^"+O.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=y?f.Buffer:void 0,L=f.Symbol,z=f.Uint8Array,R=b(Object.getPrototypeOf,Object),B=Object.create,F=N.propertyIsEnumerable,Y=_.splice,U=Object.getOwnPropertySymbols,W=j?j.isBuffer:void 0,H=b(Object.keys,Object),Q=ve(f,"DataView"),Z=ve(f,"Map"),G=ve(f,"Promise"),V=ve(f,"Set"),X=ve(f,"WeakMap"),J=ve(Object,"create"),K=we(Q),q=we(Z),$=we(G),ee=we(V),te=we(X),ne=L?L.prototype:void 0,ae=ne?ne.valueOf:void 0;function re(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}function ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}function oe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}function se(e){this.__data__=new ie(e)}function ue(e,t){var n=be(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&ke(e)}(e)&&D.call(e,"callee")&&(!F.call(e,"callee")||S.call(e)==a)}(e)?function(e,t){for(var n=-1,a=Array(e);++n<e;)a[n]=t(n);return a}(e.length,String):[],r=n.length,i=!!r;for(var o in e)!t&&!D.call(e,o)||i&&("length"==o||Me(o,r))||n.push(o);return n}function le(e,t,n){var a=e[t];D.call(e,t)&&Ie(a,n)&&(void 0!==n||t in e)||(e[t]=n)}function ce(e,t){for(var n=e.length;n--;)if(Ie(e[n][0],t))return n;return-1}function de(e,t,n,l,c,p,h){var f;if(l&&(f=p?l(e,c,p,h):l(e)),void 0!==f)return f;if(!Ce(e))return e;var g=be(e);if(g){if(f=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&D.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,a=e.length;t||(t=Array(a));for(;++n<a;)t[n]=e[n];return t}(e,f)}else{var v=me(e),y=v==r||v==i;if(Te(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if("[object Object]"==v||v==a||y&&!p){if(w(e))return p?e:{};if(f=function(e){return"function"!=typeof e.constructor||xe(e)?{}:(t=R(e),Ce(t)?B(t):{});var t}(y?{}:e),!t)return function(e,t){return fe(e,ye(e),t)}(e,function(e,t){return e&&fe(t,Ne(t),e)}(f,e))}else{if(!d[v])return p?e:{};f=function(e,t,n,a){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return he(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return function(e,t){var n=t?he(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,a);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var n=t?he(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,a);case o:return function(e,t,n){return x(t?n(I(e),!0):I(e),m,new e.constructor)}(e,a,n);case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,u.exec(e));return t.lastIndex=e.lastIndex,t}(e);case s:return function(e,t,n){return x(t?n(k(e),!0):k(e),M,new e.constructor)}(e,a,n);case"[object Symbol]":return i=e,ae?Object(ae.call(i)):{}}var i}(e,v,de,t)}}h||(h=new se);var b=h.get(e);if(b)return b;if(h.set(e,f),!g)var T=n?function(e){return function(e,t,n){var a=t(e);return be(e)?a:function(e,t){for(var n=-1,a=t.length,r=e.length;++n<a;)e[r+n]=t[n];return e}(a,n(e))}(e,Ne,ye)}(e):Ne(e);return function(e,t){for(var n=-1,a=e?e.length:0;++n<a&&!1!==t(e[n],n,e););}(T||e,(function(a,r){T&&(a=e[r=a]),le(f,r,de(a,t,n,l,r,e,h))})),f}function pe(e){return!(!Ce(e)||(t=e,P&&P in t))&&(_e(e)||w(e)?E:l).test(we(e));var t}function he(e){var t=new e.constructor(e.byteLength);return new z(t).set(new z(e)),t}function fe(e,t,n,a){n||(n={});for(var r=-1,i=t.length;++r<i;){var o=t[r],s=a?a(n[o],e[o],o,n,e):void 0;le(n,o,void 0===s?e[o]:s)}return n}function ge(e,t){var n,a,r=e.__data__;return("string"==(a=typeof(n=t))||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function ve(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return pe(n)?n:void 0}re.prototype.clear=function(){this.__data__=J?J(null):{}},re.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},re.prototype.get=function(e){var t=this.__data__;if(J){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return D.call(t,e)?t[e]:void 0},re.prototype.has=function(e){var t=this.__data__;return J?void 0!==t[e]:D.call(t,e)},re.prototype.set=function(e,t){return this.__data__[e]=J&&void 0===t?"__lodash_hash_undefined__":t,this},ie.prototype.clear=function(){this.__data__=[]},ie.prototype.delete=function(e){var t=this.__data__,n=ce(t,e);return!(n<0)&&(n==t.length-1?t.pop():Y.call(t,n,1),!0)},ie.prototype.get=function(e){var t=this.__data__,n=ce(t,e);return n<0?void 0:t[n][1]},ie.prototype.has=function(e){return ce(this.__data__,e)>-1},ie.prototype.set=function(e,t){var n=this.__data__,a=ce(n,e);return a<0?n.push([e,t]):n[a][1]=t,this},oe.prototype.clear=function(){this.__data__={hash:new re,map:new(Z||ie),string:new re}},oe.prototype.delete=function(e){return ge(this,e).delete(e)},oe.prototype.get=function(e){return ge(this,e).get(e)},oe.prototype.has=function(e){return ge(this,e).has(e)},oe.prototype.set=function(e,t){return ge(this,e).set(e,t),this},se.prototype.clear=function(){this.__data__=new ie},se.prototype.delete=function(e){return this.__data__.delete(e)},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ie){var a=n.__data__;if(!Z||a.length<199)return a.push([e,t]),this;n=this.__data__=new oe(a)}return n.set(e,t),this};var ye=U?b(U,Object):function(){return[]},me=function(e){return S.call(e)};function Me(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||c.test(e))&&e>-1&&e%1==0&&e<t}function xe(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||N)}function we(e){if(null!=e){try{return O.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ie(e,t){return e===t||e!=e&&t!=t}(Q&&"[object DataView]"!=me(new Q(new ArrayBuffer(1)))||Z&&me(new Z)!=o||G&&"[object Promise]"!=me(G.resolve())||V&&me(new V)!=s||X&&"[object WeakMap]"!=me(new X))&&(me=function(e){var t=S.call(e),n="[object Object]"==t?e.constructor:void 0,a=n?we(n):void 0;if(a)switch(a){case K:return"[object DataView]";case q:return o;case $:return"[object Promise]";case ee:return s;case te:return"[object WeakMap]"}return t});var be=Array.isArray;function ke(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!_e(e)}var Te=W||function(){return!1};function _e(e){var t=Ce(e)?S.call(e):"";return t==r||t==i}function Ce(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ne(e){return ke(e)?ue(e):function(e){if(!xe(e))return H(e);var t=[];for(var n in Object(e))D.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}n.exports=function(e){return de(e,!0,!0)}}).call(this,n(230),n(157)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(5)),r=p(n(19)),i=n(29),o=p(n(137)),s=p(n(226)),u=n(39),l=n(13),c=n(64),d=n(16);function p(e){return e&&e.__esModule?e:{default:e}}var h={graphInit:function(e){var t=e.start,n=e.end;if(t.dir+n.dir===3)return s.default.graphInit(e);if(t.dir===n.dir)return s.default.graphInit(e);var a=n.x-t.x,r=n.y-t.y,o=t.dir===i.DIRECTION.LEFT||t.dir===i.DIRECTION.RIGHT,u=.75,l=[t.x+(o?a*u:0),t.y+(o?0:r*u)],c=[n.x-(o?0:a*u),n.y-(o?r*u:0)],d=[.125*(t.x+n.x)+.375*(l[0]+c[0]),.125*(t.y+n.y)+.375*(l[1]+c[1])];return{start:t,end:n,connPs:[{x:d[0],y:d[1],type:i.IConnPointType.Split}]}},isUnderRect:function(e){var t=e.data,n=e.rect,a=e.selectMode,r=t.boundary;if((0,l.polygonIntersect)([[n.sx,n.sy],[n.sx+n.w,n.sy],[n.sx+n.w,n.sy+n.h],[n.sx,n.sy+n.h],[n.sx,n.sy]],[[r.sx,r.sy],[r.sx+r.w,r.sy],[r.sx+r.w,r.sy+r.h],[r.sx,r.sy+r.h],[r.sx,r.sy]])){var i=t._points||[];if("intersect"===a){if(2===i.length)return(0,u.isSegInRect)(i[0],i[1],n);for(var o=0;o<i.length-3;o+=3){if((0,u.isPInsideRect)(i[o],n)||(0,u.isPInsideRect)(i[o+3],n)||(0,u.isCurveSegIntersect)({curve:[i[o],i[o+1],i[o+2],i[o+3]],seg:[[n.sx,n.sy],[n.sx+n.w,n.sy]]})||(0,u.isCurveSegIntersect)({curve:[i[o],i[o+1],i[o+2],i[o+3]],seg:[[n.sx+n.w,n.sy],[n.sx+n.w,n.sy+n.h]]})||(0,u.isCurveSegIntersect)({curve:[i[o],i[o+1],i[o+2],i[o+3]],seg:[[n.sx+n.w,n.sy+n.h],[n.sx,n.sy+n.h]]})||(0,u.isCurveSegIntersect)({curve:[i[o],i[o+1],i[o+2],i[o+3]],seg:[[n.sx,n.sy+n.h],[n.sx,n.sy]]}))return!0}return!1}var s=[[n.sx,n.sy],[n.sx+n.w,n.sy],[n.sx+n.w,n.sy+n.h],[n.sx,n.sy+n.h]];if(2===i.length)return(0,l.polygonContain)(i,s);for(var c=0;c<i.length-3;c+=3){if(!((0,u.isPInsideRect)(i[c],n)&&(0,u.isPInsideRect)(i[c+3],n)&&(0,u.isPInsideRect)([.125*i[c][0]+.375*i[c+1][0]+.375*i[c+2][0]+.125*i[c+3][0],.125*i[c][1]+.375*i[c+1][1]+.375*i[c+2][1]+.125*i[c+3][1]],n)))return!1}return!0}return!1},isUnderPoint:function(e){var t=e.data,n=e.p,a=e.op,r={sx:n[0]-5/a.app.scale,sy:n[1]-5/a.app.scale,w:10/a.app.scale,h:10/a.app.scale};return this.isUnderRect({data:t,rect:r,selectMode:"intersect"})},patchLink:function(e){var t=e.data,n=e.page,o=e.op,s=t.start,l=t.end,d=t.connPs,p=(0,u.getLinkEndPos)(o.app,s,e.op,n),h=(0,u.getLinkEndPos)(o.app,l,e.op,n);if(p&&h){var v=[p].concat((0,r.default)(f(t.connPs)),[h]),y=g({start:p,end:h,connPs:d});if(y.length>0){var m=[];m.push([v[0].x,v[0].y]);for(var M=1;M<v.length;M++)m.push(y[2*M-2]),m.push(y[2*M-1]),m.push([v[M].x,v[M].y]);t._points=m}else t._points=[[p.x,p.y],[h.x,h.y]];var x=(0,c.getArrowPts)({data:t,op:o,startPos:p,endPos:h}),w=(0,c.getLinkTextPos)({data:t,op:o});t.boundary=(0,u.getCurveLinkBoundary)((0,a.default)((0,a.default)((0,a.default)({points:t._points},t.start.aType===i.IArrowType.Arrow?{startArrow:x.start}:{}),t.end.aType===i.IArrowType.Arrow?{endArrow:x.end}:{}),{textBoundaries:w}))}},drawLink:function(e){var t=e.data,n=e.ctx,a=e.op.app.scale,r=(t._points||[]).map((function(e){return(0,d.padPt)(e,a)}));if(2===r.length)n.beginPath(),n.moveTo(r[0][0],r[0][1]),n.lineTo(r[1][0],r[1][1]),n.stroke();else if((r.length-1)%3==0)for(var i=0;i<r.length-3;i+=3)n.beginPath(),n.moveTo(r[i][0],r[i][1]),n.bezierCurveTo(r[i+1][0],r[i+1][1],r[i+2][0],r[i+2][1],r[i+3][0],r[i+3][1]),n.stroke()},graphAftTypeM:function(e){var t=e.type,n=e.data,r=e.op,o=(0,u.getLinkEndPos)(r.app,n.start,r),l=(0,u.getLinkEndPos)(r.app,n.end,r);if(o&&l){if(t===i.ILinkType.Segment){var c=s.default.tidyGraph({start:o,end:l,connPs:n.connPs,op:r}).connPs;return s.default.graphAftTypeM((0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)({},n),{connPs:c})}))}return t===i.ILinkType.Line?s.default.tidyGraph({start:o,end:l,connPs:n.connPs,op:r}):void 0}},graphAftConnD:function(e){var t=e.data,n=e.index,r=e.op;if(1===t.connPs.filter((function(e){return e.type===i.IConnPointType.Anchor})).length&&t.connPs[n].type===i.IConnPointType.Anchor)return h.tidyGraph((0,a.default)((0,a.default)({},h.graphInit(e)),{op:r}));var o=s.default.graphAftConnD(e);return h.tidyGraph((0,a.default)((0,a.default)({},o),{op:e.op}))},isConnValid:function(e){return!0},graphAftConnM:function(e){var t=(0,u.moveNonSegConnPoint)(e);return h.tidyGraph({start:e.startPos,end:e.endPos,connPs:t.connPs,op:e.op})},tidyGraph:function(e){var t=e.start,n=e.end,o=e.connPs;if(1===o.length&&o[0].type===i.IConnPointType.Split)return e;var s=g({start:t,end:n,connPs:o});if(s.length>0){for(var u=[t].concat((0,r.default)(f(o)),[n]),l=[],c=0;c<u.length-1;c++)l.push({x:.125*u[c].x+.375*s[2*c][0]+.375*s[2*c+1][0]+.125*u[c+1].x,y:.125*u[c].y+.375*s[2*c][1]+.375*s[2*c+1][1]+.125*u[c+1].y,type:i.IConnPointType.Split}),c<u.length-2&&l.push({x:u[c+1].x,y:u[c+1].y,type:i.IConnPointType.Anchor});return(0,a.default)((0,a.default)({},e),{connPs:l})}var d=o.slice();return 0===o.length&&d.push({x:t.x/2+n.x/2,y:t.y/2+n.y/2,type:i.IConnPointType.Split}),(0,a.default)((0,a.default)({},e),{connPs:d})},graphAftEndM:function(e){var t=e.sTo,n=e.eTo,r=e.connPs,o=e.op;if(r.filter((function(e){return e.type===i.IConnPointType.Anchor})).length<=0)return h.graphInit({start:t,end:n,op:o});var s=r.slice(),u=r.length>1?r[1]:n,l=r.length>1?r[r.length-2]:t;return s[0]=(0,a.default)((0,a.default)({},s[0]),{x:t.x/2+u.x/2,y:t.y/2+u.y/2}),s[s.length-1]=(0,a.default)((0,a.default)({},s[s.length-1]),{x:l.x/2+n.x/2,y:l.y/2+n.y/2}),h.tidyGraph({start:t,end:n,connPs:s,op:o})},getLinkPosByPer:function(e){var t=e.per,n=e.data._points||[];if(2===n.length)return[n[0][0]+(n[1][0]-n[0][0])*t,n[0][1]+(n[1][1]-n[0][1])*t];if((n.length-1)%3==0){for(var a=(n.length-1)/3,r=0,i=[0],o=0;o<a;o++){var s=n[3*o],u=n[3*o+2];r+=(0,l.dist)(s,u),i.push(r)}for(var c=1;c<i.length;c++)if(i[c]/r>=t){var d=(t-i[c-1]/r)/(i[c]/r-i[c-1]/r),p=n[3*c-3],h=n[3*c-2],f=n[3*c-1],g=n[3*c];return[p[0]*(1-d)*(1-d)*(1-d)+3*h[0]*d*(1-d)*(1-d)+3*f[0]*d*d*(1-d)+g[0]*d*d*d,p[1]*(1-d)*(1-d)*(1-d)+3*h[1]*d*(1-d)*(1-d)+3*f[1]*d*d*(1-d)+g[1]*d*d*d]}}return n[n.length-1]},getNearestLinkInfo:function(e){return o.default.getNearestLinkInfo(e)},getEndAngle:function(e){var t=e.data,n=(e.op,t._points||[]);if(n.length<=2)return o.default.getEndAngle(e);var a=.1,r=[.9*n[0][0]*.9*.9+3*n[1][0]*a*.9*.9+3*n[2][0]*a*a*.9+n[3][0]*a*a*a,.9*n[0][1]*.9*.9+3*n[1][1]*a*.9*.9+3*n[2][1]*a*a*.9+n[3][1]*a*a*a],i=[.9*n[n.length-1][0]*.9*.9+3*n[n.length-2][0]*a*.9*.9+3*n[n.length-3][0]*a*a*.9+n[n.length-4][0]*a*a*a,.9*n[n.length-1][1]*.9*.9+3*n[n.length-2][1]*a*.9*.9+3*n[n.length-3][1]*a*a*.9+n[n.length-4][1]*a*a*a];return[(0,l.getVecAngle)(r,n[0]),(0,l.getVecAngle)(i,n[n.length-1])]},graphFromAnchors:function(e){return 0===e.anchors.length?h.tidyGraph((0,a.default)((0,a.default)({},h.graphInit(e)),{op:e.op})):h.tidyGraph((0,a.default)((0,a.default)({},s.default.graphFromAnchors(e)),{op:e.op}))}},f=function(e){return 1===e.length?e.slice():e.filter((function(e){return e.type===i.IConnPointType.Anchor}))},g=function(e){var t=e.connPs,n=e.start,a=e.end,i=f(t);if(i.length>0){for(var o=[],s=[v(n,i[0]),n].concat((0,r.default)(i),[a,v(a,i[i.length-1])]),l=s.length-3,c=(0,u.getControlPoints)(s[l].x,s[l].y,s[l+1].x,s[l+1].y,s[l+2].x,s[l+2].y,.5),d=0;d<s.length-3;d++){var p=void 0;p=0===d?(0,u.getControlPoints)(s[d].x,s[d].y,s[d+1].x,s[d+1].y,s[d+2].x,s[d+2].y,.5):d===s.length-4?(0,u.getControlPoints)(o[2*(d-1)][0],o[2*(d-1)][1],s[d+1].x,s[d+1].y,c[0][0],c[0][1],.5):(0,u.getControlPoints)(o[2*(d-1)][0],o[2*(d-1)][1],s[d+1].x,s[d+1].y,s[d+2].x,s[d+2].y,.5),d>0&&o.push(p[0]),o.push(p[1])}return o.push(c[0]),o}return[]},v=function(e,t){var n=2*(t.x-e.x),a=2*(t.y-e.y);switch(e.dir){case i.DIRECTION.RIGHT:case i.DIRECTION.LEFT:return{x:e.x-n,y:t.y};case i.DIRECTION.UP:case i.DIRECTION.DOWN:return{x:t.x,y:e.y-a};default:return{x:e.x,y:e.y}}};t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateAuxLock=t.getMoveInAuxiliaryLine=void 0;var a=n(16);t.getMoveInAuxiliaryLine=function(e,t,n,r){var i=e.scale,o=(0,a.getAuxSensitivity)(i),s=Math.abs(t-r.pos[0])/e.scale,u=Math.abs(n-r.pos[1])/e.scale,l=!r.lockX||s>r.lockX*o,c=!r.lockY||u>r.lockY*o,d=r.lockX>0&&0===r.lockY&&u<=1&&s>=3||r.lockX>0&&r.lockY>0&&s>=4&&u>=4,p=r.lockY>0&&0===r.lockX&&s<=1&&u>=3||r.lockX>0&&r.lockY>0&&s>=4&&u>=4,h=!1,f=!1;return l?h=!0:d?(r.unlockXCount+=Math.ceil(s/3),h=r.unlockXCount>=25):(r.unlockXCount-=1,r.unlockXCount=Math.max(0,r.unlockXCount)),c?f=!0:p?(r.unlockYCount+=Math.ceil(u/3),f=r.unlockYCount>=25):(r.unlockYCount-=1,r.unlockYCount=Math.max(0,r.unlockYCount)),f=f&&u>0,(h=h&&s>0)||f?{mx:t=h?t:r.pos[0],my:n=f?n:r.pos[1]}:null},t.updateAuxLock=function(e,t,n,a){e.lockX=a.lockX,e.lockY=a.lockY,e.pos=[t,n],e.unlockXCount=0,e.unlockYCount=0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.addImage=function(e,t,n,a){var r=t.app.room.currBoard,i=t.opsManager.currPage;if(a&&void 0!==a.boardName&&void 0!==a.pageName){var o=t.app.room.getPage(a.boardName,a.pageName);o&&(i=o)}else if(a&&void 0!==a.pageName){var s=t.app.room.getPage(r.boardName,a.pageName);s&&(i=s)}if(e.resourceCache.resourceLoaded(n)){var u=e.resourceCache.getResource(n),l=u.width||300,c=u.height||300;t.dispatchImage(n,l,c,i)}else i.addWaitingResource(n),e.resourceCache.fetchResource(n,(function(e){var a=e.width||300,r=e.height||300;t.dispatchImage(n,a,r,i),i.removeWaitingResource(n)}))};var a=function(e,t){var n=t.cropping,a=t.img,r=t.boundary,i=t.baseBoundary;if(n&&i&&(e.globalAlpha=.3,e.drawImage(a,i.sx,i.sy,i.w,i.h)),e.globalAlpha=1,i){var o=i.w/a.width,s=i.h/a.height;e.drawImage(a,(r.sx-i.sx)/o,(r.sy-i.sy)/s,r.w/o,r.h/s,r.sx,r.sy,r.w,r.h)}else e.drawImage(a,0,0,a.width,a.height,r.sx,r.sy,r.w,r.h)};t.draw=function(e,t,n,r,i){var o=i.page,s=i.supportToDataUrl,u=i.baseBoundary,l=i.cropping,c=void 0!==l&&l;if(s&&e.resourceCache.resourceLoaded(n,!0)?a(t,{cropping:c,img:e.resourceCache.getResource(n,!0),boundary:r,baseBoundary:u}):!s&&e.resourceCache.resourceLoaded(n)?a(t,{cropping:c,img:e.resourceCache.getResource(n,!1),boundary:r,baseBoundary:u}):e.resourceCache.resourceLoaded("imageLoading")&&a(t,{cropping:c,img:e.resourceCache.getResource("imageLoading"),boundary:r,baseBoundary:u}),!e.resourceCache.resourceLoaded(n)){o.addWaitingResource(n);var d=[n].concat(i.backupUrls||[]);e.resourceCache.fetchResource(d,(function(){o.removeWaitingResource(n)}))}},t.getImageProperPosition=function(e,t,n){return{sx:e.app.camera.centerX-t/2,sy:e.app.camera.centerY-n/2}},t.getBackgroundImagePorperPosition=function(e,t,n){return{sx:-t/2,sy:-n/2,width:t,height:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadMedia=void 0;var a=s(n(22)),r=s(n(14)),i=s(n(5)),o=s(n(158));function s(e){return e&&e.__esModule?e:{default:e}}o.default.setExpireTime(864e5);t.uploadMedia=function(e,t){if("function"==typeof e.getAuthInfo)u(e,t);else{if(e.nim&&"function"==typeof e.nim.previewFile)return e.nim.previewFile(t);e.logger.error("无法上传文件！！")}};var u=function(e,t){var n,a,r,s=(null===(n=e.serviceConf)||void 0===n?void 0:n.mediaUploadAddr)?e.serviceConf.mediaUploadAddr:"https://vcloud.163.com",u=(null===(a=e.serviceConf)||void 0===a?void 0:a.directNosAddr)?null===(r=e.serviceConf)||void 0===r?void 0:r.directNosAddr:"https://wanproxy-web.127.net";e.getAuthInfo().then((function(n){var a=o.default.createConfig({directUploadAddr:u,onError:function(e){t.done(e)},onProgress:function(e){t.uploadprogress({percentageText:(100*e).toFixed(2)+"%"})},onComplete:function(a){l(e,n,a).then((function(e){t.done(void 0,e)})).catch((function(e){t.done(e)}))}}),r=c(t);return p((0,i.default)((0,i.default)({},n),{appkey:e.appkey,url:s+"/app/vod/upload/init"}),{originFileName:r.name}).then((function(e){o.default.createTask(r,{bucketName:e.ret.bucket,objectName:e.ret.object,token:e.ret.xNosToken,payload:{mediaType:t.mediaType}},a)})).catch((function(e){t.done(e)}))}))},l=function(e,t,n){var o,s=n&&n.payload&&n.payload.mediaType;if(!s)return r.default.reject("mediaType无法解析: "+s);var u=(null===(o=e.serviceConf)||void 0===o?void 0:o.mediaUploadAddr)?e.serviceConf.mediaUploadAddr:"https://vcloud.163.com";return p((0,i.default)((0,i.default)({url:u+"/app/vod/video/query"},t),{appkey:e.appkey}),{objectNames:[n.objectName]}).then((function(e){if(e.ret&&Array.isArray(e.ret.list)&&e.ret.list.length>0)return"image"===s&&e.ret.list[0].imgId?e.ret.list[0].imgId:e.ret.list[0].vid?e.ret.list[0].vid:r.default.reject("无法获取"+s+" id: "+(0,a.default)(e))})).then((function(n){var a="image"===s?{imageId:n}:{vid:n};return p((0,i.default)((0,i.default)({url:"image"===s?u+"/app/vod/image/get":u+"/app/vod/video/get"},t),{appkey:e.appkey}),a)})).then((function(e){var t=void 0;"image"===s&&e.ret&&e.ret.url?t=e.ret.url:e.ret&&e.ret.origUrl&&(t=e.ret.origUrl);var n=null==e?void 0:e.ret.width,i=null==e?void 0:e.ret.height;return"string"==typeof t&&t.startsWith("http://")&&(t="https://"+t.slice(7)),"string"==typeof t?{url:t,width:n,height:i}:r.default.reject("找不到"+s+"的url地址: "+(0,a.default)(e))}))},c=function(e){var t=e.dataURL,n=e.fileInput,a=e.blob,r=e.fileName?e.fileName:Date.now().toString();if(n&&n.files&&n.files.length>0)return n.files[0];if(a)return new File([a],r,{type:"text/plain"});if(t)return d(t,r);throw new Error("previewFile参数中缺少数据")},d=function(e,t){for(var n=e.split(","),a=n[0].match(/:(.*?);/)[1],r=atob(n[1]),i=r.length,o=new Uint8Array(i);i--;)o[i]=r.charCodeAt(i);return new File([o],t,{type:a})},p=function(e,t){return fetch(e.url,{method:"post",headers:{"content-type":"application/json",AppKey:e.appkey,Nonce:e.nonce,CurTime:e.curTime.toString(),CheckSum:e.checksum},body:(0,a.default)(t)}).then((function(e){return e.ok?e.json():r.default.reject(e)})).then((function(e){return 200!==e.code?r.default.reject(e):e}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"subMany",value:function(e){for(var t in e)this.on(t,e[t])}},{key:"destroy",value:function(){var e=this;this.eventNames().forEach((function(t){e.removeAllListeners(t)}))}}]),t}(u(n(47)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0,r=(t.transitionToCameraBound=function(e,t,n){var a=t,i=e.centerX,o=e.centerY,s=e.width,u=e.height,l=e.app.isRecordPlayer?1:15;r({total:l,worker:function(t){var n=(t+1)/l;e.setCameraBound({centerX:a.centerX*n+i*(1-n),centerY:a.centerY*n+o*(1-n),width:a.width*n+s*(1-n),height:a.height*n+u*(1-n)})},callback:n})},t.animate=function(e){cancelAnimationFrame(a),i(0,e)}),i=(t.stopTransitionToCameraBound=function(){cancelAnimationFrame(a)},function e(t,n){t>=n.total?"function"==typeof n.callback&&n.callback():a=requestAnimationFrame((function(){n.worker(t),e(t+1,n)}))})},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEzIDE2VjEzSDI3VjE2IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CjxwYXRoIGQ9Ik0yMCAxM1YyNyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTE4IDI3SDIyIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHJ4PSIwIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuNiIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=t.WActions=void 0;!function(e){e[e.VERSION=0]="VERSION",e[e.START=1]="START",e[e.MOVE=2]="MOVE",e[e.END=3]="END",e[e.REVOKE=4]="REVOKE",e[e.SERIAL=5]="SERIAL",e[e.CLEAR=6]="CLEAR",e[e.CLEAR_ACK=7]="CLEAR_ACK",e[e.SYNC_REQUEST=8]="SYNC_REQUEST",e[e.SYNC=9]="SYNC",e[e.SYNC_PREPARE=10]="SYNC_PREPARE",e[e.SYNC_PREPARE_ACK=11]="SYNC_PREPARE_ACK",e[e.LASER_PEN=12]="LASER_PEN",e[e.LASER_PEN_END=13]="LASER_PEN_END",e[e.FILE=14]="FILE",e[e.REDO=15]="REDO",e[e.CALIBRATE=16]="CALIBRATE",e[e.TEXT=17]="TEXT"}(a||(t.WActions=a={}));t.StateRelatedActions=[a.CALIBRATE,a.FILE];var r=t.WB_MODE=void 0;!function(e){e[e.readonly=-1]="readonly",e[e.draw=1]="draw"}(r||(t.WB_MODE=r={}));var i=t.WB_TOOL=void 0;!function(e){e[e.flag=-1]="flag",e[e.free=1]="free",e[e.line=2]="line",e[e.rect=3]="rect",e[e.solidRect=4]="solidRect",e[e.roundRect=5]="roundRect",e[e.solidRoundRect=6]="solidRoundRect",e[e.circle=7]="circle",e[e.solidCircle=8]="solidCircle",e[e.ellipse=9]="ellipse",e[e.solidEllipse=10]="solidEllipse",e[e.fill=11]="fill",e[e.text=12]="text",e[e.erase=13]="erase"}(i||(t.WB_TOOL=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VersionAction=t.TextAction=t.CalibrateAction=t.RedoAction=t.FileAction=t.LaserPenEndAction=t.LaserPenAction=t.SyncPrepareAckAction=t.SyncPrepareAction=t.SyncAction=t.SyncRequestAction=t.ClearAckAction=t.ClearAction=t.SerialAction=t.RevokeAction=t.EndAction=t.MoveAction=t.StartAction=void 0;var a=p(n(19)),r=p(n(5)),i=p(n(2)),o=p(n(1)),s=p(n(3)),u=p(n(4)),l=p(n(0)),c=p(n(22)),d=n(150);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){return 0===e||e<0?"0":1===e||e>1?"1":e.toFixed(4).slice(2)},f=function(e){return"0"===e?0:"1"===e?1:parseFloat("0."+e)},g=function(e,t){return"string"==typeof e?e:(0,c.default)(e,t).replace(/;/gm,"；").replace(/,/gm,"，").replace(/:/gm,"¦")},v=function(e){var t=e.replace(/；/gm,";").replace(/，/gm,",").replace(/¦/gm,":");return JSON.parse(t)},y=function e(){(0,l.default)(this,e)},m=t.StartAction=function(e){function t(e,n){(0,l.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return a.x=e,a.y=n,a.TYPE=d.WActions.START,a}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=h(this.x),t=h(this.y);return this.TYPE+":"+e+","+t}}],[{key:"fromString",value:function(e){var n=e.split(",");return new t(f(n[0]),f(n[1]))}}]),t}(y);t.MoveAction=function(e){function t(e,n){(0,l.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return a.x=e,a.y=n,a.TYPE=d.WActions.MOVE,a}return(0,u.default)(t,e),(0,o.default)(t,null,[{key:"fromString",value:function(e){var n=e.split(",");return new t(f(n[0]),f(n[1]))}}]),t}(m),t.EndAction=function(e){function t(e,n){(0,l.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return a.x=e,a.y=n,a.TYPE=d.WActions.END,a}return(0,u.default)(t,e),(0,o.default)(t,null,[{key:"fromString",value:function(e){var n=e.split(",");return new t(f(n[0]),f(n[1]))}}]),t}(m),t.RevokeAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.REVOKE,e.TYPE=d.WActions.REVOKE,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(y),t.SerialAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SERIAL,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(y),t.ClearAction=function(e){function t(e){(0,l.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.TYPE=d.WActions.CLEAR,Array.isArray(e)?n.accounts=e:n.accounts=e?[e]:[],n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=g(this.accounts);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){return new t(v(e))}}]),t}(y),t.ClearAckAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.CLEAR_ACK,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return this.TYPE+":"}}],[{key:"fromString",value:function(e){return new t}}]),t}(y),t.SyncRequestAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SYNC_REQUEST,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(y),t.SyncAction=function(e){function t(e){(0,l.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.sync=e,n.TYPE=d.WActions.SYNC,n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=this.sync,t=g(e);return this.TYPE+":"+t}}],[{key:"fromString",value:function(e){return new t(v(e))}}]),t}(y),t.SyncPrepareAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SYNC_PREPARE,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=g(this,[""]);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){return new t}}]),t}(y),t.SyncPrepareAckAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SYNC_PREPARE_ACK,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return this.TYPE+":"}}],[{key:"fromString",value:function(e){return new t}}]),t}(y),t.LaserPenAction=function(e){function t(e,n){(0,l.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return a.x=e,a.y=n,a.TYPE=d.WActions.LASER_PEN,a}return(0,u.default)(t,e),(0,o.default)(t,null,[{key:"fromString",value:function(e){var n=e.split(",");return new t(+n[0],+n[1])}}]),t}(m),t.LaserPenEndAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.LASER_PEN_END,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return this.TYPE+":"}}],[{key:"fromString",value:function(e){return new t}}]),t}(y);(t.FileAction=function(e){function t(e){(0,l.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.file=e,n.TYPE=d.WActions.FILE,n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=this.file,t=void 0;return t="img"===e.type?"0":"h5"===e.type?"1":"-1",this.TYPE+":"+(e.docId||"")+","+(e.currentPage||"")+","+(e.pageCount||"")+","+t+","+(e.url||"")+","+(e.urlStr||"")+","+(e.h5Cmd||"")}}],[{key:"fromString",value:function(e){var n=e.split(","),a=void 0;return a="0"===n[3]?"img":"1"===n[3]?"h5":"clear",new t({docId:n[0]||"",currentPage:parseInt(n[1]||"1"),pageCount:parseInt(n[2]||"1"),type:a||"img",url:n[4]||"",urlStr:n[5]||"",h5Cmd:n[6]||""})}},{key:"immuteUpdate",value:function(e,n){var a={},r={};return t.PROPS.forEach((function(t){var i=e[t],o=n[t];void 0===o||""===o?a[t]=i:o!==i?(r[t]=o,a[t]=o):a[t]=i})),[a,r]}}]),t}(y)).PROPS=["docId","currentPage","pageCount","type","url","urlStr","h5Cmd"];t.RedoAction=function(e){function t(){(0,l.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.REDO,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(y);var M=t.CalibrateAction=function(e){function t(e){(0,l.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.TYPE=d.WActions.CALIBRATE,(0,r.default)(n,e),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=g(this,t.PROPS);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){return new t(v(e))}}]),t}(y);M.USER_PROPS=["mode","tool","size","color","fontsize","isMouseDown","keyDown","flagPos"],M.PROPS=[].concat((0,a.default)(M.USER_PROPS),["altKey","shiftKey","which","ctrlKey"],["ownerCanvasHeight","ownerCanvasWidth"]),(t.TextAction=function(e){function t(e,n,a){(0,l.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.x=e,r.y=n,r.text=a,r.TYPE=d.WActions.TEXT,r}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=g(this,t.PROPS);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){var n=v(e);return new t(n.x,n.y,n.text)}}]),t}(y)).PROPS=["x","y","text"],(t.VersionAction=function(e){function t(e){var n=e.ver,a=e.account,r=e.gzip;(0,l.default)(this,t);var o=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return o.TYPE=d.WActions.VERSION,o.ver=n,o.account=a,o.gzip=r,o}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=g(this,t.PROPS);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){var n=v(e);return new t({ver:n.ver,account:n.account,gzip:n.gzip})}}]),t}(y)).PROPS=["ver","account","gzip"]},function(e,t,n){e.exports={default:n(170),__esModule:!0}},function(e,t){e.exports=function(e,t,n){var a=void 0===n;switch(t.length){case 0:return a?e():e.call(n);case 1:return a?e(t[0]):e.call(n,t[0]);case 2:return a?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return a?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return a?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=function(e,t,n,a){e.addEventListener(t,n,a)},t.off=function(e,t,n,a){e.removeEventListener(t,n,a)}},function(e,t){var n,a,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{a="function"==typeof clearTimeout?clearTimeout:o}catch(e){a=o}}();var u,l=[],c=!1,d=-1;function p(){c&&u&&(c=!1,u.length?l=u.concat(l):d=-1,l.length&&h())}function h(){if(!c){var e=s(p);c=!0;for(var t=l.length;t;){for(u=l,l=[];++d<t;)u&&u[d].run();d=-1,t=l.length}u=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===o||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||c||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){e.exports={default:n(207),__esModule:!0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){self,e.exports=function(){"use strict";var e={d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return m}});var n=function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.logger=console,this.onError=function(e){},this.onProgress=function(e){},this.onComplete=function(e){},t)this[n]=t[n]};function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var i=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(i={privateObj:{},setItem:function(e,t){i.privateObj[e]=t},getItem:function(e){return i.privateObj[e]},removeItem:function(e){delete i.privateObj[e]},getKeys:function(){return Object.keys(i.privateObj)}});var o={getFileKey:function(e){var t=e.size.toString(),n=e.lastModified.toString();return e.name+t.slice(t.length-5)+n.slice(n.length-5)},getFileInfo:function(e){var t=i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}},initFile:function(e,t){o.clearExpiredInfo();var n=this.getFileKey(t),a={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Date.now(),end:!1};return e.payload&&(a.payload=e.payload),i.setItem(n,JSON.stringify(a)),n},setUploadContext:function(e,t){var n=this.getFileInfo(e);n&&(n.ctx=t,i.setItem(e,JSON.stringify(n)))},setComplete:function(e){var t=this.getFileInfo(e);t&&(t.modifyAt=Date.now(),t.end=!0,i.setItem(e,JSON.stringify(t)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){i.removeItem(e)},clearExpiredInfo:function(){var e,t="function"==typeof i.getKeys?i.getKeys():Object.keys(i),n=Date.now(),r=[],s=a(t);try{for(s.s();!(e=s.n()).done;){var u=e.value,l=o.getFileInfo(u);null===l||n-l.modifyAt>m.expireTime?i.removeItem(u):r.push({fileInfo:l,key:u})}}catch(e){s.e(e)}finally{s.f()}if(r.length>m.maxFileCache){var c,d=a(r.sort((function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt})).slice(m.maxFileCache));try{for(d.s();!(c=d.n()).done;){var p=c.value;i.removeItem(p.key)}}catch(e){d.e(e)}finally{d.f()}}}},s=o;function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return d(e,arguments,f(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),h(a,e)})(e)}function d(e,t,n){return(d=p()?Reflect.construct:function(e,t,n){var a=[null];a.push.apply(a,t);var r=new(Function.bind.apply(e,a));return n&&h(r,n.prototype),r}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(r,e);var t,n,a=(t=r,n=p(),function(){var e,a=f(t);if(n){var r=f(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return l(this,e)});function r(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(n=a.call(this,"NosUploadError:"+e)).errCode=t,n.errMsg=e,n}return r}(c(Error)),v=function(){function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=a,this.file=t,this.param=n,this.fileKey=s.initFile(n,t),this.resume()}var t;return(t=[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;!function e(t,n,a){if("uploading"===t.uploadState){var r=t.config,i=t.param,o=s.getUploadContext(t.fileKey);if(!o)return a(0);var u=new XMLHttpRequest,l=r.directUploadAddr+"/".concat(i.bucketName)+"/".concat(encodeURIComponent(i.objectName))+"?uploadContext"+"&context=".concat(o)+"&version=".concat(r.version);u.onreadystatechange=function(){var i;if("abort"!==t.uploadState&&4===u.readyState){var o;try{o=JSON.parse(u.responseText)}catch(e){o={errMsg:"JsonParseError in getOffset",errCode:500}}200===u.status?o.errCode?t.config.onError(new g(o.errMsg,o.errCode)):a(o.offset):u.status.toString().match(/^5/)?e(t,n-1,a):n>0?("function"==typeof(null===(i=r.logger)||void 0===i?void 0:i.error)&&r.logger.error("getOffset(".concat(l,") error. retry after 3 seconds. ").concat((new Date).toTimeString())),setTimeout((function(){e(t,n-1,a)}),3500)):(s.removeFileInfo(t.fileKey),u.status?r.onError(new g("getOffset(".concat(l,") error: ").concat(u.status," ").concat(u.statusText))):r.onError(new g("getOffset(".concat(l,") error. no Error Code"))))}},u.open("get",l),u.setRequestHeader("x-nos-token",i.token),u.timeout=r.getOffsetTimeout,u.send()}}(this,t.retryCount,(function(n){!function e(t,n,a,r){if("uploading"===t.uploadState){var i=t.param,o=t.config,u=File.prototype.slice,l=void 0!==i.ctx?i.ctx:"",c=n+o.trunkSize>t.file.size,d=c?t.file.size:n+o.trunkSize,p=new XMLHttpRequest,h=o.directUploadAddr+"/".concat(i.bucketName)+"/".concat(encodeURIComponent(i.objectName));if(p.upload.onprogress=function(e){var a=0;e.lengthComputable?(a=(n+e.loaded)/t.file.size,o.onProgress(a)):o.onError(new g("browser does not support query upload progress"))},p.onreadystatechange=function(){var i,u;if("abort"!==t.uploadState&&4===p.readyState){var l;try{l=JSON.parse(p.responseText)}catch(e){"function"==typeof(null===(i=o.logger)||void 0===i?void 0:i.error)&&o.logger.error("JsonParseError in uploadTrunk",e),l={errMsg:"JsonParseError in uploadTrunk"}}200===p.status?(t.setContext(l.context),c?(r(),t.setComplete()):e(t,l.offset,o.retryCount,r)):p.status.toString().match(/^5/)?a>0?e(t,n,a-1,r):(s.removeFileInfo(t.fileKey),o.onError(new g(l.errMsg,l.errCode))):a>0?("function"==typeof(null===(u=o.logger)||void 0===u?void 0:u.error)&&o.logger.error("uploadTrunk(".concat(h,") error. retry after 3 seconds. ").concat((new Date).toTimeString())),setTimeout((function(){e(t,n,a-1,r)}),3500)):(s.removeFileInfo(t.fileKey),p.status?o.onError(new g("uploadTrunk(".concat(h,") error: ").concat(p.status," ").concat(p.statusText))):o.onError(new g("uploadTrunk(".concat(h,") error. no Error Code. Please check your network"))))}},p.open("post",h+"?offset=".concat(n)+"&complete=".concat(c)+"&context=".concat(l)+"&version=".concat(o.version)),p.setRequestHeader("x-nos-token",i.token),t.file.type&&p.setRequestHeader("content-type",t.file.type),p.timeout=o.trunkUploadTimeout,"undefined"!=typeof FileReader){var f=new FileReader;f.addEventListener("load",(function(e){var t;(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)?p.send(e.target.result):o.onError(new g("Read ArrayBuffer failed"))})),f.addEventListener("error",(function(e){var t=e.target.error;o.onError(new g("Read ArrayBuffer error. ".concat(t.toString()),t.code))})),f.readAsArrayBuffer(u.call(t.file,n,d))}else p.send(u.call(t.file,n,d))}}(e,n,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),s.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){s.setUploadContext(this.fileKey,e),this.param.ctx=e}},{key:"setComplete",value:function(){s.setComplete(this.fileKey),this.setUploadState("ended")}}])&&function(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(e.prototype,t),e}(),y={maxFileCache:6,expireTime:864e5,getFileUploadInformation:function(e){var t=s.getFileKey(e),n=s.getFileInfo(t);return null===n?null:Date.now()-n.modifyAt>y.expireTime?(s.removeFileInfo(t),null):{uploadInfo:Object.assign({bucketName:n.bucket,objectName:n.obj,token:n.token,ctx:n.ctx},n.payload?{payload:n.payload}:{}),complete:n.end}},setMaxFileCache:function(e){y.maxFileCache=e},setExpireTime:function(e){y.expireTime=e},printCaches:function(){for(var e=0,t=Object.keys(localStorage);e<t.length;e++){var n=t[e],a=s.getFileInfo(n);a&&console.log(a,"modifiedAt",new Date(a.modifyAt).toTimeString())}},createConfig:function(e){return new n(e)},createTask:function(e,t,n){return new v(e,t,n)}},m=y;return t.default}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=t.pako=void 0;var a=i(n(14)),r=n(460);function i(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;if(!e)return o.INVALID;var n=void 0;if(16===t){var a=+e;return a<0?(n=s(a),console.log("hex2rgb",a,n),n):((n=a.toString(16)).length<3&&(n=("000"+n).slice(-3)),n.length>3&&n.length<6&&(n=("000"+n).slice(-6)),n="#"+n)}return 10===t?(n=e.replace(/#/gi,""),n=parseInt("0x"+n),isNaN(n)?o.INVALID:""+n):o.INVALID}function s(e){var t=e>>8&255,n=255&e,a=(e>>16&255).toString(16),r=t.toString(16),i=n.toString(16);return console.log("rgb",a,r,i),"#"+("0"+a).slice(-2)+("0"+r).slice(-2)+("0"+i).slice(-2)}Object.defineProperty(t,"pako",{enumerable:!0,get:function(){return i(r).default}}),t.formatColor=o,t.hex2rgb=s,t.getKiloBytes=function(e){if("number"==typeof e)return 2*e/1024;if("string"==typeof e)return 2*e.length/1024;return 0},t.sign=function(e){return e?e<0?-1:1:0},o.INVALID="++bad-color++";t.sleep=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return new a.default((function(t){setTimeout(t,e)}))}},function(e,t,n){"use strict";var a;n.r(t),n.d(t,"v1",(function(){return g})),n.d(t,"v3",(function(){return T})),n.d(t,"v4",(function(){return _})),n.d(t,"v5",(function(){return A})),n.d(t,"NIL",(function(){return P})),n.d(t,"version",(function(){return O})),n.d(t,"validate",(function(){return s})),n.d(t,"stringify",(function(){return p})),n.d(t,"parse",(function(){return v}));var r=new Uint8Array(16);function i(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(r)}var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var s=function(e){return"string"==typeof e&&o.test(e)},u=[],l=0;l<256;++l)u.push((l+256).toString(16).substr(1));var c,d,p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n},h=0,f=0;var g=function(e,t,n){var a=t&&n||0,r=t||new Array(16),o=(e=e||{}).node||c,s=void 0!==e.clockseq?e.clockseq:d;if(null==o||null==s){var u=e.random||(e.rng||i)();null==o&&(o=c=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==s&&(s=d=16383&(u[6]<<8|u[7]))}var l=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:f+1,v=l-h+(g-f)/1e4;if(v<0&&void 0===e.clockseq&&(s=s+1&16383),(v<0||l>h)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=l,f=g,d=s;var y=(1e4*(268435455&(l+=122192928e5))+g)%4294967296;r[a++]=y>>>24&255,r[a++]=y>>>16&255,r[a++]=y>>>8&255,r[a++]=255&y;var m=l/4294967296*1e4&268435455;r[a++]=m>>>8&255,r[a++]=255&m,r[a++]=m>>>24&15|16,r[a++]=m>>>16&255,r[a++]=s>>>8|128,r[a++]=255&s;for(var M=0;M<6;++M)r[a+M]=o[M];return t||p(r)};var v=function(e){if(!s(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};var y=function(e,t,n){function a(e,a,r,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof a&&(a=v(a)),16!==a.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(a),o.set(e,a.length),(o=n(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,r){i=i||0;for(var s=0;s<16;++s)r[i+s]=o[s];return r}return p(o)}try{a.name=e}catch(e){}return a.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",a.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",a};function m(e){return 14+(e+64>>>9<<4)+1}function M(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function x(e,t,n,a,r,i){return M((o=M(M(t,e),M(a,i)))<<(s=r)|o>>>32-s,n);var o,s}function w(e,t,n,a,r,i,o){return x(t&n|~t&a,e,t,r,i,o)}function I(e,t,n,a,r,i,o){return x(t&a|n&~a,e,t,r,i,o)}function b(e,t,n,a,r,i,o){return x(t^n^a,e,t,r,i,o)}function k(e,t,n,a,r,i,o){return x(n^(t|~a),e,t,r,i,o)}var T=y("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,a=0;a<n;a+=8){var r=e[a>>5]>>>a%32&255,i=parseInt("0123456789abcdef".charAt(r>>>4&15)+"0123456789abcdef".charAt(15&r),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var n=1732584193,a=-271733879,r=-1732584194,i=271733878,o=0;o<e.length;o+=16){var s=n,u=a,l=r,c=i;n=w(n,a,r,i,e[o],7,-680876936),i=w(i,n,a,r,e[o+1],12,-389564586),r=w(r,i,n,a,e[o+2],17,606105819),a=w(a,r,i,n,e[o+3],22,-1044525330),n=w(n,a,r,i,e[o+4],7,-176418897),i=w(i,n,a,r,e[o+5],12,1200080426),r=w(r,i,n,a,e[o+6],17,-1473231341),a=w(a,r,i,n,e[o+7],22,-45705983),n=w(n,a,r,i,e[o+8],7,1770035416),i=w(i,n,a,r,e[o+9],12,-1958414417),r=w(r,i,n,a,e[o+10],17,-42063),a=w(a,r,i,n,e[o+11],22,-1990404162),n=w(n,a,r,i,e[o+12],7,1804603682),i=w(i,n,a,r,e[o+13],12,-40341101),r=w(r,i,n,a,e[o+14],17,-1502002290),a=w(a,r,i,n,e[o+15],22,1236535329),n=I(n,a,r,i,e[o+1],5,-165796510),i=I(i,n,a,r,e[o+6],9,-1069501632),r=I(r,i,n,a,e[o+11],14,643717713),a=I(a,r,i,n,e[o],20,-373897302),n=I(n,a,r,i,e[o+5],5,-701558691),i=I(i,n,a,r,e[o+10],9,38016083),r=I(r,i,n,a,e[o+15],14,-660478335),a=I(a,r,i,n,e[o+4],20,-405537848),n=I(n,a,r,i,e[o+9],5,568446438),i=I(i,n,a,r,e[o+14],9,-1019803690),r=I(r,i,n,a,e[o+3],14,-187363961),a=I(a,r,i,n,e[o+8],20,1163531501),n=I(n,a,r,i,e[o+13],5,-1444681467),i=I(i,n,a,r,e[o+2],9,-51403784),r=I(r,i,n,a,e[o+7],14,1735328473),a=I(a,r,i,n,e[o+12],20,-1926607734),n=b(n,a,r,i,e[o+5],4,-378558),i=b(i,n,a,r,e[o+8],11,-2022574463),r=b(r,i,n,a,e[o+11],16,1839030562),a=b(a,r,i,n,e[o+14],23,-35309556),n=b(n,a,r,i,e[o+1],4,-1530992060),i=b(i,n,a,r,e[o+4],11,1272893353),r=b(r,i,n,a,e[o+7],16,-155497632),a=b(a,r,i,n,e[o+10],23,-1094730640),n=b(n,a,r,i,e[o+13],4,681279174),i=b(i,n,a,r,e[o],11,-358537222),r=b(r,i,n,a,e[o+3],16,-722521979),a=b(a,r,i,n,e[o+6],23,76029189),n=b(n,a,r,i,e[o+9],4,-640364487),i=b(i,n,a,r,e[o+12],11,-421815835),r=b(r,i,n,a,e[o+15],16,530742520),a=b(a,r,i,n,e[o+2],23,-995338651),n=k(n,a,r,i,e[o],6,-198630844),i=k(i,n,a,r,e[o+7],10,1126891415),r=k(r,i,n,a,e[o+14],15,-1416354905),a=k(a,r,i,n,e[o+5],21,-57434055),n=k(n,a,r,i,e[o+12],6,1700485571),i=k(i,n,a,r,e[o+3],10,-1894986606),r=k(r,i,n,a,e[o+10],15,-1051523),a=k(a,r,i,n,e[o+1],21,-2054922799),n=k(n,a,r,i,e[o+8],6,1873313359),i=k(i,n,a,r,e[o+15],10,-30611744),r=k(r,i,n,a,e[o+6],15,-1560198380),a=k(a,r,i,n,e[o+13],21,1309151649),n=k(n,a,r,i,e[o+4],6,-145523070),i=k(i,n,a,r,e[o+11],10,-1120210379),r=k(r,i,n,a,e[o+2],15,718787259),a=k(a,r,i,n,e[o+9],21,-343485551),n=M(n,s),a=M(a,u),r=M(r,l),i=M(i,c)}return[n,a,r,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(m(t)),a=0;a<t;a+=8)n[a>>5]|=(255&e[a/8])<<a%32;return n}(e),8*e.length))}));var _=function(e,t,n){var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=a[r];return t}return p(a)};function C(e,t,n,a){switch(e){case 0:return t&n^~t&a;case 1:return t^n^a;case 2:return t&n^t&a^n&a;case 3:return t^n^a}}function N(e,t){return e<<t|e>>>32-t}var A=y("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var a=unescape(encodeURIComponent(e));e=[];for(var r=0;r<a.length;++r)e.push(a.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,o=Math.ceil(i/16),s=new Array(o),u=0;u<o;++u){for(var l=new Uint32Array(16),c=0;c<16;++c)l[c]=e[64*u+4*c]<<24|e[64*u+4*c+1]<<16|e[64*u+4*c+2]<<8|e[64*u+4*c+3];s[u]=l}s[o-1][14]=8*(e.length-1)/Math.pow(2,32),s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<o;++d){for(var p=new Uint32Array(80),h=0;h<16;++h)p[h]=s[d][h];for(var f=16;f<80;++f)p[f]=N(p[f-3]^p[f-8]^p[f-14]^p[f-16],1);for(var g=n[0],v=n[1],y=n[2],m=n[3],M=n[4],x=0;x<80;++x){var w=Math.floor(x/20),I=N(g,5)+C(w,v,y,m)+M+t[w]+p[x]>>>0;M=m,m=y,y=N(v,30)>>>0,v=g,g=I}n[0]=n[0]+g>>>0,n[1]=n[1]+v>>>0,n[2]=n[2]+y>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+M>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),P="00000000-0000-0000-0000-000000000000";var O=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,n){var a=n(8),r=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}},function(e,t,n){n(163),e.exports=n(8).Number.isInteger},function(e,t,n){var a=n(10);a(a.S,"Number",{isInteger:n(164)})},function(e,t,n){var a=n(20),r=Math.floor;e.exports=function(e){return!a(e)&&isFinite(e)&&r(e)===e}},function(e,t,n){n(166),e.exports=n(8).Object.assign},function(e,t,n){var a=n(10);a(a.S+a.F,"Object",{assign:n(167)})},function(e,t,n){"use strict";var a=n(21),r=n(49),i=n(85),o=n(61),s=n(43),u=n(79),l=Object.assign;e.exports=!l||n(36)((function(){var e={},t={},n=Symbol(),a="abcdefghijklmnopqrst";return e[n]=7,a.split("").forEach((function(e){t[e]=e})),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=a}))?function(e,t){for(var n=s(e),l=arguments.length,c=1,d=i.f,p=o.f;l>c;)for(var h,f=u(arguments[c++]),g=d?r(f).concat(d(f)):r(f),v=g.length,y=0;v>y;)h=g[y++],a&&!p.call(f,h)||(n[h]=f[h]);return n}:l},function(e,t,n){var a=n(41),r=n(68),i=n(169);e.exports=function(e){return function(t,n,o){var s,u=a(t),l=r(u.length),c=i(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var a=n(81),r=Math.max,i=Math.min;e.exports=function(e,t){return(e=a(e))<0?r(e+t,0):i(e,t)}},function(e,t,n){n(44),n(51),e.exports=n(87).f("iterator")},function(e,t,n){var a=n(81),r=n(80);e.exports=function(e){return function(t,n){var i,o,s=String(r(t)),u=a(n),l=s.length;return u<0||u>=l?e?"":void 0:(i=s.charCodeAt(u))<55296||i>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):i:e?s.slice(u,u+2):o-56320+(i-55296<<10)+65536}}},function(e,t,n){"use strict";var a=n(63),r=n(53),i=n(56),o={};n(35)(o,n(17)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=a(o,{next:r(1,n)}),i(e,t+" Iterator")}},function(e,t,n){"use strict";var a=n(174),r=n(114),i=n(50),o=n(41);e.exports=n(86)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):r(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),i.Arguments=i.Array,a("keys"),a("values"),a("entries")},function(e,t){e.exports=function(){}},function(e,t,n){n(134),n(70),n(178),n(179),e.exports=n(8).Symbol},function(e,t,n){var a=n(49),r=n(85),i=n(61);e.exports=function(e){var t=a(e),n=r.f;if(n)for(var o,s=n(e),u=i.f,l=0;s.length>l;)u.call(e,o=s[l++])&&t.push(o);return t}},function(e,t,n){var a=n(41),r=n(117).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==i.call(e)?function(e){try{return r(e)}catch(e){return o.slice()}}(e):r(a(e))}},function(e,t,n){n(89)("asyncIterator")},function(e,t,n){n(89)("observable")},function(e,t,n){n(70),n(44),n(51),n(181),n(184),n(185),e.exports=n(8).Promise},function(e,t,n){"use strict";var a,r,i,o,s=n(55),u=n(15),l=n(32),c=n(71),d=n(10),p=n(20),h=n(48),f=n(90),g=n(57),v=n(120),y=n(121).set,m=n(182)(),M=n(92),x=n(122),w=n(183),I=n(123),b=u.TypeError,k=u.process,T=k&&k.versions,_=T&&T.v8||"",C=u.Promise,N="process"==c(k),A=function(){},P=r=M.f,O=!!function(){try{var e=C.resolve(1),t=(e.constructor={})[n(17)("species")]=function(e){e(A,A)};return(N||"function"==typeof PromiseRejectionEvent)&&e.then(A)instanceof t&&0!==_.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),D=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},S=function(e,t){if(!e._n){e._n=!0;var n=e._c;m((function(){for(var a=e._v,r=1==e._s,i=0,o=function(t){var n,i,o,s=r?t.ok:t.fail,u=t.resolve,l=t.reject,c=t.domain;try{s?(r||(2==e._h&&L(e),e._h=1),!0===s?n=a:(c&&c.enter(),n=s(a),c&&(c.exit(),o=!0)),n===t.promise?l(b("Promise-chain cycle")):(i=D(n))?i.call(n,u,l):u(n)):l(a)}catch(e){c&&!o&&c.exit(),l(e)}};n.length>i;)o(n[i++]);e._c=[],e._n=!1,t&&!e._h&&E(e)}))}},E=function(e){y.call(u,(function(){var t,n,a,r=e._v,i=j(e);if(i&&(t=x((function(){N?k.emit("unhandledRejection",r,e):(n=u.onunhandledrejection)?n({promise:e,reason:r}):(a=u.console)&&a.error&&a.error("Unhandled promise rejection",r)})),e._h=N||j(e)?2:1),e._a=void 0,i&&t.e)throw t.v}))},j=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){y.call(u,(function(){var t;N?k.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},z=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),S(t,!0))},R=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw b("Promise can't be resolved itself");(t=D(e))?m((function(){var a={_w:n,_d:!1};try{t.call(e,l(R,a,1),l(z,a,1))}catch(e){z.call(a,e)}})):(n._v=e,n._s=1,S(n,!1))}catch(e){z.call({_w:n,_d:!1},e)}}};O||(C=function(e){f(this,C,"Promise","_h"),h(e),a.call(this);try{e(l(R,this,1),l(z,this,1))}catch(e){z.call(this,e)}},(a=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(93)(C.prototype,{then:function(e,t){var n=P(v(this,C));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=N?k.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&S(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new a;this.promise=e,this.resolve=l(R,e,1),this.reject=l(z,e,1)},M.f=P=function(e){return e===C||e===o?new i(e):r(e)}),d(d.G+d.W+d.F*!O,{Promise:C}),n(56)(C,"Promise"),n(124)("Promise"),o=n(8).Promise,d(d.S+d.F*!O,"Promise",{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!O),"Promise",{resolve:function(e){return I(s&&this===o?C:this,e)}}),d(d.S+d.F*!(O&&n(125)((function(e){C.all(e).catch(A)}))),"Promise",{all:function(e){var t=this,n=P(t),a=n.resolve,r=n.reject,i=x((function(){var n=[],i=0,o=1;g(e,!1,(function(e){var s=i++,u=!1;n.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,n[s]=e,--o||a(n))}),r)})),--o||a(n)}));return i.e&&r(i.v),n.promise},race:function(e){var t=this,n=P(t),a=n.reject,r=x((function(){g(e,!1,(function(e){t.resolve(e).then(n.resolve,a)}))}));return r.e&&a(r.v),n.promise}})},function(e,t,n){var a=n(15),r=n(121).set,i=a.MutationObserver||a.WebKitMutationObserver,o=a.process,s=a.Promise,u="process"==n(54)(o);e.exports=function(){var e,t,n,l=function(){var a,r;for(u&&(a=o.domain)&&a.exit();e;){r=e.fn,e=e.next;try{r()}catch(a){throw e?n():t=void 0,a}}t=void 0,a&&a.enter()};if(u)n=function(){o.nextTick(l)};else if(!i||a.navigator&&a.navigator.standalone)if(s&&s.resolve){var c=s.resolve(void 0);n=function(){c.then(l)}}else n=function(){r.call(a,l)};else{var d=!0,p=document.createTextNode("");new i(l).observe(p,{characterData:!0}),n=function(){p.data=d=!d}}return function(a){var r={fn:a,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},function(e,t,n){var a=n(15).navigator;e.exports=a&&a.userAgent||""},function(e,t,n){"use strict";var a=n(10),r=n(8),i=n(15),o=n(120),s=n(123);a(a.P+a.R,"Promise",{finally:function(e){var t=o(this,r.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){"use strict";var a=n(10),r=n(92),i=n(122);a(a.S,"Promise",{try:function(e){var t=r.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){n(187);var a=n(8).Object;e.exports=function(e,t,n){return a.defineProperty(e,t,n)}},function(e,t,n){var a=n(10);a(a.S+a.F*!n(21),"Object",{defineProperty:n(24).f})},function(e,t,n){n(189),e.exports=n(8).Object.keys},function(e,t,n){var a=n(43),r=n(49);n(102)("keys",(function(){return function(e){return r(a(e))}}))},function(e,t,n){n(51),n(44),e.exports=n(191)},function(e,t,n){var a=n(26),r=n(91);e.exports=n(8).getIterator=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return a(t.call(e))}},function(e,t,n){n(70),n(44),n(51),n(193),n(197),n(199),n(200),e.exports=n(8).Set},function(e,t,n){"use strict";var a=n(126),r=n(94);e.exports=n(127)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return a.def(r(this,"Set"),e=0===e?0:e,e)}},a)},function(e,t,n){var a=n(32),r=n(79),i=n(43),o=n(68),s=n(195);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,c=4==e,d=6==e,p=5==e||d,h=t||s;return function(t,s,f){for(var g,v,y=i(t),m=r(y),M=a(s,f,3),x=o(m.length),w=0,I=n?h(t,x):u?h(t,0):void 0;x>w;w++)if((p||w in m)&&(v=M(g=m[w],w,y),e))if(n)I[w]=v;else if(v)switch(e){case 3:return!0;case 5:return g;case 6:return w;case 2:I.push(g)}else if(c)return!1;return d?-1:l||c?c:I}}},function(e,t,n){var a=n(196);e.exports=function(e,t){return new(a(e))(t)}},function(e,t,n){var a=n(20),r=n(116),i=n(17)("species");e.exports=function(e){var t;return r(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!r(t.prototype)||(t=void 0),a(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var a=n(10);a(a.P+a.R,"Set",{toJSON:n(128)("Set")})},function(e,t,n){var a=n(57);e.exports=function(e,t){var n=[];return a(e,!1,n.push,n,t),n}},function(e,t,n){n(129)("Set")},function(e,t,n){n(130)("Set")},function(e,t,n){n(44),n(202),e.exports=n(8).Array.from},function(e,t,n){"use strict";var a=n(32),r=n(10),i=n(43),o=n(118),s=n(119),u=n(68),l=n(203),c=n(91);r(r.S+r.F*!n(125)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,r,d,p=i(e),h="function"==typeof this?this:Array,f=arguments.length,g=f>1?arguments[1]:void 0,v=void 0!==g,y=0,m=c(p);if(v&&(g=a(g,f>2?arguments[2]:void 0,2)),null==m||h==Array&&s(m))for(n=new h(t=u(p.length));t>y;y++)l(n,y,v?g(p[y],y):p[y]);else for(d=m.call(p),n=new h;!(r=d.next()).done;y++)l(n,y,v?o(d,g,[r.value,y],!0):r.value);return n.length=y,n}})},function(e,t,n){"use strict";var a=n(24),r=n(53);e.exports=function(e,t,n){t in e?a.f(e,t,r(0,n)):e[t]=n}},function(e,t,n){"use strict";var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=n(46),c=new(function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,a=e.resultReturns,r=e.onDone,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onResult:function(e,t,a){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+a()+"}\n"},resultReturns:a,onDone:r,rethrowIfPossible:i})}}]),t}(n(52))),d=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncBailHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncBailHook")}},{key:"compile",value:function(e){return c.setup(this,e),c.create(e)}}]),t}(l);e.exports=d},function(e,t,n){n(206),e.exports=n(8).Object.getPrototypeOf},function(e,t,n){var a=n(43),r=n(113);n(102)("getPrototypeOf",(function(){return function(e){return r(a(e))}}))},function(e,t,n){n(208),e.exports=n(8).Object.setPrototypeOf},function(e,t,n){var a=n(10);a(a.S,"Object",{setPrototypeOf:n(209).set})},function(e,t,n){var a=n(20),r=n(26),i=function(e,t){if(r(e),!a(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,a){try{(a=n(32)(Function.call,n(101).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return i(e,n),t?e.__proto__=n:a(e,n),e}}({},!1):void 0),check:i}},function(e,t,n){n(211);var a=n(8).Object;e.exports=function(e,t){return a.create(e,t)}},function(e,t,n){var a=n(10);a(a.S,"Object",{create:n(63)})},function(e,t,n){n(70),n(44),n(51),n(213),n(214),n(215),n(216),e.exports=n(8).Map},function(e,t,n){"use strict";var a=n(126),r=n(94);e.exports=n(127)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=a.getEntry(r(this,"Map"),e);return t&&t.v},set:function(e,t){return a.def(r(this,"Map"),0===e?0:e,t)}},a,!0)},function(e,t,n){var a=n(10);a(a.P+a.R,"Map",{toJSON:n(128)("Map")})},function(e,t,n){n(129)("Map")},function(e,t,n){n(130)("Map")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=m(n(19)),r=m(n(38)),i=m(n(5)),o=m(n(2)),s=m(n(0)),u=m(n(1)),l=m(n(3)),c=m(n(25)),d=m(n(4)),p=m(n(75)),h=m(n(23)),f=n(297),g=n(103),v=n(30),y=n(16);function m(e){return e&&e.__esModule?e:{default:e}}var M=function(e){function t(){(0,s.default)(this,t);var e=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="pen",e.description="涂鸦操作工具。\n首先使用op:pen:activate设置画布为涂鸦模式。通过op:pen:lineWidth, op:pen:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,d.default)(t,e),(0,u.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handleMouseDown",value:function(e,n,a,r,i){var s,u,l,d,p=!1;if(this.mUpInfo){var h=Date.now()-this.mUpInfo.t<this.app.appConfig.drawMergeInterval,f=Math.abs(i-this.mUpInfo.cy)+Math.abs(r-this.mUpInfo.cx)<this.app.appConfig.drawMergeDist;this.app.appConfig.drawMergeDebug&&(console.log("time diff",Date.now()-this.mUpInfo.t),console.log("dist diff",Math.abs(i-this.mUpInfo.cy)+Math.abs(r-this.mUpInfo.cx))),p=h&&f}clearTimeout(this.mUpTimer),p?(this.points.push(void 0),(0,c.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"handleMouseMove",this).call(this,e,n,a)):(this.mUpInfo&&((0,c.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"handleMouseUp",this).call(this,e,null===(s=this.mUpInfo)||void 0===s?void 0:s.mx,null===(u=this.mUpInfo)||void 0===u?void 0:u.my,null===(l=this.mUpInfo)||void 0===l?void 0:l.cx,null===(d=this.mUpInfo)||void 0===d?void 0:d.cy),this.mUpInfo=void 0),(0,c.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"handleMouseDown",this).call(this,e,n,a,r,i))}},{key:"handleMouseUp",value:function(e,n,a,r,i){var s=this;this.app.appConfig.drawMergeInterval>0?((0,c.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"handleMouseMove",this).call(this,e,n,a),this.mUpInfo={t:Date.now(),mx:n,my:a,cx:r,cy:i},this.mUpTimer=setTimeout((function(){(0,c.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"handleMouseUp",s).call(s,e,n,a,r,i,!0),s.mUpInfo=void 0}),this.app.appConfig.drawMergeInterval)):(0,c.default)(t.prototype.__proto__||(0,o.default)(t.prototype),"handleMouseUp",this).call(this,e,n,a,r,i)}},{key:"getSnapshot",value:function(e){var t=this.points,n=this.opsManager.currPage.getOpId(),a=this.app.room.opIdSnapshotMap[n];if(!a||!a.snapshot.hasOwnProperty("category"))return(0,i.default)({points:t.slice(),total:t.length},this.getFreeDrawCommonProperty({inProgress:e}));var r={boundary:this.getBoundaryRectOfFreeDraw()};return this.sampleSeq>0&&e?(0,i.default)((0,i.default)({},r),{points:t.slice(t.length-h.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,i.default)((0,i.default)({},r),{points:t.slice(t.length-h.default.pointsPerBatch),total:t.length,inProgress:e}):(0,i.default)({points:t.slice(),total:t.length},this.getFreeDrawCommonProperty({inProgress:e}))}},{key:"_draw",value:function(e,t){var n=e.data,a=n.points,r=this.app.scale,i=a.map((function(e){return e?(e=(0,v.getTransPoint)(e,n.mat),(0,y.padPt)(e,r)):e}));return(0,f.drawCurve)(t,i,this.app.scale,.5),i}},{key:"draw",value:function(e,t){var n=e.data;this._draw(e,t),this.strokeOrFill(t,{stroke:n.stroke||n.color,lineWidth:n.lineWidth,opacity:n.opacity,isShape:!1})}},{key:"ifMouseOnOp",value:function(e,t,n){var a=this.app.container.ctx;return this._draw(e,a),a.lineWidth=e.data.lineWidth+20,a.strokeStyle="rgba(0,0,0,0)",a.stroke(),a.isPointInStroke(t,n)}},{key:"patchOp",value:function(e){var t=Number(e.data.lineWidth),n=Math.abs(e.data.xFactor||1),a=Math.abs(e.data.yFactor||1),i=(e.data.points||[]).reduce((function(e,t){return[Math.min(t[0],e[0]),Math.min(t[1],e[1]),Math.max(t[0],e[2]),Math.max(t[1],e[3])]}),[e.data.points[0][0],e.data.points[0][1],e.data.points[0][0],e.data.points[0][1]]),o=(0,r.default)(i,4),s=o[0],u=o[1],l=o[2],c=o[3];e.data.boundary={sx:s-t/2/n,sy:u-t/2/a,w:Math.abs(l-s)+t/n,h:Math.abs(c-u)+t/a}}},{key:"mergePartial",value:function(e,t){var n=this._mergePartial(e,t);return n.data.points.length!==n.data.total&&this.logger.warn("merge ........",e,t),n}},{key:"_mergePartial",value:function(e,t){try{var n=t.data.total-e.data.total,r=!1===e.data.inProgress||!1===t.data.inProgress?{inProgress:!1}:{};if(0===n)return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),r),{points:e.data.points})});if(n<0){var o=t.data.total-t.data.points.length,s=t.data.total;return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),r),{total:e.data.total,boundary:e.data.boundary,points:[].concat((0,a.default)(e.data.points.slice(0,o)),(0,a.default)(t.data.points),(0,a.default)(e.data.points.slice(s)))})})}if(n<=t.data.points.length){var u=t.data.points.length-n;return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),r),{points:e.data.points.concat(t.data.points.slice(u))})})}var l=n-t.data.points.length;return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),r),{points:[].concat((0,a.default)(e.data.points),(0,a.default)(new Array(l)),(0,a.default)(t.data.points))})})}catch(n){return g.LOG&&this.logger.warn("[白板] mergePartial error",e,t),e}}}]),t}(p.default);t.default=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MINIMUM_BROADCAST_GAP_PER_DATATYPE=void 0;var a=g(n(7)),r=g(n(27)),i=g(n(5)),o=g(n(18)),s=g(n(22)),u=g(n(0)),l=g(n(1)),c=n(31),d=g(n(33)),p=n(293),h=n(76),f=n(132);function g(e){return e&&e.__esModule?e:{default:e}}var v=t.MINIMUM_BROADCAST_GAP_PER_DATATYPE=25,y=function(){function e(t,n){var a=this;(0,u.default)(this,e),this.incId=0,this.debounceData={},this.noAckData={},this.dataInResendQueue={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-2,this.dataOfSync={},this.syncStartToLog=-1,this.syncEndToLog=-1,this.pkgInside=0,this.appliedPkgs={},this.isSynchronizing=!1,this.isFirstSync=!0,this.timerTrigger=requestAnimationFrame.bind(window),this._scheduleNextBroadcast=function(e,t){return a.timerTrigger((function(){(new Date).valueOf()-e.time<v?e.timer=a._scheduleNextBroadcast(e,t):a._doBroadcastData(e,t)}))},this._doBroadcastData=function(e,t){var n=e.dataType,r=a.app.room.mergeDebouncedData(e.dataQueue,n),i={strategy:"snapshot"===n?1:2,data:(0,s.default)(r),client_pkg_id:e.client_pkg_id};"snapshot"!==n&&(i.dataType=n),a.app.isConnected&&a.handler.broadcastData(i),a._shouldDataBeResendIfLost(r)&&a._pushDataToResendQueue(i),a.noAckData[i.client_pkg_id]={data:r,fakePkgId:e.fakePkgId},a.debounceData[t]={timer:null,client_pkg_id:-1,time:0,dataQueue:[],fakePkgId:-1,dataType:""}},this._checkResendQueue=function(){if(0===(0,o.default)(a.dataInResendQueue).length)a.resendTimer=null;else{var e=Date.now();for(var t in a.dataInResendQueue){if(a.dataInResendQueue[t].resendCount>=3)return a.logger.error("重发数据超过3次，停止重发该数据",(0,s.default)(a.dataInResendQueue[t].data)),a.app.dataReportUtil("v3_conn_error",{error:{code:h.DataReportConnError.Resend_Count_Exceed_Max,message:(0,s.default)(a.dataInResendQueue[t].data)}}),a.resendTimer=null,a._handleResendFail();e-a.dataInResendQueue[t].sendAt>2e3&&a.app.isConnected&&(a.handler.broadcastData(a.dataInResendQueue[t].data),a.dataInResendQueue[t]=(0,i.default)((0,i.default)({},a.dataInResendQueue[t]),{sendAt:Date.now(),resendCount:a.dataInResendQueue[t].resendCount+1}))}a.resendTimer=setTimeout(a._checkResendQueue,2e3)}},this._handleResendFail=function(){a.dataInResendQueue={};var e=a.room.getCachedTil(a.lastContinueServerPkgId),t=a.room.pkgIdOpIdMap,n=a.room.opIdSnapshotMap;a.app.resetState(),a.app.room.execCachedSnapshots({lastConfirmId:e,pkgIdOpIdMap:t,opIdSnapshotMap:n}),a.lastContinueServerPkgId=e,(0,c.showToast)({msg:"同步数据中...",time:1e3,type:"info",msgType:d.default.SYNCHRONIZING}),a.app.readyToSyncData()},this._setupResendSyncRequestTimer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;clearTimeout(a.resendSyncRequestTimer),a.resendSyncRequestTimer=setTimeout((function(){e<=8?(a.logger.error("[白板] 同步数据超时，第"+(e+1)+"次请求同步数据, "+a.lastContinueServerPkgId),a.handler.sendSyncRequest(a.lastContinueServerPkgId),a._setupResendSyncRequestTimer(e+1)):((0,c.showToast)({type:"error",msg:"无法同步数据，请检查你的网络",time:1e3,msgType:d.default.SYNC_FAIL}),a.app.dataReportUtil("v3_conn_error",{error:{code:h.DataReportConnError.Sync_Timeout,message:(0,s.default)({lastContinueServerPkgId:a.lastContinueServerPkgId,lastPkgIdToSync:a.lastPkgIdToSync})}}),a.logger.error("[白板] 多次同步数据失败"))}),1e4)},this._setCameraAftRdy=function(){a.app.container.width&&a.app.container.height&&a.app.container.mounted?a.app.defaultCameraBound?a.app.setCameraBound(a.app.defaultCameraBound,!1):a.app.hasBackground()||a.app.hasTransDoc()?a.app.fitToDoc(!1):a.app.zoomTo1AfterJoin?(a.app.fitToContent(!1),a.app.zoomTo(1,!1)):a.app.setCameraBound({centerX:0,centerY:0,width:1920,height:1080},!1):a.app.once("container:resize",a._setCameraAftRdy)},this.app=t,this.handler=n,this.randomSeed=(0,p.getRandomIntByStr)(9),this.incId=0,this.bindEvents()}return(0,l.default)(e,[{key:"destroy",value:function(){clearTimeout(this.resendSyncRequestTimer),clearTimeout(this.resendTimer),this.isSynchronizing=!1,void 0===(0,r.default)(this.visHandlerUnregist)&&(this.visHandlerUnregist(),this.visHandlerUnregist=void 0)}},{key:"reset",value:function(){for(var e in this.debounceData)this.debounceData[e].timer&&cancelAnimationFrame(this.debounceData[e].timer);this.debounceData={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-2,this.dataOfSync={},this.appliedPkgs={},this.isSynchronizing=!1,this.randomSeed=(0,p.getRandomIntByStr)(9),this.incId=0,clearTimeout(this.resendSyncRequestTimer)}},{key:"bindEvents",value:function(){var e=this;this.handler.on("data",this.onData.bind(this)),this.handler.on("broadcastAck",this.onBroadcastAck.bind(this)),this.handler.on("syncRequestAck",this.onSendRequestAck.bind(this)),this.handler.on("syncRequestResponse",this.onSendRequestResponse.bind(this)),this.visHandlerUnregist=(0,f.registerVisibleChangeHandler)((function(){e.timerTrigger=requestAnimationFrame.bind(window)}),(function(){e.timerTrigger=setTimeout.bind(window)}))}},{key:"hasPkgBeenApplied",value:function(e,t){if(!t||!e)return!1;var n=this.getAppliedPkgKey(e,t);return this.appliedPkgs.hasOwnProperty(n)}},{key:"setPkgBeenApplied",value:function(e,t,n){if(t&&e){var a=this.getAppliedPkgKey(e,t);(!this.appliedPkgs.hasOwnProperty(a)||this.appliedPkgs[a]>n)&&(this.appliedPkgs[a]=n)}}},{key:"getAppliedPkgKey",value:function(e,t){return t.toString()+"_"+e.toString()}},{key:"onData",value:function(e){var t,n=e.data,a=e.server_pkg_id,r=e.client_pkg_id,i=e.source_uid;if(this._updateServerPkgInfo(a,a),this.isSynchronizing)this.dataOfSync[a]={data:n,client_pkg_id:r,source_uid:i};else{if(this.hasPkgBeenApplied(r,i))return;this.setPkgBeenApplied(r,i,a);var o=n.type,s=n.value;"snapshot"===o?this.room.execSnapshot({snapshot:s,pkgId:a}):"broadcaster"===o?this.app.vision.receiveBroadcaster(s):"alive"===o?null===(t=this.app.aliveManager)||void 0===t||t.receiveAlive(s):"snapshotArr"===o&&this.room.execBatchSnapshots(s.map((function(e){return{snapshot:e,pkgId:a}})),"data")}}},{key:"sendSyncRequest",value:function(){this.logger.log("[白板] 请求同步数据, 是否正在同步数据",this.isSynchronizing,"当前最后一个数据id",this.lastContinueServerPkgId),this.isSynchronizing||(this.isSynchronizing=!0,this.handler.sendSyncRequest(this.lastContinueServerPkgId),this.lastPkgIdToSync=-2,this.dataOfSync={},this._setupResendSyncRequestTimer())}},{key:"stopSyncRequest",value:function(){this.logger.log("白板--\x3e 终止同步数据, 是否正在同步数据",this.isSynchronizing),this.isSynchronizing=!1,clearTimeout(this.resendSyncRequestTimer)}},{key:"onSendRequestAck",value:function(e){this.lastPkgIdToSync=e.last_server_pkg_id,this.logger.log("[白板] 收到同步响应，需求同步到序列号: "+this.lastPkgIdToSync),this._updateAppAfterSync()}},{key:"onSendRequestResponse",value:function(e){var t=this;if(this.isSynchronizing){var n=e.start_server_pkg_id,r=e.end_server_pkg_id,i=e.packages;Array.isArray(i)||(i=[]),clearTimeout(this.syncLogTimer),-1!==this.syncEndToLog&&n!==this.syncEndToLog+1?(this.logger.warn("[白板] 收到同步数据不重叠。\n            \n之前同步数据为: "+this.syncStartToLog+"-"+this.syncEndToLog+", 共有"+this.pkgInside+"数据包\n            \n当前同步数据为: "+n+"-"+r+", 共有"+i.length+"数据包"),this.syncStartToLog=-1,this.syncEndToLog=-1,this.pkgInside=0):(this.syncStartToLog=-1===this.syncStartToLog?n:this.syncStartToLog,this.syncEndToLog=r,this.pkgInside=this.pkgInside+i.length,this.syncLogTimer=setTimeout((function(){t.logger.log("[白板] 收到同步数据: "+t.syncStartToLog+"-"+t.syncEndToLog+"。实际包括"+t.pkgInside+"个数据包"),t.syncStartToLog=-1,t.syncEndToLog=-1,t.pkgInside=0}),2e3));var o=!0,s=!1,u=void 0;try{for(var l,c=(0,a.default)(i);!(o=(l=c.next()).done);o=!0){var d=l.value;this.dataOfSync[d.server_pkg_id]={data:d.data,client_pkg_id:d.client_pkg_id,source_uid:d.source_uid}}}catch(e){s=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}this._updateServerPkgInfo(n,r),this._updateAppAfterSync()}}},{key:"onBroadcastAck",value:function(e){var t=this,n=e.server_pkg_id,a=e.client_pkg_id;if(delete this.dataInResendQueue[a],this._updateServerPkgInfo(n,n),!this.noAckData[a])return this.logger.warn("[白板] broadcastAck, clientSeqId:"+a+"的数据不存在");var r=this.noAckData[a].data,i=this.noAckData[a].fakePkgId;if(delete this.noAckData[a],!r)return this.logger.warn("[白板] broadcastAck, clientSeqId:"+a+"的数据不存在");r&&"snapshot"===r.type?this.app.room.cacheOrExecAckPkg({pkgId:n,snapshot:r.value},i):r&&"snapshotArr"===r.type&&r.value.forEach((function(e){t.app.room.cacheOrExecAckPkg({pkgId:n,snapshot:e},i)}))}},{key:"sendSnapshot",value:function(e,t){return this.broadcastData({data:{type:"snapshot",value:e}},e.opId,"snapshot",t)}},{key:"broadcastRoomState",value:function(e,t){return this.broadcastData({data:{type:t,value:e}},t,t,!0)}},{key:"broadcastData",value:function(e,t,n,a){if(!this.debounceData.hasOwnProperty(t)||!this.debounceData[t].timer){var r=this.nextLocalFakeId,i=this.getNextClientPkgId();this.debounceData[t]={timer:null,time:(new Date).valueOf(),client_pkg_id:i,dataQueue:[],dataType:n,fakePkgId:r},this.noAckData[i]={data:void 0,fakePkgId:r}}var o=this.debounceData[t];return o.dataQueue.push(e.data),a?this._doBroadcastData(o,t):o.timer||(o.timer=this._scheduleNextBroadcast(o,t)),o.fakePkgId}},{key:"getNextClientPkgId",value:function(){return this.incId+=1,Number(this.randomSeed.toString()+this.incId.toString())}},{key:"_shouldDataBeResendIfLost",value:function(e){if("snapshot"===e.type){var t=e.value&&e.value.data&&e.value.data.type,n=e.value&&e.value.data&&e.value.data.inProgress;return(!t||-1===["select","select-hover","camera-bound","laser","mouse-pointer"].indexOf(t))&&!n}return!0}},{key:"_pushDataToResendQueue",value:function(e){this.dataInResendQueue[e.client_pkg_id]={data:e,sendAt:Date.now(),resendCount:0},this.resendTimer||(clearTimeout(this.resendTimer),this.resendTimer=setTimeout(this._checkResendQueue,2e3))}},{key:"_updateAppAfterSync",value:function(){var e=this;if(-2!==this.lastPkgIdToSync&&(this.lastContinueServerPkgId>=this.lastPkgIdToSync&&clearTimeout(this.resendSyncRequestTimer),this.lastContinueServerPkgId>=this.lastPkgIdToSync&&this.isSynchronizing)){this.logger.log("[白板] 同步数据接收完毕: "+this.lastContinueServerPkgId+"--"+this.lastPkgIdToSync),this.isSynchronizing=!1,this.app.emit("event:editable:change",this.app.editable);var t=this._getDataToSync();this.dataOfSync={};for(var n=void 0,r=[],i=t.length-1;i>=0;i--)if("broadcaster"===t[i].data.type){n=t[i].data.value;break}for(var o=0;o<t.length;o++)"broadcaster"===t[o].data.type?n=t[o].data.value:"alive"===t[o].data.type&&r.push(t[o].data.value);var s=[],u=!0,l=!1,c=void 0;try{for(var d,p=(0,a.default)(t);!(u=(d=p.next()).done);u=!0){var h=d.value;if(this.dataInResendQueue.hasOwnProperty(h.client_pkg_id)&&delete this.dataInResendQueue[h.client_pkg_id],!this.hasPkgBeenApplied(h.client_pkg_id,h.source_uid))if(this.setPkgBeenApplied(h.client_pkg_id,h.source_uid,h.pkgId),"snapshot"===h.data.type)s.push({pkgId:h.pkgId,snapshot:h.data.value});else if("snapshotArr"===h.data.type){var f=!0,g=!1,v=void 0;try{for(var y,m=(0,a.default)(h.data.value);!(f=(y=m.next()).done);f=!0){var M=y.value;s.push({pkgId:h.pkgId,snapshot:M})}}catch(e){g=!0,v=e}finally{try{!f&&m.return&&m.return()}finally{if(g)throw v}}}}}catch(e){l=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(l)throw c}}this.app.aliveManager.receiveSyncData(r),n&&this.app.vision.receiveBroadcasterAfterSync(n),setTimeout((function(){e.app.dispatcher.emit("event:sync_finished")}),0),this.app.room.execBatchSnapshots(s,"sync",(function(){if(e.isFirstSync){e.isFirstSync=!1;var t=e.app.vision.mode;if("follower"===t||"broadcaster"===t)return;e._setCameraAftRdy()}else e.app.room.executeDelayedSnaps()}))}}},{key:"_getDataToSync",value:function(){var e=this;return(0,o.default)(this.dataOfSync).sort((function(e,t){return Number(e)-Number(t)})).map((function(t){try{var n=e.dataOfSync[t].data;return{data:n="object"===(void 0===n?"undefined":(0,r.default)(n))?n:JSON.parse(n),client_pkg_id:e.dataOfSync[t].client_pkg_id,source_uid:e.dataOfSync[t].source_uid,pkgId:Number(t)}}catch(e){return}})).filter((function(e){return e}))}},{key:"_updateServerPkgInfo",value:function(e,t){for(var n=0,a=e;n<=this.serverPkgSinceLast.length&&!(a>t);)if(a<=this.lastContinueServerPkgId)a++;else if(n===this.serverPkgSinceLast.length){for(var r,i=[];a<=t;)i.push(a),a+=1;(r=this.serverPkgSinceLast).splice.apply(r,[n,0].concat(i))}else this.serverPkgSinceLast[n]<a?n++:this.serverPkgSinceLast[n]===a?(a++,n++):(this.serverPkgSinceLast.splice(n,0,a),a++,n++);for(n=0;n<this.serverPkgSinceLast.length&&this.serverPkgSinceLast[n]===this.lastContinueServerPkgId+n+1;n++);this.lastContinueServerPkgId+=n,this.serverPkgSinceLast.splice(0,n)}},{key:"room",get:function(){return this.app.room}},{key:"logger",get:function(){return this.app.logger}},{key:"lastServerPkgId",get:function(){return this.serverPkgSinceLast.length>0?this.serverPkgSinceLast[this.serverPkgSinceLast.length-1]:this.lastContinueServerPkgId}},{key:"nextLocalFakeId",get:function(){var e=this,t=this.lastServerPkgId,n=(0,o.default)(this.noAckData).map((function(t){return Number(e.noAckData[t].fakePkgId)})).sort((function(e,t){return e-t}));return 0===n.length||t>=n[n.length-1]?t+1:n[n.length-1]+1}}]),e}();t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(0)),r=o(n(1)),i=o(n(220));function o(e){return e&&e.__esModule?e:{default:e}}var s=void 0,u=function(){function e(){(0,a.default)(this,e)}return(0,r.default)(e,null,[{key:"createInstance",value:function(){return this._instance=this._instance||new i.default,this._instance}},{key:"show",value:function(e){var t=this,n=e.time,a=void 0===n?3:n;this._instance||this.createInstance(),this._instance.show(e),s&&clearTimeout(s),a&&(s=setTimeout((function(){t.hide()}),1e3*a))}},{key:"hide",value:function(){s&&clearTimeout(s),this._instance&&this._instance.hide()}},{key:"destory",value:function(){this._instance&&(this._instance.destroy(),this._instance=null)}}]),e}();t.default=u,u._instance=null},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(108)),r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}n(221);var s=function(){function e(){(0,r.default)(this,e),this.toastDiv=document.createElement("div"),this.toastDiv.className="whiteboard-toast",this.toastDiv.onclick=this.hide.bind(this),document.body.appendChild(this.toastDiv)}return(0,i.default)(e,[{key:"show",value:function(e){var t=this.toastDiv;t.style.display="block","warn"===e.type?(t.style.color="#8a6d3b",t.style.backgroundColor="#fcf8e3",t.style.borderColor="#faebcc"):"info"===e.type?(t.style.color="#31708f",t.style.backgroundColor="#d9edf7",t.style.borderColor="#bce8f1"):"error"===e.type?(t.style.color="#a94442",t.style.backgroundColor="#f2dede",t.style.borderColor="#ebccd1"):(t.style.color="#3c763d",t.style.backgroundColor="#dff0d8",t.style.borderColor="#d6e9c6"),(0,a.default)(e.top)&&(t.style.top=e.top+"px"),t.innerHTML=e.msg}},{key:"hide",value:function(){this.toastDiv&&(this.toastDiv.style.display="none")}},{key:"destroy",value:function(){this.toastDiv&&(document.body.removeChild(this.toastDiv),this.toastDiv=null)}}]),e}();t.default=s},function(e,t,n){var a=n(222);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".whiteboard-toast {\n    display: none;\n    position: fixed;\n    left: 50%;\n    transform: translate(-50%);\n    top: 200px;\n    padding: 8px 15px;\n    margin-bottom: 20px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    color: #3c763d;\n    background-color: #dff0d8;\n    border-color: #d6e9c6;\n    z-index: 100;\n}",""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,a=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var r,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(r=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:a+i.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMi41Mzg2IDIuNDYwMzRDMTMuMTUyNCAxLjg0NjU2IDE0LjE0NzUgMS44NDY1NSAxNC43NjEzIDIuNDYwMzRMMTcuNTM5NyA1LjIzODcxQzE4LjE1MzQgNS44NTI0OSAxOC4xNTM0IDYuODQ3NjIgMTcuNTM5NyA3LjQ2MTRMNy44MDEyMiAxNy4xOTk4QzcuNTQyMjIgMTcuNDU4OCA3LjIwMDkgMTcuNjE5MiA2LjgzNjIyIDE3LjY1MzRMMy4xODEyNyAxNy45OTUyQzIuNTA3MTMgMTguMDU4MiAxLjk0MTc2IDE3LjQ5MjkgMi4wMDQ4MSAxNi44MTg3TDIuMzQ2NjQgMTMuMTYzOEMyLjM4MDc1IDEyLjc5OTEgMi41NDExNSAxMi40NTc4IDIuODAwMTUgMTIuMTk4OEwxMi41Mzg2IDIuNDYwMzRaTTEzLjkyNzggMy4yOTM4NUMxMy43NzQzIDMuMTQwNCAxMy41MjU2IDMuMTQwNCAxMy4zNzIxIDMuMjkzODVMMy42MzM2NiAxMy4wMzIzQzMuNTY4OTEgMTMuMDk3IDMuNTI4ODEgMTMuMTgyNCAzLjUyMDI4IDEzLjI3MzVMMy4xODk0OSAxNi44MTA1TDYuNzI2NDYgMTYuNDc5N0M2LjgxNzYzIDE2LjQ3MTIgNi45MDI5NiAxNi40MzExIDYuOTY3NyAxNi4zNjYzTDE2LjcwNjIgNi42Mjc4OUMxNi44NTk2IDYuNDc0NDUgMTYuODU5NiA2LjIyNTY2IDE2LjcwNjIgNi4wNzIyMkwxMy45Mjc4IDMuMjkzODVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjYyMjQgOS41NDUxOEwxMC40NTQ4IDUuMzc3NjJMMTEuMjg4MyA0LjU0NDExTDE1LjQ1NTkgOC43MTE2N0wxNC42MjI0IDkuNTQ1MThaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawInProgressSnapshots=t.drawLocalSnapshots=t.refresh=t.refreshOnStreamCanvas=t.cleanNonCanvasElements=t.LayerOrder=void 0;var a=u(n(7)),r=u(n(18)),i=n(106),o=n(16),s=n(96);function u(e){return e&&e.__esModule?e:{default:e}}t.LayerOrder={video:-1,audio:2},t.cleanNonCanvasElements=function(e){var t,n=(0,r.default)(e.drawOpQueue);e.app.container&&e.app.container.domEl&&(e.app.container.domEl.innerHTML="");for(var a=Array.prototype.slice.apply(e.app.container.el.getElementsByClassName("neteaseyunxin-wb-media-container")),i=0;i<a.length;i++){var o=a[i],s=o.id;-1===n.indexOf(s)&&(null===(t=null==o?void 0:o.parentNode)||void 0===t||t.removeChild(o))}e.app.opsManager.hooks.cleanNonCanvasEle.call(e)},t.refreshOnStreamCanvas=function(e){var t=e.app.container.streamCtx;if(t){if(t.save(),(0,s.clearCtx)(t),t.fillStyle=e.app.appConfig.canvasBgColor,(0,s.fillCtx)(t),e.app.bgRenderContainer&&e.app.bgRenderContainer({width:e.app.container.width,height:e.app.container.height,DPI:i.DPI,zoom:e.app.scale,ctx:t}),e.app.camera.convertPreviewCanvas(t),e.app.bgRenderWorld){var n=e.app.camera.getContainerWorldRect();e.app.bgRenderWorld({width:e.app.container.width,height:e.app.container.height,DPI:i.DPI,rect:n,zoom:e.app.scale,ctx:t})}if(e.backgroundSnapshot)e.opsManager.preview(e.backgroundSnapshot,t,{page:e,supportToDataUrl:!0});else{var r=e.getBoard(),u=e.getAnimPageIndex();null!==u&&r.previewDoc({ctx:t,animPageIndex:u,keepAnimState:!0,stream:!0})}var c=(0,o.getSortedDrawOpIds)(e.drawOpQueue),d=!0,p=!1,h=void 0;try{for(var f,g=(0,a.default)(c);!(d=(f=g.next()).done);d=!0){var v=f.value;e.opsManager.preview(e.drawOpQueue[v],t,{page:e,supportToDataUrl:!0})}}catch(e){p=!0,h=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw h}}for(var y in l(e,t,{preview:!1}),e.lastLaserOfUser){var m=e.lastLaserOfUser[y];e.opsManager.preview(m,t,{page:e,supportToDataUrl:!0})}t.restore()}},t.refresh=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.ctx,r=t.preview;n||(n=e.ctx);var u=r?n:e.frontCtx,d=r?n:e.bgCtx,p=!r||!t.supportToDataUrl&&e.app.appConfig.previewCustomBg||t.supportToDataUrl&&t.exportCustomBg;if(e.opsManager.hooks.refresh.call(),n.save(),r||(e.frontCtx.save(),e.bgCtx.save(),e.laserCtx.save()),(0,s.clearCtx)(n),(0,s.clearCtx)(d),r&&(d.fillStyle=e.app.appConfig.canvasBgColor,(0,s.fillCtx)(d)),e.app.bgRenderContainer&&p){var h=e.app.container.width,f=e.app.container.height;t.supportToDataUrl&&t.boundary&&(h=d.canvas.width,f=d.canvas.height),e.app.bgRenderContainer({width:h,height:f,DPI:i.DPI,zoom:e.app.scale,ctx:d})}if(r?t.boundary?e.app.camera.convertPreviewCanvas(n,t.boundary):e.app.camera.convertPreviewCanvas(n):(e.app.camera.convertCanvas(n),e.app.camera.convertCanvas(e.bgCtx)),e.app.bgRenderWorld&&p){var g=e.app.camera.getContainerWorldRect(),v=e.app.scale,y=t.supportToDataUrl&&t.boundary?t.boundary:g;v*=t.supportToDataUrl&&t.boundary?g.width/t.boundary.width:1,e.app.bgRenderWorld({width:e.app.container.width,height:e.app.container.height,DPI:i.DPI,rect:y,zoom:v,ctx:d})}if(!r&&e.getBoard()&&e.getBoard().updateDocClipPath(),r||((0,s.clearCtx)(u),(0,s.clearCtx)(e.laserCtx),e.app.camera.convertCanvas(u),e.app.camera.convertCanvas(e.laserCtx)),e.backgroundSnapshot&&!r?e.opsManager.draw(e.backgroundSnapshot,d,{page:e}):e.backgroundSnapshot&&e.opsManager.preview(e.backgroundSnapshot,n,{page:e,supportToDataUrl:t.supportToDataUrl}),r){var m=e.getBoard(),M=e.getAnimPageIndex();null!==M&&(n.save(),m.previewDoc({ctx:n,animPageIndex:M,keepAnimState:t.supportToDataUrl&&!t.exportBoard,toDataUrl:t.supportToDataUrl,boundary:t.boundary}),n.restore())}var x=(0,o.getSortedDrawOpIds)(e.drawOpQueue);if(r){var w=!0,I=!1,b=void 0;try{for(var k,T=(0,a.default)(x);!(w=(k=T.next()).done);w=!0){var _=k.value;e.opsManager.preview(e.drawOpQueue[_],n,{page:e,supportToDataUrl:t.supportToDataUrl,boundary:t.boundary})}}catch(e){I=!0,b=e}finally{try{!w&&T.return&&T.return()}finally{if(I)throw b}}}else{var C=!0,N=!1,A=void 0;try{for(var P,O=(0,a.default)(x);!(C=(P=O.next()).done);C=!0){var D=P.value;e.opsManager.draw(e.drawOpQueue[D],n,{div:e.app.container.domEl,page:e})}}catch(e){N=!0,A=e}finally{try{!C&&O.return&&O.return()}finally{if(N)throw A}}for(var S in e.hiddenOpQueue)e.opsManager.hide(e.hiddenOpQueue[S],n,e.app.container.domEl);for(var E in e.deletedOpQueue)e.opsManager.hide(e.deletedOpQueue[E],n,e.app.container.domEl)}if(r&&t.omitSelection||l(e,u,{preview:r}),!r)for(var j in c(e,e.laserCtx),e.lastLaserOfUser){var L=e.lastLaserOfUser[j];e.opsManager.draw(L,e.laserCtx)}n.restore(),r||(e.frontCtx.restore(),e.bgCtx.restore(),e.laserCtx.restore())},t.drawLocalSnapshots=function(e){for(var t in e.localCtx.save(),(0,s.clearCtx)(e.localCtx),e.app.camera.convertCanvas(e.localCtx),e.localDrawQueue)e.opsManager.draw(e.localDrawQueue[t],e.localCtx,{page:e});e.localCtx.restore()},t.drawInProgressSnapshots=function(e){e.laserCtx.save(),e.frontCtx.save(),(0,s.clearCtx)(e.laserCtx),(0,s.clearCtx)(e.frontCtx),e.app.camera.convertCanvas(e.laserCtx),e.app.camera.convertCanvas(e.frontCtx),(0,r.default)(e.lastInProgressSnapshotOfUser).map((function(t){return e.lastInProgressSnapshotOfUser[t]})).sort((function(e,t){return e.beginAt-t.beginAt})).forEach((function(t){var n=t.snapshot.opId,a=e.drawOpQueue[n];if(a){var r="laser"===a.data.type?e.laserCtx:e.frontCtx;e.opsManager.draw(a,r,{div:e.app.container.domEl,page:e})}else{var i="laser"===t.snapshot.data.type?e.laserCtx:e.frontCtx;e.opsManager.draw(t.snapshot,i,{div:e.app.container.domEl,page:e})}})),l(e,e.frontCtx,{preview:!1}),c(e,e.laserCtx),e.laserCtx.restore(),e.frontCtx.restore()};var l=function(e,t,n){for(var a in e.lastSelectOfUser)n.preview?e.opsManager.preview(e.lastSelectOfUser[a],t,{page:e}):e.opsManager.draw(e.lastSelectOfUser[a],t);for(var r in e.lastInProgressSelectOfUser)n.preview?e.opsManager.preview(e.lastInProgressSelectOfUser[r],t,{page:e}):e.opsManager.draw(e.lastInProgressSelectOfUser[r],t)},c=function(e,t){for(var n in e.lastMousePointerOfUser){var a=e.lastMousePointerOfUser[n];e.opsManager.draw(a,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(19)),r=p(n(7)),i=p(n(5)),o=n(29),s=p(n(137)),u=n(39),l=p(n(142)),c=n(64),d=n(16);function p(e){return e&&e.__esModule?e:{default:e}}var h={graphInit:function(e){var t=e.start,n=e.end,a={x:t.x/2+n.x/2,y:t.y/2+n.y/2};return{start:t,end:n,connPs:[{x:a.x,y:a.y,type:o.IConnPointType.Split}]}},isUnderRect:function(e){return s.default.isUnderRect(e)},isUnderPoint:function(e){return s.default.isUnderPoint(e)},patchLink:function(e){var t=e.data,n=e.page,a=e.op;t._points=[];var s=t.start,l=t.end,d=t.connPs,p=(0,u.getLinkEndPos)(a.app,s,e.op,n),h=(0,u.getLinkEndPos)(a.app,l,e.op,n);if(p&&h){t._points.push([p.x,p.y]);var f=!0,g=!1,v=void 0;try{for(var y,m=(0,r.default)(d);!(f=(y=m.next()).done);f=!0){var M=y.value;M.type===o.IConnPointType.Anchor&&t._points.push([M.x,M.y])}}catch(e){g=!0,v=e}finally{try{!f&&m.return&&m.return()}finally{if(g)throw v}}t._points.push([h.x,h.y]);var x=(0,c.getArrowPts)({data:t,op:a,startPos:p,endPos:h}),w=(0,c.getLinkTextPos)({data:t,op:a});t.boundary=(0,u.getLinkBoundary)((0,i.default)((0,i.default)((0,i.default)({start:p,end:h,connPs:d},t.start.aType===o.IArrowType.Arrow?{startArrow:x.start}:{}),t.end.aType===o.IArrowType.Arrow?{endArrow:x.end}:{}),{textBoundaries:w}))}},drawLink:function(e){var t=e.data,n=e.ctx,a=e.op.app.scale,r=(t._points||[]).map((function(e){return(0,d.padPt)(e,a)}));if(n.beginPath(),r.length>=2){n.moveTo(r[0][0],r[0][1]);for(var i=1;i<r.length;i++)n.lineTo(r[i][0],r[i][1])}n.stroke()},graphAftTypeM:function(e){var t=e.data,n=e.type,a=e.op,r=(0,u.getLinkEndPos)(a.app,t.start,a),c=(0,u.getLinkEndPos)(a.app,t.end,a);if(r&&c&&n!==o.ILinkType.Line){if(n===o.ILinkType.Curve)return l.default.tidyGraph({start:r,end:c,connPs:t.connPs,op:a});if(n===o.ILinkType.Segment){var d=t.connPs.filter((function(e){return e.type===o.IConnPointType.Anchor})),p=t.connPs.filter((function(e){return e.type===o.IConnPointType.Split}));if((0,u.isConnAllHV)(d,a.app.scale)&&d){var h=r.dir===o.DIRECTION.LEFT||r.dir===o.DIRECTION.RIGHT;p[0]=(0,i.default)((0,i.default)({},p[0]),{x:h?r.x/2+d[0].x/2:r.x,y:h?r.y:r.y/2+d[0].y/2});var f=p.length%2==1?h:!h;return p[p.length-1]=(0,i.default)((0,i.default)({},p[p.length-1]),{x:f?c.x/2+d[d.length-1].x/2:c.x,y:f?c.y:c.y/2+d[d.length-1].y/2}),s.default.tidyGraph({start:r,end:c,connPs:p,op:a,data:t})}return s.default.graphInit({start:r,end:c,op:a})}}},graphAftConnD:function(e){var t=e.start,n=e.end,a=e.data,r=e.index,i=a.connPs;if(i[r].type===o.IConnPointType.Split)return{connPs:i,start:t,end:n};var s=i.slice(),u=i[r-2]||t,l=i[r+2]||n,c={x:(u.x+l.x)/2,y:(u.y+l.y)/2,type:o.IConnPointType.Split};return s.splice(r-1,3,c),{connPs:s,start:t,end:n}},isConnValid:function(e){return!0},graphAftConnM:function(e){return(0,u.moveNonSegConnPoint)(e)},graphFromAnchors:function(e){var t=e.start,n=e.end,r=e.anchors,i=e.op;if(0===r.length)return h.graphInit(e);for(var s=[],u=[t].concat((0,a.default)(r),[n]),l=1;l<u.length;l++)s.push({x:u[l].x/2+u[l-1].x/2,y:u[l].y/2+u[l-1].y/2,type:o.IConnPointType.Split}),l<u.length-1&&s.push({x:u[l].x,y:u[l].y,type:o.IConnPointType.Anchor});return h.tidyGraph({start:t,end:n,op:i,connPs:s})},tidyGraph:function(e){for(var t=e.start,n=e.end,a=e.connPs.filter((function(e){return e.type===o.IConnPointType.Anchor})),r=[],s=0;s<a.length;s++){var u=a[s-1]||t;r.push({x:u.x/2+a[s].x/2,y:u.y/2+a[s].y/2,type:o.IConnPointType.Split}),r.push(a[s]),s===a.length-1&&r.push({x:n.x/2+a[s].x/2,y:n.y/2+a[s].y/2,type:o.IConnPointType.Split})}return 0===r.length&&r.push({x:t.x/2+n.x/2,y:t.y/2+n.y/2,type:o.IConnPointType.Split}),(0,i.default)((0,i.default)({},e),{connPs:r})},graphAftEndM:function(e){var t=e.sTo,n=e.eTo,a=e.connPs,r=e.op;if(a.filter((function(e){return e.type===o.IConnPointType.Anchor})).length<=0)return h.graphInit({start:t,end:n,op:r});var s=a.slice(),u=a.length>1?a[1]:n,l=a.length>1?a[a.length-2]:t;return s[0]=(0,i.default)((0,i.default)({},s[0]),{x:t.x/2+u.x/2,y:t.y/2+u.y/2}),s[s.length-1]=(0,i.default)((0,i.default)({},s[s.length-1]),{x:l.x/2+n.x/2,y:l.y/2+n.y/2}),{start:t,end:n,connPs:s}},getLinkPosByPer:function(e){return s.default.getLinkPosByPer(e)},getNearestLinkInfo:function(e){return s.default.getNearestLinkInfo(e)},getEndAngle:function(e){return s.default.getEndAngle(e)}};t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(2)),r=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(9)),l=n(16),c=d(n(23));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.points=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"postMouseUp",value:function(e){}},{key:"postClick",value:function(e){}},{key:"postMouseMove",value:function(e,t){}},{key:"handleMouseDown",value:function(e,t,n){t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.dispatch(this.getSelectionSnapshot(!1,[])),this.points=[[t,n]];var a=(0,l.findOpsUnderMouse)(this.app,this.app.scale,this.points,this.drawOpsOfPage,this.opsManager);a=this.opsManager.groupOp.getOpIdsInGroups(a),this.dispatch(this.getSelectionSnapshot(!0,a))}},{key:"handleMouseMove",value:function(e,t,n){t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.isMouseDown?this.points.push([t,n]):this.points=[[t,n]];var a=[];this.isMouseDown&&(a=(0,l.findOpsUnderRect)(this.app,this.points,this.drawOpsOfPage,this.app.appConfig.selectMode),a=this.opsManager.groupOp.getOpIdsInGroups(a),this.dispatch(this.getSelectionSnapshot(!0,a))),this.postMouseMove(e,a)}},{key:"handleMouseUp",value:function(e,t,n){if(this.isMouseDown&&this.isMouseMoved){t=Number(t.toFixed(1)),n=Number(n.toFixed(1));var a=(Math.abs(this.points[this.points.length-1][0]-this.points[0][0])+Math.abs(this.points[this.points.length-1][1]-this.points[0][1]))*this.app.scale,r=0===this.points.length||this.points.length<5&&a<5?(0,l.findOpsUnderMouse)(this.app,this.app.scale,this.points,this.drawOpsOfPage,this.opsManager):(0,l.findOpsUnderRect)(this.app,this.points,this.drawOpsOfPage,this.app.appConfig.selectMode);r=this.opsManager.groupOp.getOpIdsInGroups(r),this.postMouseUp(r)}else this.handleClick(e,t,n)}},{key:"handleClick",value:function(e,t,n){t=Number(t.toFixed(2)),n=Number(n.toFixed(2)),this.points=[[t,n]];var a=(0,l.findOpsUnderMouse)(this.app,this.app.scale,this.points,this.drawOpsOfPage,this.opsManager);if(1===a.length)if(-1!==this.opsManager.selectedOpIds.indexOf(a[0]));else if(1===this.opsManager.selectedOpIds.length){this.opsManager.currPage.idToGroup.get(a[0])!==this.opsManager.currPage.idToGroup.get(this.opsManager.selectedOpIds[0])&&(a=this.opsManager.groupOp.getOpIdsInGroups(a))}else a=this.opsManager.groupOp.getOpIdsInGroups(a);this.postClick(a)}},{key:"getSelectionSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{type:"select",sp:this.sp,ep:this.ep,inProgress:e,selectedOpIds:t.slice(),reuseOpType:n?"select-hover":"select",skipUndo:!0,color:c.default.penDef.stroke,nickname:this.app.nickname}}},{key:"sp",get:function(){return this.points.length>0?this.points[0]:void 0}},{key:"ep",get:function(){return this.points.length>0?this.points[this.points.length-1]:void 0}}]),t}(u.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTransIconPos=t.ROTATE_DIST=t.ROTATE_TEST_RADIUS=void 0;var a=y(n(5)),r=y(n(2)),i=y(n(0)),o=y(n(1)),s=y(n(3)),u=y(n(4)),l=y(n(9)),c=n(45),d=y(n(58)),p=n(16),h=n(13),f=n(30),g=n(97),v=n(39);function y(e){return e&&e.__esModule?e:{default:e}}var m=t.ROTATE_TEST_RADIUS=8,M=t.ROTATE_DIST=30,x=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="rotate",e.activate=!1,e.angle=0,e.cx=0,e.cy=0,e.sx=0,e.sy=0,e.description="旋转",e.activateOpId="",e.snapsBeenRotate={},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MouseMovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mousedown.tap("MouseMovePlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mouseup.tap("MouseMovePlugin",this.handleMouseUp.bind(this))}},{key:"eventsToListen",value:function(){return{"rotate:ele":{value:this.rotateEle.bind(this),information:{args:"id: string, angle: number",message:""}}}}},{key:"shouldRotateTest",value:function(e,t){var n=this.opsManager.selectedOpIds;if(1!==n.length)return!1;var a=this.opsManager.drawOpsOfPage[n[0]];return-1===c.nonRotateTypes.indexOf(a.data.type)&&this.mousePosTest(e,t)}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof d.default&&this.shouldRotateTest(t,n)){if(document.body.style.cursor="pointer",!this.activate){this.beginBatch(),this.activate=!0,this.activateOpId=this.opsManager.currPage.getNextOpId(!0),this.opId=this.opsManager.selectedOpIds[0],this.snapsBeenRotate=(0,v.deepCopySnapBeforeMove)([this.opId],this.drawOpsOfPage),this.angle=0;var a=this.opsManager.drawOpsOfPage[this.opId],r=(0,h.getTransformedBoundary)(this.app.scale,a.data);this.cx=r.sx+r.w/2,this.cy=r.sy+r.h/2,this.sx=t,this.sy=n}return!0}this.activate=!1}},{key:"handleMouseMove",value:function(e,t,n,a,r){var i,o;if(this.opsManager.currOp instanceof d.default){if(this.activate){if(this.lastAuxiliaryPos&&Math.abs(a-this.lastAuxiliaryPos[0])<5&&Math.abs(r-this.lastAuxiliaryPos[1])<5)return!0;if(this.angle=(0,p.getVecAngle)([this.sx,this.sy],[t,n],[this.cx,this.cy]),this.opId){var s=void 0,u=(null===(o=null===(i=this.snapsBeenRotate[this.opId])||void 0===i?void 0:i.data)||void 0===o?void 0:o.rAngle)||0,l=u+this.angle;Math.abs(l%(Math.PI/2))<.03||Math.abs(Math.PI/2-l%(Math.PI/2))<.03?(l=Math.round(l/(Math.PI/2))*Math.PI/2,this.angle=l-u,s=this.getSnapshot(!0,this.opId,this.angle,this.cx,this.cy),this.opsManager.auxiliaryOp.setRotateLine({opsBeforeChange:this.snapsBeenRotate,snap:s,id:this.opId}),this.lastAuxiliaryPos=[a,r]):(this.opsManager.auxiliaryOp.clean(),s=this.getSnapshot(!0,this.opId,this.angle,this.cx,this.cy),this.lastAuxiliaryPos=void 0),this.opsManager.graphOp.handleElePosChange(this.snapsBeenRotate,s,this.activateOpId,this.activateOpId+"_rotate")}return!0}if(this.shouldRotateTest(t,n))return document.body.style.cursor="pointer",!0;document.body.style.cursor="default"}}},{key:"handleMouseUp",value:function(e,t,n){if(this.lastAuxiliaryPos=void 0,this.opsManager.auxiliaryOp.clean(),this.activate)return this.activate=!1,this.opId&&this.opsManager.graphOp.handleElePosChange(this.snapsBeenRotate,this.getSnapshot(!1,this.opId,this.angle,this.cx,this.cy),this.activateOpId,this.activateOpId+"_rotate"),!0}},{key:"mousePosTest",value:function(e,t){var n,a=this.opsManager.opMap.select;if(null===(n=a.selectInfo)||void 0===n?void 0:n.rotateIcon){var r=a.selectInfo.rotateIcon,i=r.x-e,o=r.y-t,s=m;return-1!==g.TouchPlatformArray.indexOf(this.app.platform)&&(s*=2.2),Math.sqrt(i*i+o*o)*this.app.scale<s}return!1}},{key:"rotateEle",value:function(e,t){var n=this.opsManager.drawOpsOfPage[e];if(!n)return this.logger.error("当前页面找不到id为"+e+"的可见元素");var a=(0,h.getTransformedBoundary)(this.app.scale,n.data),r=a.sx+a.w/2,i=a.sy+a.h/2;this.dispatch({type:"rotate",inProgress:!1,rotate:{angle:t,x:r,y:i},dependOn:[e]})}},{key:"getSnapshot",value:function(e,t,n,a,r){return{type:"rotate",inProgress:e,rotate:{angle:n,x:a,y:r},dependOn:[t]}}},{key:"transformOp",value:function(e,t){if("link"===e.data.type)return e;var n=((e.data.rAngle||0)+t.rotate.angle)/(2*Math.PI);return n=(n-=Math.floor(n))*Math.PI*2,(0,a.default)({},e,{data:(0,a.default)((0,a.default)({},e.data),{mat:(0,f.rotateMat)(e.data.mat,t.rotate),rAngle:n})})}}]),t}(l.default);t.getTransIconPos=function(e,t,n){var a=e.data.boundary,r=("number"==typeof e.data.xFactor&&e.data.xFactor)<0?-1:1,i=("number"==typeof e.data.yFactor&&e.data.yFactor)<0?-1:1,o=M/n/Math.abs(e.data.xFactor||1),s=M/n/Math.abs(e.data.yFactor||1),u=(0,f.getTransPoint)([a.sx-o,a.sy+a.h+s],e.data.mat),l=e.data.rAngle||0;return(0,h.getPointAftPad)(u,t,l,3,r,i)};t.default=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateEditor=t.removeEditor=t.setupTextEditor=void 0;var a,r=n(5),i=(a=r)&&a.__esModule?a:{default:a},o=n(139),s=n(98);var u=1,l=(t.setupTextEditor=function(e,t,n,a){var r=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div");i.contentEditable="true",i.dataset.editorId="text-"+(u++).toString(),r.appendChild(i),r.appendChild(o);var c=0;r.ontouchstart=function(e){c=Date.now(),e.stopPropagation()},r.onmousedown=function(e){c=Date.now(),e.stopPropagation()},r.onmousemove=function(e){document.body.style.cursor="auto",e.stopPropagation()};var d=!1;return i.oninput=function(e){d=!0,(0,s.inputHandler)(e,a.onchange,t.maxTxtLen,!0)},i.onblur=function(e){if(Date.now()-c<100)e.target.focus();else{var t=(0,s.htmlToText)(e.target);a.onblur("\n"===t?"":t,d),a.container.removeChild(r)}},i.onfocus=function(e){(0,s.setTextRange)(i,"end")},i.onkeydown=function(e){return(0,s.preventOverLen)(e,t.maxTxtLen)},i.onpaste=function(e){return(0,s.preventOverLen)(e,t.maxTxtLen)},i.addEventListener("beforeinput",s.beforeInputHandler),i.addEventListener("compositionstart",s.beforeInputHandler),i.addEventListener("compositionend",(function(e){(0,s.inputHandler)(e,a.onchange,t.maxTxtLen,!0)})),(null==t?void 0:t.text)&&(i.innerText=t.text),l(n,{container:r,core:i,placeholder:o},t),a.container.appendChild(r),i.focus(),{container:r,core:i,placeholder:o}},t.removeEditor=function(e){var t;e.core.onblur=null,null===(t=e.container.parentNode)||void 0===t||t.removeChild(e.container)},t.updateEditor=function(e,t,n,a){var r=(null==n?void 0:n.fontSize)||32,u=1.25*r,l=e.width+"px"||!1;(0,s.setEditorTxt)(t.core,(null==n?void 0:n.text)||""),(0,i.default)(t.container.style,{position:"absolute",left:e.sx+"px",top:e.sy+"px",width:l,height:"fit-content",minHeight:u+"px",minWidth:o.MIN_TXT_W+"px",transform:"rotate("+180*e.angle/Math.PI+"deg)",transformOrigin:"0 0",padding:"0 2px",overflow:"hidden",textAlign:(null==n?void 0:n.textAlign)||"left",outline:"1px dashed black",pointerEvents:"auto"});var c=e.width?"pre-wrap":"pre";(0,i.default)(t.core.style,(0,i.default)({fontSize:r+"px",fontFamily:null==n?void 0:n.fontFamily,fontWeight:"normal",lineHeight:u+"px",display:"inline",outline:"none","-webkit-font-smoothing":"antialiased",userSelect:"text",webkitUserSelect:"text",color:(null==n?void 0:n.stroke)||"rgb(0,0,0)",background:"transparent",whiteSpace:c},(null==n?void 0:n.fill)?{backgroundColor:null==n?void 0:n.fill}:{})),t.placeholder&&(t.placeholder.innerText=(null==n?void 0:n.text)?"":a||"",(0,i.default)(t.placeholder.style,{fontSize:r+"px",fontFamily:null==n?void 0:n.fontFamily,fontWeight:"normal",lineHeight:u+"px",background:"transparent",outline:"none",userSelect:"text",webkitUserSelect:"text",whiteSpace:c,opacity:.3,display:!(null==n?void 0:n.text)&&a?"inline":"none",wordBreak:"break-all"}))})},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(19)),r=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4)),l=p(n(75)),c=n(30),d=n(16);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="line",e.description="绘制线段。\n首先使用op:line:activate设置画布为线段模式。通过op:line:lineWidth, op:line:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({inProgress:e})}},{key:"getBoundaryRect",value:function(){return this.getBoundaryRectOfLine()}},{key:"draw",value:function(e,t){var n=e.data,r=this.getStartEndPointFromSnapshot(n),i=r.sp,o=r.ep;t.beginPath(),t.moveTo.apply(t,(0,a.default)((0,d.padPt)((0,c.getTransPoint)(i,n.mat),this.app.scale))),t.lineTo.apply(t,(0,a.default)((0,d.padPt)((0,c.getTransPoint)(o,n.mat),this.app.scale))),this.strokeOrFill(t,{stroke:n.stroke||n.color,lineWidth:n.lineWidth,opacity:n.opacity,isShape:!1})}},{key:"ifMouseOnOp",value:function(e,t,n){var r=this.app.container.ctx,i=e.data,o=this.getStartEndPointFromSnapshot(i),s=o.sp,u=o.ep;return r.beginPath(),r.moveTo.apply(r,(0,a.default)((0,c.getTransPoint)(s,i.mat))),r.lineTo.apply(r,(0,a.default)((0,c.getTransPoint)(u,i.mat))),r.strokeStyle="rgba(0,0,0,0)",r.lineWidth=i.lineWidth+20,r.stroke(),r.isPointInStroke(t,n)}},{key:"getStartEndPointFromSnapshot",value:function(e){var t=void 0,n=void 0;return Array.isArray(e.points)?(t=e.points[0],n=e.points[e.points.length-1]):(t=e.sp,n=e.ep),{sp:t,ep:n}}},{key:"patchOp",value:function(e){var t=Number(e.data.lineWidth),n=Math.abs(e.data.xFactor||1),a=Math.abs(e.data.yFactor||1);e.data.boundary={sx:Math.min(e.data.sp[0],e.data.ep[0])-t/2/n,sy:Math.min(e.data.sp[1],e.data.ep[1])-t/2/a,w:Math.abs(e.data.sp[0]-e.data.ep[0])+t/n,h:Math.abs(e.data.sp[1]-e.data.ep[1])+t/a}}}]),t}(l.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(2)),r=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=c(n(75)),l=n(30);function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="rect",e.shouldSaniteEp=!0,e.description="绘制矩形。\n首先使用op:rect:activate设置画布为矩形模式。通过op:rect:lineWidth, op:rect:stroke, op:rect:fill设置矩形的宽度和颜色。然后画布会监听鼠标动作，生成矩形。具体用法如下：",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({inProgress:e})}},{key:"draw",value:function(e,t){var n=e.data,a=(0,l.getTransPoint)(n.sp,n.mat),r=(0,l.getTransPoint)([n.ep[0],n.sp[1]],n.mat),i=(0,l.getTransPoint)(n.ep,n.mat),o=(0,l.getTransPoint)([n.sp[0],n.ep[1]],n.mat);t.beginPath(),t.moveTo(a[0],a[1]),t.lineTo(r[0],r[1]),t.lineTo(i[0],i[1]),t.lineTo(o[0],o[1]),t.closePath(),this.strokeOrFill(t,{stroke:n.stroke,fill:n.fill,lineWidth:n.lineWidth,opacity:n.opacity,isShape:!0})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(2)),r=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=c(n(75)),l=n(30);function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="ellipse",e.shouldSaniteEp=!0,e.description="绘制椭圆形",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({inProgress:e})}},{key:"draw",value:function(e,t){var n=e.data;this._draw(t,n),this.strokeOrFill(t,{stroke:n.stroke,fill:n.fill,lineWidth:n.lineWidth,opacity:n.opacity,isShape:!0})}},{key:"_draw",value:function(e,t){var n=[[.5,0],[.7761424,0],[1,.2238576],[1,.5]],a=[[1,.7761424],[.7761424,1],[.5,1]],r=[void 0,[.2238576,1],[0,.7761424],[0,.5]],i=[void 0,[0,.2238576],[.2238576,0],[.5,0]],o=t.ep[0]-t.sp[0],s=t.ep[1]-t.sp[1],u=function(e){if(e){var n=[t.sp[0]+o*e[0],t.sp[1]+s*e[1]];return(0,l.getTransPoint)(n,t.mat)}return e},c=n.map(u).filter((function(e){return e})),d=a.map(u).filter((function(e){return e})),p=r.map(u).filter((function(e){return e})),h=i.map(u).filter((function(e){return e}));e.beginPath(),e.moveTo(c[0][0],c[0][1]),e.bezierCurveTo(c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1]),e.bezierCurveTo(d[0][0],d[0][1],d[1][0],d[1][1],d[2][0],d[2][1]),e.bezierCurveTo(p[0][0],p[0][1],p[1][0],p[1][1],p[2][0],p[2][1]),e.bezierCurveTo(h[0][0],h[0][1],h[1][0],h[1][1],h[2][0],h[2][1]),e.closePath()}},{key:"ifMouseOnOp",value:function(e,t,n){var a=this.app.container.ctx,r=e.data;return this._draw(a,r),a.fillStyle="rgba(0,0,0,0)",a.fill(),a.isPointInPath(t,n)}}]),t}(u.default);t.default=d},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEuNDQyMjkiIHdpZHRoPSI4LjM4OTY3IiBoZWlnaHQ9IjE0LjY4MTkiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSAxMiAxLjQ0MjI5KSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuNTg0NSA4Ljg1Nzc5TDEwLjUxNjkgMTQuNzkwMiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuMjI0NjQgMTcuNjgxOEgxNS43NjA0IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaFitStrategy=t.DEFAULT_FONTSIZE=void 0;var a=s(n(5)),r=s(n(18)),i=s(n(22)),o=s(n(0));function s(e){return e&&e.__esModule?e:{default:e}}var u=(0,n(66).deviceOS)(),l=(t.DEFAULT_FONTSIZE=32,t.MediaFitStrategy=void 0);!function(e){e[e.None=0]="None",e[e.Contain=1]="Contain",e[e.FitPercentange=2]="FitPercentange"}(l||(t.MediaFitStrategy=l={}));t.default=function e(t){var n=this;(0,o.default)(this,e),this.setAppConfig=function(e){var t,o,s;if(n.app.logger.log("[白板] setAppConfig",(0,i.default)(e)),0===(0,r.default)(e).length)n.app.logger.error("[白板]","调用了setAppConfig, 但传入的参数为空",e);else for(var u in e)"canvasBgColor"===u?(n.config.canvasBgColor=e.canvasBgColor,n.app.container.setBackgroundColor(),null===(t=n.app.previewFactory)||void 0===t||t.setBackgroundColor()):"canvas_bg_color"===u?(n.config.canvasBgColor=e.canvas_bg_color,n.app.container.setBackgroundColor(),null===(o=n.app.previewFactory)||void 0===o||o.setBackgroundColor()):"previewMode"===u?(n.config.previewMode=e.previewMode,null===(s=n.app.previewFactory)||void 0===s||s.refreshPreviewsOfCurrBoard(!0)):n.config.hasOwnProperty(u)?n.config[u]=e[u]:(n.app.logger.error("[白板]","setAppConfig传入的参数键值"+u+"不是有效的配置项"),n.app.logger.error("[白板]","目前支持的配置项有："+(0,r.default)(n.config)));(0,a.default)(n.config,e),n.app.emit("event:appState:change","config",n.config)},this.getAppConfig=function(){return n.config},this.app=t,this.config=(0,a.default)((0,a.default)({canvasBgColor:"#f5f5f7",showCursorNickname:!1,showSelectNickname:!1,showLaserNickname:!1,cameraTransformEnabled:!0,allowReplaceActiveBroadcaster:!0,zoomSensitivity:.91,staticDocType:"template",previewMode:"fitDoc",previewCustomBg:!1,disableAutoResize:!0,drawMergeInterval:-1,drawMergeDist:200,drawMergeDebug:!1,selectMode:"intersect",resRetryInterval:5e3,resRetryCors:!1,presetId:-1,cacheUploadDocs:!0},{videoFitStrategy:u.isMobile?{type:l.FitPercentange,value:1}:{type:l.FitPercentange,value:.5}}),{audioFitStrategy:u.isMobile?{type:l.FitPercentange,value:1}:{type:l.FitPercentange,value:.5}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=v(n(38)),r=v(n(5)),i=v(n(2)),o=v(n(0)),s=v(n(1)),u=v(n(3)),l=v(n(4)),c=v(n(9)),d=n(13),p=n(144),h=n(16),f=v(n(326)),g=v(n(337));function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.mediaPlugins={},e.description="多媒体文件类操作",e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.app.on("event:deletePage",this.handleDeletePage.bind(this))}},{key:"handleDeletePage",value:function(e){if(e)for(var t in e.drawOpQueue)this.mediaPlugins.hasOwnProperty(t)&&(this.mediaPlugins[t].destroy(),delete this.mediaPlugins[t])}},{key:"destroy",value:function(){for(var e in this.mediaPlugins)this.mediaPlugins[e].destroy(),delete this.mediaPlugins[e]}},{key:"getMediaPluginByType",value:function(e){return"video"===e?f.default:g.default}},{key:"addMedia",value:function(e,t){var n=this,a=this.app.room.currBoard,r=this.opsManager.currPage;if(t&&void 0!==t.boardName&&void 0!==t.pageName){var i=this.app.room.getPage(t.boardName,t.pageName);i&&(r=i)}else if(t&&void 0!==t.pageName){var o=this.app.room.getPage(a.boardName,t.pageName);o&&(r=o)}if(this.app.resourceCache.mediaResourceLoaded(e,this.type)){var s=this.app.resourceCache.getMediaResource(e),u=this.getMediaPluginByType(this.type).getElementWidth(s),l=this.getMediaPluginByType(this.type).getElementHeight(s);this.dispatchMedia({url:e,title:t.title,width:u,height:l,page:r,sourceType:t.sourceType})}else r.addWaitingResource(e),this.app.resourceCache.fetchMediaResource(e,t.sourceType,this.type,(function(a){var i=n.getMediaPluginByType(n.type).getElementWidth(a),o=n.getMediaPluginByType(n.type).getElementHeight(a);n.dispatchMedia({url:e,title:t.title,width:i,height:o,page:r,sourceType:t.sourceType}),r.removeWaitingResource(e)}))}},{key:"dispatchMedia",value:function(e){var t=e.width,n=e.height,a=(0,p.getImageProperPosition)(this,t,n),i=a.sx,o=a.sy,s={};"audio"===this.type&&(s.fixRealWorldHeight=g.default.getElementHeight()),e.page?this.dispatchFromPage({type:this.type,url:e.url,skipUndo:!1,title:e.title?e.title:"",sourceType:e.sourceType,boundary:(0,r.default)({w:t,h:n,sx:i,sy:o},s)},e.page):this.dispatch({type:this.type,url:e.url,skipUndo:!1,title:e.title?e.title:"",sourceType:e.sourceType,boundary:(0,r.default)({w:t,h:n,sx:i,sy:o},s)})}},{key:"preview",value:function(e,t,n){}},{key:"draw",value:function(e,t,n){if(!this.mediaPlugins[e.opId]){var r=this.getMediaPluginByType(e.data.type);this.mediaPlugins[e.opId]=new r(e,this.app,this)}var i=this.mediaPlugins[e.opId],o=e.data,s=(0,d.getTransformedBoundary)(this.app.scale,o),u=this.app.container.el,l=o.url;if(this.app.resourceCache.mediaResourceLoaded(l,this.type)&&u){var c="number"==typeof e.data.layer?e.data.layer>0:"video"!==e.data.type,p=u.querySelector("[id='"+e.opId+"']");p?p.parentNode===this.app.container.bottomEl&&c?(this.app.container.bottomEl.removeChild(p),this.app.container.topEl.appendChild(p)):p.parentNode!==this.app.container.topEl||c||(this.app.container.topEl.removeChild(p),this.app.container.bottomEl.appendChild(p)):((p=document.createElement("div")).style.position="fixed",p.id=""+e.opId,p.className="video-plugin-container",c?this.app.container.topEl.appendChild(p):this.app.container.bottomEl.appendChild(p),i.mountElement(p,l));var f=this.app.camera.convertWorldPointInContainer(s.sx,s.sy),g=(0,a.default)(f,2),v=g[0],y=g[1],m=this.app.camera.convertWorldPointInContainer(s.sx+s.w,s.sy+s.h),M=(0,a.default)(m,2),x=M[0],w=M[1];p.style.width=x-v+"px",p.style.height=w-y+"px",p.style.left=v+this.app.container.left+"px",p.style.top=y+this.app.container.top+"px",(0,h.updateDocClipPath)(s,this.app.camera,p,1/this.app.scale),i.onReceiveAttributes(e),i.onSizeChange({width:x-v,height:w-y})}var I=e.data.sourceType;this.app.resourceCache.mediaResourceLoaded(l,this.type)||(n.page.addWaitingResource(l),this.app.resourceCache.fetchMediaResource(l,I,this.type,(function(){n.page.removeWaitingResource(l)})))}},{key:"hide",value:function(e,t,n){var a=this.mediaPlugins[e.opId];a&&(a.destroy(),delete this.mediaPlugins[e.opId])}},{key:"transformOp",value:function(e,t){return(0,h.transformPropertyOverwriteOp)(e,t)}}]),t}(c.default);t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(5)),r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{emitEvent:!0};(0,r.default)(this,e),this.isDragging=!1,this.lastPercent=0,this.onMouseDown=function(e){e.stopPropagation(),e.preventDefault(),t.isDragging=!0,t.lastPercent=-1,t.onMouseMove(e)},this.onMouseMove=function(e){if(t.isDragging){e.stopPropagation(),e.preventDefault();var n=t.getPercent(e);t.lastPercent=n,t.seekListener&&t.seekListener(n,!0),t.updateProgress(n,!0)}},this.onMouseUp=function(e){if(t.isDragging){e.stopPropagation(),e.preventDefault();var n=t.lastPercent;t.updateProgress(n,!0),t.seekListener&&t.seekListener(n,!1)}t.isDragging=!1},this.getPercent=function(e){var n=0,a=t.widget.getBoundingClientRect().left;n=e.type.search(/mouse|click/)>-1?e.clientX-a:e.touches[0].clientX-a;var r=t.widget.offsetWidth;return n<0&&(n=0),n>r&&(n=r),n/r};var o=document.createElement("div");(0,a.default)(o.style,{flex:"auto",height:"4px",position:"relative",pointerEvents:i.emitEvent?"auto":"none",cursor:i.emitEvent?"pointer":"auto"});var s=document.createElement("div"),u=document.createElement("div");o.appendChild(s),o.appendChild(u);var l={height:"100%",position:"absolute",top:"50%",transform:"translateY(-50%)"};(0,a.default)(s.style,(0,a.default)({width:"100%",backgroundColor:"rgb(0,0,0)"},l)),(0,a.default)(u.style,(0,a.default)({width:100*n+"%",backgroundColor:"rgb(255,255,255)"},l)),this.widget=o,this.frontBar=u,i.emitEvent&&this.bindEvents()}return(0,i.default)(e,[{key:"addSeekListener",value:function(e){this.seekListener=e}},{key:"bindEvents",value:function(){this.widget.addEventListener("mousedown",this.onMouseDown),this.widget.addEventListener("touchstart",this.onMouseDown),window.document.addEventListener("mousemove",this.onMouseMove),window.document.addEventListener("touchmove",this.onMouseMove),window.document.addEventListener("mouseup",this.onMouseUp,!0),window.document.addEventListener("touchend",this.onMouseUp,!0)}},{key:"destroy",value:function(){this.widget.removeEventListener("mousedown",this.onMouseDown),this.widget.removeEventListener("touchstart",this.onMouseDown),window.document.removeEventListener("mousemove",this.onMouseMove),window.document.removeEventListener("touchmove",this.onMouseMove),window.document.removeEventListener("mouseup",this.onMouseUp,!0),window.document.removeEventListener("touchend",this.onMouseUp,!0),this.seekListener=void 0}},{key:"updateProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDragging&&!t||(this.lastPercent=e,this.frontBar.style.width=100*e+"%")}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=M(n(5)),r=M(n(28)),i=M(n(2)),o=M(n(0)),s=M(n(1)),u=M(n(3)),l=M(n(4)),c=M(n(14)),d=M(n(327)),p=M(n(239)),h=M(n(328)),f=M(n(329)),g=M(n(330));n(331);var v=n(334),y=n(132),m=n(66);function M(e){return e&&e.__esModule?e:{default:e}}var x=function(e,t,n,a){return new(n||(n=c.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},w=function(e){return new c.default((function(t){return setTimeout(t,e)}))},I=(0,m.isIosDevice)(),b=!1;document.addEventListener("click",(function(){b=!0}));var k=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.selfMute=!I&&!b,e.count=0,e.lastTimeCalibrateCheck=null,e.isWaiting=!0,e.hasCalibrate=!1,e.shouldPlay=!1,e.destroyed=!1,e.onPageInVisible=function(){e.media&&e.media.pause()},e.onPageVisible=function(){e.boardName===e.app.room.currIndex&&e.pageName===e.app.room.currBoard.currIndex.toString()&&e.setNativeInitState()},e.onContainerMouseOver=function(){var t;null===(t=e.mediaDiv)||void 0===t||t.classList.add("visible")},e.onContainerMouseMove=function(){var t;clearTimeout(e.mediaDivHideTimer),e.mediaDivHideTimer=void 0,null===(t=e.mediaDiv)||void 0===t||t.classList.add("visible")},e.onContainerMouseLeave=function(){e.mediaDivHideTimer||(e.mediaDivHideTimer=setTimeout((function(){var t;null===(t=e.mediaDiv)||void 0===t||t.classList.remove("visible"),e.mediaDivHideTimer=void 0}),1500))},e.onMediaPause=function(){e.data.play&&setTimeout((function(){var t,n;if(e.media){var a=null===(t=e.media.parentNode)||void 0===t?void 0:t.parentNode,r=e.boardName===e.app.room.currBoard.boardName&&e.pageName===e.app.room.currBoard.currPage.pageIndex,i=e.media.duration-e.media.currentTime>1,o=null===(n=e.progressController)||void 0===n?void 0:n.isDragging;e.data.play&&!e.destroyed&&a&&r&&i&&!o&&(e.setNativePlayState(e.data.play),e.setNativeCurrTime(e.data))}}),100)},e.onMediaWait=function(){e.isWaiting=!0},e.onMediaCanPlay=function(){clearTimeout(e.canPlayTimer),e.canPlayTimer=setTimeout((function(){if(e.isWaiting&&e.media){e.isWaiting=!1;var t=e.getCurrTimeFromData(e.data),n=Math.abs(t-e.media.currentTime);(n>1.5||!e.hasCalibrate&&n>.2)&&(e.hasCalibrate=!0,e.setNativeCurrTime(e.data))}}),30)},e.onDurationChange=function(){e.media&&(e.duration=e.media.duration,e.updateTimeLabel(e.data.seek))},e.onTimeUpdate=function(){var t;if(e.media){var n=e.media.currentTime;e.duration&&e.duration>2&&e.duration-n<.23&&(n=e.duration),e.updateTimeLabel(n),"number"!=typeof e.duration||isNaN(e.duration)||null===(t=e.progressController)||void 0===t||t.updateProgress(n/e.duration);var a=e.getNtpTime();if(null===e.lastTimeCalibrateCheck||a-e.lastTimeCalibrateCheck>5e3){var r=e.getCurrTimeFromData(e.data);Math.abs(r-e.media.currentTime)>1.2&&e.setNativeCurrTime(e.data),e.lastTimeCalibrateCheck=a}}},e.onMediaEnd=function(){if(e.allowControl()&&!e.isInReplay()&&e.media&&e.duration){var t=e.media.currentTime-e.duration;e.count<100&&(e.count++,console.warn("media end","video time",e.media.currentTime,"duration",e.duration),console.warn("")),Math.abs(t)<1&&e.putAttributes({ended:!0,seek:"number"==typeof e.duration?e.duration:0,play:!1})}},e.onPlayClick=function(t){t.stopPropagation(),t.preventDefault(),e.media&&(e.data.ended?e.onNativePlayChange(!0,0):e.data.play?e.onNativePlayChange(!1,e.media.currentTime):e.onNativePlayChange(!0,e.data.seek||0))},e.onDeleteClick=function(t){t.stopPropagation(),t.preventDefault(),e.app.deleteElementByOpIds([e.opId])},e.onSelfMuteClick=function(){e.selfMute=!e.selfMute,e.updateSelfMute()},e.eventStopPropagation=function(e){e.stopPropagation()},e.setNativeInitState=function(){return x(e,void 0,void 0,r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data.hasOwnProperty("play")&&this.setNativePlayState(this.data.play),!this.data.hasOwnProperty("seek")){e.next=6;break}if(!I){e.next=5;break}return e.next=5,w(300);case 5:this.setNativeCurrTime(this.data);case 6:case"end":return e.stop()}}),e,this)})))},e.onNativePlayChange=function(t,n){e.allowControl()&&!e.isInReplay()&&e.putAttributes({play:t,seek:n,seekTime:e.getNtpTime()/1e3,ended:!1})},e.onNativeSeek=function(t){e.allowControl()&&!e.isInReplay()&&e.putAttributes({seek:t,seekTime:e.getNtpTime()/1e3})},e.setNativePlayState=function(t){return x(e,void 0,void 0,r.default.mark((function e(){var n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.media,this.updatePlayIcon("boolean"==typeof t&&t),this.shouldPlay=t||!1,!t||!n){e.next=19;break}return e.prev=4,e.next=7,n.play();case 7:e.next=17;break;case 9:if(e.prev=9,e.t0=e.catch(4),!e.t0||""+e.t0.name!="NotAllowedError"&&""+e.t0.name!="AbortError"){e.next=17;break}if(!this.shouldPlay){e.next=17;break}return this.selfMute=!0,this.updateSelfMute(!1),e.next=17,n.play();case 17:e.next=22;break;case 19:if(!n){e.next=22;break}return e.next=22,n.pause();case 22:case"end":return e.stop()}}),e,this,[[4,9]])})))},e.getTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e){return e<10?"0"+e:""+e},a=(e=e>1?Math.round(e):0)%60,r=(e=~~((e-=a)/60))%60,i=~~(e/60);return 0===i&&!1===t?n(r)+":"+n(a):i+":"+n(r)+":"+n(a)},e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"getNtpTime",value:function(){return Date.now()+this.ntpTimeDiff}},{key:"mountElement",value:function(e,t){this.selfMute=!I&&!b;var n=this.app.resourceCache.getMediaResource(t).cloneNode(!0);e.appendChild(this.createHeader()),e.appendChild(n),e.className="neteaseyunxin-wb-media-container "+this.type,n.preload="metadata",(0,a.default)(n.style,{webkitUserSelect:"none",userSelect:"none",width:"100%",height:"100%",pointerEvents:"none"}),n.controls=!1,n.playsInline=!0,n.disablePictureInPicture=!0,n.muted=this.selfMute,this.duration=n.duration,this.media=n,e.appendChild(this.createControllor()),this.mediaDiv=e,this.addContainerListener(),this.addMediaListener(),this.setNativeInitState(),"function"==typeof this.unregisterVisibleChangeListener&&this.unregisterVisibleChangeListener(),this.unregisterVisibleChangeListener=(0,y.registerVisibleChangeHandler)(this.onPageVisible,this.onPageInVisible)}},{key:"onPrePageChange",value:function(e){this.media&&e===this.app.account&&this.data.play&&this.putAttributes({play:!1,seek:this.media.currentTime,seekTime:this.getNtpTime()/1e3,ended:!1})}},{key:"onPlaySpeedChange",value:function(e){this.media&&(this.media.playbackRate=e)}},{key:"onAttributeUpdated",value:function(e){return x(this,void 0,void 0,r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.play===this.data.play&&!this.isInReplay()){t.next=5;break}return n=e.play,this.isInReplay()&&(n=n&&"play"===this.replayMode()),t.next=5,this.setNativePlayState(n);case 5:(e.seek!==this.data.seek||e.seekTime!==this.data.seekTime||this.app.isRecordPlayer)&&this.setNativeCurrTime(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"addContainerListener",value:function(){this.mediaDiv&&(this.mediaDiv.addEventListener("mouseover",this.onContainerMouseOver),this.mediaDiv.addEventListener("mouseleave",this.onContainerMouseLeave),this.mediaDiv.addEventListener("touchstart",this.onContainerMouseOver),this.mediaDiv.addEventListener("touchmove",this.onContainerMouseMove),window.document.addEventListener("touchend",this.onContainerMouseLeave))}},{key:"addMediaListener",value:function(){var e=this;this.media&&(this.media.addEventListener("durationchange",this.onDurationChange),this.media.addEventListener("timeupdate",this.onTimeUpdate),this.media.addEventListener("ended",this.onMediaEnd),this.media.addEventListener("waiting",this.onMediaWait),this.media.addEventListener("canplay",this.onMediaCanPlay),this.media.addEventListener("pause",this.onMediaPause)),this.allowControl()&&!this.isInReplay()&&(this.playWidget&&this.playWidget.addEventListener("click",this.onPlayClick),this.progressController&&this.progressController.addSeekListener((function(t,n){if("number"==typeof e.duration&&!isNaN(e.duration)){var a=t*e.duration;n&&e.media?(e.media.pause(),e.media.currentTime=a):e.media&&(e.setNativePlayState(e.data.play),e.onNativeSeek(a))}}))),this.deleteIcon&&this.deleteIcon.addEventListener("click",this.onDeleteClick),this.selfMuteIcon&&this.selfMuteIcon.addEventListener("click",this.onSelfMuteClick),this.playWidget&&this.playWidget.addEventListener("click",this.eventStopPropagation),this.selfMuteIcon&&this.selfMuteIcon.addEventListener("click",this.eventStopPropagation),this.deleteIcon&&this.deleteIcon.addEventListener("click",this.eventStopPropagation)}},{key:"onPluginWillDestroy",value:function(){this.destroyed=!0,this.media&&(this.media.removeEventListener("durationchange",this.onDurationChange),this.media.removeEventListener("timeupdate",this.onTimeUpdate),this.media.removeEventListener("ended",this.onMediaEnd),this.media.removeEventListener("waiting",this.onMediaWait),this.media.removeEventListener("canplay",this.onMediaCanPlay),this.media.removeEventListener("pause",this.onMediaPause),this.media.pause()),"function"==typeof this.unregisterVisibleChangeListener&&this.unregisterVisibleChangeListener(),this.allowControl()&&!this.isInReplay()&&(this.playWidget&&this.playWidget.removeEventListener("click",this.onPlayClick),this.progressController&&this.progressController.destroy()),this.deleteIcon&&this.deleteIcon.removeEventListener("click",this.onDeleteClick),this.selfMuteIcon&&this.selfMuteIcon.removeEventListener("click",this.onSelfMuteClick),this.playWidget&&this.playWidget.removeEventListener("click",this.eventStopPropagation),this.selfMuteIcon&&this.selfMuteIcon.removeEventListener("click",this.eventStopPropagation),this.deleteIcon&&this.deleteIcon.removeEventListener("click",this.eventStopPropagation)}},{key:"getCurrTimeFromData",value:function(e){var t=0;if(this.app.isRecordPlayer)if(e.hasOwnProperty("seek")&&e.play){var n=this.replaySeekDiff();t=e.seek+n}else e.hasOwnProperty("seek")&&(t=e.seek);else e.play&&e.seekTime&&e.hasOwnProperty("seek")?t=e.seek+this.getNtpTime()/1e3-e.seekTime:e.hasOwnProperty("seek")&&(t=e.seek);return"number"!=typeof this.duration||isNaN(this.duration)||(t=this.duration>2?Math.min(t,this.duration-.22):Math.min(t,this.duration)),t}},{key:"setNativeCurrTime",value:function(e){var t=this.getCurrTimeFromData(e),n=this.media;n&&(n.currentTime=t)}},{key:"createHeader",value:function(){var e=document.createElement("div");e.className="header";var t=document.createElement("div");t.className="title",t.innerText=this.getTitle(),e.appendChild(t);var n=document.createElement("div");return n.className="close icon",e.appendChild(n),this.deleteIcon=n,this.headerWidget=e,e}},{key:"createControlContainer",value:function(){var e=document.createElement("div");return e.className="control-container",e}},{key:"createPlayWidget",value:function(){var e=document.createElement("div");return e.className="play-icon",this.playWidget=e,(0,a.default)(e.style,{pointerEvents:this.allowControl()&&!this.isInReplay()?"auto":"none",cursor:this.allowControl()&&!this.isInReplay()?"pointer":"auto"}),e}},{key:"createTimeIndicator",value:function(){var e=document.createElement("div"),t=document.createElement("span");return e.className="time-container",t.className="time-text",this.timeIndicator=t,this.timeWidget=e,e.appendChild(t),e}},{key:"createVolumeWidget",value:function(){var e=document.createElement("div");(0,a.default)(e.style,{display:"inline-flex",height:"40px",color:"white",flexDirection:"row",alignItems:"center",verticalAlign:"top",marginRight:"16px"});var t=document.createElement("div");(0,v.appendTooltip)(t,"开关本端声音");var n=this.selfMute?g.default:f.default;return(0,a.default)(t.style,{display:"inline-block",height:"20px",width:"20px",backgroundImage:"url("+n+")",backgroundSize:"contain",pointerEvents:"auto",cursor:"pointer",marginLeft:"10px"}),e.appendChild(t),this.selfMuteIcon=t,e}},{key:"updatePlayIcon",value:function(e){if(this.playWidget){var t=e?h.default:p.default;this.playWidget.style.backgroundImage="url("+t+")"}}},{key:"updateTimeLabel",value:function(e){var t=!1,n="00:00";e||(e=0),"number"!=typeof this.duration||isNaN(this.duration)||(t=this.duration>=3600,n=this.getTime(this.duration,t));var a=this.getTime(e,t)+" / "+n;this.timeIndicator&&(this.timeIndicator.innerText=a)}},{key:"updateSelfMute",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.selfMute?g.default:f.default;if(this.selfMuteIcon&&(this.selfMuteIcon.style.backgroundImage="url("+t+")"),this.media&&(this.media.muted=this.selfMute),this.media&&e){var n=this.data.play;this.isInReplay()&&(n=n&&"play"===this.replayMode()),this.setNativePlayState(n),this.setNativeCurrTime(this.data)}}},{key:"ntpTimeDiff",get:function(){return this.app.ntpTimeDiff}}]),t}(d.default);t.default=k},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTI0MjE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTgwMCAtODAwIDI2MjQgMjYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTEyLjcyNDg4NCA0MjkuMzU1NjgxTDIwOC43OTc1NDUgMTMuMTk4NjM4QzE1MS42MDM0NDktMjAuNTk3ODc0IDY0LjAxMjQ5IDEyLjE5ODc0MSA2NC4wMTI0OSA5NS43OTAxMTJWOTI3LjkwNDIxOWMwIDc0Ljk5MjI1OSA4MS4zOTE1OTkgMTIwLjE4NzU5NCAxNDQuNzg1MDU1IDgyLjU5MTQ3NWw3MDMuOTI3MzM5LTQxNS45NTcwNjRjNjIuNzkzNTE4LTM2Ljk5NjE4MSA2Mi45OTM0OTgtMTI4LjE4Njc2OCAwLTE2NS4xODI5NDl6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyMTMyIj48L3BhdGg+PC9zdmc+"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.regExitListener=function(e,t){function n(t){t.persisted&&e()}return window.addEventListener("beforeunload",e,!1),window.addEventListener("pagehide",n,!1),t.on("event:destroy",e),function(){window.removeEventListener("beforeunload",e,!1),window.removeEventListener("pagehide",n,!1),t.off("event:destroy",e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(28)),r=l(n(0)),i=l(n(1)),o=l(n(14)),s=l(n(242)),u=n(244);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,a){return new(n||(n=o.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},d=function(){function e(t,n,a){(0,r.default)(this,e),this.pages={},this.pageNames=[],this.newPageIndex=1,this.hasDoc=!1,this.app=t,this.dispatch=t.dispatcher,this.boardName=n,this.displayName=a,this.pages={0:new s.default(t,n,"0")},this.pageNames=["0"],this.currIndex=0}return(0,i.default)(e,[{key:"getPageByIndex",value:function(e){return this.pages[this.pageNames[e]]}},{key:"getPageNameByAnimPageIndex",value:function(e){for(var t=this.payloadOfPages,n=0;n<t.length;n++){var a=t[n];if(a&&a.animPageIndex===e)return this.pageNames[n]}return null}},{key:"getCurrPageIndex",value:function(){return this.pageNames.indexOf(this.currIndex.toString())}},{key:"getPageSnapshots",value:function(){var e=this;return this.app.room.boardOps[this.boardName].pageSnapshotIds.map((function(t){return e.app.room.opIdSnapshotMap[t]})).filter((function(e){return"goto"!==e.snapshot.data.action}))}},{key:"getPageBuiltInIndex",value:function(e){return Number(this.pageNames[e])}},{key:"addOpInBoard",value:function(e){var t=e.data,n=t.action,a=t.page,r=t.insertAfter;"add"===n&&(0,u.addPage)(this,r,e),"goto"===n&&(0,u.gotoPage)(this,a,e),"delete"===n&&(0,u.deletePage)(this,a,e),this.app.opsManager.hooks.opAdd.call(e,!0)}},{key:"addTransDocOp",value:function(e,t){var n=this.app.opsManager.opMap.transDoc;this.transDocSnapshot?this.transDocSnapshot.opId!==e.data.dependOn?this.logger.warn("[白板] transDocOp添加的snapshot有问题",this.transDocSnapshot,e):this.transDocSnapshot=n.transformOp(this.transDocSnapshot,e.data):this.transDocSnapshot=e;try{if(this.transDocSnapshot.data.transDocData){var a=Number(this.getPageNameByAnimPageIndex(this.transDocSnapshot.data.transDocData.animPageIndex));null!==this.transDocSnapshot.data.transDocData.animPageIndex&&a!==this.currIndex&&(0,u.gotoPage)(this,a,e)}n.apply(this.transDocSnapshot,t)}catch(e){this.logger.error("[白板] transDoc.apply",e)}}},{key:"previewDoc",value:function(e){try{if(this.transDocSnapshot)this.app.opsManager.opMap.transDoc.previewDoc(this.transDocSnapshot,e)}catch(e){this.logger.error("[白板] previewDoc",e)}}},{key:"updateDocClipPath",value:function(){this.transDocSnapshot&&this.app.opsManager.opMap.transDoc.updateDocClipPath(this.transDocSnapshot)}},{key:"waitTilReady",value:function(){return c(this,void 0,void 0,a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.transDocSnapshot){e.next=4;break}return t=this.app.opsManager.opMap.transDoc,e.next=4,t.waitTilReady(this.transDocSnapshot);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"logger",get:function(){return this.app.logger}},{key:"currPage",get:function(){return this.pages[this.currIndex]}},{key:"payloadOfPages",get:function(){var e=this;return this.pageNames.map((function(t){return e.pages[t].payload}))}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(28)),r=f(n(7)),i=f(n(74)),o=f(n(0)),s=f(n(1)),u=f(n(14)),l=n(160),c=n(225),d=n(243),p=n(96),h=n(355);function f(e){return e&&e.__esModule?e:{default:e}}var g=function(e,t,n,a){return new(n||(n=u.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},v=function(){function e(t,n,a){(0,o.default)(this,e),this.localDrawQueue={},this.localEditQueue={},this.drawOpQueue={},this.hiddenOpQueue={},this.deletedOpQueue={},this.lastSelectOfUser={},this.lastInProgressSelectOfUser={},this.lastInProgressSnapshotOfUser={},this.lastLaserOfUser={},this.opQueueMap={},this.lastMousePointerOfUser={},this.groups=new i.default,this.idToGroup=new i.default,this.blockedResourceList=[],this._currOpId=(0,l.v4)(),this._nextOpId=(0,l.v4)(),this.app=t,this.opsManager=t.opsManager,this.boardName=n,this.pageIndex=a,window.page=this}return(0,s.default)(e,[{key:"getBoard",value:function(){return this.app.room.boards[this.boardName]}},{key:"prepareNewOpId",value:function(){this._currOpId=this._nextOpId,this._nextOpId=(0,l.v4)()}},{key:"getOpId",value:function(){return this.app.account+"-"+this._currOpId}},{key:"getNextOpId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?(this.prepareNewOpId(),this.getOpId()):this.app.account+"-"+this._nextOpId}},{key:"setBackgroundSnapshot",value:function(e){this.backgroundSnapshot=e,this.getBoard().hasDoc=!0}},{key:"hasMedia",value:function(e){for(var t in this.drawOpQueue)if(this.drawOpQueue[t].data.type===e)return!0;for(var n in this.hiddenOpQueue)if(this.hiddenOpQueue[n].data.type===e)return!0;return!1}},{key:"getAnimPageIndex",value:function(){return this.payload&&this.payload.hasOwnProperty("animPageIndex")?this.payload.animPageIndex:null}},{key:"setPayload",value:function(e){this.payload=e}},{key:"addWaitingResource",value:function(e){-1!==this.blockedResourceList.indexOf(e)||this.app.resourceCache.resourceLoaded(e)||this.blockedResourceList.push(e)}},{key:"removeWaitingResource",value:function(e){var t=this.blockedResourceList.indexOf(e);t>-1&&(this.blockedResourceList.splice(t,1),this.blocked||(this.app.opsManager.hooks.pageReady.call(this.boardName,this.pageIndex),this.isCurrPage&&(this.app.room.pageToRefresh=this)))}},{key:"addOpInPage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"none"===e.opId?(this.logger.warn("[白板]","snapshot no opid",e),!1):(this.lastInProgressSnapshotOfUser.hasOwnProperty(e.uid)&&-1===["mouse-pointer"].indexOf(e.data.type)&&(e.data.inProgress&&e.opId===this.lastInProgressSnapshotOfUser[e.uid].snapshot.opId||delete this.lastInProgressSnapshotOfUser[e.uid]),"background"===e.data.type&&(this.setBackgroundSnapshot(e),this.cleanNonCanvasElements(!0)),(0,p.opNeedRefresh)(this,e)&&!this.app.room.isReceivingBatchSnapshots&&this.calcDrawOpQueue(e),-1!==["undo","redo","clear"].indexOf(e.data.type)&&this.cleanNonCanvasElements(!1),this.app.room.isReceivingBatchSnapshots||((0,p.opNeedRefresh)(this,e)?t&&this.boardName===this.app.room.currIndex&&this.pageIndex===this.app.room.currBoard.currIndex.toString()&&(this.app.room.pageToRefresh=this):(0,h.addIncrementSnapshot)(this,e)),this.opsManager.hooks.opAdd.call(e),(0,p.opNeedRefresh)(this,e))}},{key:"calcDrawOpQueue",value:function(e){e&&e.data.inProgress?(0,d.processInProgressSnap)(this,e):(0,d.calcDrawOpQueue)(this,this.app.room.isReceivingBatchSnapshots)}},{key:"cleanNonCanvasElements",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,c.cleanNonCanvasElements)(this,e)}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,c.refresh)(this,e)}},{key:"incRefresh",value:function(){(0,c.drawInProgressSnapshots)(this)}},{key:"refreshOnStreamCanvas",value:function(){(0,c.refreshOnStreamCanvas)(this)}},{key:"setLocalOp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t)(0,p.patchOp)(this,t),n?this.localEditQueue[e]=t:this.localDrawQueue[e]=t;else if(Array.isArray(e)){var a=!0,i=!1,o=void 0;try{for(var s,u=(0,r.default)(e);!(a=(s=u.next()).done);a=!0){var l=s.value;delete this.localDrawQueue[l],delete this.localEditQueue[l]}}catch(e){i=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw o}}}else delete this.localDrawQueue[e],delete this.localEditQueue[e];n?(this.calcDrawOpQueue(t),this.app.room.refresh()):(0,c.drawLocalSnapshots)(this)}},{key:"waitTilReady",value:function(){return g(this,void 0,void 0,a.default.mark((function e(){var t,n,r,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in t=this.drawOpQueue,n=[],t)i=t[r],n.push(this.opsManager.waitTilReady(i));return this.backgroundSnapshot&&n.push(this.opsManager.waitTilReady(this.backgroundSnapshot)),e.abrupt("return",u.default.all(n));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"logger",get:function(){return this.app.logger}},{key:"opQueue",get:function(){var e=this.app.room;try{return e.boardOps[this.boardName].pages[this.pageIndex].inPageSnapshotIds.map((function(t){return e.opIdSnapshotMap[t].snapshot}))}catch(e){return[]}}},{key:"isCurrPage",get:function(){return this.app.room.currBoard.currPage===this}},{key:"bgCtx",get:function(){return this.app.container.bgCtx}},{key:"ctx",get:function(){return this.app.container.ctx}},{key:"frontCtx",get:function(){return this.app.container.frontCtx}},{key:"localCtx",get:function(){return this.app.container.localCtx}},{key:"laserCtx",get:function(){return this.app.container.laserCtx}},{key:"width",get:function(){return this.app.container.width}},{key:"height",get:function(){return this.app.container.height}},{key:"blocked",get:function(){return this.blockedResourceList.length>0}}]),e}();t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDrawOpFromSnapshotQueue=t.calcDrawOpQueue=t.processInProgressSnap=void 0;var a=s(n(19)),r=s(n(7)),i=n(45),o=n(96);function s(e){return e&&e.__esModule?e:{default:e}}t.processInProgressSnap=function(e,t){var n=[];if(t.data.dependOn){var a=Array.isArray(t.data.dependOn)?t.data.dependOn:[t.data.dependOn],i=!0,s=!1,u=void 0;try{for(var l,c=(0,r.default)(a);!(i=(l=c.next()).done);i=!0){var p=l.value;if(e.opQueueMap.hasOwnProperty(p)){for(var h=e.opQueueMap[p],f=h.length-1;f>=0;f--)if(h[f].opId===t.opId){h.splice(f,1);break}h.push(t),n.push(p)}}}catch(e){s=!0,u=e}finally{try{!i&&c.return&&c.return()}finally{if(s)throw u}}}else e.opQueueMap[t.opId]=[t],n.push(t.opId);var g=[],v=!0,y=!1,m=void 0;try{for(var M,x=(0,r.default)(n);!(v=(M=x.next()).done);v=!0){var w=M.value;(C=d(e,w)).data.deleted?e.deletedOpQueue[w]=C:C.data.hidden?(e.hiddenOpQueue[w]=C,g.push(C)):(e.drawOpQueue[w]=C,g.push(C))}}catch(e){y=!0,m=e}finally{try{!v&&x.return&&x.return()}finally{if(y)throw m}}var I=!0,b=!1,k=void 0;try{for(var T,_=(0,r.default)(g);!(I=(T=_.next()).done);I=!0){var C=T.value;(0,o.patchOp)(e,C)}}catch(e){b=!0,k=e}finally{try{!I&&_.return&&_.return()}finally{if(b)throw k}}},t.calcDrawOpQueue=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.drawOpQueue={},e.hiddenOpQueue={},e.deletedOpQueue={};var n=p(e,e.opQueue),a=n.normalQueue,r=n.abNormalQueue,i=h(e,a),o=f(e,i),s=g(e,o);u(e,r),l(e,s),t||c(e)};var u=function(e,t){for(var n=0;n<t.length;n++){var a=t[n];"select"===a.data.type?a.data.inProgress?e.lastInProgressSelectOfUser[a.uid]=a:(delete e.lastInProgressSelectOfUser[a.uid],e.lastSelectOfUser[a.uid]=a):"mouse-pointer"===a.data.type?e.lastMousePointerOfUser[a.uid]=a:"laser"===a.data.type&&(e.lastLaserOfUser[a.uid]=a)}},l=function(e,t){e.opQueueMap={};var n=[],i={};e.opsManager.groupOp.reset(e);var s=!0,u=!1,l=void 0;try{for(var c,p=(0,r.default)(t);!(s=(c=p.next()).done);s=!0){var h=c.value;if(e.lastInProgressSelectOfUser={},"group"!==h.data.type)if(Array.isArray(h.data.dependOn)){var f=!0,g=!1,y=void 0;try{for(var m,M=(0,r.default)(h.data.dependOn);!(f=(m=M.next()).done);f=!0){var x=m.value;e.opQueueMap.hasOwnProperty(x)?(n.push(x),e.opQueueMap[x].push(h)):(i[x]=i[x]||[],i[x].push(h))}}catch(e){g=!0,y=e}finally{try{!f&&M.return&&M.return()}finally{if(g)throw y}}}else if("string"==typeof h.data.dependOn)e.opQueueMap.hasOwnProperty(h.data.dependOn)?(n.push(h.data.dependOn),e.opQueueMap[h.data.dependOn].push(h)):(i[h.data.dependOn]=i[h.data.dependOn]||[],i[h.data.dependOn].push(h));else{var w;if(e.opQueueMap[h.opId]=[h],i[h.opId])(w=e.opQueueMap[h.opId]).push.apply(w,(0,a.default)(i[h.opId])),i[h.opId]=[]}else e.opsManager.groupOp.process(e,h)}}catch(e){u=!0,l=e}finally{try{!s&&p.return&&p.return()}finally{if(u)throw l}}v(e,n);var I=[];for(var b in e.opQueueMap){var k=d(e,b);k.data.deleted?e.deletedOpQueue[b]=k:k.data.hidden?(e.hiddenOpQueue[b]=k,I.push(k)):(e.drawOpQueue[b]=k,I.push(k))}var T=!0,_=!1,C=void 0;try{for(var N,A=(0,r.default)(I);!(T=(N=A.next()).done);T=!0){var P=N.value;(0,o.patchOp)(e,P)}}catch(e){_=!0,C=e}finally{try{!T&&A.return&&A.return()}finally{if(_)throw C}}},c=function(e){if(e.app.room.currBoard.currPage===e){var t=(0,o.getSelectedOpIds)(e);e.opsManager.selectOp.setSelectedOpIds(t)}},d=t.getDrawOpFromSnapshotQueue=function(e,t){for(var n=e.opQueueMap[t][0],a=1;a<e.opQueueMap[t].length;a++)n=(0,o.transformOp)(e,n,e.opQueueMap[t][a]);return n},p=function(e,t){var n=[],a=[],o=!0,s=!1,u=void 0;try{for(var l,c=(0,r.default)(t);!(o=(l=c.next()).done);o=!0){var d=l.value;-1!==i.snapshotOutOfNormalFlowTypes.indexOf(d.data.type)?a.push(d):n.push(d)}}catch(e){s=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}for(var p in e.localEditQueue)n.push(e.localEditQueue[p]);return{normalQueue:n,abNormalQueue:a}},h=function(e,t){for(var n=t.slice(),i=n.length-1;i>=0;i--){var o=n[i];if("undo"===o.data.type||"redo"===o.data.type){var s=[];o.data.redoOpId?s.push(o.data.redoOpId):o.data.undoOpId?s.push(o.data.undoOpId):Array.isArray(o.data.undoOpIds)&&s.push.apply(s,(0,a.default)(o.data.undoOpIds)),n.splice(i,1);var u=!0,l=!1,c=void 0;try{for(var d,p=(0,r.default)(s);!(u=(d=p.next()).done);u=!0)for(var h=d.value,f=i-1;f>=0;f--)n[f].opId===h&&(n.splice(f,1),i--)}catch(e){l=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(l)throw c}}}}return n},f=function(e,t){for(var n=t.slice(),a=n.length-1;a>=0;a--){if("clear"===n[a].data.type)return v(e,n.slice(0,a+1).map((function(e){return e.opId}))),n=n.slice(a+1)}return n},g=function(e,t){for(var n=[],a=0;a<t.length;a++){var r=t[a];"duplicate"===r.data.type?n=n.concat(r.data.duplicates):n.push(t[a])}return n},v=function(e,t){for(var n in e.lastInProgressSnapshotOfUser){var a=e.lastInProgressSnapshotOfUser[n];-1!==t.indexOf(a.snapshot.opId)&&delete e.lastInProgressSnapshotOfUser[n]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deletePage=t.gotoPage=t.addPage=void 0;var a=i(n(18)),r=i(n(242));function i(e){return e&&e.__esModule?e:{default:e}}t.addPage=function(e,t,n,a){e.app.emit("event:prePageChange",n),e.pages[e.newPageIndex]=new r.default(e.app,e.boardName,e.newPageIndex.toString()),a?e.pages[e.newPageIndex].setPayload(a):"pageOp"===n.category&&e.pages[e.newPageIndex].setPayload(n.data.payload),t=void 0===t?e.pageNames.length-1:t,e.pageNames.splice(t+1,0,e.newPageIndex.toString()),e.app.room.isReceivingBatchSnapshots||(e.pages[e.newPageIndex].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[e.newPageIndex]),e.currIndex=e.newPageIndex,e.newPageIndex+=1,e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(n),s(e.app)},t.gotoPage=function(e,t,n){if(!e.pages.hasOwnProperty(t))return e.logger.error("[白板] goto的页面不存在, 不执行goto动作");e.app.emit("event:prePageChange",n),e.currIndex=Number(t),e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(n),s(e.app),e.app.room.isReceivingBatchSnapshots||(e.pages[t].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[t])},t.deletePage=function(e,t,n){if(e.pages.hasOwnProperty(t))if(1===(0,a.default)(e.pages).length)e.logger.error("[白板]","不能删除最后一页");else{e.app.emit("event:prePageChange",n),e.app.emit("event:deletePage",e.pages[t]),delete e.pages[t];var r=e.pageNames.indexOf(t.toString());-1!==r&&e.pageNames.splice(r,1);var i=r;r===e.pageNames.length&&(i=r-1),e.currIndex=Number(e.pageNames[i]),e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(n),s(e.app),e.app.room.isReceivingBatchSnapshots||(e.pages[e.currIndex].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[e.currIndex])}else e.logger.error("[白板]","删除页面:"+t+", 但是页面不存在")};var o=void 0;function s(e){clearTimeout(o),o=setTimeout((function(){var t=e.room.currBoard.currIndex;e.preparePreview([t-2,t-1,t,t+1,t+2])}),0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getCameraBoundFromGlobalOp=function(e,t){var n=e.app.camera,a=e.app.vision;if("camera-bound"===t.data.type){if(n.cameraBoundByUser[t.uid]=t.data.boundary,"freeObserver"===a.mode&&t.uid===e.app.account)return t.data.boundary;if("broadcaster"===a.mode&&t.uid===e.app.account)return t.data.boundary;if("follower"===a.mode&&t.uid===a.broadcaster)return t.data.boundary;if("follower"===a.mode&&t.uid===e.app.account)return t.data.boundary}return null},t.shouldCacheSnapshot=function(e){return!!e.category&&(!("boardOp"!==e.category||"add"!==e.data.action||!e.data.tmpl)||("boardOp"===e.category&&"addTransDoc"===e.data.action||!("video"!==e.data.type&&"audio"!==e.data.type&&"image"!==e.data.type||e.data.skipUndo)))};var a=void 0;t.fitToContentAfterBoardChange=function(e){clearTimeout(a),a=setTimeout((function(){e.app.hasBackground()||e.app.hasTransDoc()?e.app.fitToContent(!1):(e.app.fitToContent(!1),e.app.camera.zoomFactor>=1&&e.app.zoomTo(1,!1))}),0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(22)),r=s(n(18)),i=s(n(5)),o=s(n(27));function s(e){return e&&e.__esModule?e:{default:e}}t.default={isUndefined:function(e){return void 0===e},isDOM:function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,o.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,o.default)(e))&&1===e.nodeType&&"string"==typeof e.nodeName},isValidString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isValidArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isValidHexColor:function(e){return/^#[0-9abcdef]{6}$/gi.test(e)},isObject:function(e){return"object"===(void 0===e?"undefined":(0,o.default)(e))},isValidObject:function(e){if("object"!==(void 0===e?"undefined":(0,o.default)(e)))return!1;if(e=(0,i.default)({},e),r.default&&0===(0,r.default)(e).length)return!1;try{return"{}"!==(0,a.default)(e)}catch(e){return!1}},validate:function(e,t,n,i){var o=this,s=[];return(0,r.default)(i).map((function(e){var t=i[e],r=n[e];if(o.isUndefined(r))t.isRequire&&s.push({key:e,message:e+" is required"});else{switch(t.type.toLowerCase()){case"dom":o.isDOM(r)||s.push({key:e,message:"Expected dom, but get other type"});break;case"string":o.isValidString(r)||s.push({key:e,message:"Expected string, but get other type"});break;case"boolean":o.isBoolean(r)||s.push({key:e,message:"Expected boolean, but get other type"});break;case"function":o.isFunction(r)||s.push({key:e,message:"Expected function, but get other type"});break;case"number":o.isNumber(r)||s.push({key:e,message:"Expected number, but get other type"});break;case"object":o.isObject(r)||s.push({key:e,message:"Expected object, but get other type"});break;case"array":o.isValidArray(r)||s.push({key:e,message:"Expected array, but get other type"});break;default:s.push({key:e,message:e+"的类型未知: "+t.type.toLowerCase()})}t.enum&&-1===t.enum.indexOf(r)&&s.push({key:e,message:"Expected "+e+" to be one of "+(0,a.default)(t.enum)+", but it is not"})}})),s.length>0&&(e.error("[白板]",t+"参数异常"),e.error("[白板]","错误信息：",s),e.error("[白板]","参数为：",n)),0===s.length}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chooseImgAndUpload=t.uploadAndAddImg=void 0;var a=s(n(5)),r=n(31),i=s(n(33)),o=n(145);function s(e){return e&&e.__esModule?e:{default:e}}window.addEventListener("load",(function(){p()}));var u=["jpg","jpeg","png","bmp","webp"],l=t.uploadAndAddImg=function(e,t,n){var s=n.pageName,u=n.boardName;return t.dataURL||t.fileInput?t.dataURL&&!t.fileName?e.logger.error("[白板] uploadAndAddImg 提供了dataURL时，必须同时提供fileName"):(e.logger.log("[白板] 已选择image文件，现在开始上传文件"),(0,o.uploadMedia)(e,(0,a.default)((0,a.default)({},t),{mediaType:"image",uploadprogress:function(e){e&&"string"==typeof e.percentageText&&(0,r.showToast)({msg:"文件上传进度"+e.percentageText,time:1e5,type:"info",msgType:i.default.FILE_IS_UPLOADING})},done:function(t,n){if((0,r.hideToast)(),t){var a=(null==t?void 0:t.msg)||(null==t?void 0:t.message)||"上传失败";e.logger.error("[白板] 文件上传失败",t),(0,r.showToast)({msg:a,type:"error",time:3,msgType:i.default.FILE_UPLOAD_FAIL})}else e.logger.log("[白板] 上传image文件成功"),(0,r.showToast)({msg:"image上传成功",type:"success",time:3,msgType:i.default.FILE_UPLOAD_FAIL}),e.addImage({url:n.url,pageName:s,boardName:u})}})),void(0,r.showToast)({msg:"上传文件中...",time:1e5,type:"info",msgType:i.default.FILE_IS_UPLOADING})):e.logger.error("[白板] uploadAndAddImg dataURL和fileInput至少提供一个")},c=(t.chooseImgAndUpload=function(e,t){var n=d();n.accept=u.map((function(e){return"."+e})).join(","),n.value="",n.onchange=function(n){return c(n,{app:e,pageName:t.pageName,boardName:t.boardName})},n.click()},function(e,t){var n=t.app,a=t.pageName,o=t.boardName,s=e.target,c=e.target.files[0];if(c&&c.size&&c.size>10485760)return s.value="",n.logger.error("[白板] image大小超过10M，请重新选择文件"),(0,r.showToast)({msg:"image大小不能超过"+Math.round(10)+"M",type:"error",msgType:i.default.FILE_SIZE_EXCEED_LIMIT});if(!c||0===c.size)return s.value="",n.logger.error("[白板] 选择的文件大小为空: "+(null==c?void 0:c.name)),(0,r.showToast)({msg:"文件不能为空",type:"error",msgType:i.default.FILE_IS_EMPTY});var d=c.name.split("."),p=d[d.length-1],h=-1!==u.indexOf(p.toLowerCase());if(h||(s&&s.files&&s.files.length>0&&(p=s.files[0].type),h=-1!==u.indexOf(p)),!h)return s.value="",(0,r.showToast)({msg:"当前仅支持"+u.join(",")+"格式文件",time:3,type:"error",msgType:i.default.FILE_ACCEPTED_TYPE_LIMIT});l(n,{fileInput:s},{pageName:a,boardName:o})}),d=function(){var e=document.getElementById("netease-wb-resource-input");return e||p()},p=function(){var e=document.getElementById("netease-wb-resource-input");return e||(e=document.createElement("input"),document.body.appendChild(e),e.id="netease-wb-resource-input",e.style.position="absolute",e.style.visibility="hidden",e.type="file",e.style.width="0",e.style.height="0",e.style.top="-100px"),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FloatComponent=void 0;var a=d(n(19)),r=d(n(5)),i=d(n(2)),o=d(n(0)),s=d(n(1)),u=d(n(3)),l=d(n(4)),c=d(n(6));function d(e){return e&&e.__esModule?e:{default:e}}t.FloatComponent=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.pickedProps={},e.nativeProps={},e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"propsFilter",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.pickedProps={},this.nativeProps=(0,r.default)({},this.props),n=(0,r.default)({unrendered:!1},n),[].concat((0,a.default)(t),["unrendered"]).forEach((function(t){t in e.nativeProps?(e.pickedProps[t]=e.nativeProps[t],delete e.nativeProps[t]):e.pickedProps[t]=n[t]}))}},{key:"render",value:function(){return this.propsFilter(),this.pickedProps.unrendered?null:this.children}},{key:"children",get:function(){return null}}]),t}(c.default.Component)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SliderItem=void 0;var a=p(n(5)),r=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(25)),l=p(n(4)),c=p(n(6)),d=n(40);function p(e){return e&&e.__esModule?e:{default:e}}n(393);t.SliderItem=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.changeHandler=function(t,n){var a,r,i=e.pickedProps,o=i.onChange,s=i.toolName;null==o||o({type:"change",target:t.target,toolName:s,value:t.target.value},n),null===(r=(a=e.nativeProps).onInput)||void 0===r||r.call(a,t),e.forceUpdate()},e}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange"],{icon:void 0,value:void 0})}},{key:"defaultClassNames",get:function(){return(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"defaultClassNames",this).concat("slider-item")}},{key:"defaultStyle",get:function(){return(0,a.default)((0,a.default)({},(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"defaultStyle",this)),{pointerEvents:"none"})}},{key:"inputStyle",get:function(){return{pointerEvents:"all"}}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.value,r=t.disabled;return c.default.createElement("label",(0,a.default)({className:this.className,style:this.style},this.hoverProps),this.itemChildren,c.default.createElement("input",(0,a.default)({type:"range",style:this.inputStyle,disabled:r},this.nativeProps,{onInput:function(t){return e.changeHandler(t,!0)},onChange:function(t){return e.changeHandler(t,!1)}},void 0!==n?{value:n}:{})))}}]),t}(d.Item)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){var t=parseInt(e,16);return isNaN(t)?0:t},r=t.getRGBvalues=function(e){if("string"==typeof e&&e){var t,n,r=e.slice(0,1);return"#"===r?4===(t=e).length?(n=t.replace("#","").split(""),{r:a(n[0]+n[0]),g:a(n[1]+n[1]),b:a(n[2]+n[2])}):{r:a(t.slice(1,3)),g:a(t.slice(3,5)),b:a(t.slice(5))}:"r"===r.toLowerCase()?function(e){var t,n=e.slice(e.indexOf("(")+1,e.indexOf(")")).split(","),a=!1;return t={r:(n=n.map((function(e,t){return 3!==t?parseInt(e,10):a=!0,parseFloat(e)})))[0],g:n[1],b:n[2]},a&&(t.a=n[3]),t}(e):{r:0,g:0,b:0}}};t.mixColorAndOpacity=function(e,t){var n=r(e);return t=Number(t),t=isNaN(t)?1:t,void 0===n?e:"rgba("+n.r+","+n.g+","+n.b+","+t+")"}},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1MDg3NTcyMzAxOSIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSItMjAwIC0yMDAgMTQyNCAxNDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMzY4NyIgd2lkdGg9IjMyIgogICAgaGVpZ2h0PSIzMiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPGRlZnM+CiAgICAgICAgPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KICAgICAgICAgICAgQGZvbnQtZmFjZSB7CiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogZmVlZGJhY2staWNvbmZvbnQ7CiAgICAgICAgICAgICAgICBzcmM6IHVybCgiLy9hdC5hbGljZG4uY29tL3QvZm9udF8xMDMxMTU4X3U2OXc4eWh4ZHUud29mZjI/dD0xNjMwMDMzNzU5OTQ0IikgZm9ybWF0KCJ3b2ZmMiIpLCB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LndvZmY/dD0xNjMwMDMzNzU5OTQ0IikgZm9ybWF0KCJ3b2ZmIiksIHVybCgiLy9hdC5hbGljZG4uY29tL3QvZm9udF8xMDMxMTU4X3U2OXc4eWh4ZHUudHRmP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgidHJ1ZXR5cGUiKTsKICAgICAgICAgICAgfQogICAgICAgIDwvc3R5bGU+CiAgICA8L2RlZnM+CiAgICA8cGF0aAogICAgICAgIGQ9Ik04MTguMzQ2NjY3IDM1Mi44NTMzMzNsLTIwMi44MzczMzQtMTg4LjE2IDU2LjQ5MDY2Ny02MC44ODUzMzMgMjAyLjgzNzMzMyAxODguMTZ6TTQzOC43NDEzMzMgNzYyLjE5NzMzM2wtMjAyLjkyMjY2Ni0xODguMjQ1MzMzIDM2MC44NzQ2NjYtMzg4Ljk0OTMzMyAyMDIuODggMTg4LjI0NTMzM3pNMjE3LjAwMjY2NyA1OTQuMjE4NjY3bDIwMi45MjI2NjYgMTg4LjI4OC0yNzAuODkwNjY2IDg4LjQ0OHoiCiAgICAgICAgZmlsbD0iIzJjMmMyYyIgcC1pZD0iMzY4OCI+PC9wYXRoPgogICAgPHBhdGgKICAgICAgICBkPSJNNzQ3LjY0OCA5OC41NmwxMjYuODA1MzMzIDExNy42MzJjMjAuOTkyIDE5LjQ5ODY2NyAyMS4xNjI2NjcgNTMuNTA0IDAuNDI2NjY3IDc1Ljg2MTMzMy0yMC44MjEzMzMgMjIuNDQyNjY3LTU0LjY5ODY2NyAyNC43NDY2NjctNzUuNjkwNjY3IDUuMjkwNjY3TDY3Mi4zODQgMTc5LjYyNjY2N2MtMjEuMDM0NjY3LTE5LjQ5ODY2Ny0yMS4yMDUzMzMtNTMuNTA0LTAuNDI2NjY3LTc1Ljg2MTMzNCAyMC44MjEzMzMtMjIuNCA1NC42OTg2NjctMjQuNzQ2NjY3IDc1LjY5MDY2Ny01LjI5MDY2NnoiCiAgICAgICAgZmlsbD0iIzJjMmMyYyIgcC1pZD0iMzY4OSI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTAwMjU5MDkxNCIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMTIyNDAiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij4KICAgIDxwYXRoCiAgICAgICAgZD0iTTAgNDU3djExMGg3NTB2MTEwbDIyMC0xNjVsLTIyMC0xNjV2MTEweiIKICAgICAgICBmaWxsPSIiIHAtaWQ9IjEyMjQxIj48L3BhdGg+Cjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjExNzE5MjA5NTA5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTIwMCAtMjAwIDE0MjQgMTQyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMxNzQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjE2LjMyNyAyMjMuNzc0cTE1NC4xMTYgMCA2MTYuNDY1IDAgMjcuMDEwIDAgNDYuMDc2IDE5LjA2NiAxOS4wNjYgMTkuMDY2IDE5LjA2NiA0Ni4wNzYgMCAxNTUuNzA1IDAgNDY3LjExNSAwIDI3LjAxMC0xOS4wNjYgNDYuMDc2LTE5LjA2NiAxOS4wNjYtNDYuMDc2IDE5LjA2Ni0yMDUuNzUzIDAtNjE2LjQ2NSAwLTI2LjIxNiAwLTQ2LjA3Ni0xOS4wNjYtMTkuMDY2LTE5LjA2Ni0xOS4wNjYtNDYuMDc2IDAtNTQuODE1IDAtMTY0LjQ0NCAwLTE5LjA2NiAwLTQ3LjY2NSAwLTE0LjI5OSAwLTMwLjk4MiAwLTIwLjY1NSAwLTQ1LjI4MiAwLTczLjA4NiAwLTE3OC43NDMgMC0yNy4wMTAgMTkuMDY2LTQ2LjA3NiAxOS44Ni0xOS4wNjYgNDYuMDc2LTE5LjA2NnpNMjE2LjMyNyA4NTUuMzMzcTE1NC4xMTYgMCA2MTYuNDY1IDAgNDEuMzEgMCA2OS45MDgtMjguNTk5IDI3LjgwNC0yOC41OTkgMjcuODA0LTY5LjExNCAwLTE1NS43MDUgMC00NjcuOTEgMC00MC41MTUtMjcuODA0LTY5LjExNC0yOC41OTktMjguNTk5LTY5LjkwOC0yOC41OTktMjA1Ljc1MyAwLTYxNi40NjUgMC00MC41MTUgMC02OS4xMTQgMjguNTk5LTI4LjU5OSAyOC41OTktMjguNTk5IDY5LjExNCAwIDQxLjMxIDAgMTIzLjkyOSAwIDQyLjg5OCAwIDEyOC42OTUgMCA0Mi44OTggMCA5Ni45MTggMCAyNy4wMTAgMCA1Ni40MDMgMCAyOS4zOTMgMCA2MS45NjQgMCAzOS43MjEgMjguNTk5IDY4LjMyIDI4LjU5OSAyOS4zOTMgNjkuMTE0IDI5LjM5M3pNMjYyLjQwMyA0MjUuNTU1cTAgMjguNTk5IDE5Ljg2IDQ4LjQ1OSAyMC42NTUgMjAuNjU1IDQ5LjI1NCAyMC42NTUgMjguNTk5IDAgNDkuMjU0LTIwLjY1NSAxOS44Ni0xOS44NiAxOS44Ni00OC40NTkgMC0yOC41OTktMTkuODYtNDguNDU5LTIwLjY1NS0yMC42NTUtNDkuMjU0LTIwLjY1NS0yOC41OTkgMC00OS4yNTQgMjAuNjU1dC0xOS44NiA0OC40NTl6TTI5NC45NzQgNDI1LjU1NXEwLTE1LjA5NCAxMS4xMjItMjYuMjE2IDEwLjMyNy0xMC4zMjcgMjUuNDIxLTEwLjMyNyAxNS4wOTQgMCAyNS40MjEgMTAuMzI3IDExLjEyMiAxMS4xMjIgMTEuMTIyIDI2LjIxNiAwIDE1LjA5NC0xMS4xMjIgMjYuMjE2LTEwLjMyNyAxMC4zMjctMjUuNDIxIDEwLjMyNy0xNC4yOTkgMC0yNS40MjEtMTAuMzI3dC0xMS4xMjItMjYuMjE2ek02NjMuNTgyIDQ5My4wODFxNDIuODk4IDQyLjg5OCAxNzIuMzg4IDE3Mi4zODggNS41NjEgNS41NjEgNS41NjEgMTEuMTIyIDAgNi4zNTUtNS41NjEgMTEuOTE2LTUuNTYxIDYuMzU1LTExLjkxNiA2LjM1NS01LjU2MSAwLTExLjEyMi02LjM1NS01Ny4xOTgtNTcuMTk4LTE3Mi4zODgtMTcyLjM4OC04LjczOS04LjczOS0yMi4yNDQtOC43MzktMTQuMjk5IDAtMjMuODMyIDguNzM5LTQ2LjA3NiA0Ni4wNzYtMTM4LjIyOCAxMzcuNDM0LTE5LjA2NiAxOS4wNjYtNDYuODcgMTkuMDY2LTI3LjAxMCAwLTQ2Ljg3LTE5LjA2Ni03LjE1LTcuMTUtMjEuNDQ5LTIyLjI0NC05LjUzMy04LjczOS0yMy44MzItOC43MzktMTMuNTA1IDAtMjIuMjQ0IDguNzM5LTE5LjA2NiAxOS4wNjYtNTcuMTk4IDU3LjE5OC0xMS4xMjIgMTEuOTE2LTIzLjAzOCAwLTUuNTYxLTUuNTYxLTUuNTYxLTExLjEyMiAwLTUuNTYxIDUuNTYxLTExLjkxNiAxOS4wNjYtMTkuMDY2IDU3LjE5OC01Ny4xOTggMTkuMDY2LTE5LjA2NiA0Ni44Ny0xOS4wNjYgMjcuMDEwIDAgNDYuODcgMTkuMDY2IDcuMTUgNy4xNSAyMS40NDkgMjIuMjQ0IDguNzM5IDguNzM5IDIyLjI0NCA4LjczOSAxNC4yOTkgMCAyMy44MzItOC43MzkgNDUuMjgyLTQ2LjA3NiAxMzYuNjM5LTEzNy40MzQgMTkuODYtMTkuMDY2IDQ3LjY2NS0xOS4wNjYgMjcuMDEwIDAgNDYuMDc2IDE5LjA2NnoiIHAtaWQ9IjMxNzUiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPScjNDQ0NDQ0JyB0PSIxNjIwMjcyOTk5MzUwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTIwMCAtMjAwIDE0MjQgMTQyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMzYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiA2NTguMjg2YTIwMS4xNDMgMjAxLjE0MyAwIDAgMCAyMDEuMTQzLTIwMS4xNDNWMjU2YTIwMS4xNDMgMjAxLjE0MyAwIDAgMC00MDIuMjg2IDB2MjAxLjE0M0EyMDEuMTQzIDIwMS4xNDMgMCAwIDAgNTEyIDY1OC4yODZ6TTM2NS43MTQgMjU2YTE0Ni4yODYgMTQ2LjI4NiAwIDAgMSAyOTIuNTcyIDB2MjAxLjE0M2ExNDYuMjg2IDE0Ni4yODYgMCAwIDEtMjkyLjU3MiAweiIgcC1pZD0iMjAzNyIgZmlsbD0iIzY2NjY2NiI+PC9wYXRoPjxwYXRoIGQ9Ik04NDEuMTQzIDQ3NS40MjlhMjcuNDI5IDI3LjQyOSAwIDAgMC01NC44NTcgMCAyNTYgMjU2IDAgMCAxLTI1NiAyNTZoLTM2LjU3MmEyNTYgMjU2IDAgMCAxLTI1Ni0yNTYgMjcuNDI5IDI3LjQyOSAwIDAgMC01NC44NTcgMCAzMTAuODU3IDMxMC44NTcgMCAwIDAgMzAxLjcxNCAzMTAuODU3VjkzMi41N0gzNjUuNzE0YTI3LjQyOSAyNy40MjkgMCAwIDAgMCA1NC44NThoMjkyLjU3MmEyNy40MjkgMjcuNDI5IDAgMCAwIDAtNTQuODU4SDUzOS40MjlWNzg2LjI4NmEzMTAuODU3IDMxMC44NTcgMCAwIDAgMzAxLjcxNC0zMTAuODU3eiIgcC1pZD0iMjAzOCIgZmlsbD0iIzY2NjY2NiI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=t.stringToBlob=t.formatLogs=t.SPLITTER=void 0;var a,r=n(14),i=(a=r)&&a.__esModule?a:{default:a};var o=t.SPLITTER="*&(&(*&(&(&*(*&^&^$^%$($^%";t.formatLogs=function(e,t,n){for(var a=[],r="用户账号: "+n+", 房间ID: "+t+"\n\n",i=0;i<e.length;i++)e[i]&&(-1!==e[i].indexOf(o)&&a.length>0?(r+=a.join("\n")+"\n\n\n\n\n\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n\n\n",a=[]):a.push(e[i]));return a.length>0&&(r+=a.join("\n")+"\n\n"),r},t.stringToBlob=function(e,t){var n=new Blob([e],{type:"text/plain"});return n.lastModifiedDate=new Date,n.name=t,n},t.delay=function(e){return new i.default((function(t){setTimeout((function(){t()}),e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(47);var i=new((a=r)&&a.__esModule?a:{default:a}).default;t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLineStyle=u,t.setpixelated=l,t.setCavansStyleSize=function(e,t,n){var a=e.canvas;a.style.width=t+"px",a.style.height=n+"px"},t.setCanvasPropSize=function(e,t){var n=e.canvas,a=!1;0!=n.width&&0!=n.height||(a=!0);var r=document.createElement("canvas").getContext("2d");a||(r.canvas.width=n.width,r.canvas.height=n.height,l(r),u(r),r.drawImage(n,0,0,n.width,n.height));n.width=t.width,n.height=t.height,u(e),l(e),a||(l(r),e.drawImage(r.canvas,0,0,n.width,n.height))},t.applyCanvasLayout=function(e,t){var n=t.paddingLeft,a=t.paddingTop;e.style.left=n+"px",e.style.top=a+"px"},t.clearCtx=c,t.free=function(e,t,n,a,r,i){if(e.fillStyle=r,e.strokeStyle=r,e.beginPath(),t.x===a.x&&t.y===a.y)return void e.lineTo(t.x,t.y);e.moveTo(t.x,t.y),e.quadraticCurveTo(n.x,n.y,a.x,a.y),e.stroke(),s("free")},t.line=function(e,t,n,a){i.default.log("line",arguments),e.fillStyle=a,e.strokeStyle=a,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke(),s("line")},t.rect=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments[5];r?(e.fillStyle=i,e.fillRect(t.x,t.y,n,a)):e.strokeRect(t.x,t.y,n,a)},t.roundRect=function(e,t,n,a,r){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments[6],s=t.x,u=t.y,l=n<0?-r:r,c=a<0?-r:r;e.beginPath(),e.moveTo(s+l,u),e.lineTo(s+n-l,u),e.quadraticCurveTo(s+n,u,s+n,u+c),e.lineTo(s+n,u+a-c),e.quadraticCurveTo(s+n,u+a,s+n-l,u+a),e.lineTo(s+l,u+a),e.quadraticCurveTo(s,u+a,s,u+a-c),e.lineTo(s,u+c),e.quadraticCurveTo(s,u,s+l,u),e.stroke(),i&&(e.fillStyle=o,e.fill())},t.circle=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments[4];r&&(e.strokeStyle=r);e.beginPath(),e.arc(t.x,t.y,n,0,2*Math.PI),a&&(e.fillStyle=r,e.fill());e.stroke()},t.ellipse=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments[5];i&&(e.strokeStyle=i);e.beginPath(),e.ellipse(t.x,t.y,n,a,0,0,2*Math.PI),r&&(e.fillStyle=i,e.fill());e.stroke()},t.fill=function(e,t,n,r){var o=Math.round(t.x),s=Math.round(t.y);e.save(),e.beginPath();var p=e.getImageData(0,0,Math.round(e.canvas.width),Math.round(e.canvas.height)),h=p.height,f=p.width;r&&(r.ctx.canvas.width=f,r.ctx.canvas.height=h,l(r.ctx),u(r.ctx));var g=n||e.strokeStyle,v=parseInt(g.substr(1,2),16),y=parseInt(g.substr(3,2),16),m=(255<<24|parseInt(g.substr(5,2),16)<<16|y<<8|v)>>>0,M=[o,s],x=r.ctx.createImageData(f,h),w=new Uint32Array(x.data.buffer),I=new Uint32Array(p.data.buffer),b=I[s*f+o];if(0==(16777215&(b^m))&&b>>>24==m>>>24)return;var k=16777215&b,T=(255&k)>>>0,_=(65280&k)>>>8,C=(16711680&k)>>>16,N=(4278190080&b)>>>24,A=d(T-15),P=d(_-15),O=d(C-15),D=d(T+15),S=d(_+15),E=d(C+15),j=[M],L=void 0,z=f-1,R=h-1;function B(e){if(e===b)return!0;var t=(4278190080&e)>>>24;if(N<10&&0===t)return!0;var n=(16777215&e)>>>0,a=(255&n)>>>0,r=(65280&n)>>>8,i=(16711680&n)>>>16;return a>=A&&a<=D&&r>=P&&r<=S&&i>=O&&i<=E&&Math.abs(N-t)<10}var F={},Y=new a.Coord(Math.round(f),Math.round(h)),U=new a.Coord(0,0),W=function(e,t){return t*f+e},H=function(e,t){return I[W(e,t)]};for(;L=j.pop();){for(var Q=L[0],Z=L[1];--Z>=0&&B(H(Q,Z)););Z++;for(var G=!1,V=!1;Z++<R&&B(H(Q,Z));){Y.topLeft(Q,Z),U.bottomRight(Q+1,Z+1);var X=W(Q,Z);I[X]=m,w[X]=m,F[X]=!0,Q>0&&!F[X-1]&&(B(I[X-1])?G||(j.push([Q-1,Z]),G=!0):G&&(G=!1)),Q<z&&!F[X+1]&&(B(I[X+1])?V||(F[X+1]||j.push([Q+1,Z]),V=!0):V&&(V=!1))}}var J=a.Coord.areaSize(Y,U);i.default.log("fill area is ",J),i.default.log("fill corner is ",Y,U),r.corner=[Y,U],r.ctx.putImageData(x,0,0);var K=r.ctx.getImageData(Y.x,Y.y,J.width,J.height);i.default.log(K),r.ctx.canvas.height=K.height,r.ctx.canvas.width=K.width,l(r.ctx),u(r.ctx),r.ctx.putImageData(K,0,0),console.log("shape:",r.ctx.canvas.toDataURL()),c(e),i.default.image(e.canvas.toDataURL(),"ctx.canvas"),i.default.image(r.ctx.canvas.toDataURL(),"shape.ctx"),e.putImageData(p,0,0),console.error(r.ctx.canvas.toDataURL()),i.default.image(e.canvas.toDataURL(),"final"),r.ctx.beginPath(),e.restore()},t.text=function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments[5],o=t.x,s=t.y;e.beginPath(),e.moveTo(o,s),e.font=a+'px "微软雅黑",Arial',e.textBaseline="top",e.textAlign="left",r?(e.fillStyle=i,e.fillText(n,o,s)):e.strokeText(n,o,s);e.beginPath()};var a=n(264),r=o(n(262)),i=o(n(104));function o(e){return e&&e.__esModule?e:{default:e}}var s=(0,r.default)("DrawWorker/CanvasHelper");function u(e){e.lineCap="round",e.lineJoin="round"}function l(e){null!==e&&(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1)}function c(e){e.clearRect(-40,-40,e.canvas.width+80,e.canvas.height+80)}function d(e){return e<0?0:e>255?255:e}},,function(e,t,n){(function(e){var a=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},a=0;a<t.length;a++)n[t[a]]=Object.getOwnPropertyDescriptor(e,t[a]);return n},r=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var a=arguments,i=a.length,o=String(e).replace(r,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(a[n++]);case"%d":return Number(a[n++]);case"%j":try{return JSON.stringify(a[n++])}catch(e){return"[Circular]"}default:return e}})),u=a[n];n<i;u=a[++n])g(u)||!x(u)?o+=" "+u:o+=" "+s(u);return o},t.deprecate=function(n,a){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,a).apply(this,arguments)};var r=!1;return function(){if(!r){if(e.throwDeprecation)throw new Error(a);e.traceDeprecation?console.trace(a):console.error(a),r=!0}return n.apply(this,arguments)}};var i,o={};function s(e,n){var a={seen:[],stylize:l};return arguments.length>=3&&(a.depth=arguments[2]),arguments.length>=4&&(a.colors=arguments[3]),f(n)?a.showHidden=n:n&&t._extend(a,n),m(a.showHidden)&&(a.showHidden=!1),m(a.depth)&&(a.depth=2),m(a.colors)&&(a.colors=!1),m(a.customInspect)&&(a.customInspect=!0),a.colors&&(a.stylize=u),c(a,e,a.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function l(e,t){return e}function c(e,n,a){if(e.customInspect&&n&&b(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(a,e);return y(r)||(r=c(e,r,a)),r}var i=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(v(t))return e.stylize(""+t,"number");if(f(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,n);if(i)return i;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),I(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return d(n);if(0===o.length){if(b(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(M(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(I(n))return d(n)}var l,x="",k=!1,T=["{","}"];(h(n)&&(k=!0,T=["[","]"]),b(n))&&(x=" [Function"+(n.name?": "+n.name:"")+"]");return M(n)&&(x=" "+RegExp.prototype.toString.call(n)),w(n)&&(x=" "+Date.prototype.toUTCString.call(n)),I(n)&&(x=" "+d(n)),0!==o.length||k&&0!=n.length?a<0?M(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),l=k?function(e,t,n,a,r){for(var i=[],o=0,s=t.length;o<s;++o)N(t,String(o))?i.push(p(e,t,n,a,String(o),!0)):i.push("");return r.forEach((function(r){r.match(/^\d+$/)||i.push(p(e,t,n,a,r,!0))})),i}(e,n,a,s,o):o.map((function(t){return p(e,n,a,s,t,k)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(l,x,T)):T[0]+x+T[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,a,r,i){var o,s,u;if((u=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),N(a,r)||(o="["+r+"]"),s||(e.seen.indexOf(u.value)<0?(s=g(n)?c(e,u.value,null):c(e,u.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),m(o)){if(i&&r.match(/^\d+$/))return s;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function h(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function g(e){return null===e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function m(e){return void 0===e}function M(e){return x(e)&&"[object RegExp]"===k(e)}function x(e){return"object"==typeof e&&null!==e}function w(e){return x(e)&&"[object Date]"===k(e)}function I(e){return x(e)&&("[object Error]"===k(e)||e instanceof Error)}function b(e){return"function"==typeof e}function k(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(m(i)&&(i=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(i)){var a=e.pid;o[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,a,e)}}else o[n]=function(){};return o[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=f,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=y,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=M,t.isObject=x,t.isDate=w,t.isError=I,t.isFunction=b,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(276);var _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(){var e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":");return[e.getDate(),_[e.getMonth()],t].join(" ")}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",C(),t.format.apply(t,arguments))},t.inherits=n(277),t._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),a=n.length;a--;)e[n[a]]=t[n[a]];return e};var A="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(A&&e[A]){var t;if("function"!=typeof(t=e[A]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,A,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,a=new Promise((function(e,a){t=e,n=a})),r=[],i=0;i<arguments.length;i++)r.push(arguments[i]);r.push((function(e,a){e?n(e):t(a)}));try{e.apply(this,r)}catch(e){n(e)}return a}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),A&&Object.defineProperty(t,A,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,a(e))},t.promisify.custom=A,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],a=0;a<arguments.length;a++)n.push(arguments[a]);var r=n.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var i=this,o=function(){return r.apply(i,arguments)};t.apply(this,n).then((function(t){e.nextTick(o,null,t)}),(function(t){e.nextTick(P,t,o)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,a(t)),n}}).call(this,n(155))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0;var a,r=n(14),i=(a=r)&&a.__esModule?a:{default:a};t.delay=function(e){return new i.default((function(t){setTimeout((function(){t()}),e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSONStringify=void 0;var a=o(n(18)),r=o(n(22)),i=o(n(27));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return"[object Number]"==Object.prototype.toString.call(e)}function u(e){return"[object String]"==Object.prototype.toString.call(e)}function l(e){return"[object Array]"==Object.prototype.toString.call(e)}function c(e){return"[object Boolean]"==Object.prototype.toString.call(e)}function d(e){return void 0===e}function p(e){return null===e}function h(e){return"[object Symbol]"==Object.prototype.toString.call(e)}function f(e){return!("[object Object]"!=Object.prototype.toString.call(e)&&(s(e)||u(e)||c(e)||l(e)||p(e)||g(e)||d(e)||h(e)))}function g(e){return"[object Function]"==Object.prototype.toString.call(e)}function v(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,i.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,i.default)(e))&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function y(e){var t=Object.prototype.toString.call(e);return"[object global]"==t||"[object Window]"==t||"[object DOMWindow]"==t}t.getDate=function(e){var t=e>0?new Date(e):new Date,n=t.getDate()<10?"0"+t.getDate():t.getDate(),a=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getFullYear(),i=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),s=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),u=t.getMilliseconds()<10?"0"+t.getMilliseconds():t.getMilliseconds();u<100&&(u="0"+u);return{time:+t,year:r,month:a,day:n,hour:i,minute:o,second:s,millisecond:u}},t.isNumber=s,t.isString=u,t.isArray=l,t.isBoolean=c,t.isUndefined=d,t.isNull=p,t.isSymbol=h,t.isObject=f,t.isFunction=g,t.isElement=v,t.isWindow=y,t.isPlainObject=function(e){var t=Object.prototype.hasOwnProperty;if(!e||"object"!==(void 0===e?"undefined":(0,i.default)(e))||e.nodeType||y(e))return!1;try{if(e.constructor&&!t.call(e,"constructor")&&!t.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var n=void 0;for(n in e);return void 0===n||t.call(e,n)},t.getObjAllKeys=function(e){if(!f(e)&&!l(e))return[];var t=[];for(var n in e)t.push(n);return t.sort()},t.getObjName=function(e){return Object.prototype.toString.call(e).replace("[object ","").replace("]","")},t.setStorage=function(e,t){if(!window.localStorage)return;e="vConsole_"+e,localStorage.setItem(e,t)},t.getStorage=function(e){if(!window.localStorage)return;return e="vConsole_"+e,localStorage.getItem(e)};t.JSONStringify=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if("function"==typeof t)return"[Function]";if(f(t)||Array.isArray(t)){if(v(t))return"[HTML Element]";if(m(t))return"[NIM Object]"}else try{return(0,r.default)(t)}catch(e){return""}var o="{",s="}";if(Array.isArray(t)&&(o="[",s="]"),n<1)return"typeof ["+(void 0===t?"undefined":(0,i.default)(t))+"]";var u=(0,a.default)(t);return o+u.map((function(a){return a+": "+e(t[a],n-1)})).join(",")+s};function m(e){return e&&("im"===e.subType||e.__isNimWhiteboard__)}},function(e,t,n){(function(t){void 0===t||"renderer"===t.type||!0===t.browser||t.__nwjs?e.exports=n(507):e.exports=n(509)}).call(this,n(155))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.packBulk=function(e){var t=e.map((function(e){return u(e)})).join(";")+";";return i.default.m.syncmanager("packBulk anyAction",t),t},t.pack=u,t.unpackBulk=function(e){var t=[];return e.split(";").forEach((function(e){var n=l(e);n&&t.push(n)})),t},t.unpack=l;var a,r=n(104),i=(a=r)&&a.__esModule?a:{default:a},o=n(150),s=n(151);function u(e,t){return i.default.m.syncmanager("pack anyAction",e),console.assert(void 0!==e.action,"ooops"),e.action.toString()}function l(e){if(e){var t=e.indexOf(":");i.default.m.syncmanager("unpack command ",e);var n=void 0,a=void 0;switch(-1==t?(n=+e,a=""):(n=+e.slice(0,t),a=e.slice(t+1,e.length)),i.default.command("unpack",e),n){case o.WActions.START:return s.StartAction.fromString(a);case o.WActions.MOVE:return s.MoveAction.fromString(a);case o.WActions.END:return s.EndAction.fromString(a);case o.WActions.REVOKE:return s.RevokeAction.fromString(a);case o.WActions.SERIAL:return s.SerialAction.fromString(a);case o.WActions.CLEAR:return s.ClearAction.fromString(a);case o.WActions.CLEAR_ACK:return s.ClearAckAction.fromString(a);case o.WActions.LASER_PEN:return s.LaserPenAction.fromString(a);case o.WActions.SYNC_REQUEST:return s.SyncRequestAction.fromString(a);case o.WActions.SYNC:return s.SyncAction.fromString(a);case o.WActions.SYNC_PREPARE:return s.SyncPrepareAction.fromString(a);case o.WActions.SYNC_PREPARE_ACK:return s.SyncPrepareAckAction.fromString(a);case o.WActions.LASER_PEN_END:return s.LaserPenEndAction.fromString(a);case o.WActions.FILE:return s.FileAction.fromString(a);case o.WActions.REDO:return s.RedoAction.fromString(a);case o.WActions.CALIBRATE:return s.CalibrateAction.fromString(a);case o.WActions.TEXT:return s.TextAction.fromString(a);case o.WActions.VERSION:return s.VersionAction.fromString(a);default:}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Coord=void 0;var a=i(n(0)),r=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var o=/\(x:([.\d]+),y:([.\d]+)\)/,s=function(){function e(t,n){(0,a.default)(this,e),this.x=t||0,this.y=n||0}return(0,r.default)(e,[{key:"destroy",value:function(){}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toString",value:function(){return"(x:"+this.x.toFixed(8)+",y:"+this.y.toFixed(8)+")"}},{key:"toCoord",value:function(e,t){return new u(this.x*e,this.y*t)}},{key:"copy",value:function(e){this.x=e.x,this.y=e.y}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"topLeft",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t<this.x&&(this.x=t),n<this.y&&(this.y=n)):t instanceof e&&this.topLeft(t.x,t.y),this}},{key:"bottomRight",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t>this.x&&(this.x=t),n>this.y&&(this.y=n)):t instanceof e&&this.bottomRight(t.x,t.y),this}}],[{key:"fromString",value:function(t){var n=o.exec(t);return n?new e(+n[1],+n[2]):new e(0,0)}},{key:"middle",value:function(t,n){return new e((t.x+n.x)/2,(t.y+n.y)/2)}},{key:"areaSize",value:function(e,t){return{width:Math.ceil(Math.abs(e.x-t.x)),height:Math.ceil(Math.abs(e.y-t.y))}}},{key:"clone",value:function(t){return new e(t.x,t.y)}}]),e}();t.default=s;var u=t.Coord=function(){function e(t,n){(0,a.default)(this,e),this.x=t,this.y=n}return(0,r.default)(e,[{key:"destroy",value:function(){}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toPoint",value:function(e,t){return new s(this.x/e,this.y/t)}},{key:"copy",value:function(e){this.x=e.x,this.y=e.y}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"topLeft",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t<this.x&&(this.x=t),n<this.y&&(this.y=n)):t instanceof e&&this.topLeft(t.x,t.y),this}},{key:"bottomRight",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t>this.x&&(this.x=t),n>this.y&&(this.y=n)):t instanceof e&&this.bottomRight(t.x,t.y),this}}],[{key:"fromString",value:function(t,n,a){var r=o.exec(t);return r?new e(Math.round(+r[1]*n),Math.round(+r[2]*a)):new e(0,0)}},{key:"middle",value:function(t,n){return new e((t.x+n.x)/2,(t.y+n.y)/2)}},{key:"areaSize",value:function(e,t){return{width:Math.ceil(Math.abs(e.x-t.x)),height:Math.ceil(Math.abs(e.y-t.y))}}},{key:"clone",value:function(t){return new e(t.x,t.y)}}]),e}()},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.App=void 0;var _regenerator=__webpack_require__(28),_regenerator2=_interopRequireDefault(_regenerator),_keys=__webpack_require__(18),_keys2=_interopRequireDefault(_keys),_typeof2=__webpack_require__(27),_typeof3=_interopRequireDefault(_typeof2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_getIterator2=__webpack_require__(7),_getIterator3=_interopRequireDefault(_getIterator2),_stringify=__webpack_require__(22),_stringify2=_interopRequireDefault(_stringify),_set=__webpack_require__(37),_set2=_interopRequireDefault(_set),_classCallCheck2=__webpack_require__(0),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(1),_createClass3=_interopRequireDefault(_createClass2),_promise=__webpack_require__(14),_promise2=_interopRequireDefault(_promise),_container=__webpack_require__(106),_container2=_interopRequireDefault(_container),_OpsManager=__webpack_require__(273),_OpsManager2=_interopRequireDefault(_OpsManager),_dispatcher2=__webpack_require__(146),_dispatcher3=_interopRequireDefault(_dispatcher2),_room=__webpack_require__(354),_room2=_interopRequireDefault(_room),_dataHub=__webpack_require__(218),_dataHub2=_interopRequireDefault(_dataHub),_types=__webpack_require__(97),_previewFactory=__webpack_require__(358),_previewFactory2=_interopRequireDefault(_previewFactory),_config=__webpack_require__(235),_config2=_interopRequireDefault(_config),_camera=__webpack_require__(359),_camera2=_interopRequireDefault(_camera),_validate=__webpack_require__(246),_validate2=_interopRequireDefault(_validate),_player=__webpack_require__(360),_player2=_interopRequireDefault(_player),_simulator=__webpack_require__(361),_simulator2=_interopRequireDefault(_simulator),_vision=__webpack_require__(362),_vision2=_interopRequireDefault(_vision),_toast=__webpack_require__(31),_util=__webpack_require__(247),_isBase=__webpack_require__(363),_isBase2=_interopRequireDefault(_isBase),_textConfig=__webpack_require__(364),_textConfig2=_interopRequireDefault(_textConfig),_globalVar=__webpack_require__(103),_constant=__webpack_require__(33),_constant2=_interopRequireDefault(_constant),_dataReport=__webpack_require__(76),_dataReport2=_interopRequireDefault(_dataReport),_aliveManager=__webpack_require__(365),_aliveManager2=_interopRequireDefault(_aliveManager),_instance=__webpack_require__(366),_instance2=_interopRequireDefault(_instance),_delay=__webpack_require__(260),_ShapeSelector=__webpack_require__(445),_ShapeSelector2=_interopRequireDefault(_ShapeSelector),_resourceCache=__webpack_require__(446),_resourceCache2=_interopRequireDefault(_resourceCache),_shapeManager=__webpack_require__(449),_shapeManager2=_interopRequireDefault(_shapeManager),_drawConfig=__webpack_require__(23),_drawConfig2=_interopRequireDefault(_drawConfig),_util2=__webpack_require__(135);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __awaiter=function(e,t,n,a){return new(n||(n=_promise2.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},App=function(){function App(e){var t,n,a,r,i,o,s,u,l,c;if((0,_classCallCheck3.default)(this,App),this.PluginType=_types.PluginType,this.isRecordPlayer=!1,this.editEnabled=!1,this.showCursor=!1,this.isConnected=!1,this.floatToolbar=null,this.zoomTo1AfterJoin=!0,this.reportedError=new _set2.default,this.sessionId=e.sessionId||"",this.account=e.account,this.nickname=e.nickname?e.nickname:e.account,this.platform=e.platform,this.appkey=e.appkey,this.logger=e.logger,this.isG1=e.isG1,this.serviceConf=e.serviceConf,this.ntpTimeDiff=e.ntpTimeDiff?e.ntpTimeDiff:0,this.uid=Number(e.uid),!isNaN(Number(null===(t=e.cameraBound)||void 0===t?void 0:t.centerX))&&!isNaN(Number(null===(n=e.cameraBound)||void 0===n?void 0:n.centerY))&&!isNaN(Number(null===(a=e.cameraBound)||void 0===a?void 0:a.width))&&!isNaN(Number(null===(r=e.cameraBound)||void 0===r?void 0:r.height))&&Number(null===(i=e.cameraBound)||void 0===i?void 0:i.width)>0&&Number(null===(o=e.cameraBound)||void 0===o?void 0:o.height)>0?this.defaultCameraBound={centerX:Number(null===(s=e.cameraBound)||void 0===s?void 0:s.centerX),centerY:Number(null===(u=e.cameraBound)||void 0===u?void 0:u.centerY),width:Number(null===(l=e.cameraBound)||void 0===l?void 0:l.width),height:Number(null===(c=e.cameraBound)||void 0===c?void 0:c.height)}:e.cameraBound&&this.logger.error("[白板] 初始坐标系存在问题",(0,_stringify2.default)(e.cameraBound)),this.zoomTo1AfterJoin=void 0===e.zoomTo1AfterJoin||!0===e.zoomTo1AfterJoin,this.nim=e.nim,this.resourceCache=new _resourceCache2.default(this),this.simulator=new _simulator2.default(this),this.shapeManager=new _shapeManager2.default(this),this.configInstance=new _config2.default(this),this.dispatcher=new _dispatcher3.default,this.opsManager=new _OpsManager2.default(this),this.opsManager.extendDefaultOps(),this.dataHub=new _dataHub2.default(this,e.connector),this.shapeSelector=new _ShapeSelector2.default(this),this.container=new _container2.default(this),this.room=new _room2.default(this,this.dataHub),this.container.addOpsManager(this.opsManager),this.opsManager.addContainer(this.container),this.camera=new _camera2.default(this,this.defaultCameraBound),this.vision=new _vision2.default(this),this.textConfig=new _textConfig2.default(this),Array.isArray(e.pluginDefArr)){var d=!0,p=!1,h=void 0;try{for(var f,g=(0,_getIterator3.default)(e.pluginDefArr);!(d=(f=g.next()).done);d=!0){var v=f.value;this.definePlugin(v)}}catch(e){p=!0,h=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw h}}}this.isRecordPlayer=!!e.isRecordPlayer,e.isRecordPlayer||(this.previewFactory=new _previewFactory2.default(this)),this.aliveManager=new _aliveManager2.default(this),e.isRecordPlayer&&(this.player=new _player2.default(this)),e.container&&this.setContainer(e.container),_drawConfig2.default.init(),!1===e.cacheUploadDocs&&this.setAppConfig({cacheUploadDocs:!1})}return(0,_createClass3.default)(App,[{key:"getStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _validate2.default.validate(this.logger,"container.getStream",e,{width:{isRequire:!1,type:"number"},keepDPI:{isRequire:!1,type:"boolean"}}),this.container.getStream(e,!0)}},{key:"updateStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _validate2.default.validate(this.logger,"container.updateStream",e,{width:{isRequire:!1,type:"number"},keepDPI:{isRequire:!1,type:"boolean"}}),this.container.getStream(e,!1)}},{key:"stopStream",value:function(){this.container.stopStream()}},{key:"getStrokeWidth",value:function(){return this.logger.error("[白板] getStrokeWidth已废弃，请使用getDefStyles")}},{key:"getOpacity",value:function(){return this.logger.error("[白板] getOpacity已废弃，请使用getDefStyles")}},{key:"getColor",value:function(){return this.logger.error("[白板] getColor已废弃，请使用getDefStyles")}},{key:"getDefStyles",value:function(){return _drawConfig2.default.getDefStyles()}},{key:"getRedoCount",value:function(){return this.opsManager.opMap.redo.getCount()}},{key:"getUndoCount",value:function(){return this.opsManager.opMap.undo.getCount()}},{key:"isClearAvailable",value:function(){return this.opsManager.opMap.clear.isAvailable()}},{key:"getSelectedIds",value:function(){return this.opsManager.opMap.select.getSelectedIds()}},{key:"getPageElementInfos",value:function(){var e=this.room.currBoard.currPage.drawOpQueue,t=this.room.currBoard.currPage.hiddenOpQueue,n=[];for(var a in e)n.push({id:a,type:e[a].data.type,visible:!0});for(var r in t)n.push({id:r,type:t[r].data.type,visible:!1});return n}},{key:"getZoomFactor",value:function(){return this.camera.zoomFactor}},{key:"getCameraBound",value:function(){return this.camera.getContainerWorldRect()}},{key:"getVisionState",value:function(){return{mode:this.vision.mode,broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}},{key:"getCoordInWorld",value:function(e){var t=e.x,n=e.y;return"ratio"===e.type&&(t=this.container.width*t,n=this.container.height*n),this.camera.convertToPointInWorld(t,n)}},{key:"setAppConfig",value:function(e){this.configInstance.setAppConfig(e)}},{key:"setContainer",value:function(e){var t;this.logger.log("set container"),e.innerHTML="",this.container.appendTo(e),null===(t=this.previewFactory)||void 0===t||t.reset(),this.isRecordPlayer||this.setFloatToolbar(e)}},{key:"setFloatToolbar",value:function(e){var t=this;_promise2.default.resolve().then((function(){t.floatToolbar=_instance2.default.getInstance({container:e,drawPlugin:t})}))}},{key:"updateContainerAfterResize",value:function(){this.container.resize()}},{key:"readyToSyncData",value:function(){document.body.style.cursor="auto",this.dataHub.sendSyncRequest()}},{key:"stopSyncData",value:function(){_globalVar.LOG&&this.logger.log("[白板]","drawPlugin.stopSyncData"),this.dataHub.stopSyncRequest()}},{key:"setIsConnected",value:function(e){this.logger.warn("[白板] drawPlugin.setIsConnected",e),this.isConnected=e,this.isConnected||(document.body.style.cursor="auto")}},{key:"resetState",value:function(){var e;this.logger.log("[白板] resetState"),this.room.reset(),this.dataHub.reset(),this.opsManager.destroy(),this.resourceCache.destroy(),null===(e=this.previewFactory)||void 0===e||e.reset(),this.shapeSelector.destroy()}},{key:"addImage",value:function(e){this.logger.log("[白板]","drawPlugin.addImage",e),_validate2.default.validate(this.logger,"drawPlugin.addImage",e,{url:{type:"string",isRequire:!0}});var t=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;(0,_isBase2.default)(e.url)||(0,_isBase2.default)(e.url,{allowMime:!0})?(0,_util.uploadAndAddImg)(this,{dataURL:e.url,fileName:"img.png"},{pageName:t,boardName:e.boardName}):e.url.length>1e4?this.logger.error("[白板]","drawPlugin.addImage opt.url长度不应该大于10000"):this.emit("op:image:upload",e.url,{pageName:t,boardName:e.boardName})}},{key:"addVideo",value:function(e){this.logger.log("[白板]","drawPlugin.addVideo",e),_validate2.default.validate(this.logger,"drawPlugin.addVideo",e,{url:{type:"string",isRequire:!0},sourceType:{type:"string",isRequire:!0},title:{type:"string"}});var t=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;if(!this.hasMediaOnPage(!0,e.boardName,t)){var n=e.sourceType.startsWith("video/")?e.sourceType:"video/"+e.sourceType;this.emit("op:video:insert",e.url,{title:e.title,sourceType:n,pageName:t,boardName:e.boardName})}}},{key:"hasMediaOnPage",value:function(e,t,n){var a=this.room.getPageWithFallback(t,n);return!(!a||!a.hasMedia("audio")&&!a.hasMedia("video"))&&(this.logger.warn("[白板] 同一页白板中仅允许插入一个音视频"),e&&(0,_toast.showToast)({msg:"只允许同时放置一个音视频插件",type:"warn",time:3,msgType:_constant2.default.ONE_MEDIA_LIMIT}),!0)}},{key:"addAudio",value:function(e){this.logger.log("[白板]","drawPlugin.addAudio",e),_validate2.default.validate(this.logger,"drawPlugin.addAudio",e,{url:{type:"string",isRequire:!0},sourceType:{type:"string",isRequire:!0},title:{type:"string"}});var t=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;if(!this.hasMediaOnPage(!0,e.boardName,t)){var n=e.sourceType.startsWith("audio/")?e.sourceType:"audio/"+e.sourceType;this.emit("op:audio:insert",e.url,{title:e.title,sourceType:n,pageName:t,boardName:e.boardName})}}},{key:"setPageBackground",value:function(e){this.logger.log("[白板]","drawPlugin.setPageBackground",e),_validate2.default.validate(this.logger,"drawPlugin.setPageBackground",e,{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});var t=this.room.getPageNameFromIndex(e.boardName,e.pageIndex);this.emit("op:background:imageUpload",e.url,{width:e.width,height:e.height,pageName:t,boardName:e.boardName})}},{key:"hasBackground",value:function(e){return(e=e||this.room.currBoard.currPage).backgroundSnapshot||null!==e.getAnimPageIndex()}},{key:"hasTransDoc",value:function(){return void 0!==this.room.currBoard.transDocSnapshot}},{key:"hasDoc",value:function(e){return(e=e||this.room.currBoard).hasDoc}},{key:"addTransDoc",value:function(e){this.logger.log("[白板]","drawPlugin.addTransDoc",e);var t=e.docName+"_"+(new Date).valueOf(),n=(0,_assign2.default)({},e,{displayName:e.docName,boardName:t});return this.emit("op:transDoc:add",n),t}},{key:"addDoc",value:function(e){return Array.isArray(e.params)?this._addDocByUrlArray(e):this._addDocByUrlTemplate(e)}},{key:"_addDocByUrlArray",value:function(e){this.logger.log("[白板]","drawPlugin.addDoc",e),_validate2.default.validate(this.logger,"drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0},params:{type:"array",isRequire:!0}});for(var t=0;t<e.params.length;t++)_validate2.default.validate(this.logger,"drawPlugin.addDoc opt.params["+t+"]",e.params[t],{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});if(0===e.params.length)throw new Error("addDoc参数中params的数组长度必须大于0");for(var n=e.docName,a=e.params,r=this.addBoard(n,a.length),i=0;i<a.length;i++)this.setPageBackground({url:a[i].url,width:a[i].width,height:a[i].height,pageIndex:i,boardName:r});return r}},{key:"_addDocByUrlTemplate",value:function(e){if(this.logger.log("[白板]","drawPlugin.addDoc",e),_validate2.default.validate(this.logger,"drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0}}),_validate2.default.validate(this.logger,"drawPlugin.addDoc opt.params",e.params,{template:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0},pageCount:{type:"number",isRequire:!0},offset:{type:"number",isRequire:!0}}),e.params.pageCount<=0)throw new Error("addDoc参数中params.pageCount必须大于0");var t=e.docName,n=e.params,a=t+"_"+(new Date).valueOf();return this.emit("op:board:add",t,a,n.pageCount,{width:e.params.width,height:e.params.height,template:e.params.template,offset:e.params.offset,backupResultUrls:e.params.backupResultUrls}),a}},{key:"setCustomBackground",value:function setCustomBackground(coordinate,customFn,bgName){if("string"==typeof customFn)try{customFn=eval(customFn)}catch(e){return void this.logger.error("setCustomBackground的参数应该为函数，或者函数的字符串表达",e)}"function"==typeof customFn&&"world"===coordinate?(this.bgRenderWorld=customFn,this.bgRenderContainer=void 0,this.bgRenderName=bgName):"function"==typeof customFn&&"container"===coordinate?(this.bgRenderWorld=void 0,this.bgRenderContainer=customFn,this.bgRenderName=bgName):this.logger.error("setCustomBackground第一个参数为函数，第二个参数为world或者container"),this.room.refresh()}},{key:"unsetCustomBackground",value:function(){this.bgRenderContainer=void 0,this.bgRenderWorld=void 0,this.bgRenderName=void 0,this.room.refresh()}},{key:"getBgRendererName",value:function(){return this.bgRenderName}},{key:"setTool",value:function(e){this.emit("op:activate",e)}},{key:"setFontFamilies",value:function(e){Array.isArray(e)&&0!==e.length||this.logger.error("[白板]","drawPlugin.setFontFamilies参数必须为数组，且数组长度必须大于0"),this.textConfig.setFontFamilies(e)}},{key:"getFontFamilies",value:function(){return this.textConfig.getFontFamilies()}},{key:"setFontFamily",value:function(e){return this.logger.error("[白板]","drawPlugin.setFontFamily已废弃，请使用setFontFamilies")}},{key:"setColor",value:function(e){this.logger.log("[白板]","drawPlugin.setColor",e),this.setStrokeColor("link",e),this.setStrokeColor("pen",e),this.setStrokeColor("shape",e)}},{key:"setStrokeColor",value:function(e,t){if(this.logger.log("[白板]","drawPlugin.setStrokeColor",e,t),-1===["link","shape","pen"].indexOf(e))return this.logger.error("[白板] setStrokeColor参数type只能是link, shape, pen");"link"===e?_drawConfig2.default.linkDef.stroke=t:"shape"===e?_drawConfig2.default.shapeDef.stroke=t:"pen"===e&&(_drawConfig2.default.penDef.stroke=t),_drawConfig2.default.notify(this)}},{key:"setStrokeWidth",value:function(e,t){if(this.logger.log("[白板]","drawPlugin.setStrokeWidth",e,t),-1===["link","shape","pen"].indexOf(e))return this.logger.error("[白板] setStrokeWidth参数type只能是link, shape, pen");"link"===e?_drawConfig2.default.linkDef.lineWidth=t:"shape"===e?_drawConfig2.default.shapeDef.lineWidth=t:"pen"===e&&(_drawConfig2.default.penDef.lineWidth=t),_drawConfig2.default.notify(this)}},{key:"setOpacity",value:function(e){}},{key:"setShowCursor",value:function(e){this.logger.log("[白板]","drawPlugin.setShowCursor",e),this.showCursor=e}},{key:"enableDraw",value:function(e){this.logger.log("[白板]","drawPlugin.enableDraw",e),_validate2.default.validate(this.logger,"drawPlugin.enableDraw",{editEnabled:e},{editEnabled:{type:"boolean",isRequire:!0}}),this.editEnabled!==e&&(e||(document.body.style.cursor="auto"),this.editEnabled=e,this.opsManager.hooks.enableDrawChange.call(e),this.emit("event:editable:change",this.editable))}},{key:"enableCameraTransform",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.enableCameraTransform",e),this.setAppConfig({cameraTransformEnabled:e})}},{key:"resetCamera",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.resetCamera"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:reset-camera:exec",e)}},{key:"setCameraBound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.logger.log("[白板]","drawPlugin.setCameraBound boundary: ",(0,_stringify2.default)(e),"animate: ",t);var n=_validate2.default.validate(this.logger,"drawPlugin.setCameraBound",e,{centerX:{type:"number",isRequire:!0},centerY:{type:"number",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});n&&this.emit("op:camera-bound:send",e,t)}},{key:"fitToContent",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.fitToContent"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:fit-to-content:exec",e)}},{key:"fitToDoc",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.fitToDoc"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:fit-to-doc:exec",e)}},{key:"zoomIn",value:function(){this.logger.log("[白板]","drawPlugin.zoomIn"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:in")}},{key:"zoomOut",value:function(){this.logger.log("[白板]","drawPlugin.zoomOut"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:out")}},{key:"zoomTo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.logger.log("[白板]","drawPlugin.zoomTo: ",e," animate: ",t),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:to",e,t)}},{key:"lockCameraWithContent",value:function(e){this.camera.lockCameraWithContent(e)}},{key:"unlockCameraWithContent",value:function(){this.camera.unlockCameraWithContent()}},{key:"rotateElement",value:function(e){_validate2.default.validate(this.logger,"drawPlugin.rotateElement",e,{id:{type:"string",isRequire:!0},angle:{type:"number",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.rotateElement"),this.emit("op:rotate:ele",e.id,e.angle)}},{key:"setElementsVisibility",value:function(e){return this.logger.log("[白板]","drawPlugin.setElementsVisibility",e),e&&"object"===(void 0===e?"undefined":(0,_typeof3.default)(e))?void 0===e.ids||Array.isArray(e.ids)&&0!==e.ids.length?"boolean"!=typeof e.visible?this.logger.error("[白板] drawPlugin.setElementsVisibility参数opt.visible必须为布尔值，实际参数为: ",e):void this.emit("op:visible:eles",e.ids,e.visible):this.logger.error("[白板] drawPlugin.setElementsVisibility参数opt.ids必须为undefined或者为长度大于1的数组，实际参数为: ",e):this.logger.error("[白板] drawPlugin.setElementsVisibility必须提供如下参数类型opt: {ids: string[] | undefined, visible: boolean}，实际参数为: ",e)}},{key:"undo",value:function(){this.logger.log("[白板]","drawPlugin.undo"),this.emit("op:undo:exec")}},{key:"redo",value:function(){this.logger.log("[白板]","drawPlugin.redo"),this.emit("op:redo:exec")}},{key:"clear",value:function(){this.logger.log("[白板]","drawPlugin.clear"),this.emit("op:clear:exec")}},{key:"duplicate",value:function(){this.logger.log("[白板]","drawPlugin.duplicate"),this.emit("op:duplicate:exec")}},{key:"deleteSelectedElements",value:function(){this.logger.log("[白板]","drawPlugin.deleteSelectedElements"),this.emit("op:delete:exec")}},{key:"deleteElementByOpIds",value:function(e){this.logger.log("[白板]","drawPlugin.deleteElementByOpIds",e),this.emit("op:delete:deleteOps",e)}},{key:"addPage",value:function(e){"object"===(void 0===e?"undefined":(0,_typeof3.default)(e))?this.logger.log("[白板]","drawPlugin.addPage",(0,_stringify2.default)(e)):this.logger.log("[白板]","drawPlugin.addPage, insertAfter",e),"number"==typeof e?e={insertAfter:e}:e||(e={}),this.emit("op:page:add",e)}},{key:"deletePage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);this.logger.log("[白板]","drawPlugin.deletePage: ",e,"builtInIndex",t),this.emit("op:page:delete",t)}},{key:"gotoPage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);this.logger.log("[白板]","drawPlugin.gotoPage: ",e,"buildInIndex",t),isNaN(t)?this.logger.error("[白板] 第"+(e+1)+"不存在，当前文档内的页面总数为: "+this.room.currBoard.pageNames.length):this.emit("op:page:goto",t)}},{key:"gotoFirstPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoFirstPage"),this.room.currBoard.getCurrPageIndex()>0&&this.gotoPage(0)}},{key:"gotoPrevPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoPrevPage");var e=this.room.currBoard.getCurrPageIndex();e>0&&this.gotoPage(e-1)}},{key:"gotoNextPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoNextPage");var e=this.room.currBoard,t=e.getCurrPageIndex();t<e.pageNames.length-1&&this.gotoPage(t+1)}},{key:"gotoLastPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoLastPage");var e=this.room.currBoard;e.getCurrPageIndex()<e.pageNames.length-1&&this.gotoPage(e.pageNames.length-1)}},{key:"gotoAnim",value:function(e){if(!this.hasTransDoc())return this.logger.error("[白板] drawPlugin.gotoAnim调用时，当前文档不是动态文档");this.logger.log("[白板] drawPlugin.gotoAnim",e),this.emit("op:transDoc:gotoAnim",e)}},{key:"nextAnim",value:function(){this.logger.log("[白板] drawPlugin.nextAnim"),this.emit("op:transDoc:nextAnim")}},{key:"prevAnim",value:function(){this.logger.log("[白板] drawPlugin.prevAnim"),this.emit("op:transDoc:prevAnim")}},{key:"gotoBoard",value:function(e){_validate2.default.validate(this.logger,"drawPlugin.gotoBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.gotoBoard:",e),this.emit("op:board:goto",e)}},{key:"addBoard",value:function(e,t){_validate2.default.validate(this.logger,"drawPlugin.addBoard",{displayName:e},{displayName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.addBoard, displayName:",e," pageCount:",t);var n=e+"_"+(new Date).valueOf();return this.emit("op:board:add",e,n,t),n}},{key:"deleteBoard",value:function(e){_validate2.default.validate(this.logger,"drawPlugin.deleteBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.deleteBoard: ",e),this.emit("op:board:delete",e)}},{key:"getAnimInfos",value:function(){var e=this.opsManager.opMap.transDoc.getPluginOfCurrBoard();if(e){var t=e.data;return t&&null!==t.animPageIndex?{pageIndex:e.data.animPageIndex,animIndex:e.data.animIndex,animState:e.data.animState}:null}return null}},{key:"getPageInfos",value:function(e){var t=e?this.room.boards[e]:this.room.currBoard;return{pageNames:(t=t||this.room.currBoard).pageNames.slice(),currPage:t.currIndex,activeIndex:t.getCurrPageIndex(),pagePayloads:t.payloadOfPages}}},{key:"getBoardInfos",value:function(){return{boardNames:(0,_keys2.default)(this.room.boards),currBoard:this.room.currIndex,currBoardDisplayName:this.room.currBoard.displayName,boardDisplayNames:this.room.getBoardDisplayNames()}}},{key:"bindPreviewContainer",value:function(e){var t;null===(t=this.previewFactory)||void 0===t||t.bindPreviewContainer(e)}},{key:"preparePreview",value:function(e){var t;null===(t=this.previewFactory)||void 0===t||t.preparePreview(e)}},{key:"emit",value:function(e){for(var t,n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];(t=this.dispatcher).emit.apply(t,[e].concat(a))}},{key:"on",value:function(e,t){this.dispatcher.on(e,t)}},{key:"off",value:function(e,t){this.dispatcher.off(e,t)}},{key:"once",value:function(e,t){this.dispatcher.once(e,t)}},{key:"getOpDoc",value:function(e){return this.opsManager.getOpDoc(e)}},{key:"getCurrTool",value:function(){var e;return null===(e=this.opsManager.currOp)||void 0===e?void 0:e.type}},{key:"destroy",value:function(){this.logger.log("[白板]","drawPlugin.destroy"),this.emit("event:destroy"),this.dispatcher.destroy(),this.container.destroy(),this.opsManager.destroy(),this.dataHub.destroy(),this.vision.destroy(),this.aliveManager.destroy(),this.shapeSelector.destroy(),this.resourceCache.destroy(),this.stopStream(),this.toolCollection&&"function"==typeof this.toolCollection.destroy&&this.toolCollection.destroy(),document.body.style.cursor="auto",this.setIsConnected(!1)}},{key:"addRecordData",value:function(e){var t;null===(t=this.player)||void 0===t||t.addRecordData(e)}},{key:"seekTo",value:function(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e)}},{key:"play",value:function(){var e;null===(e=this.player)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.player)||void 0===e||e.pause()}},{key:"setPlaySpeed",value:function(e){var t;null===(t=this.player)||void 0===t||t.setPlaySpeed(e)}},{key:"setViewer",value:function(e){var t;null===(t=this.player)||void 0===t||t.setViewer(e)}},{key:"setSelfAsBroadcaster",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsBroadcaster"),this.vision.setSelfAsBroadcaster()}},{key:"unsetSelfAsBroadcaster",value:function(){this.logger.log("[白板]","drawPlugin.unsetSelfAsBroadcaster"),this.vision.unsetSelfAsBroadcaster()}},{key:"setSelfAsFollower",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsFollower"),this.vision.setSelfAsFollower()}},{key:"setSelfAsFreeObserver",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsFreeObserver"),this.vision.setSelfAsFreeObserver()}},{key:"exportBoardAsStr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return __awaiter(this,void 0,void 0,_regenerator2.default.mark((function n(){var a,r,i,o,s,u,l,c,d,p,h,f,g,v,y,m,M=this;return _regenerator2.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return _validate2.default.validate(this.logger,"drawPlugin.exportBoardAsStr",e,{type:{type:"string"},quality:{type:"number"},content:{type:"string",enum:["clip","fitToDoc","fitToContent"]},omitSelection:{type:"boolean"},customBg:{type:"boolean"},boardName:{type:"string"},resWait:{type:"number"}}),_validate2.default.validate(this.logger,"drawPlugin.exportBoardAsStr",t,{onComplete:{type:"function",isRequire:!0},onResourceProgress:{type:"function"},onImgProgress:{type:"function"},onError:{type:"function"}}),n.prev=2,n.next=5,(0,_delay.delay)(50);case 5:for(a=this.room.currIndex,e.boardName&&(a=e.boardName),r=this.room.boards[a],i="number"!=typeof e.resWait||isNaN(e.resWait)?24e4:e.resWait,i=Math.max(i,3e3),o=this.getPageInfos(a),s=[],u=0;u<o.pageNames.length;u++)(l=this.room.getPage(a,o.pageNames[u]))&&s.push(l);return c=0,d=s.map((function(e){return __awaiter(M,void 0,void 0,_regenerator2.default.mark((function n(){return _regenerator2.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.waitTilReady();case 2:c+=1,"function"==typeof t.onResourceProgress&&r&&!r.transDocSnapshot&&t.onResourceProgress(c/s.length);case 4:case"end":return n.stop()}}),n,this)})))})),r&&d.push(r.waitTilReady()),n.next=18,_promise2.default.race([_promise2.default.all(d),(0,_delay.delay)(i)]);case 18:return"function"==typeof t.onResourceProgress&&t.onResourceProgress(1),n.next=21,(0,_delay.delay)(20);case 21:p=[],h=[],f=[],g=0,v=0,y=0;case 27:if(!(y<o.pageNames.length)){n.next=36;break}return m=this.exportAsBase64String((0,_assign2.default)((0,_assign2.default)({},e),{pageIndex:y,exportBoard:!0})),"function"==typeof t.onImgProgress&&t.onImgProgress((y+1)/o.pageNames.length),n.next=32,(0,_delay.delay)(20);case 32:null===m?h.push(y):(p.push(m.content),f.push({w:m.width,h:m.height}),g=Math.max(g,m.width),v=Math.max(v,m.height));case 33:y++,n.next=27;break;case 36:t.onComplete({contents:p,nullPages:h,maxW:g,maxH:v,sizes:f}),n.next=43;break;case 39:n.prev=39,n.t0=n.catch(2),this.logger.error("exportBoardAsStr error",n.t0),"function"==typeof t.onError&&t.onError(n.t0);case 43:case"end":return n.stop()}}),n,this,[[2,39]])})))}},{key:"exportAsImage",value:function(e){this.logger.log("[白板]","drawPlugin.exportAsImage",e);var t=null==e?void 0:e.type,n=this.exportAsBase64String(e);if(null!==n){var a=document.createElement("a");a.href=n.content;var r=t&&-1!==t.toLowerCase().indexOf("jpeg")?"jpeg":"png";a.download="whiteboard."+r,a.click()}else this.logger.error("[白板]","drawPlugin.exportAsImage get null")}},{key:"exportAsBase64String",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.log("[白板]","drawPlugin.exportAsBase64String",e),_validate2.default.validate(this.logger,"drawPlugin.exportAsBase64String",e,{type:{type:"string"},quality:{type:"number"},content:{type:"string",enum:["clip","fitToDoc","fitToContent"]},omitSelection:{type:"boolean"},customBg:{type:"boolean"},boardName:{type:"string"},pageIndex:{type:"number"}});var t=e.type?e.type:"image/png",n=e.content?e.content:"fitToContent",a="number"!=typeof e.quality||isNaN(e.quality)?.92:e.quality,r=void 0===e.omitSelection||e.omitSelection,i=void 0===e.customBg||e.customBg,o=void 0===e.boardName?this.room.currIndex:e.boardName,s=this.room.currBoard.currIndex.toString();if(void 0!==e.pageIndex){var u=this.room.getPageNameFromIndex(o,e.pageIndex);void 0===u?this.logger.warn("[白板]","drawPlugin.exportAsBase64String could not find board: "+o+", pageIndex: "+e.pageIndex):s=u}t&&!t.startsWith("image")&&(t="image/"+t);var l=this.previewFactory.generatePreviewToDataUrl({pageIndex:s,boardName:o,state:"ready",content:n,omitSelection:r,customBg:i,exportBoard:e.exportBoard},t,a);return l}},{key:"setMemberList",value:function(e){this.emit("event:member:change",e.slice())}},{key:"dataReportUtil",value:function(e,t){this.dataReportUrl&&this.dataReportParams&&!this.isRecordPlayer&&("v3_run_error"===e?t.error&&!this.reportedError.has(t.error.message)&&((0,_dataReport2.default)(this.dataReportUrl,e,this.sessionId,(0,_assign2.default)((0,_assign2.default)((0,_assign2.default)({},this.dataReportParams),{time:Date.now()}),t)),this.reportedError.add(t.error.message)):(0,_dataReport2.default)(this.dataReportUrl,e,this.sessionId,(0,_assign2.default)((0,_assign2.default)((0,_assign2.default)({},this.dataReportParams),{time:Date.now()}),t)))}},{key:"setDataReportParams",value:function(e,t){this.dataReportUrl=e,this.dataReportParams=t}},{key:"setToolCollection",value:function(e){this.toolCollection&&"function"==typeof this.toolCollection.destroy&&this.toolCollection.destroy(),this.toolCollection=e}},{key:"disableInteraction",value:function(){this.container.disableInteraction()}},{key:"enableInteraction",value:function(){this.container.enableInteraction()}},{key:"definePlugin",value:function(e){"page"===e.type&&this.opsManager.opMap.pagePlugin.definePlugin(e)}},{key:"insertPlugin",value:function(e){this.logger.log("[白板]","drawPlugin.insertPlugin",e),_validate2.default.validate(this.logger,"drawPlugin.insertPlugin",e,{pluginType:{type:"string",isRequire:!0},cameraBound:{type:"object"}});var t=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;this.emit("op:pagePlugin:insert",(0,_assign2.default)((0,_assign2.default)({},e),{pageName:t,boardName:e.boardName}))}},{key:"downloadRes",value:function(e){var t=this.opsManager.drawOpsOfPage[e];if(t)if("image"!==t.data.type)this.logger.error("[白板]","drawPlugin.downloadRes element: "+e+" is not image, it is $"+t.data.type);else{var n=this.previewFactory.generateElesToDataUrl([e]);if(n){var a=document.createElement("a");a.href=n;a.download="image.png",a.click()}else(0,_toast.showToast)({type:"error",msg:"图片下载失败"})}else this.logger.error("[白板]","drawPlugin.downloadRes could not find element: "+e)}},{key:"copySelectedElesToClipboard",value:function(){var e=this.previewFactory.generateElesToDataUrl(this.opsManager.selectOp.selectedOpIds);e?(0,_util2.copyImgToClipBoard)(e,(function(t){if(t)(0,_toast.showToast)({type:"success",msg:"元素已复制至剪切板中"});else{var n=document.createElement("a");n.href=e;n.download="image.png",n.click()}})):(0,_toast.showToast)({type:"error",msg:"复制元素为图片失败"})}},{key:"ifDeviceSupportOrientation",get:function(){return-1!==_types.TouchPlatformArray.indexOf(this.platform.toLowerCase())}},{key:"editable",get:function(){return this.editEnabled&&!this.dataHub.isSynchronizing&&this.isConnected}},{key:"appConfig",get:function(){return this.configInstance.getAppConfig()}},{key:"scale",get:function(){return this.camera.scale||1}},{key:"ShapeDesc",get:function(){return this.shapeManager.ShapeDesc}}]),App}(),DrawPlugin={getInstance:function(e){return e.logger.log("[白板]","DrawPlugin.getInstance arguments:",e),_validate2.default.validate(e.logger,"DrawPlugin.instance",e,{account:{type:"string",isRequire:!0},nickname:{type:"string",isRequire:!1},container:{type:"dom",isRequire:!1},platform:{type:"string",isRequire:!0,enum:_types.PlatformArray},connector:{type:"object",isRequire:!0},nim:{type:"object",isRequire:!0}}),new App(e)}};exports.App=App,exports.default=DrawPlugin},function(e,t,n){var a=function(){return this}()||Function("return this")(),r=a.regeneratorRuntime&&Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime")>=0,i=r&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,e.exports=n(268),r)a.regeneratorRuntime=i;else try{delete a.regeneratorRuntime}catch(e){a.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,a=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag",u="object"==typeof e,l=t.regeneratorRuntime;if(l)u&&(e.exports=l);else{(l=t.regeneratorRuntime=u?e.exports:{}).wrap=g;var c={},d={};d[i]=function(){return this};var p=Object.getPrototypeOf,h=p&&p(p(_([])));h&&h!==n&&a.call(h,i)&&(d=h);var f=M.prototype=y.prototype=Object.create(d);m.prototype=f.constructor=M,M.constructor=m,M[s]=m.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,M):(e.__proto__=M,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(f),e},l.awrap=function(e){return{__await:e}},x(w.prototype),w.prototype[o]=function(){return this},l.AsyncIterator=w,l.async=function(e,t,n,a){var r=new w(g(e,t,n,a));return l.isGeneratorFunction(t)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},x(f),f[s]="Generator",f[i]=function(){return this},f.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},l.values=_,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:_(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}}}function g(e,t,n,a){var r=t&&t.prototype instanceof y?t:y,i=Object.create(r.prototype),o=new T(a||[]);return i._invoke=function(e,t,n){var a="suspendedStart";return function(r,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw i;return C()}for(n.method=r,n.arg=i;;){var o=n.delegate;if(o){var s=I(o,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var u=v(e,t,n);if("normal"===u.type){if(a=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function y(){}function m(){}function M(){}function x(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(n,r){function i(){return new Promise((function(t,i){!function t(n,r,i,o){var s=v(e[n],e,r);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&a.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,i,o)}),(function(e){t("throw",e,i,o)})):Promise.resolve(l).then((function(e){u.value=e,i(u)}),o)}o(s.arg)}(n,r,t,i)}))}return t=t?t.then(i,i):i()}}function I(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var a=v(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,c;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function _(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:C}}function C(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){e.exports={default:n(270),__esModule:!0}},function(e,t,n){n(51),n(44),e.exports=n(271)},function(e,t,n){var a=n(71),r=n(17)("iterator"),i=n(50);e.exports=n(8).isIterable=function(e){var t=Object(e);return void 0!==t[r]||"@@iterator"in t||i.hasOwnProperty(a(t))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evenify=function(e){return 2*Math.ceil(e/2)},t.deltaXY=function(e,t){return[(t[0]-e[0]+t[2]-e[2])/2,(t[1]-e[1]+t[3]-e[3])/2]},t.fingerDiff=function(e,t){return Math.abs(t[0]-e[0]-t[2]+e[2])+Math.abs(t[1]-e[1]-t[3]+e[3])},t.pinchScale=function(e,t){var n=Math.abs(e[0]-e[2])+Math.abs(e[1]-e[3]);return(Math.abs(t[0]-t[2])+Math.abs(t[1]-t[3]))/n},t.ptsCenter=function(e,t){return[(e[0]+e[2]+t[0]+t[2])/4,(e[1]+e[3]+t[1]+t[3])/4]},t.scaleProb=function(e,t,n){var a=0,r=[2.5,6],i=0,o=[.01,.05],s=e/t;if(isNaN(s))return.5;a=s>r[1]?1:s>r[0]?Math.min(1,.5+Math.sqrt((s-r[0])/(r[1]-r[0]))/2):(1-Math.sqrt((r[0]-s)/r[0]))/2;i=n>o[1]?1:n>o[0]?Math.min(1,.5+Math.sqrt((n-o[0])/(o[1]-o[0]))/2):(1-Math.sqrt((o[0]-n)/o[0]))/2;return.7*a+.3*i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=ue(n(5)),r=ue(n(22)),i=ue(n(28)),o=ue(n(0)),s=ue(n(1)),u=ue(n(37)),l=ue(n(14)),c=n(45),d=n(274),p=ue(n(217)),h=ue(n(231)),f=ue(n(58)),g=ue(n(298)),v=ue(n(299)),y=ue(n(300)),m=ue(n(301)),M=ue(n(302)),x=ue(n(303)),w=ue(n(304)),I=ue(n(232)),b=ue(n(233)),k=ue(n(138)),T=ue(n(305)),_=ue(n(306)),C=ue(n(307)),N=ue(n(308)),A=ue(n(309)),P=ue(n(310)),O=ue(n(311)),D=ue(n(312)),S=ue(n(313)),E=ue(n(314)),j=ue(n(315)),L=ue(n(316)),z=ue(n(317)),R=ue(n(318)),B=ue(n(320)),F=ue(n(321)),Y=ue(n(322)),U=ue(n(67)),W=ue(n(323)),H=ue(n(324)),Q=ue(n(325)),Z=ue(n(338)),G=n(103),V=ue(n(339)),X=ue(n(340)),J=ue(n(343)),K=n(13),q=n(240),$=ue(n(345)),ee=ue(n(228)),te=ue(n(347)),ne=ue(n(348)),ae=ue(n(349)),re=ue(n(350)),ie=ue(n(351)),oe=ue(n(352)),se=ue(n(353));function ue(e){return e&&e.__esModule?e:{default:e}}var le=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},ce=new u.default,de=function(){function e(t){var n=this;(0,o.default)(this,e),this.currOp=null,this.opMap={},this.drawOpTypes=[],this.shapeTypes=[],this.exitHandler=function(){if(n.selectOp.selectedOpIds.length>0&&n.selectOp.dispatch(n.selectOp.getSnapshot([]),!0),n.currOp===n.opMap.laser&&n.currOp.dispatch(n.currOp.getSnapshot(!1),!0),n.app.showCursor){var e=n.opMap["mouse-pointer"];e&&e.dispatch(e.getSnapshot([0,0],!1),!0)}},this.app=t,this.dispatcher=t.dispatcher,this.unregistExit=(0,q.regExitListener)(this.exitHandler,t),this.hooks={scale:new d.SyncBailHook(["event","scale","clientX","clientY"]),pan:new d.SyncBailHook(["event","clientDx","clientDy"]),mousedown:new d.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseup:new d.SyncBailHook(["event","mx","my","clientX","clientY"]),mousemove:new d.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseleave:new d.SyncBailHook(["event","mx","my","clientX","clientY"]),mousewheel:new d.SyncBailHook(["event","mx","my","clientX","clientY"]),resize:new d.SyncBailHook(["event","width","height"]),click:new d.SyncBailHook(["event","mx","my","clientX","clientY"]),dblClick:new d.SyncBailHook(["event","mx","my","clientX","clientY"]),keyup:new d.SyncBailHook(["event"]),keydown:new d.SyncBailHook(["event"]),opAdd:new d.SyncHook(["snapshot","isNew"]),refresh:new d.SyncHook([]),opChange:new d.SyncHook(["type"]),selectChange:new d.SyncHook(["prevSelectedOpIds","selectedOpIds"]),pageChange:new d.SyncHook(["snapshot"]),boardChange:new d.SyncHook([]),pageReady:new d.SyncHook(["boardName, pageIndex"]),enableDrawChange:new d.SyncHook(["enable"]),previewWaiting:new d.SyncHook(["pageIndex"]),cleanNonCanvasEle:new d.SyncHook(["page"])},this.dispatcher.on("op:activate",(function(e){n.setCurrOp(e)}))}return(0,s.default)(e,[{key:"extendDefaultOps",value:function(){this.extendOp(re.default),this.extendOp(ne.default),this.extendOp(te.default),this.extendOp(R.default),this.extendOp(J.default),this.extendDrawOp(p.default),this.extendDrawOp(A.default),this.extendDrawOp(P.default),this.extendDrawOp(h.default),this.extendShapeOp($.default),this.extendDrawOp(I.default),this.extendDrawOp(W.default),this.extendDrawOp(H.default),this.extendDrawOp(b.default),this.extendOp(k.default),this.extendOp(D.default),this.extendOp(f.default),this.extendOp(ee.default),this.extendOp(v.default),this.extendOp(g.default),this.extendOp(y.default),this.extendOp(N.default),this.extendOp(m.default),this.extendOp(M.default),this.extendOp(x.default),this.extendOp(w.default),this.extendOp(O.default),this.extendOp(T.default),this.extendOp(C.default),this.extendOp(X.default),this.extendOp(_.default),this.extendOp(Q.default),this.extendOp(V.default),this.extendOp(E.default),this.extendOp(S.default),this.extendOp(j.default),this.extendOp(L.default),this.extendOp(z.default),this.extendOp(B.default),this.extendOp(U.default),this.extendOp(F.default),this.extendOp(Y.default),this.extendOp(Z.default),this.extendOp(ae.default),this.extendOp(ie.default),this.extendOp(oe.default),this.extendOp(se.default),this.setCurrOp("pen")}},{key:"addContainer",value:function(e){this.container=e}},{key:"extendDrawOp",value:function(e){var t=this.extendOp(e);this.drawOpTypes.push(t.type)}},{key:"extendShapeOp",value:function(e){var t=this.extendOp(e);for(var n in this.drawOpTypes.push(t.type),this.app.ShapeDesc)this.shapeTypes.push(n)}},{key:"extendOp",value:function(e){var t,n,a=new e(this.app);this.opMap[a.type]=a;var r=a.eventsToListen();if((null===(t=r.activate)||void 0===t?void 0:t.value)&&(null===(n=r.exec)||void 0===n?void 0:n.value))throw new Error("DEV--\x3e 操作不能同时设置activate和exec为true。操作不同同时为命令类操作，及状态类操作");for(var i in r.activate&&r.activate.value||r.exec&&r.exec.value&&this.dispatcher.on("op:"+a.type+":exec",a.execCommand.bind(a)),r)"activate"!==i&&"exec"!==i&&this.dispatcher.on("op:"+i,r[i].value);return a}},{key:"getOpDoc",value:function(e){var t=[];if(void 0!==e)t=this._getOpDoc(e);else{for(var n in this.opMap)(t=t.concat(this._getOpDoc(n))).push("*************************************");t.push("全局事件\n\n用法：app.on('event:add:snapshot', (data: {local: boolean, snapshot: IOPSnapshot}) => {})\n作用： 接收到新的快照时发送此事件\n"),t.push("*************************************")}return t.join("\n\n")}},{key:"_getOpDoc",value:function(e){var t=[];if(this.opMap.hasOwnProperty(e)){var n=this.opMap[e];n.description&&t.push(n.description);var a=n.eventsToListen();for(var r in a){var i=a[r].information,o="op:"+r;"activate"!==r&&"exec"!==r||(o="op:"+n.type+":"+r),t.push("用法：app.emit('"+o+"'"+(i.args.length>0?", "+i.args:"")+")\n作用："+i.message)}}else this.logger.log("DEV--\x3e","op:"+e+"不存在!!!!!!");return t}},{key:"setCurrOp",value:function(e){var t;return G.LOG&&this.logger.log("[白板]","设置当前op为："+e),(null===(t=this.currOp)||void 0===t?void 0:t.type)!==e&&(document.body.style.cursor="default",this.hooks.opChange.call(e),-1!==this.shapeTypes.indexOf(e)?(this.currOp=this.opMap.shape,this.currOp.setSubType(e)):this.currOp=this.opMap[e],this.app.emit("event:appState:change","currTool",e),!0)}},{key:"currOpIsCamera",value:function(){var e;return this.currOp&&-1!==c.cameraSnapshotTypes.indexOf(null===(e=this.currOp)||void 0===e?void 0:e.type)}},{key:"resize",value:function(e,t,n){this.hooks.resize.call(e,t,n)||this.currOp&&"handleResize"in this.currOp&&this.currOp.handleResize(e,t,n)}},{key:"pan",value:function(e,t,n){(this.app.editable||this.app.isRecordPlayer)&&(this.hooks.pan.call(e,t,n)||this.currOp&&"handlePan"in this.currOp&&this.currOp.handlePan(e,t,n))}},{key:"scale",value:function(e,t,n,a){(this.app.editable||this.app.isRecordPlayer)&&(this.hooks.scale.call(e,t,n,a)||this.currOp&&"handleScale"in this.currOp&&this.currOp.handleScale(e,t,n,a))}},{key:"mousedown",value:function(e,t,n,a,r){(this.app.editable||this.app.isRecordPlayer)&&(this.hooks.mousedown.call(e,t,n,a,r)||this.currOp&&"handleMouseDown"in this.currOp&&this.currOp.handleMouseDown(e,t,n,a,r))}},{key:"mouseup",value:function(e,t,n,a,r){(this.app.editable||this.app.isRecordPlayer)&&(this.hooks.mouseup.call(e,t,n,a,r)||this.currOp&&"handleMouseUp"in this.currOp&&this.currOp.handleMouseUp(e,t,n,a,r))}},{key:"mouseleave",value:function(e,t,n,a,r){(this.app.editable||this.app.isRecordPlayer)&&(this.hooks.mouseleave.call(e,t,n,a,r)||this.currOp&&"handleMouseLeave"in this.currOp&&this.currOp.handleMouseLeave(e,t,n,a,r))}},{key:"mousewheel",value:function(e,t,n,a,r){(this.app.editable||this.app.isRecordPlayer)&&(this.hooks.mousewheel.call(e,t,n,a,r)||this.currOp&&"handleMouseWheel"in this.currOp&&this.currOp.handleMouseWheel(e,t,n,a,r))}},{key:"mousemove",value:function(e,t,n,a,r){(this.app.editable||this.app.isRecordPlayer)&&(this.hooks.mousemove.call(e,t,n,a,r)||this.currOp&&"handleMouseMove"in this.currOp&&this.currOp.handleMouseMove(e,t,n,a,r))}},{key:"click",value:function(e,t,n,a,r){this.app.editable&&(this.hooks.click.call(e,t,n,a,r)||this.currOp&&"handleClick"in this.currOp&&this.currOp.handleClick(e,t,n,a,r))}},{key:"dblClick",value:function(e,t,n,a,r){this.app.editable&&(this.hooks.dblClick.call(e,t,n,a,r)||this.currOp&&"handleDblClick"in this.currOp&&this.currOp.handleDblClick(e,t,n,a,r))}},{key:"keyup",value:function(e){this.app.editable&&(this.hooks.keyup.call(e)||this.currOp&&"handleKeyUp"in this.currOp&&this.currOp.handleKeyUp(e))}},{key:"keydown",value:function(e){this.app.editable&&(this.hooks.keydown.call(e)||this.currOp&&"handleKeyDown"in this.currOp&&this.currOp.handleKeyDown(e))}},{key:"draw",value:function(e,t,n){try{var a=e.data.type;if(this.opMap[a]){e=this.opMap[a].intepSnap(e);var r=this.app.camera.getContainerWorldRect(),i={sx:r.centerX-r.width/2,sy:r.centerY-r.height/2,w:r.width,h:r.height};if(this.snapOutBound(e,i)&&-1===["audio","video","image","text"].indexOf(a))return;this.opMap[a].draw(e,t,n)}}catch(e){this.logger.warn("[白板] opsManager.draw error",e)}}},{key:"snapOutBound",value:function(e,t){if(e.data.boundary){var n=(0,K.getTransformedBoundary)(this.app.scale,e.data);return n.sx-.5*n.w>=t.sx+t.w||n.sx+1.5*n.w<=t.sx||n.sy-.5*n.h>=t.sy+t.h||n.sy+1.5*n.h<=t.sy}return!1}},{key:"preview",value:function(e,t,n){try{var a=e.data.type;this.opMap[a].preview(e,t,n)}catch(e){this.logger.warn("[白板] opsManager.preview error",e)}}},{key:"hide",value:function(e,t,n){try{var a=e.data.type;this.opMap[a]&&this.opMap[a].hide(e,t,n)}catch(e){this.logger.warn("[白板] opsManager.hide error",e)}}},{key:"waitTilReady",value:function(e){return le(this,void 0,void 0,i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.opMap[e.data.type]){t.next=4;break}return t.abrupt("return",this.opMap[e.data.type].waitTilReady(e));case 4:return t.abrupt("return",l.default.resolve());case 5:case"end":return t.stop()}}),t,this)})))}},{key:"mergePartial",value:function(e,t){var n=e.data.type;return this.opMap[n]?this.opMap[n].mergePartial(e,t):(ce.has(n)||(this.logger.error("[白板] 找不到type为"+n+"的教具类型",(0,r.default)(e)),ce.add(n)),t.hasOwnProperty("category")?t.time>=e.time?t:e:(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)({},e.data),t.data)}))}},{key:"mergeTwoPartial",value:function(e,t){var n={opId:e.opId,data:e.data};for(var a in t.data)Array.isArray(t.data[a])&&Array.isArray(n.data[a])?n.data[a]=n.data[a].concat(t.data[a]):n.data[a]=t.data[a];return n}},{key:"hasOpType",value:function(e){return this.opMap.hasOwnProperty(e)}},{key:"resetUndoRedoCount",value:function(){this.opMap.undo.resetCount(),this.opMap.redo.resetCount()}},{key:"destroy",value:function(){for(var e in this.opMap)this.opMap[e]&&"function"==typeof this.opMap[e].destroy&&this.opMap[e].destroy();"function"==typeof this.unregistExit&&this.unregistExit()}},{key:"logger",get:function(){return this.app.logger}},{key:"currPage",get:function(){return this.currBoard.pages[this.currBoard.currIndex]}},{key:"currBoard",get:function(){return this.app.room.boards[this.app.room.currIndex]}},{key:"drawOpsOfPage",get:function(){return this.currPage.drawOpQueue||{}}},{key:"hiddenOpsOfPage",get:function(){return this.currPage.hiddenOpQueue||{}}},{key:"auxiliaryOp",get:function(){return this.opMap.auxiliary}},{key:"graphOp",get:function(){return this.opMap.graph}},{key:"linkOp",get:function(){return this.opMap.link}},{key:"textOp",get:function(){return this.opMap.text}},{key:"dupOp",get:function(){return this.opMap.duplicate}},{key:"selectOp",get:function(){return this.opMap.select}},{key:"modifyOp",get:function(){return this.opMap.modify}},{key:"deleteOp",get:function(){return this.opMap.delete}},{key:"cropOp",get:function(){return this.opMap.crop}},{key:"groupOp",get:function(){return this.opMap.group}},{key:"selectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.selectedOpIds}}]),e}();t.default=de},function(e,t,n){"use strict";t.__esModule=!0,t.Tapable=n(275),t.SyncHook=n(280),t.SyncBailHook=n(204),t.SyncWaterfallHook=n(281),t.SyncLoopHook=n(282),t.AsyncParallelHook=n(283),t.AsyncParallelBailHook=n(284),t.AsyncSeriesHook=n(285),t.AsyncSeriesBailHook=n(286),t.AsyncSeriesWaterfallHook=n(287),t.HookMap=n(288),t.MultiHook=n(289)},function(e,t,n){"use strict";var a=i(n(37)),r=i(n(7));function i(e){return e&&e.__esModule?e:{default:e}}var o=n(259),s=n(204);function u(){var e=this;this._pluginCompat=new s(["options"]),this._pluginCompat.tap({name:"Tapable camelCase",stage:100},(function(e){e.names.add(e.name.replace(/[- ]([a-z])/g,(function(e,t){return t.toUpperCase()})))})),this._pluginCompat.tap({name:"Tapable this.hooks",stage:200},(function(t){var n=void 0,a=!0,i=!1,o=void 0;try{for(var s,u=(0,r.default)(t.names);!(a=(s=u.next()).done);a=!0){var l=s.value;if(void 0!==(n=e.hooks[l]))break}}catch(e){i=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw o}}if(void 0!==n){var c={name:t.fn.name||"unnamed compat plugin",stage:t.stage||0};return t.async?n.tapAsync(c,t.fn):n.tap(c,t.fn),!0}}))}e.exports=u,u.addCompatLayer=function(e){u.call(e),e.plugin=u.prototype.plugin,e.apply=u.prototype.apply},u.prototype.plugin=o.deprecate((function(e,t){if(Array.isArray(e))e.forEach((function(e){this.plugin(e,t)}),this);else if(!this._pluginCompat.call({name:e,fn:t,names:new a.default([e])}))throw new Error("Plugin could not be registered at '"+e+"'. Hook was not found.\nBREAKING CHANGE: There need to exist a hook at 'this.hooks'. To create a compatibility layer for this hook, hook into 'this._pluginCompat'.")}),"Tapable.plugin is deprecated. Use new API on `.hooks` instead"),u.prototype.apply=o.deprecate((function(){for(var e=0;e<arguments.length;e++)arguments[e].apply(this)}),"Tapable.apply is deprecated. Call apply on the plugin directly instead")},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){n(279);var a=n(8).Object;e.exports=function(e,t){return a.defineProperties(e,t)}},function(e,t,n){var a=n(10);a(a.S+a.F*!n(21),"Object",{defineProperties:n(133)})},function(e,t,n){"use strict";var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=n(46),c=new(function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,a=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:a})}}]),t}(n(52))),d=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncHook")}},{key:"compile",value:function(e){return c.setup(this,e),c.create(e)}}]),t}(l);e.exports=d},function(e,t,n){"use strict";var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=n(46),c=new(function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,a=e.onResult,r=e.resultReturns,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,t){return n(t)},onResult:function(e,n,a){var r="";return r+="if("+n+" !== undefined) {\n",r+=t._args[0]+" = "+n+";\n",r+="}\n",r+=a()},onDone:function(){return a(t._args[0])},doneReturns:r,rethrowIfPossible:i})}}]),t}(n(52))),d=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncWaterfallHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncWaterfallHook")}},{key:"compile",value:function(e){return c.setup(this,e),c.create(e)}}]),t}(l);e.exports=d},function(e,t,n){"use strict";var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=n(46),c=new(function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,a=e.rethrowIfPossible;return this.callTapsLooping({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:a})}}]),t}(n(52))),d=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncLoopHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncLoopHook")}},{key:"compile",value:function(e){return c.setup(this,e),c.create(e)}}]),t}(l);e.exports=d},function(e,t,n){"use strict";var a=l(n(73)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=n(46),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsParallel({onError:function(e,n,a,r){return t(n)+r(!0)},onDone:n})}}]),t}(n(52))),p=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(c);(0,a.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,n){"use strict";var a=l(n(73)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=n(46),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,a=e.onDone,r="";return r+="var _results = new Array("+this.options.taps.length+");\n",r+="var _checkDone = () => {\n",r+="for(var i = 0; i < _results.length; i++) {\n",r+="var item = _results[i];\n",r+="if(item === undefined) return false;\n",r+="if(item.result !== undefined) {\n",r+=n("item.result"),r+="return true;\n",r+="}\n",r+="if(item.error) {\n",r+=t("item.error"),r+="return true;\n",r+="}\n",r+="}\n",r+="return false;\n",r+="}\n",r+=this.callTapsParallel({onError:function(e,t,n,a){var r="";return r+="if("+e+" < _results.length && ((_results.length = "+(e+1)+"), (_results["+e+"] = { error: "+t+" }), _checkDone())) {\n",r+=a(!0),r+="} else {\n",r+=n(),r+="}\n"},onResult:function(e,t,n,a){var r="";return r+="if("+e+" < _results.length && ("+t+" !== undefined && (_results.length = "+(e+1)+"), (_results["+e+"] = { result: "+t+" }), _checkDone())) {\n",r+=a(!0),r+="} else {\n",r+=n(),r+="}\n"},onTap:function(e,t,n,a){var r="";return e>0&&(r+="if("+e+" >= _results.length) {\n",r+=n(),r+="} else {\n"),r+=t(),e>0&&(r+="}\n"),r},onDone:a})}}]),t}(n(52))),p=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(c);(0,a.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,n){"use strict";var a=l(n(73)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=n(46),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsSeries({onError:function(e,n,a,r){return t(n)+r(!0)},onDone:n})}}]),t}(n(52))),p=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(c);(0,a.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,n){"use strict";var a=l(n(73)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=n(46),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,a=e.resultReturns,r=e.onDone;return this.callTapsSeries({onError:function(e,n,a,r){return t(n)+r(!0)},onResult:function(e,t,a){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+a()+"}\n"},resultReturns:a,onDone:r})}}]),t}(n(52))),p=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(c);(0,a.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,n){"use strict";var a=l(n(73)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=n(46),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,a=e.onResult;e.onDone;return this.callTapsSeries({onError:function(e,t,a,r){return n(t)+r(!0)},onResult:function(e,n,a){var r="";return r+="if("+n+" !== undefined) {\n",r+=t._args[0]+" = "+n+";\n",r+="}\n",r+=a()},onDone:function(){return a(t._args[0])}})}}]),t}(n(52))),p=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(c);(0,a.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,n){"use strict";var a=s(n(5)),r=s(n(74)),i=s(n(0)),o=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,i.default)(this,e),this._map=new r.default,this._factory=t,this._interceptors=[]}return(0,o.default)(e,[{key:"get",value:function(e){return this._map.get(e)}},{key:"for",value:function(e){var t=this.get(e);if(void 0!==t)return t;for(var n=this._factory(e),a=this._interceptors,r=0;r<a.length;r++)n=a[r].factory(e,n);return this._map.set(e,n),n}},{key:"intercept",value:function(e){this._interceptors.push((0,a.default)({factory:function(e,t){return t}},e))}},{key:"tap",value:function(e,t,n){return this.for(e).tap(t,n)}},{key:"tapAsync",value:function(e,t,n){return this.for(e).tapAsync(t,n)}},{key:"tapPromise",value:function(e,t,n){return this.for(e).tapPromise(t,n)}}]),e}();e.exports=u},function(e,t,n){"use strict";var a=o(n(7)),r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}n(46);var s=function(){function e(t){(0,r.default)(this,e),this.hooks=t}return(0,i.default)(e,[{key:"tap",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tap(e,t)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"tapAsync",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tapAsync(e,t)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"tapPromise",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tapPromise(e,t)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"isUsed",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this.hooks);!(e=(r=i.next()).done);e=!0){if(r.value.isUsed())return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"intercept",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,a.default)(this.hooks);!(t=(i=o.next()).done);t=!0){i.value.intercept(e)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"withOptions",value:function(t){return new e(this.hooks.map((function(e){return e.withOptions(t)})))}}]),e}();e.exports=s},function(e,t,n){e.exports={default:n(291),__esModule:!0}},function(e,t,n){n(292);var a=n(8).Object;e.exports=function(e,t){return a.getOwnPropertyDescriptor(e,t)}},function(e,t,n){var a=n(41),r=n(101).f;n(102)("getOwnPropertyDescriptor",(function(){return function(e,t){return r(a(e),t)}}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(294),i=(a=r)&&a.__esModule?a:{default:a};function o(e){var t="0123456789abcdefghijklmnopqrstuvwxyz!@#$%^&*()_+[]{}|/<>,./";return e?"0123456789"[Math.floor(Math.random()*"0123456789".length)]:t[Math.floor(Math.random()*t.length)]}t.getRandomIntByStr=function(e){var t=(n=function(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=(0,i.default)(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return function(){return n=(0,i.default)(n^n>>>16,2246822507),n=(0,i.default)(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(function(e){for(var t="",n=0;n<e;n++)t+=o(!1);return t}(18))(),function(){var e=n+=1831565813;return e=(0,i.default)(e^e>>>15,1|e),((e^=e+(0,i.default)(e^e>>>7,61|e))^e>>>14)>>>0})().toString().slice(0,e);var n;if(t.length<e)for(var a=t.length;a<e;a++)t+=o(!0);return t}},function(e,t,n){e.exports={default:n(295),__esModule:!0}},function(e,t,n){n(296),e.exports=n(8).Math.imul},function(e,t,n){var a=n(10),r=Math.imul;a(a.S+a.F*n(36)((function(){return-5!=r(4294967295,5)||2!=r.length})),"Math",{imul:function(e,t){var n=+e,a=+t,r=65535&n,i=65535&a;return 0|r*i+((65535&n>>>16)*i+r*(65535&a>>>16)<<16>>>0)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawCurve=void 0;var a,r=n(19),i=(a=r)&&a.__esModule?a:{default:a};t.drawCurve=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.3;(a>.5||a<=0)&&console.error("k should be between 0 and 0.5"),e.beginPath();for(var r=0;r<t.length;r++)if(t[r])for(var i=r+1;i<=t.length;i++)if(i===t.length||!t[i]){o(e,t.slice(r,i),n,a),r=i;break}};var o=function(e,t,n,a){if(t.length<=2)2===t.length&&(e.moveTo.apply(e,(0,i.default)(t[0])),e.lineTo.apply(e,(0,i.default)(t[1])));else{e.moveTo.apply(e,(0,i.default)(t[0]));var r=t[0],o=t[1],s=[a*r[0]+(1-a)*o[0],a*r[1]+(1-a)*o[1]];Math.abs(a-.5)>.01&&e.lineTo.apply(e,(0,i.default)(s)),r=o;for(var u=2;u<t.length;u++){o=t[u];var l=(Math.abs(o[0]-r[0])+Math.abs(o[1]-r[1]))*n;if(!(l<3)){if(l>30){var c=[(1-a)*r[0]+a*o[0],(1-a)*r[1]+a*o[1]];e.quadraticCurveTo.apply(e,(0,i.default)(r).concat(c))}var d=[a*r[0]+(1-a)*o[0],a*r[1]+(1-a)*o[1]];e.lineTo.apply(e,d),s=d,r=o}}e.lineTo.apply(e,(0,i.default)(t[t.length-1]))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=y(n(5)),r=y(n(2)),i=y(n(0)),o=y(n(1)),s=y(n(3)),u=y(n(4)),l=y(n(9)),c=n(13),d=n(16),p=n(58),h=y(p),f=n(30),g=n(39),v=n(143);function y(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="move",e.points=[],e.activate=!1,e.activateOpId="",e.description="移动操作工具。内部使用，不提供对外接口",e.idsBeenMoved=[],e.snapsBeenMoved={},e.auxLock={pos:[0,0],lockX:0,lockY:0,unlockXCount:0,unlockYCount:0},e.keyDownMoveEnd=function(){if(e.keyMove){var t={type:"move",sp:[0,0],ep:[e.keyMove.dx,e.keyMove.dy],dependOn:e.keyMove.moveIds,inProgress:!1};e.opsManager.graphOp.handleElePosChange(e.keyMove.snaps,t,e.keyMove.opId,e.keyMove.opId+"_move"),clearTimeout(e.keyMove.timer)}e.keyMove=void 0},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("MousedownPlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseup.tap("MouseupPlugin",this.handleMouseUp.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleMouseMove",value:function(e,t,n,a,r){if(this.opsManager.currOp instanceof h.default){if(t=Number(t.toFixed(3)),n=Number(n.toFixed(3)),this.activate){var i=(0,v.getMoveInAuxiliaryLine)(this.app,t,n,this.auxLock);if(!i)return!0;t=i.mx,n=i.my,this.points.push([t,n]);var o=this.getSnapshot(!0,this.idsBeenMoved),s=this.opsManager.auxiliaryOp.calcAuxiliaryLine({opsBeforeChange:this.snapsBeenMoved,snap:o,action:"move",ids:this.idsBeenMoved.slice()});return(0,v.updateAuxLock)(this.auxLock,t,n,s),this.opsManager.graphOp.handleElePosChange(this.snapsBeenMoved,o,this.activateOpId,this.activateOpId+"_move"),!0}if(!this.isMouseDown){if(!(0,d.linkSelectOnly)(this.opsManager.selectedOpIds,this.drawOpsOfPage)&&this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds))return document.body.style.cursor="move",!0;var u=(0,d.findOpsUnderMouse)(this.app,this.app.scale,[[t,n]],this.drawOpsOfPage,this.opsManager),l=(0,d.arrayDeduce)(u,this.opsManager.selectedOpIds);if((0,d.linkSelectOnly)(l,this.drawOpsOfPage))return void(document.body.style.cursor="default");l.length>0?document.body.style.cursor="move":document.body.style.cursor="default"}}}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof h.default){if(t=Number(t.toFixed(3)),n=Number(n.toFixed(3)),this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds)&&!(0,d.linkSelectOnly)(this.opsManager.selectedOpIds,this.drawOpsOfPage))return this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=this.opsManager.selectedOpIds,this.points=[[t,n]],this.activate=!0,this.activateOpId=this.opsManager.currPage.getNextOpId(!0),this.snapsBeenMoved=(0,g.deepCopySnapBeforeMove)(this.idsBeenMoved,this.drawOpsOfPage),!0;var a=(0,d.findOpsUnderMouse)(this.app,this.app.scale,[[t,n]],this.drawOpsOfPage,this.opsManager);if((a=this.opsManager.groupOp.getOpIdsInGroups(a)).length>0){if((0,d.linkSelectOnly)(a,this.drawOpsOfPage))return;return this.dispatch(this.opsManager.selectOp.getSnapshot([])),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=this.opsManager.groupOp.getOpIdsInGroups(a.slice()),this.points=[[t,n]],this.activate=!0,this.activateOpId=this.opsManager.currPage.getNextOpId(!0),this.snapsBeenMoved=(0,g.deepCopySnapBeforeMove)(this.idsBeenMoved,this.drawOpsOfPage),!0}}this.activate=!1}},{key:"handleMouseUp",value:function(){if(this.auxLock.lockX=0,this.auxLock.lockY=0,this.opsManager.auxiliaryOp.clean(),this.activate&&(this.activate=!1,this.points.length>0&&this.isMouseMoved))return this.opsManager.graphOp.handleElePosChange(this.snapsBeenMoved,this.getSnapshot(!1,this.idsBeenMoved),this.activateOpId,this.activateOpId+"_move"),!0}},{key:"handleKeyDown",value:function(e){var t,n=this;if(this.opsManager.currOp instanceof h.default&&this.opsManager.selectedOpIds.length>0){if((0,d.linkSelectOnly)(this.opsManager.selectedOpIds,this.drawOpsOfPage))return;var a=e.key.toLocaleLowerCase(),r=Date.now(),i=(this.keyMove?r-this.keyMove.last:120)<110?6:1,o=0,s=0;if("arrowup"===a?s=-i:"arrowdown"===a?s=i:"arrowleft"===a?o=-i:"arrowright"===a&&(o=i),0!==o||0!==s){clearTimeout(null===(t=this.keyMove)||void 0===t?void 0:t.timer),void 0===this.keyMove?this.keyMove={timer:null,dx:o,dy:s,last:r,opId:this.opsManager.currPage.getNextOpId(!0),moveIds:this.opsManager.selectedOpIds.slice(),snaps:(0,g.deepCopySnapBeforeMove)(this.opsManager.selectedOpIds.slice(),this.drawOpsOfPage)}:(this.keyMove.dx+=o,this.keyMove.dy+=s,this.keyMove.last=r);var u={type:"move",sp:[0,0],ep:[this.keyMove.dx,this.keyMove.dy],dependOn:this.keyMove.moveIds,inProgress:!0};this.opsManager.graphOp.handleElePosChange(this.keyMove.snaps,u,this.keyMove.opId,this.keyMove.opId+"_move"),this.keyMove.timer=setTimeout((function(){n.keyDownMoveEnd()}),1e3)}}}},{key:"getSnapshot",value:function(e,t){return{type:"move",sp:this.points[0],ep:this.points[this.points.length-1],dependOn:t.slice(),inProgress:e}}},{key:"mouseInSelectedEleBoundary",value:function(e,t,n){var a=this;if(0===(n=n.filter((function(e){return a.drawOpsOfPage.hasOwnProperty(e)}))).length)return!1;var r=p.SELECT_PAD;if(n.length>1){var i=n.map((function(e){var t=a.drawOpsOfPage[e];return(0,c.getTransformedBoundary)(a.app.scale,t.data)})).reduce((function(e,t){return(0,c.combineBoundary)(e,t)}));return(0,c.pointInRect)(i,r,[e,t])}var o=this.drawOpsOfPage[n[0]],s=(0,c.getTransformedVertices)(o.data);return(0,c.pointInVertices)(s,[e,t])}},{key:"transformOp",value:function(e,t){if("link"===e.data.type)return e;var n=void 0,r=void 0;return Array.isArray(t.points)?(n=t.points[t.points.length-1][0]-t.points[0][0],r=t.points[t.points.length-1][1]-t.points[0][1]):(n=t.ep[0]-t.sp[0],r=t.ep[1]-t.sp[1]),(0,a.default)({},e,{data:(0,a.default)((0,a.default)({},e.data),{mat:(0,f.panMat)(e.data.mat,n,r)})})}}]),t}(l.default);t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=v(n(5)),r=v(n(2)),i=v(n(0)),o=v(n(1)),s=v(n(3)),u=v(n(4)),l=v(n(9)),c=v(n(58)),d=n(13),p=n(97),h=n(30),f=n(39),g=n(143);function v(e){return e&&e.__esModule?e:{default:e}}var y=["text","video","image"],m=["audio"],M=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="scale",e.coordinateX=0,e.coordinateY=0,e.v1=[1,0],e.v2=[0,1],e.activate=!1,e.activateOpId="",e.idsBeenScaled=[],e.snapsBeenScaled={},e.auxLock={pos:[0,0],lockX:0,lockY:0,unlockXCount:0,unlockYCount:0},e.description="缩放",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MouseMovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mousedown.tap("MouseMovePlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mouseup.tap("MouseMovePlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof c.default){var a=this.mousePosTest(t,n);document.body.style.cursor=a.cursorSuggestion;var r=this.opsManager.selectedOpIds;if(0===r.length)return;if(!0===a.value){this.beginBatch(),this.activate=!0,this.activateOpId=this.opsManager.currPage.getNextOpId(!0),this.idsBeenScaled=r,this.snapsBeenScaled=(0,f.deepCopySnapBeforeMove)(this.idsBeenScaled,this.drawOpsOfPage),this.coordinateX=a.coordinateX,this.coordinateY=a.coordinateY;var i=a.angle,o=a.xSign,s=a.ySign;return this.v1=[o*Math.cos(i)/a.w,o*Math.sin(i)/a.w],this.v2=[-s*Math.sin(i)/a.h,s*Math.cos(i)/a.h],!0}}this.activate=!1}},{key:"handleMouseMove",value:function(e,t,n,a,r){if(this.opsManager.currOp instanceof c.default){var i=this.opsManager.selectedOpIds;if(this.activate){var o=(0,g.getMoveInAuxiliaryLine)(this.app,t,n,this.auxLock);if(!o)return!0;t=o.mx,n=o.my;var s=t-this.coordinateX,u=n-this.coordinateY,l=s*this.v1[0]+u*this.v1[1],d=s*this.v2[0]+u*this.v2[1];this.idsBeenScaled.length>1&&(d=l=Math.min(l,d)),this.scaleInfo={scaleX:{coordinate:this.coordinateX,factor:l},scaleY:{coordinate:this.coordinateY,factor:d}};var p=this.getSnapshot(!0,this.idsBeenScaled),h=this.opsManager.auxiliaryOp.calcAuxiliaryLine({opsBeforeChange:this.snapsBeenScaled,snap:p,action:"scale",ids:this.idsBeenScaled.slice(),exclude:[{dir:"h",val:this.coordinateY},{dir:"v",val:this.coordinateX}]});return(0,g.updateAuxLock)(this.auxLock,t,n,h),this.opsManager.graphOp.handleElePosChange(this.snapsBeenScaled,this.getSnapshot(!0,this.idsBeenScaled),this.activateOpId,this.activateOpId+"_scale"),!0}if(this.opsManager.currOp instanceof c.default&&!this.isMouseDown&&i.length>0){var f=this.mousePosTest(t,n);if(document.body.style.cursor=f.cursorSuggestion,"default"!==f.cursorSuggestion)return!0}else document.body.style.cursor="default"}}},{key:"handleMouseUp",value:function(){if(this.auxLock.lockX=0,this.auxLock.lockY=0,this.opsManager.auxiliaryOp.clean(),this.activate&&this.scaleInfo)return this.activate=!1,this.opsManager.graphOp.handleElePosChange(this.snapsBeenScaled,this.getSnapshot(!1,this.idsBeenScaled),this.activateOpId,this.activateOpId+"_scale"),this.scaleInfo=void 0,!0;this.activate=!1,this.scaleInfo=void 0}},{key:"mousePosTest",value:function(e,t){var n=this,a=this.opsManager.opMap.select.selectInfo,r=this.opsManager.selectedOpIds;if(0===(r=r.filter((function(e){return n.drawOpsOfPage.hasOwnProperty(e)}))).length||!a)return{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,xSign:1,ySign:1,angle:0,w:1,h:1};var i=a.boundary,o=a.pad,s=i.isCombined?[i.sx,i.sy]:i.p1,u=i.isCombined?[i.sx+i.w,i.sy]:i.p2,l=i.isCombined?[i.sx+i.w,i.sy+i.h]:i.p3,c=i.isCombined?[i.sx,i.sy+i.h]:i.p4,h=i.isCombined?i.w:Math.sqrt((u[0]-s[0])*(u[0]-s[0])+(u[1]-s[1])*(u[1]-s[1])),f=i.isCombined?i.h:Math.sqrt((c[0]-s[0])*(c[0]-s[0])+(c[1]-s[1])*(c[1]-s[1]));h=Math.max(h,1),f=Math.max(f,1);var g=a.rotateIcon?a.rotateIcon.angle:0,v=0,y=1,m=1,M=!0;if(1===r.length){var x=this.drawOpsOfPage[r[0]];"link"===x.data.type&&(M=!1),x&&x.data.xFactor&&(v+=x.data.xFactor>0?0:Math.PI/2,y=x.data.xFactor>0?1:-1),x&&x.data.yFactor&&(v+=x.data.yFactor>0?0:-Math.PI/2,m=x.data.yFactor>0?1:-1)}var w=15;return-1!==p.TouchPlatformArray.indexOf(this.app.platform)&&(w*=2.2),w/=this.app.scale,M&&(0,d.pointCollideWithPoint)([e,t],(0,d.getPointAftPad)(l,o,g,2,y,m),w)?{value:!0,cursorSuggestion:(0,d.getScaleCursor)(Math.PI/4+g+v),coordinateX:s[0],coordinateY:s[1],xSign:y,ySign:m,angle:g,w:h,h:f}:M&&(0,d.pointCollideWithPoint)([e,t],(0,d.getPointAftPad)(c,o,g,3,y,m),w)?{value:!0,cursorSuggestion:(0,d.getScaleCursor)(Math.PI/4*3+g+v),coordinateX:u[0],coordinateY:u[1],xSign:-y,ySign:m,angle:g,w:h,h:f}:M&&(0,d.pointCollideWithPoint)([e,t],(0,d.getPointAftPad)(s,o,g,0,y,m),w)?{value:!0,cursorSuggestion:(0,d.getScaleCursor)(Math.PI/4*5+g+v),coordinateX:l[0],coordinateY:l[1],xSign:-y,ySign:-m,angle:g,w:h,h:f}:M&&(0,d.pointCollideWithPoint)([e,t],(0,d.getPointAftPad)(u,o,g,1,y,m),w)?{value:!0,cursorSuggestion:(0,d.getScaleCursor)(Math.PI/4*7+g+v),coordinateX:c[0],coordinateY:c[1],xSign:y,ySign:-m,angle:g,w:h,h:f}:{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,xSign:1,ySign:1,angle:0,w:1,h:1}}},{key:"getSnapshot",value:function(e,t){return{type:"scale",inProgress:e,scaleInfo:this._clipScaleInfo(),dependOn:t.slice()}}},{key:"_clipScaleInfo",value:function(){return this.scaleInfo?{scaleX:{coordinate:Number(this.scaleInfo.scaleX.coordinate.toFixed(3)),factor:Number(this.scaleInfo.scaleX.factor.toFixed(3))},scaleY:{coordinate:Number(this.scaleInfo.scaleY.coordinate.toFixed(3)),factor:Number(this.scaleInfo.scaleY.factor.toFixed(3))}}:this.scaleInfo}},{key:"transformOp",value:function(e,t){if("link"===e.data.type)return e;var n=Array.isArray(t.scaleList)?t.scaleList[t.scaleList.length-1]:t.scaleInfo,r={coordinate:void 0===n.scaleX?0:n.scaleX.coordinate,factor:void 0===n.scaleX?1:n.scaleX.factor},i={coordinate:void 0===n.scaleY?0:n.scaleY.coordinate,factor:void 0===n.scaleY?1:n.scaleY.factor};if(-1!==y.indexOf(e.data.type)){var o=(n.scaleX.factor||1)/2+(n.scaleY.factor||1)/2;r.factor=o,i.factor=o}else-1!==m.indexOf(e.data.type)&&(i.factor=1);return"text"!==e.data.type?(0,a.default)({},e,{data:(0,a.default)((0,a.default)({},e.data),{mat:(0,h.scaleMat)(e.data.mat,e.data.rAngle,r,i),xFactor:(e.data.xFactor||1)*r.factor,yFactor:(e.data.yFactor||1)*i.factor})}):(0,a.default)({},e,{data:(0,a.default)((0,a.default)({},e.data),{mat:(0,h.scaleMat)(e.data.mat,e.data.rAngle,r,i),fontSize:Math.abs(e.data.fontSize*r.factor),xFactor:(e.data.xFactor||1)*r.factor,yFactor:(e.data.yFactor||1)*i.factor})})}}]),t}(l.default);t.default=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(5)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="delete",e.description="删除元素。",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"删除当前选中的元素"}},"delete:deleteOps":{value:this.deleteOps.bind(this),information:{args:"opIds: Array<string>",message:"删除ops"}}}}},{key:"handleKeyDown",value:function(e){var t=e.key.toLocaleLowerCase();if(-1!==["backspace","delete"].indexOf(t))return this.execCommand(),!0}},{key:"deleteOps",value:function(e){Array.isArray(e)&&e.length>0&&this.dispatch(this.getSnapshot(e))}},{key:"execCommand",value:function(){this.opsManager.selectedOpIds.length>0&&this.dispatch(this.getSnapshot(this.opsManager.selectedOpIds))}},{key:"getSnapshot",value:function(e){for(var t in e=e.slice(),this.drawOpsOfPage){var n=this.drawOpsOfPage[t];if("link"===n.data.type&&-1===e.indexOf(t)){if(n.data.start&&n.data.start.id&&-1!==e.indexOf(n.data.start.id)){e.push(t);continue}if(n.data.end&&n.data.end.id&&-1!==e.indexOf(n.data.end.id)){e.push(t);continue}}}return{type:this.type,dependOn:e}}},{key:"transformOp",value:function(e,t){var n=(0,a.default)({},e.data,{deleted:!0});return(0,a.default)({},e,{data:n})}}]),t}(l(n(9)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(7)),r=p(n(37)),i=p(n(2)),o=p(n(0)),s=p(n(1)),u=p(n(3)),l=p(n(4)),c=p(n(9)),d=n(45);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="undo",e.description="撤销操作",e.idsCouldUndo=new r.default,e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"getCount",value:function(){return this.idsCouldUndo.size}},{key:"registerHooks",value:function(){this.opsManager.hooks.opAdd.tap("OpAdd",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"z"===e.key.toLocaleLowerCase()&&this.app.container.isCtrlPressed()&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldUndo.clear(),this.emit("event:appState:change","undoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldUndo.clear();else{if(e.data.skipUndo||e.data.inProgress||-1!==d.snapshotOutOfNormalFlowTypes.indexOf(e.data.type))return;if(e.uid!==this.app.account)return;if("undo"===e.data.type){if(e.data.undoOpId&&this.idsCouldUndo.delete(e.data.undoOpId),Array.isArray(e.data.undoOpIds)){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,a.default)(e.data.undoOpIds);!(t=(i=o.next()).done);t=!0){var s=i.value;this.idsCouldUndo.delete(s)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}}else"undo"!==e.data.type&&this.idsCouldUndo.add(e.opId)}this.emit("event:appState:change","undoCount",this.idsCouldUndo.size)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldUndo.size&&(this.getSnapshot().undoOpIds.length>0&&this.dispatch(this.getSnapshot()))}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t=[],n=-1,i=new r.default,o=e.length-1;o>=0;o--){var s=e[o],u=s.data.inProgress||s.data.skipUndo||-1!==d.snapshotOutOfNormalFlowTypes.indexOf(s.data.type)||s.uid!==this.app.account;if("undo"===s.data.type||u||i.has(s.opId)){if("undo"===s.data.type&&(s.data.undoOpId&&i.add(s.data.undoOpId),Array.isArray(s.data.undoOpIds))){var l=!0,c=!1,p=void 0;try{for(var h,f=(0,a.default)(s.data.undoOpIds);!(l=(h=f.next()).done);l=!0){var g=h.value;i.add(g)}}catch(e){c=!0,p=e}finally{try{!l&&f.return&&f.return()}finally{if(c)throw p}}}}else{var v=s.time;-1===n?(t.push(s.opId),n=v):Math.abs(v-n)<100&&t.push(s.opId)}}return{type:"undo",undoOpIds:t}}}]),t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(37)),r=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),l=d(n(9)),c=n(45);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="redo",e.description="重做操作",e.idsCouldRedo=new a.default,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getCount",value:function(){return this.idsCouldRedo.size}},{key:"registerHooks",value:function(){this.opsManager.hooks.opAdd.tap("OpAdd",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"y"===e.key.toLocaleLowerCase()&&this.app.container.isCtrlPressed()&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldRedo.clear(),this.emit("event:appState:change","redoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldRedo.clear();else{if(e.data.inProgress||e.data.skipUndo||-1!==c.snapshotOutOfNormalFlowTypes.indexOf(e.data.type))return;if(e.uid!==this.app.account)return;"redo"===e.data.type?this.idsCouldRedo.delete(e.data.redoOpId):"undo"===e.data.type?this.idsCouldRedo.add(e.opId):this.idsCouldRedo.clear()}this.emit("event:appState:change","redoCount",this.idsCouldRedo.size)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldRedo.size&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",n=0,a=e.length-1;a>=0;a--){var r=e[a];if(r.uid===this.app.account){if("undo"===r.data.type&&0===n){t=r.opId;break}"undo"===r.data.type?n--:"redo"===r.data.type?n++:r.data.skipUndo||-1!==c.snapshotOutOfNormalFlowTypes.indexOf(r.data.type)||this.logger.warn("DEV--\x3e","redo操作之前有非undo操作。请查看具体细节",e)}}return{type:this.type,redoOpId:t}}}]),t}(l.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(18)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="clear",e.description="清空操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"isAvailable",value:function(){return(0,a.default)(this.drawOpsOfPage).length>0}},{key:"registerHooks",value:function(){this.opsManager.hooks.refresh.tap("RefreshPlugin",this.onRefresh.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){(0,a.default)(this.drawOpsOfPage).length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"onRefresh",value:function(){var e=(0,a.default)(this.drawOpsOfPage).length>0;this.emit("event:appState:change","clearAvailable",e)}}]),t}(l(n(9)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="eraser",e.eraserColor="rgba(230, 100, 100, .4)",e.width=20,e.points=[],e.description="橡皮擦",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handleMouseMove",value:function(e,t,n){this.isMouseDown&&(this.points.push([t,n]),this.dispatch(this.getSnapshot()))}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.points=[],this.points.push([t,n])}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&(this.dispatch(this.getSnapshot()),this.points=[])}},{key:"getSnapshot",value:function(){return{type:this.type,points:this.points.slice(),width:this.width}}},{key:"draw",value:function(e,t){t.save(),t.fillStyle="rgb(0, 0, 0)";var n=e.data.points;t.beginPath(),t.globalCompositeOperation="destination-out";for(var a=1;a<n.length;a++)t.moveTo(n[a][0],n[a][1]),t.arc(n[a][0],n[a][1],this.width,0,2*Math.PI,!0);t.fill(),t.restore(),this.drawEraserSignpost(t)}},{key:"drawEraserSignpost",value:function(e){this.opsManager.currOp instanceof t&&this.isMouseDown&&(e.beginPath(),e.arc(this.points[this.points.length-1][0],this.points[this.points.length-1][1],this.width,0,2*Math.PI,!0),e.fillStyle=this.eraserColor,e.fill())}}]),t}(u(n(9)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(18)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="page",e.description="页面相关操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("pageChangePlugin",this.onPageChange.bind(this))}},{key:"onPageChange",value:function(){return this.emit("event:appState:change","page",{activeIndex:this.opsManager.currBoard.getCurrPageIndex(),pageNames:this.opsManager.currBoard.pageNames.slice(),currPage:this.opsManager.currBoard.currIndex,pagePayloads:this.opsManager.currBoard.payloadOfPages})}},{key:"eventsToListen",value:function(){return{"page:goto":{value:this.goto.bind(this),information:{args:"page: number",message:"跳转至页面"}},"page:add":{value:this.add.bind(this),information:{args:"opt: {insertAfter?: number, payload?: any}",message:"添加页面。默认添加至当前board最后"}},"page:delete":{value:this.delete.bind(this),information:{args:"page: number",message:"删除页面。只有当页面数量大于1时可以删除页面"}}}}},{key:"add",value:function(e){this.dispatch({type:this.type,action:"add",insertAfter:e.insertAfter,payload:e.payload})}},{key:"goto",value:function(e){e!==this.opsManager.currBoard.currIndex&&-1!==this.opsManager.currBoard.pageNames.indexOf(e.toString())&&this.dispatch({type:this.type,action:"goto",page:e})}},{key:"delete",value:function(e){var t=this.opsManager.currBoard.pages;e in t&&(0,a.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",page:e})}}]),t}(l(n(9)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(28)),r=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4)),l=p(n(14)),c=p(n(9)),d=n(144);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},f=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="image",e.description="图片操作",e.dispatchImage=function(t,n,a,r){var i=(0,d.getImageProperPosition)(e,n,a),o=i.sx,s=i.sy;r?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:o,sy:s,w:n,h:a}},r):e.dispatch({type:e.type,url:t,boundary:{sx:o,sy:s,w:n,h:a}})},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{"image:upload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        pageName?: string,\n                        boardName?: string\n                    }",message:"上传图片"}}}}},{key:"addImage",value:function(e,t){return(0,d.addImage)(this.app,this,e,t)}},{key:"preview",value:function(e,t,n){var a=e.data,r=a.crop?a.crop.boundary:a.boundary;if(t.save(),a.mat){var i=a.mat;t.transform(i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2])}(0,d.draw)(this.app,t,a.url,a.boundary,{baseBoundary:r,page:n.page,supportToDataUrl:n.supportToDataUrl,preview:!0}),t.restore()}},{key:"draw",value:function(e,t,n){var a=e.data,r=a.crop?a.crop.boundary:a.boundary;if(t.save(),a.mat){var i=a.mat;t.transform(i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2])}(0,d.draw)(this.app,t,a.url,a.boundary,{cropping:!!a.crop&&a.crop.inProgress,baseBoundary:r,page:n.page,id:e.opId,type:"image"}),a.crop&&a.crop.inProgress&&this.opsManager.cropOp.drawCrop(t,a),t.restore()}},{key:"hide",value:function(e,t,n){var a,r=n.querySelector("[id='"+e.opId+"']");null===(a=null==r?void 0:r.parentNode)||void 0===a||a.removeChild(r)}},{key:"waitTilReady",value:function(e){return h(this,void 0,void 0,a.default.mark((function t(){var n=this;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.app.resourceCache.resourceLoaded(e.data.url)){t.next=4;break}return t.abrupt("return",l.default.resolve());case 4:return t.abrupt("return",new l.default((function(t){n.app.resourceCache.fetchResource(e.data.url,(function(){t()}))})));case 5:case"end":return t.stop()}}),t,this)})))}}]),t}(c.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(18)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="board",e.description="board相关操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"onBoardChange",value:function(){var e=this;setTimeout((function(){return e.emit("event:appState:change","board",{boardNames:(0,a.default)(e.app.room.boards),boardDisplayNames:e.app.room.getBoardDisplayNames(),currBoard:e.app.room.currIndex,currBoardDisplayName:e.app.room.currBoard.displayName})}),0)}},{key:"eventsToListen",value:function(){return{"board:goto":{value:this.goto.bind(this),information:{args:"boardName: string",message:"跳转至board。若board不存在，则创建board"}},"board:add":{value:this.add.bind(this),information:{args:"displayName: string, boardName: string, pageCount: number, opt?: {\n                        width: number,\n                        height: number,\n                        template: string,\n                        offset?: number\n                    }",message:"创建[pageCount]页数的board"}},"board:delete":{value:this.delete.bind(this),information:{args:"boardName: string",message:"删除board。只有当board数量大于1时可以删除board"}}}}},{key:"goto",value:function(e){e!==this.app.room.currIndex&&this.dispatch({type:this.type,action:"goto",boardName:e})}},{key:"add",value:function(e,t,n,a){var r=Array.isArray(null==a?void 0:a.backupResultUrls)?null==a?void 0:a.backupResultUrls:[];if(a){var i=a.width,o=a.height;try{if(i/o>this.app.container.width/this.app.container.height){var s=Math.max(this.app.container.width,600);o=o/i*s,i=s}else{var u=Math.max(this.app.container.height,600);i=i/o*u,o=u}}catch(e){this.app.logger.error("[白板] add background error",e,i,o,this.app.container.width,this.app.container.height)}this.dispatch({type:this.type,action:"add",boardName:t,displayName:e,pageCount:n,w:i,h:o,tmpl:a.template,backupResultUrls:r,offset:a.offset?a.offset:0})}else this.dispatch({type:this.type,action:"add",boardName:t,displayName:e,pageCount:n})}},{key:"delete",value:function(e){var t=this.app.room.boards;e in t&&(0,a.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",boardName:e})}}]),t}(l(n(9)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COPY_PASTE_SHIFT=void 0;var a=x(n(7)),r=x(n(2)),i=x(n(0)),o=x(n(1)),s=x(n(3)),u=x(n(4)),l=x(n(9)),c=x(n(141)),d=n(16),p=n(13),h=n(30),f=n(145),g=n(31),v=x(n(33)),y=x(n(23)),m=n(29),M=n(39);function x(e){return e&&e.__esModule?e:{default:e}}var w=t.COPY_PASTE_SHIFT=50;function I(e){navigator.clipboard?navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(e){console.error("Async: Could not copy text: ",e)})):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+n)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}(e)}var b=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="duplicate",e.description="",e.copiedSnapshotArray=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"复制当前选中的元素"}}}}},{key:"copy",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=(0,d.filterNonMediaOpIds)(this,this.opsManager.selectedOpIds);a.length>0&&(this.copiedSnapshotArray=(0,c.default)(a.map((function(e){return t.drawOpsOfPage[e]}))),n&&e&&(e.preventDefault(),e.stopPropagation(),I("")))}},{key:"paste",value:function(e){var t,n,r,i=this,o=e.mx,s=e.my,u=e.fromWb,l=e.event,c=l&&(l.clipboardData||window.clipboardData||l.originalEvent.clipboardData),p=c&&c.items||[],h=c&&c.getData("Text"),m=!1,M=!0,x=!1,w=void 0;try{for(var I,b=(0,a.default)(p);!(M=(I=b.next()).done);M=!0){var k=I.value;if("file"===k.kind&&0===k.type.indexOf("image/")){m=!0;var T=k.getAsFile();(0,g.showToast)({type:"info",msg:"处理中，请稍候...",time:3,msgType:v.default.PASTE_IMG_UPLOAD_WAIT}),(0,f.uploadMedia)(this.app,{blob:T,fileName:"temp.png",mediaType:"image",uploadprogress:function(e){},done:function(e,t){if((0,g.hideToast)(),e){var n=(null==e?void 0:e.msg)||(null==e?void 0:e.message)||"图片上传失败";(0,g.showToast)({type:"error",msg:n,time:3,msgType:v.default.PASTE_IMG_UPLOAD_ERROR}),i.logger.error("[白板] 粘贴图片上传失败",e)}else if(!e){var a=i.dispatch({type:"image",url:t.url,boundary:{sx:(o||0)-t.width/2,sy:(s||0)-t.height/2,w:t.width,h:t.height}});i.dispatch(i.opsManager.selectOp.getSnapshot([a]))}}})}}}catch(e){x=!0,w=e}finally{try{!M&&b.return&&b.return()}finally{if(x)throw w}}var _=void 0;if(!m)if(u||!h){if(this.copiedSnapshotArray.length>0){var C=this.getSnapshot(this.copiedSnapshotArray,o,s);_=C.duplicates.map((function(e){return e.opId}));var N=0,A=0,P=0;for(P=0;P<C.duplicates.length;P++){A+=700;var O=C.duplicates[P];if("pen"===O.data.type)A+=13*(O.data.points||[]).length;else if("shape"===O.data.type)A+=((null===(t=O.data.text)||void 0===t?void 0:t.value)||"").length;else if("text"===O.data.type)A+=(O.data.text||"").length;else if("link"===O.data.type){var D=(null===(r=null===(n=O.data)||void 0===n?void 0:n.text)||void 0===r?void 0:r.arr)||[],S=!0,E=!1,j=void 0;try{for(var L,z=(0,a.default)(D);!(S=(L=z.next()).done);S=!0){A+=(L.value.value||"").length}}catch(e){E=!0,j=e}finally{try{!S&&z.return&&z.return()}finally{if(E)throw j}}}A>15e3&&(this.dispatch({type:"duplicate",duplicates:C.duplicates.slice(N,P+1)},!0),N=P+1,A=0)}P>N&&this.dispatch({type:"duplicate",duplicates:C.duplicates.slice(N,P+1)},!0)}}else if(!u&&h){var R=(h||"").slice(0,1200);R=(0,d.convertWinTxtToUnixTxt)(R);var B=this.opsManager.textOp.getTextSize({text:R,fontSize:y.default.textDef.fontSize,fontFamily:y.default.textDef.fontFamily});_=[this.dispatch({boundary:{sx:(o||0)-B.w/2,sy:(s||0)-B.h/2,w:B.w,h:B.h},type:"text",stroke:y.default.textDef.stroke,fill:y.default.textDef.fill,text:R,fontSize:y.default.textDef.fontSize,fontFamily:y.default.textDef.fontFamily,textAlign:y.default.textDef.textAlign,inProgress:!1,skipUndo:!1})]}_&&this.dispatch(this.opsManager.selectOp.getSnapshot(_))}},{key:"execCommand",value:function(){this.copy(!1),this.paste({fromWb:!0,event:void 0})}},{key:"getSnapshot",value:function(e,t,n){var a=this,r=e.map((function(e){return(0,p.getTransformedBoundary)(a.app.camera.scale,e.data)})).reduce((function(e,t){return(0,p.combineBoundary)(e,t)})),i=w,o=w;"number"==typeof t&&"number"==typeof n&&(i=t-r.sx-r.w/2,o=n-r.sy-r.h/2);var s={};return(e=e.map((function(e){var t=e.opId;return"link"!==(e=(0,c.default)(e)).data.type&&(e.data.mat=(0,h.panMat)(e.data.mat,i,o)),e.opId=a.opsManager.currPage.getNextOpId(!0),s[t]=e.opId,e}))).forEach((function(e){if("link"===e.data.type){var t=e.data;t.start.type===m.IEndPointType.COORD?(t.start.x+=i,t.start.y+=o):s.hasOwnProperty(t.start.id)?t.start.id=s[t.start.id]:t.start={type:m.IEndPointType.COORD,x:(0,M.getLinkEndPos)(a.app,t.start,a).x+i,y:(0,M.getLinkEndPos)(a.app,t.start,a).y+o,aType:t.start.aType,dir:t.start.dir},t.end.type===m.IEndPointType.COORD?(t.end.x+=i,t.end.y+=o):s.hasOwnProperty(t.end.id)?t.end.id=s[t.end.id]:t.end={type:m.IEndPointType.COORD,x:(0,M.getLinkEndPos)(a.app,t.end,a).x+i,y:(0,M.getLinkEndPos)(a.app,t.end,a).y+o,aType:t.end.aType,dir:t.end.dir},t.connPs.forEach((function(e){e.x+=i,e.y+=o}))}})),{type:this.type,duplicates:e}}}]),t}(l.default);t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(19)),r=h(n(5)),i=h(n(2)),o=h(n(0)),s=h(n(1)),u=h(n(3)),l=h(n(4)),c=n(13),d=h(n(217)),p=h(n(23));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="pen-arrow",e.description="带箭头的涂鸦操作工具。\n首先使用op:pen-arrow:activate设置画布为涂鸦模式。通过op:pen-arrow:lineWidth, op:pen-arrow:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getArrowPoints",value:function(e,t,n){t=Number(t);var a=[];if(e.length<3||!e[0]||!e[1]||!e[2])return a;if(e.length>1&&n){for(var r=e[e.length-1],i=void 0,o=e.length-2;o>=0&&o>=e.length-30;o--){var s=e[o];if(Math.abs(s[0]-r[0])+Math.abs(s[1]-r[1])>1){i=s;break}}void 0===i&&(i=e[o]);var u=[i,r],l=(0,c.getLineCoef)(u);if((0,c.dist)(u[0],u[1])>1){var d=u[1][0]-u[0][0]>0?(0,c.getXFromCoefAndOffset)(u[1],l,1):2*u[1][0]-(0,c.getXFromCoefAndOffset)(u[1],l,1),p=u[1][0]-u[0][0]==0?u[1][1]+(u[1][1]-u[0][1]>0?1:-1):(0,c.getLineFromPointsY)(u,d);u.push([d,p])}a=(0,c.getArrowPoints)(t+1,u)}return a}},{key:"getSnapshot",value:function(e){var t=this.points,n=!e&&t.length>2,a=this.getArrowPoints(t,p.default.penDef.lineWidth,n),i=this.opsManager.currPage.getOpId(),o=this.app.room.opIdSnapshotMap[i];if(!o||!o.snapshot.hasOwnProperty("category"))return(0,r.default)({points:t.slice(),arrowPoints:a,total:t.length},this.getFreeDrawCommonProperty({inProgress:e}));var s={boundary:this.getBoundaryRectOfFreeDraw()};return this.sampleSeq>0&&e?(0,r.default)((0,r.default)({},s),{points:t.slice(t.length-p.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,r.default)((0,r.default)({},s),{points:t.slice(t.length-p.default.pointsPerBatch),arrowPoints:a,inProgress:e,total:t.length}):(0,r.default)({points:t.slice(),arrowPoints:a,total:t.length},this.getFreeDrawCommonProperty({inProgress:e}))}},{key:"draw",value:function(e,t){t.save();var n=e.data,r=this._draw(e,t);if(t.strokeStyle=n.stroke||n.color,t.lineWidth=n.lineWidth,"number"==typeof n.opacity&&(t.globalAlpha=n.opacity),t.stroke(),3===n.arrowPoints.length){var i=this.getArrowPoints(r,n.lineWidth,!0);3===i.length&&(t.beginPath(),t.moveTo.apply(t,(0,a.default)(i[0])),t.lineTo.apply(t,(0,a.default)(i[1])),t.lineTo.apply(t,(0,a.default)(i[2])),t.fillStyle=n.stroke||n.color,t.fill())}t.restore()}}]),t}(d.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(19)),r=f(n(5)),i=f(n(2)),o=f(n(0)),s=f(n(1)),u=f(n(3)),l=f(n(4)),c=n(13),d=f(n(231)),p=n(30),h=f(n(23));function f(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="line-arrow",e.description="绘制带箭头线段。\n首先使用op:line-arrow:activate设置画布为线段模式。通过op:line-arrow:lineWidth, op:line-arrow:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t=!e&&this.points.length>2,n=[];if(this.points.length>1&&t){var a=[this.sp,this.ep];n=(0,c.getArrowPoints)(h.default.penDef.lineWidth+1,a)}return(0,r.default)({arrowPoints:n},this.getTwoPointShapeCommonProperty({inProgress:e}))}},{key:"draw",value:function(e,t){t.save();var n=e.data,r=this.getStartEndPointFromSnapshot(n),i=r.sp,o=r.ep,s=(0,p.getTransPoint)(i,n.mat),u=(0,p.getTransPoint)(o,n.mat);if(t.beginPath(),t.moveTo.apply(t,(0,a.default)(s)),t.lineTo.apply(t,(0,a.default)(u)),t.strokeStyle=n.stroke||n.color,t.lineWidth=n.lineWidth,"number"==typeof n.opacity&&(t.globalAlpha=n.opacity),t.stroke(),3===n.arrowPoints.length){var l=(0,c.getArrowPoints)(Number(n.lineWidth)+1,[s,u]);t.beginPath(),t.moveTo.apply(t,(0,a.default)(l[0])),t.lineTo.apply(t,(0,a.default)(l[1])),t.lineTo.apply(t,(0,a.default)(l[2])),t.fillStyle=n.stroke||n.color,t.fill()}t.restore()}}]),t}(d.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(5)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="element-eraser",e.description="删除元素。",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"postMouseMove",value:function(e){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(234)+") 2 13, auto":document.body.style.cursor="auto"}},{key:"postMouseUp",value:function(e){this.postClick(e)}},{key:"postClick",value:function(e){this.dispatch(this.getSelectionSnapshot(!1,[]));var t=this.filterMediaIds(e);t.length>0&&this.dispatch(this.opsManager.deleteOp.getSnapshot(t))}},{key:"filterMediaIds",value:function(e){var t=this;return e.filter((function(e){var n=t.opsManager.drawOpsOfPage[e];return!n||!n.data||"audio"!==n.data.type&&"video"!==n.data.type}))}},{key:"getSnapshot",value:function(e){return{type:"element-eraser",dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,a.default)({},e.data,{deleted:!0});return(0,a.default)({},e,{data:n})}}]),t}(l(n(227)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(2)),r=h(n(0)),i=h(n(1)),o=h(n(3)),s=h(n(4)),u=h(n(9)),l=h(n(23)),c=n(16),d=n(136),p=h(d);function h(e){return e&&e.__esModule?e:{default:e}}var f=(0,d.pointInterpFn)("point"),g=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="laser",e.description="镭射灯",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this))}},{key:"handleOpChange",value:function(e){var t;"laser"!==e&&"laser"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&(document.body.style.cursor="default",this.dispatch(this.getSnapshot(!1)))}},{key:"handleMouseLeave",value:function(e,t,n){this.dispatch(this.getSnapshot(!1))}},{key:"handleMouseMove",value:function(e,t,n){var a=!0;this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="none":(document.body.style.cursor="auto",a=!1),this.dispatch(this.getSnapshot(a,[t,n]))}},{key:"getSnapshot",value:function(e,t){return{type:"laser",point:t,inProgress:e,skipUndo:!0,reuseOpType:"laser",color:l.default.penDef.stroke,nickname:this.app.nickname}}},{key:"intepSnap",value:function(e){return p.default.getSmootherSnapshot({app:this.app,snapshot:e,now:Date.now()+this.app.ntpTimeDiff,interpolateFn:f})}},{key:"draw",value:function(e,t){var n,a=e.data,r=Date.now()+this.app.ntpTimeDiff;if(this.app.isRecordPlayer){if(this.app.player&&(null===(n=this.app.player)||void 0===n?void 0:n.lastTime)-e.data.recordTime>9e4)return}else if(r-e.time>9e4)return;var i=6/this.app.scale;e.data.inProgress&&a.point&&(t.save(),t.beginPath(),t.arc(a.point[0],a.point[1],i,0,2*Math.PI,!0),t.shadowColor="rgba(255, 0, 0, 0.5)",t.shadowBlur=8,t.fillStyle="#ff0000",t.fill(),t.restore(),e.uid!==this.app.account&&this.app.appConfig.showLaserNickname&&(0,c.drawUserName)({ctx:t,account:a.nickname||e.uid,scale:this.app.scale,px:a.point[0],py:a.point[1],bgColor:a.color}))}}]),t}(u.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(5)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="lock",e.description="锁定元素。",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{lock:{value:this.lockOps.bind(this),information:{args:"opIds",message:"锁定元素"}},unlock:{value:this.unlockOps.bind(this),information:{args:"opIds",message:"解锁元素"}}}}},{key:"lockOps",value:function(e){this.dispatch(this.getSnapshot(e,"lock"))}},{key:"unlockOps",value:function(e){this.dispatch(this.getSnapshot(e,"unlock"))}},{key:"getSnapshot",value:function(e,t){return{type:this.type,action:t,dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,a.default)({},e.data,{locked:"lock"===t.action});return(0,a.default)({},e,{data:n})}}]),t}(l(n(9)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(28)),r=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4)),l=p(n(14)),c=p(n(9)),d=n(144);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},f=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="background",e.description="设置背景操作",e.getBoundaryFromSnapshot=function(t){var n=void 0;if(t.data.hasOwnProperty("imgWidth")){var a=(0,d.getImageProperPosition)(e,t.data.imgWidth,t.data.imgHeight);n={sx:a.sx,sy:a.sy,w:width,h:height}}else n=t.data.boundary;return n},e.dispatchImage=function(t,n,a,r){var i=(0,d.getBackgroundImagePorperPosition)(e,n,a),o=i.sx,s=i.sy,u=i.width,l=i.height;r?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}},r):e.dispatch({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}})},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{"background:imageUpload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number,\n                        pageName?: string,\n                        boardName?: string\n                    }",message:"上传背景图片"}}}}},{key:"addImage",value:function(e,t){return(0,d.addImage)(this.app,this,e,t)}},{key:"preview",value:function(e,t,n){var a=e.data;return(0,d.draw)(this.app,t,a.url,this.getBoundaryFromSnapshot(e),{page:n.page,supportToDataUrl:n.supportToDataUrl,preview:!0,backupUrls:e.data.backupUrls||[]})}},{key:"draw",value:function(e,t,n){var a=e.data;return(0,d.draw)(this.app,t,a.url,this.getBoundaryFromSnapshot(e),{page:n.page,id:e.opId,type:"background",backupUrls:e.data.backupUrls||[]})}},{key:"waitTilReady",value:function(e){return h(this,void 0,void 0,a.default.mark((function t(){var n=this;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.app.resourceCache.resourceLoaded(e.data.url)){t.next=4;break}return t.abrupt("return",l.default.resolve());case 4:return t.abrupt("return",new l.default((function(t){n.app.resourceCache.fetchResource(e.data.url,(function(){t()}))})));case 5:case"end":return t.stop()}}),t,this)})))}}]),t}(c.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(2)),r=h(n(0)),i=h(n(1)),o=h(n(3)),s=h(n(4)),u=h(n(9)),l=n(67),c=n(99),d=n(31),p=h(n(33));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="pan",e.activate=!1,e.description="平移操作",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pan.tap("pan",this.handlePan.bind(this))}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handleMouseMove",value:function(e,t,n,a,r){if(this.app.appConfig.cameraTransformEnabled&&(0,c.shouldDispatch)(this.app)){if(this.activate)document.body.style.cursor="grabbing";else{if(this.app.container.isTargetOnContainer(e.target))return document.body.style.cursor="grab",!0;document.body.style.cursor="auto"}return this.activate&&this.lastPoint?(this.dispatch(this.getSnapshot(a-this.lastPoint[0],r-this.lastPoint[1])),this.lastPoint=[a,r],!0):void 0}}},{key:"handlePan",value:function(e,t,n){if(this.app.appConfig.cameraTransformEnabled){if((0,c.shouldDispatch)(this.app)||(0,c.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(t,n)),!0;(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}})}}},{key:"handleMouseDown",value:function(e,t,n,a,r){this.app.appConfig.cameraTransformEnabled&&((0,c.shouldDispatch)(this.app)?(this.activate=!0,this.beginBatch(),this.lastPoint=[a,r]):(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}}))}},{key:"handleMouseUp",value:function(e,t,n,a,r){this.app.appConfig.cameraTransformEnabled&&(0,c.shouldDispatch)(this.app)&&(this.activate&&this.lastPoint&&(this.dispatch(this.getSnapshot(a-this.lastPoint[0],r-this.lastPoint[1])),this.lastPoint=void 0),this.activate=!1)}},{key:"getSnapshot",value:function(e,t){return(0,l.convertToCameraBoundSnapshot)(this.app.camera,{type:"pan",dx:-e,dy:-t,animate:!1})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(2)),r=h(n(0)),i=h(n(1)),o=h(n(3)),s=h(n(4)),u=h(n(9)),l=n(67),c=n(99),d=n(31),p=h(n(33));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="zoom",e.sp=[0,0],e.description="缩放操作",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousewheel.tap("MousewheelPlugin",this.handleMouseWheel.bind(this)),this.opsManager.hooks.scale.tap("Scale",this.handleScale.bind(this))}},{key:"eventsToListen",value:function(){return{"zoom:in":{value:this.zoomIn.bind(this),information:{args:"",message:"缩放"}},"zoom:out":{value:this.zoomOut.bind(this),information:{args:"",message:"缩放"}},"zoom:to":{value:this.zoomTo.bind(this),information:{args:"scale: number, animate: boolean",message:"缩放"}}}}},{key:"handleScale",value:function(e,t,n,a){this.app.appConfig.cameraTransformEnabled&&((0,c.shouldDispatch)(this.app)?this.app.scale*t>=10&&t>1||this.app.scale*t<=.1&&t<1||(this.beginBatch(),this.dispatch(this.getSnapshot(t,!1,[n,a]))):(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}}))}},{key:"handleMouseWheel",value:function(e,t,n,a,r){if(this.app.appConfig.cameraTransformEnabled)if((0,c.shouldDispatch)(this.app)){var i=void 0,o=this.app.appConfig.zoomSensitivity;if("gesturestart"!==e.type)if("gestureend"!==e.type){if("gesturechange"===e.type){if(void 0===this.gestureLastScale)return void(this.gestureLastScale=e.scale);i=e.scale/this.gestureLastScale,this.gestureLastScale=e.scale}else o=(1-("DOMMouseScroll"===e.type?1.1:Math.abs(e.deltaY)<20?Math.max(Math.min(Math.pow(Math.abs(e.deltaY)/4,2),.8),.1):Math.max(Math.min(Math.pow(Math.abs(e.deltaY)/150,2),1),.5)))*(1-o)+o,i="DOMMouseScroll"===e.type?e.detail>0?o:1/o:e.deltaY>0?o:1/o;this.app.scale*i>=10&&i>1||this.app.scale*i<=.1&&i<1||this.isMouseDown||this.app.container.isTargetOnContainer(e.target)&&(this.beginBatch(),this.dispatch(this.getSnapshot(i,!1,[a,r])))}else this.gestureLastScale=void 0;else this.gestureLastScale=e.scale}else(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}})}},{key:"zoomIn",value:function(){if((0,c.shouldDispatch)(this.app)&&!(this.app.scale/this.app.appConfig.zoomSensitivity>=10))return this.beginBatch(),this.dispatch(this.getSnapshot(1/this.app.appConfig.zoomSensitivity,!1))}},{key:"zoomOut",value:function(){if((0,c.shouldDispatch)(this.app)&&!(this.app.scale*this.app.appConfig.zoomSensitivity<=.1))return this.beginBatch(),this.dispatch(this.getSnapshot(this.app.appConfig.zoomSensitivity,!1))}},{key:"zoomTo",value:function(e,t){if((0,c.shouldDispatch)(this.app))return this.beginBatch(),this.dispatch(this.getSnapshot(e/this.app.scale,t))}},{key:"getSnapshot",value:function(e,t,n){return(0,l.convertToCameraBoundSnapshot)(this.app.camera,{type:"zoom",animate:t,center:n,scale:e})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(2)),r=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(9)),l=n(67),c=n(99);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="reset-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,c.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,l.convertToCameraBoundSnapshot)(this.app.camera,{type:"reset-camera",animate:e})}}]),t}(u.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=y(n(38)),r=y(n(2)),i=y(n(0)),o=y(n(1)),s=y(n(3)),u=y(n(4)),l=y(n(9)),c=y(n(224)),d=y(n(234)),p=y(n(319)),h=y(n(23)),f=n(16),g=n(136),v=y(g);function y(e){return e&&e.__esModule?e:{default:e}}var m=new Image,M=new Image,x=new Image;m.src=c.default,M.src=d.default,x.src=p.default;var w=(0,g.pointInterpFn)("point"),I=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="mouse-pointer",e.description="展示鼠标位置",e.sampleSeq=0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseleave.tap("MousemovePlugin",this.handleMouseLeave.bind(this))}},{key:"handleMouseMove",value:function(e,t,n){var a;if(this.app.showCursor&&"laser"!==(null===(a=this.opsManager.currOp)||void 0===a?void 0:a.type)){var r=this.app.container.isTargetOnContainer(e.target);this.sampleSeq%6==0&&this.dispatch(this.getSnapshot([t,n],r)),this.sampleSeq+=1}}},{key:"handleMouseLeave",value:function(e,t,n){var a;this.app.showCursor&&"laser"!==(null===(a=this.opsManager.currOp)||void 0===a?void 0:a.type)&&(this.dispatch(this.getSnapshot([t,n],!1)),this.sampleSeq=0)}},{key:"getSnapshot",value:function(e,t){return{type:"mouse-pointer",point:[Number(e[0].toFixed(1)),Number(e[1].toFixed(1))],c:h.default.penDef.stroke,show:t?1:0,op:this.opsManager.currOp?this.opsManager.currOp.type:"",reuseOpType:"mouse-pointer",nickname:this.app.nickname,inProgress:!0}}},{key:"preview",value:function(){}},{key:"intepSnap",value:function(e){return v.default.getSmootherSnapshot({app:this.app,snapshot:e,now:Date.now()+this.app.ntpTimeDiff,interpolateFn:w})}},{key:"draw",value:function(e,t){var n,r=(new Date).valueOf();if(this.app.isRecordPlayer){if(this.app.player&&(null===(n=this.app.player)||void 0===n?void 0:n.lastTime)-e.data.recordTime>5e3)return}else if(r-e.time>5e3)return;var i=e.data;if(e.uid!==this.app.account&&i.show&&i.point){var o=this.getImageByOpType(i.op),s=this.mapPointInsideContainer(i.point[0],i.point[1]),u=(0,a.default)(s,2),l=u[0],c=u[1];-1!==this.opsManager.drawOpTypes.indexOf(i.op)&&(l-=1/this.app.scale,c-=27/this.app.scale);var d=32/this.app.scale;t.drawImage(o,l,c,d,d),this.app.appConfig.showCursorNickname&&(0,f.drawUserName)({ctx:t,account:i.nickname||e.uid,scale:this.app.scale,px:l,py:c,bgColor:i.c})}}},{key:"mapPointInsideContainer",value:function(e,t){var n=this.app.camera.convertToPointInWorld(0,0),r=(0,a.default)(n,2),i=r[0],o=r[1],s=this.app.camera.convertToPointInWorld(this.app.container.width,this.app.container.height),u=(0,a.default)(s,2),l=u[0],c=u[1];return e<i+30?e=i+30:e>l-25&&(e=l-25),t<o+30?t=o+30:t>c-15&&(t=c-15),[e,t]}},{key:"getImageByOpType",value:function(e){return"element-eraser"===e?M:-1!==this.opsManager.drawOpTypes.indexOf(e)?m:x}}]),t}(l.default);t.default=I},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MzA2MTkyNDQ5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwOTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU2IDBsNjEyLjY1MDY2NyA1NzMuODI0LTI1MC4yODI2NjcgMjIuNzQxMzMzLTQ1LjQ0IDQuMDk2IDE4LjkwMTMzMyA0MS41NTczMzMgMTUxLjg1MDY2NyAzMzIuNTQ0TDYzMS42OCAxMDI0bC0xNDQuODk2LTMzNi4xMjgtMTguMTc2LTQyLjM2OC0zMy41Nzg2NjcgMzEuNTMwNjY3LTE3Ny43OTIgMTY2Ljc0MTMzM0wyNTYgMCIgcC1pZD0iMjA5NyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(2)),r=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=c(n(9)),l=n(67);function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="resize-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.resize.tap("ResizePlugin",this.handleResize.bind(this))}},{key:"handleResize",value:function(e,t,n){if(t&&n)if("follower"===this.app.vision.mode)this.app.camera.updateTransParamAndRefresh();else{var a=this.app.camera,r=this.app.camera.getNextCameraBound({type:"resize-camera",width:t,height:n,animate:!1});if(Math.abs(r.centerX-a.centerX)+Math.abs(r.centerY-a.centerY)+Math.abs(r.width-a.width)+Math.abs(r.height-a.height)<1)return;this.dispatch(this.getSnapshot(t,n))}else this.logger.warn("[白板] resize 宽高无效",t,n)}},{key:"getSnapshot",value:function(e,t){return(0,l.convertToCameraBoundSnapshot)(this.app.camera,{type:"resize-camera",width:e,height:t,animate:!1})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(2)),r=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(9)),l=n(67),c=n(99);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="fit-to-content",e.description="缩放至完全包含内容",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,c.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,l.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-content",animate:e})}}]),t}(u.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(2)),r=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(9)),l=n(67),c=n(99);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="fit-to-doc",e.description="缩放至完全包含文档",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,c.shouldDispatch)(this.app)&&(this.app.room.currBoard.currPage.backgroundSnapshot||this.app.room.currBoard.transDocSnapshot))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,l.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-doc",animate:e})}}]),t}(u.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="rect-fill",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({inProgress:e})}}]),t}(u(n(232)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="ellipse-fill",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({inProgress:e})}}]),t}(u(n(233)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="video",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"video:insert":{value:this.addMedia.bind(this),information:{args:"url: string, opts: {\n                        width: number,\n                        sourceType: string,\n                        title?: string\n                        pageName?: string\n                        boardName?: string\n                    }",message:"上传视频"}}}}},{key:"preview",value:function(e,t,n){var a=e.data;if(t.save(),a.mat){var r=a.mat;t.transform(r[0][0],r[1][0],r[0][1],r[1][1],r[0][2],r[1][2])}var i=a.boundary;try{this.app.resourceCache.mediaResourceLoaded(a.url,"video")&&!n.supportToDataUrl&&t.drawImage(this.app.resourceCache.getMediaResource(a.url),i.sx,i.sy,i.w,i.h)}catch(e){this.logger.error("error",e)}t.restore()}}]),t}(u(n(236)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(2)),r=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(237));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"onSizeChange",value:function(e){this.headerWidget&&this.controlWidget&&(this.headerWidget.style.visibility=e.height>130&&e.width>180?"visible":"hidden",this.controlWidget.style.visibility=e.height>130&&e.width>180?"visible":"hidden")}},{key:"getTitle",value:function(){return this.title?this.title:"视频文件"}},{key:"createControllor",value:function(){var e=document.createElement("div");this.progressController=new u.default(0,{emitEvent:this.allowControl()});var t=this.createControlContainer(),n=this.createPlayWidget(),a=this.createTimeIndicator(),r=this.createVolumeWidget();return e.appendChild(this.progressController.widget),e.appendChild(t),t.appendChild(n),t.appendChild(a),t.appendChild(r),e.style.userSelect="none",e.style.webkitUserSelect="none",e.className="media-control",this.controlWidget=e,e}}],[{key:"getElementWidth",value:function(e){return 550}},{key:"getElementHeight",value:function(e){var t=e;return t.videoWidth&&t.videoHeight?550*t.videoHeight/t.videoWidth:250}}]),t}(l(n(238)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(28)),r=u(n(5)),i=u(n(0)),o=u(n(1)),s=u(n(14));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n,a){return new(n||(n=s.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},c=function(){function e(t,n,a){var r=this;(0,i.default)(this,e),this.recordTime=0,this.handlePrePageChange=function(e){r.app.room.getPage(r.boardName,r.pageName)&&r.boardName===r.app.room.currIndex&&r.pageName===r.app.room.currBoard.currIndex.toString()&&"delete"!==e.data.action&&r.onPrePageChange(e.uid)},this.handlePlayerPlay=function(){r.boardName===r.app.room.currIndex&&r.pageName===r.app.room.currBoard.currIndex.toString()&&r.onAttributeUpdated(r.data)},this.handlePlayerPause=function(){r.boardName===r.app.room.currIndex&&r.pageName===r.app.room.currBoard.currIndex.toString()&&r.onAttributeUpdated(r.data)},this.handlePlayerSeekTo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;clearTimeout(r.seekToTimer),e>30||r.boardName===r.app.room.currIndex&&r.pageName===r.app.room.currBoard.currIndex.toString()&&(r.media?r.onAttributeUpdated(r.data):r.seekToTimer=setTimeout((function(){r.handlePlayerSeekTo(e+1)}),100))},this.handlePlayerPlaySpeed=function(e){r.onPlaySpeedChange(e)},this.opId=t.opId,this.boardName=t.board,this.pageName=t.page.toString(),this.mediaOwner=t.uid,this.app=n,this.operation=a,this.type=a.type,this.title=t.data.title,this.data=t.data.mediaData||{play:!1,seek:0,ended:!1},this.app.player&&(this.app.on("event:player:play",this.handlePlayerPlay),this.app.on("event:player:pause",this.handlePlayerPause),this.app.on("event:player:seekTo",this.handlePlayerSeekTo),this.app.on("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.app.on("event:prePageChange",this.handlePrePageChange)}return(0,o.default)(e,[{key:"allowControl",value:function(){return!0}},{key:"isInReplay",value:function(){return this.app.isRecordPlayer}},{key:"replayMode",value:function(){return this.app.player?this.app.player.state:"pause"}},{key:"replaySeekDiff",value:function(){return this.app.player?(this.app.player.lastTime-this.recordTime)/1e3:0}},{key:"destroy",value:function(){var e;this.app.off("event:prePageChange",this.handlePrePageChange),this.app.player&&(this.app.off("event:player:play",this.handlePlayerPlay),this.app.off("event:player:pause",this.handlePlayerPause),this.app.off("event:player:seekTo",this.handlePlayerSeekTo),this.app.off("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.onPluginWillDestroy();var t=this.app.container.el.querySelector("[id='"+this.opId+"']");null===(e=null==t?void 0:t.parentNode)||void 0===e||e.removeChild(t)}},{key:"putAttributes",value:function(e){var t=this.app.room.getPage(this.boardName,this.pageName);t&&this.operation.dispatchFromPage({dependOn:this.opId,skipUndo:!0,type:this.type,reuseOpType:this.opId+"-"+this.type+"-action",mediaData:(0,r.default)((0,r.default)({},this.data),e)},t)}},{key:"onReceiveAttributes",value:function(e){return l(this,void 0,void 0,a.default.mark((function t(){var n,r;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n={play:!1,seek:0,ended:!1},e.data.hasOwnProperty("mediaData"))for(r in n=e.data.mediaData||{},this.data)n.hasOwnProperty(r)||(n[r]=this.data[r]);return this.recordTime=e.data.recordTime||0,t.next=5,this.onAttributeUpdated(n);case 5:this.data=n;case 6:case"end":return t.stop()}}),t,this)})))}}],[{key:"getElementWidth",value:function(e){return 600}},{key:"getElementHeight",value:function(e){return 340}}]),e}();t.default=c},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTUxOTYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTYwMCAtNjAwIDIyMjQgMjIyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MDgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU5Ljk0NzkyOTA5IDEzMy45MjE4OTNoMTI2LjAyNjAzNDgxYzIzLjMzODE1NDczIDAgNDIuMDA4Njc4MjcgMTguNjcwNTIzNTMgNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZ2NjcyLjEzODg1NzQ4YzAgMjMuMzM4MTU0NzMtMTguNjcwNTIzNTMgNDIuMDA4Njc4MjctNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZIMjU5Ljk0NzkyOTA5Yy0yMy4zMzgxNTQ3MyAwLTQyLjAwODY3ODI3LTE4LjY3MDUyMzUzLTQyLjAwODY3OTU2LTQyLjAwODY3ODI2VjE3NS45MzA1NzEyNmMwLTIzLjMzODE1NDczIDE4LjY3MDUyMzUzLTQyLjAwODY3ODI3IDQyLjAwODY3OTU2LTQyLjAwODY3ODI2ek02MzguMDI2MDM2MSAxMzMuOTIxODkzaDEyNi4wMjYwMzQ4MWMyMy4zMzgxNTQ3MyAwIDQyLjAwODY3ODI3IDE4LjY3MDUyMzUzIDQyLjAwODY3OTU2IDQyLjAwODY3ODI2djY3Mi4xMzg4NTc0OGMwIDIzLjMzODE1NDczLTE4LjY3MDUyMzUzIDQyLjAwODY3ODI3LTQyLjAwODY3OTU2IDQyLjAwODY3ODI2aC0xMjYuMDI2MDM0ODFjLTIzLjMzODE1NDczIDAtNDIuMDA4Njc4MjctMTguNjcwNTIzNTMtNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZWMTc1LjkzMDU3MTI2YzAtMjMuMzM4MTU0NzMgMTguNjcwNTIzNTMtNDIuMDA4Njc4MjcgNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyOTA5Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPScjZmZmZmZmJyB0PSIxNjIwODcxNDY4NTkwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTU2OS44OTg2NjcgMjc1LjJjLTIuMTMzMzMzLTIwLjczNi00LjM5NDY2Ny00Mi4yNC05Ljg5ODY2Ny02My43NDRDNTQ1LjA2NjY2NyAxNjAuMDg1MzMzIDUwMy41MDkzMzMgMTI4IDQ1OS4wMDggMTI4Yy0yNC44MzItMC4wODUzMzMtNTYuMjM0NjY3IDE1LjE4OTMzMy03NC4wNjkzMzMgMzAuNzJsLTE0Ny42MjY2NjcgMTIzLjYwNTMzM2gtNzcuMjI2NjY3Yy01Ni44NzQ2NjcgMC0xMDIuNTcwNjY3IDQzLjgxODY2Ny0xMTEuMjMyIDEwNy4wOTMzMzQtNy4zMzg2NjcgNjAuNzU3MzMzLTkuMTMwNjY3IDE3NS4zNiAwIDI0Mi4yMTg2NjYgNy45MzYgNjYuODU4NjY3IDUxLjYyNjY2NyAxMTAuMDM3MzMzIDExMS4yMzIgMTEwLjAzNzMzNGg3Ny4yMjY2NjdsMTUwLjQ4NTMzMyAxMjUuNDRjMTUuNDQ1MzMzIDEzLjQ0IDQyLjY2NjY2NyAyOC44NDI2NjcgNjcuNzU0NjY3IDI4Ljg0MjY2Nmw0LjQ4IDAuMDQyNjY3YzQ1LjM1NDY2NyAwIDg1LjMzMzMzMy0zMy4yOCAxMDAuMjY2NjY3LTg0LjQ4IDUuNjc0NjY3LTIxLjcxNzMzMyA3LjY4LTQyLjAyNjY2NyA5LjU1NzMzMy02MS42NTMzMzNsMC4wNDI2NjctMC4zNDEzMzQgMi4wMDUzMzMtMTkuNTg0YzcuNjgtNjMuNDQ1MzMzIDcuNjgtMzcyLjg2NCAwLTQzNS44NGwtMi4wMDUzMzMtMTguODU4NjY2eiBtMTcyLjggMS45MmEzOC42OTg2NjcgMzguNjk4NjY3IDAgMCAwLTU0LjU3MDY2Ny0xMC4xMTIgNDAuODMyIDQwLjgzMiAwIDAgMC05LjcyOCA1NS44MDhjMzQuMjE4NjY3IDUwLjQzMiA1My4wMzQ2NjcgMTE3LjU4OTMzMyA1My4wMzQ2NjcgMTg5LjE4NCAwIDcxLjU1Mi0xOC44MTYgMTM4Ljc1Mi01My4wMzQ2NjcgMTg5LjE4NGE0MC43ODkzMzMgNDAuNzg5MzMzIDAgMCAwIDkuODEzMzMzIDU1LjgwOCAzOC42MTMzMzMgMzguNjEzMzMzIDAgMCAwIDU0LjQ4NTMzNC0xMC4xMTJjNDMuMTc4NjY3LTYzLjY1ODY2NyA2Ny4wMjkzMzMtMTQ3LjA3MiA2Ny4wMjkzMzMtMjM0Ljg4cy0yMy44NTA2NjctMTcxLjIyMTMzMy02Ny4wMjkzMzMtMjM0Ljg4ek04MjMuMDQgMTM3LjM4NjY2N2EzOC42MTMzMzMgMzguNjEzMzMzIDAgMCAxIDU0LjQ4NTMzMyAxMC4wNjkzMzNDOTQ0LjQ2OTMzMyAyNDYuMDU4NjY3IDk4MS4zMzMzMzMgMzc1LjU1MiA5ODEuMzMzMzMzIDUxMmMwIDEzNi41MzMzMzMtMzYuODY0IDI2NS45ODQtMTAzLjgwOCAzNjQuNTQ0YTM4LjQ4NTMzMyAzOC40ODUzMzMgMCAwIDEtNTQuNDQyNjY2IDEwLjA2OTMzMyA0MC44MzIgNDAuODMyIDAgMCAxLTkuODEzMzM0LTU1LjgwOGM1Ny44NTYtODUuMjkwNjY3IDg5Ljc3MDY2Ny0xOTguNTI4IDg5Ljc3MDY2Ny0zMTguODA1MzMzIDAtMTIwLjIzNDY2Ny0zMS45MTQ2NjctMjMzLjQ3Mi04OS44MTMzMzMtMzE4Ljc2MjY2N2E0MC44NzQ2NjcgNDAuODc0NjY3IDAgMCAxIDkuODEzMzMzLTU1LjgwOHoiIGZpbGw9IiNmZmZmZmYiIHAtaWQ9IjIwMzIiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIwODkxOTY3ODE0IiBmaWxsPScjZmZmZmZmJyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE4NzQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTg5OS42NDggNTMzLjk1MmwxMDIuNC0xMDIuNGMxNC42MjQtMTQuNjI0IDE0LjYyNC0zNi41NzYgMC01MS4ycy0zNi41NzYtMTQuNjI0LTUxLjIgMGwtMTAyLjQgMTAyLjQtMTA5LjcyOC0xMDkuNzI4Yy03LjMyOC03LjMyOC0yOS4yNDgtMjEuOTUyLTUxLjIgMGEzNS4zNiAzNS4zNiAwIDAgMCAwIDUxLjJsMTAyLjQgMTAyLjQtMTAyLjQgMTA5LjcyOGMtMTQuNjI0IDE0LjYyNC0xNC42MjQgMzYuNTc2IDAgNTEuMnMzNi41NzYgMTQuNjI0IDUxLjIgMGwxMDkuNzI4LTEwMi40IDEwMi40IDEwMi40YzE0LjYyNCAxNC42MjQgMzYuNTc2IDE0LjYyNCA1MS4yIDBzMTQuNjI0LTM2LjU3NiAwLTUxLjJsLTEwMi40LTEwMi40eiBtLTQwMi4yNzItNDYwLjhjLTcuMzI4IDAtMTQuNjI0IDAtMjEuOTUyIDcuMzI4TDE1My42IDM1MS4xMDRINzMuMTUyYy0yOS4yNDgtNy4zMjgtNTEuMiAyMS45NTItNTEuMiA1MS4ydjIxOS40MjRjMCAyOS4yNDggMjEuOTUyIDU4LjUyOCA1MS4yIDU4LjUyOCAwIDAgODcuNzc2IDAgOTUuMDcyIDcuMzI4bDMwNy4yIDI2My4zMjhoMjEuOTUyYzIxLjk1MiAwIDM2LjU3Ni0yMS45NTIgMzYuNTc2LTUxLjJWMTI0LjM4NGMwLTI5LjI0OC0xNC42MjQtNTEuMi0zNi41NzYtNTEuMnoiIHAtaWQ9IjE4NzUiPjwvcGF0aD48L3N2Zz4="},function(e,t,n){var a=n(332);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){t=e.exports=n(11)(!1);var a=n(62),r=a(n(333)),i=a(n(239));t.push([e.i,".neteaseyunxin-wb-media-container {\n    position: fixed;\n    pointer-events: auto;\n}\n    .neteaseyunxin-wb-media-container .header {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 32px;\n        background-color: rgba(0,0,0,.7);\n        align-items: center;\n        display: none;\n    }\n    .neteaseyunxin-wb-media-container .header .title {\n            flex: 1;\n            color: white;\n            margin-left: 8px;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            font-size: 18px;\n        }\n    .neteaseyunxin-wb-media-container .header .close.icon {\n            width: 20px;\n            height: 20px;\n            background-image: url("+r+");\n            background-size: contain;\n            margin-right: 8px\n        }\n    .neteaseyunxin-wb-media-container .header .close.icon:hover {\n                cursor: pointer;\n            }\n    .neteaseyunxin-wb-media-container .media-control {\n        width: 100%;\n        position: absolute;\n        bottom: 0;\n        background: rgba(0,0,0,.7);\n        padding-top: 3px;\n        display: none;\n    }\n    .neteaseyunxin-wb-media-container .media-control .control-container {\n            display: flex;\n            height: 40px;\n            width: 100%;\n        }\n    .neteaseyunxin-wb-media-container .media-control .play-icon {\n            display: inline-block;\n            height: 100%;\n            width: 40px;\n            background-image: url("+i+");\n            background-size: contain;\n        }\n    .neteaseyunxin-wb-media-container .media-control .time-container {\n            display: inline-block;\n            height: 40px;\n            color: white;\n            vertical-align: top;\n            margin: 0 16px 0 0;\n        }\n    .neteaseyunxin-wb-media-container .media-control .time-text {\n            line-height: 40px;\n            height: 40px;\n            vertical-align: middle;\n            font-size: 14px;\n        }\n.neteaseyunxin-wb-media-container.visible .header, .neteaseyunxin-wb-media-container.audio .header {\n            display: flex;\n        }\n.neteaseyunxin-wb-media-container.visible .media-control, .neteaseyunxin-wb-media-container.audio .media-control {\n            display: block;\n        }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHQ9IjE2MjA4OTY3NjEwNjEiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNSAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMTg2MyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIzMi4wMzEyNSIgaGVpZ2h0PSIzMiI+CjxkZWZzPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPgo8cGF0aCBkPSJNNTEzLjM0NCAwYTUxMiA1MTIgMCAxIDAgMCAxMDI0IDUxMiA1MTIgMCAwIDAgMC0xMDI0eiBtMjI2LjA0OCA2NzQuNjI0bC01NC41MjggNTYuODk2LTE3MS41Mi0xNjQuOTI4LTE3MS4zOTIgMTY0LjkyOC01NC41OTItNTYuODk2TDQ1Ni41NzYgNTEyIDI4Ny4zNiAzNDkuMzEybDU0LjU5Mi01Ni43NjggMTcxLjM5MiAxNjQuOCAxNzEuNTItMTY0LjggNTQuNTI4IDU2Ljc2OEw1NzAuMTc2IDUxMmwxNjkuMjE2IDE2Mi42MjR6IiBmaWxsPSIjZDgzZjIzIiBwLWlkPSIxODY0Ij48L3BhdGg+Cjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendTooltip=void 0;var a=i(n(0)),r=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}n(335);var o=function(){function e(t,n){var r=this;(0,a.default)(this,e),this.onMouseOver=function(){r.widget.classList.add("visible")},this.onTouchStart=function(){r.widget.classList.add("visible"),clearTimeout(r.hideTimer),r.hideTimer=setTimeout((function(){r.onMouseLeave()}),1e3)},this.onMouseLeave=function(){r.widget.classList.remove("visible")},t.classList.add("neteaseyunxin-wb-tooltip");var i=document.createElement("span");i.className="tooltiptext",i.innerText=n,t.appendChild(i),this.widget=t,this.bindEvents()}return(0,r.default)(e,[{key:"bindEvents",value:function(){this.widget.addEventListener("mouseover",this.onMouseOver),this.widget.addEventListener("mouseleave",this.onMouseLeave),this.widget.addEventListener("touchstart",this.onTouchStart),window.document.addEventListener("touchend",this.onMouseLeave)}}]),e}();t.appendTooltip=function(e,t){return new o(e,t)}},function(e,t,n){var a=n(336);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".neteaseyunxin-wb-tooltip {\n    position: relative;\n    display: inline-block;\n}\n\n    \n    .neteaseyunxin-wb-tooltip .tooltiptext {\n        visibility: hidden;\n        width: 120px;\n        background-color: black;\n        color: #fff;\n        text-align: center;\n        border-radius: 6px;\n        padding: 5px 0;\n      \n        /* Position the tooltip */\n        position: absolute;\n        z-index: 1;\n        bottom: 30px;\n        left: 50%;\n        transform: translateX(-50%);\n    }\n\n    \n.neteaseyunxin-wb-tooltip.visible .tooltiptext {\n        visibility: visible;\n    }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(5)),r=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4)),l=c(n(237));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"onSizeChange",value:function(e){this.playWidget&&this.timeWidget&&this.selfMuteIcon&&this.progressController&&(this.playWidget.style.display=e.width>140?"inline-block":"none",this.progressController.widget.style.display=e.width>140?"inline-block":"none",this.timeWidget.style.display=e.width>260?"inline-block":"none",this.selfMuteIcon.style.display=e.width>140?"inline-block":"none")}},{key:"getTitle",value:function(){return this.title?this.title:"音频文件"}},{key:"createControllor",value:function(){var e=document.createElement("div");this.progressController=new l.default(0,{emitEvent:this.allowControl()});var t=this.createControlContainer(),n=this.createPlayWidget(),r=this.createTimeIndicator(),i=this.createVolumeWidget();e.appendChild(t),t.appendChild(n),t.appendChild(r);var o=document.createElement("div");return(0,a.default)(o.style,{height:"40px",lineHeight:"40px",display:"inline-flex",alignItems:"center",flex:1,marginRight:"16px"}),o.appendChild(this.progressController.widget),t.appendChild(o),t.appendChild(i),e.style.userSelect="none",e.style.webkitUserSelect="none",e.className="media-control",this.controlWidget=e,e}}],[{key:"getElementWidth",value:function(){return 320}},{key:"getElementHeight",value:function(){return 75}}]),t}(c(n(238)).default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=M(n(5)),r=M(n(27)),i=M(n(7)),o=M(n(95)),s=M(n(2)),u=M(n(0)),l=M(n(1)),c=M(n(3)),d=M(n(4)),p=M(n(9)),h=M(n(23)),f=n(64),g=n(13),v=n(138),y=n(29),m=n(39);function M(e){return e&&e.__esModule?e:{default:e}}var x=function(e){function t(){(0,u.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).apply(this,arguments));return e.type="modify",e.description="移动操作工具。内部使用，不提供对外接口",e.modifyHandler=function(t,n,a){if(!((t=t.filter((function(t){return e.drawOpsOfPage[t]}))).length<1)&&n){h.default.updateDefAttr(e.app,t.map((function(t){return e.drawOpsOfPage[t]})),n);var r=e.getAttrs(t,n);if(r&&r.updateGraph){var i={type:"modify",dependOn:t,attrs:r.attrs,inProgress:a},o=e.opsManager.currPage.getNextOpId(!0),s=(0,m.deepCopySnapBeforeMove)(t,e.drawOpsOfPage);e.opsManager.graphOp.handleElePosChange(s,i,o,o+"_modify")}else r&&e.dispatch({type:"modify",dependOn:t,attrs:r.attrs,inProgress:a})}},e}return(0,d.default)(t,e),(0,l.default)(t,[{key:"eventsToListen",value:function(){return{"modify:change":{value:this.modifyHandler,information:{args:"ids: Array<string>, attrs:{key:string, value: any}[], inProgress: boolean",message:"更改选中元素的属性"}}}}},{key:"getAttrs",value:function(e,t){for(var n,a,r,s,u,l=this,c=!1,d={common:[],sub:[]},p=e.map((function(e){return l.drawOpsOfPage[e]})).filter((function(e){return e})),m=p.filter((function(e){return"text"===e.data.type})).map((function(e){return e.opId})),M=p.filter((function(e){return"shape"===e.data.type})).map((function(e){return e.opId})),x=p.filter((function(e){return"link"===e.data.type})).map((function(e){return e.opId})),w=0;w<t.length;w++){var I=t[w];if(-1!==["fontStroke","fontFill","textAlign","verticalAlign"].indexOf(I.k)){var b=-1!==["fontStroke","fontFill"].indexOf(I.k)?I.k.slice(4).toLowerCase():I.k;m.length>0&&d.sub.push({ids:m,attrs:[{k:b,v:I.v}]}),(M.length>0||x.length>0)&&d.sub.push({ids:M.concat(x),attrs:[{k:"text",v:(0,o.default)({},b,I.v)}]})}else if("fontSize"===I.k||"fontFamily"===I.k){if(m.length>0){var k=!0,T=!1,_=void 0;try{for(var C,N=(0,i.default)(m);!(k=(C=N.next()).done);k=!0){var A=C.value,P=null===(n=this.drawOpsOfPage[A])||void 0===n?void 0:n.data;if(P){var O=void 0;if("fontFamily"===I.k)O=this.opsManager.textOp.getUpdatedTxtBoundary(P,(0,o.default)({},I.k,I.v));else{var D=I.v/P.fontSize||1;O={sx:P.boundary.sx,sy:P.boundary.sy,w:P.boundary.w*D,h:P.boundary.h*D}}d.sub.push({ids:[A],attrs:[{k:I.k,v:I.v},{k:"boundary",v:O}]})}}}catch(e){T=!0,_=e}finally{try{!k&&N.return&&N.return()}finally{if(T)throw _}}c=!0}var S=!0,E=!1,j=void 0;try{for(var L,z=(0,i.default)(x);!(S=(L=z.next()).done);S=!0){var R=L.value,B=this.app.opsManager.linkOp.getUpdatedTxtProps(this.drawOpsOfPage[R].data,(0,o.default)({},I.k,I.v));B&&d.sub.push({ids:[R],attrs:[{k:"text",v:B}]})}}catch(e){E=!0,j=e}finally{try{!S&&z.return&&z.return()}finally{if(E)throw j}}M.length>0&&d.sub.push({ids:M,attrs:[{k:"text",v:(0,o.default)({},I.k,I.v)}]})}else if("linkType"===I.k){d.common.push(I);var F=!0,Y=!1,U=void 0;try{for(var W,H=(0,i.default)(p);!(F=(W=H.next()).done);F=!0){var Q=W.value,Z=(0,f.graphAftTypeM)({data:Q.data,type:I.v,op:this});Z&&d.sub.push({ids:[Q.opId],attrs:[{k:"connPs",v:Z.connPs},{k:"linkType",v:I.v},{k:"start",v:{dir:Z.start.dir}},{k:"end",v:{dir:Z.end.dir}}]})}}catch(e){Y=!0,U=e}finally{try{!F&&H.return&&H.return()}finally{if(Y)throw U}}}else{if("typeChange"!==I.k){d.common.push(I);continue}if("text"===p[0].data.type&&"text"!==I.v){var G=p[0].data,V=this.opsManager.textOp.getTextActualBound(G),X=this.app.shapeManager.getShapeBoundByTextBound(I.v,V);d.common.push({k:"_reset",v:{type:"shape",shape:I.v,boundary:X,rAngle:G.rAngle||0,mat:G.mat,xFactor:G.xFactor,yFactor:G.yFactor,lineWidth:h.default.shapeDef.lineWidth,stroke:h.default.shapeDef.stroke,fill:h.default.shapeDef.fill,dash:y.IDashType.Solid,text:{value:G.text,stroke:G.stroke,fontSize:G.fontSize,fill:G.fill,textAlign:G.textAlign,verticalAlign:h.default.shapeDef.text.verticalAlign,fontFamily:G.fontFamily},inProgress:!1}}),c=!0}else if("shape"===p[0].data.type&&"text"===I.v){var J=p[0].data,K=((null===(a=J.text)||void 0===a?void 0:a.value)||"").trim();K=K||v.DefaultText;var q=(null===(r=J.text)||void 0===r?void 0:r.value)?(null===(s=J.text)||void 0===s?void 0:s.fontSize)||h.default.textDef.fontSize:16,$=(null===(u=J.text)||void 0===u?void 0:u.fontFamily)||h.default.textDef.fontFamily,ee=J.boundary,te=(0,g.getTransformedSize)(J),ne=this.opsManager.textOp.getTextSize({text:K,fontSize:q,fontFamily:$,width:te.w}),ae=ee.h*ne.h/te.h;d.common.push({k:"_reset",v:{type:"text",boundary:{sx:ee.sx,sy:ee.sy+ee.h/2-ae/2,w:ee.w,h:ae},fixW:ee.w,rAngle:J.rAngle||0,mat:J.mat,xFactor:J.xFactor,yFactor:J.yFactor,text:J.text?J.text.value:" ",stroke:J.text?J.text.stroke:h.default.textDef.stroke,textAlign:J.text?J.text.textAlign:h.default.textDef.textAlign,fill:J.text?J.text.fill:h.default.textDef.fill,fontSize:q,fontFamily:J.text?J.text.fontFamily:h.default.textDef.fontFamily,inProgress:!1}}),c=!0}else{if("shape"!==p[0].data.type||p[0].data.shape===I.v)return this.logger.log("转换类型不能相同，当前类型："+p[0].data.type+"-"+p[0].data.shape+"，目标类型："+I.v),null;d.common.push({k:"shape",v:I.v})}}}return{updateGraph:c,attrs:d}}},{key:"getSnapshot",value:function(e,t,n){return{type:"modify",dependOn:e,attrs:this.getAttrs(e,t).attrs,inProgress:n}}},{key:"transformOp",value:function(e,t){var n=e.data.boundary?{boundary:e.data.boundary}:{},o=e.data.text&&"object"===(0,r.default)(e.data.text)?{text:(0,a.default)({},e.data.text)}:{},s=(0,a.default)((0,a.default)((0,a.default)({},e.data),n),o),u=t.attrs;if(s=w(u.common,s),Array.isArray(u.sub)){var l=!0,c=!1,d=void 0;try{for(var p,h=(0,i.default)(u.sub);!(l=(p=h.next()).done);l=!0){var f=p.value,g=f.ids,v=f.attrs;-1!==g.indexOf(e.opId)&&(s=w(v,s))}}catch(e){c=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw d}}}return(0,a.default)((0,a.default)({},e),{data:s})}}]),t}(p.default);function w(e,t){return Array.isArray(e)?(e.forEach((function(e){var n=e.k,i=e.v;"_reset"===n?t=(0,a.default)({},i):i&&"object"===(void 0===i?"undefined":(0,r.default)(i))&&!Array.isArray(i)?i.reset?t[n]=i:t[n]=(0,a.default)((0,a.default)({},t[n]||{}),i):t[n]=i,"boundary"===n&&i.reset&&(t.dx=0,t.dy=0,t.scaleX={coordinate:0,factor:1},t.scaleY={coordinate:0,factor:1},t.xFactor=1,t.yFactor=1,t.rAngle=0,t.mat=void 0)})),t):t}t.default=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(2)),r=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="audio",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"audio:insert":{value:this.addMedia.bind(this),information:{args:"url: string, opts: {\n                         width: number,\n                         sourceType: string,\n                         title?: string\n                         pageName?: string\n                         boardName?: string\n                     }",message:"上传视频"}}}}},{key:"preview",value:function(e,t,n){t.save();var a=void 0,r=void 0;if(n.boundary){var i=t.canvas.width/t.canvas.height,o=void 0,s=void 0;i>n.boundary.width/n.boundary.height?(o=n.boundary.height*i,s=n.boundary.height):(s=n.boundary.width/i,o=n.boundary.width);var u=Math.min(o,s)/6;a=[n.boundary.centerX-o/2,n.boundary.centerY+s/2-u],r=[n.boundary.centerX-o/2+u,n.boundary.centerY+s/2]}else{var l=void 0,c=void 0,d=this.app.container.width,p=this.app.container.height,h=t.canvas.width/t.canvas.height,f=d,g=p;h>d/p?(l=(d-(f=p*h))/2,c=p):(l=0,c=((g=d/h)+p)/2);var v=Math.min(f,g)/6;a=this.app.camera.convertToPointInWorld(l,c-v),r=this.app.camera.convertToPointInWorld(l+v,c)}try{this.app.resourceCache.resourceLoaded("audio")&&!n.supportToDataUrl&&t.drawImage(this.app.resourceCache.getResource("audio"),a[0],a[1],r[0]-a[0],r[1]-a[1])}catch(e){this.logger.error("error",e)}t.restore()}}]),t}(u(n(236)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=g(n(18)),r=g(n(28)),i=g(n(2)),o=g(n(0)),s=g(n(1)),u=g(n(3)),l=g(n(4)),c=g(n(14)),d=n(13),p=g(n(9)),h=n(16),f=g(n(341));function g(e){return e&&e.__esModule?e:{default:e}}var v=function(e,t,n,a){return new(n||(n=c.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},y=void 0,m=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="transDoc",e.description="转码相关的操作汇聚地",e.transDocPlugin={},e.boardLastSnapshot={},e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"getPluginOfCurrBoard",value:function(){var e=this.app.room.currBoard.transDocSnapshot,t=e&&e.opId||"";return this.transDocPlugin[t]}},{key:"eventsToListen",value:function(){return{"transDoc:add":{value:this.addTransDoc.bind(this),information:{args:"opt",message:"添加ppt转码文档页面"}},"transDoc:nextAnim":{value:this.nextAnim.bind(this),information:{args:"",message:"播放下一个动画"}},"transDoc:prevAnim":{value:this.prevAnim.bind(this),information:{args:"",message:"跳到上一个动画"}},"transDoc:gotoAnim":{value:this.gotoAnim.bind(this),information:{args:"",message:"跳到指定位置"}}}}},{key:"addTransDoc",value:function(e){var t=Array.isArray(e.backupResultUrls)?e.backupResultUrls:[];this.dispatch({type:this.type,action:"addTransDoc",boardName:e.boardName,displayName:e.displayName,pageCount:e.pageCount,transDocUrl:e.url,backupResultUrls:t,boundary:{sx:-e.width/2,sy:-e.height/2,w:e.width,h:e.height},transDocData:{animIndex:0,animState:"start",animPageIndex:0}})}},{key:"waitTilReady",value:function(e){return v(this,void 0,void 0,r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.transDocPlugin[e.opId])){t.next=4;break}return t.next=4,n.waitTilReady();case 4:case"end":return t.stop()}}),t,this)})))}},{key:"nextAnim",value:function(){var e=this.getPluginOfCurrBoard();if(e)return e.nextAnim()}},{key:"prevAnim",value:function(){var e=this.getPluginOfCurrBoard();if(e)return e.prevAnim()}},{key:"gotoAnim",value:function(e){var t=this.getPluginOfCurrBoard();if(t)return t.gotoAnim(e)}},{key:"onBoardChange",value:function(){var e=(0,a.default)(this.app.room.boards);for(var t in this.transDocPlugin){var n=this.transDocPlugin[t];-1===e.indexOf(n.boardName)?this.destroyPlugin(n):n.boardName!==this.app.room.currIndex&&n.hide()}var r=this.app.room.currIndex;this.boardLastSnapshot.hasOwnProperty(r)&&this.apply(this.boardLastSnapshot[r],{fromBatch:!0})}},{key:"destroy",value:function(){for(var e in this.transDocPlugin)this.destroyPlugin(this.transDocPlugin[e])}},{key:"destroyPlugin",value:function(e){e.destroy(),delete this.transDocPlugin[e.opId]}},{key:"previewDoc",value:function(e,t){var n=this.transDocPlugin[e.opId];n&&n.previewDoc(t)}},{key:"updateDocClipPath",value:function(e){var t=this.transDocPlugin[e.opId];t&&(0,h.updateDocClipPath)(t.boundary,this.app.camera,t.container)}},{key:"apply",value:function(e,t){var n=this;this.boardLastSnapshot[e.data.boardName]=e,clearTimeout(y),t.fromBatch&&!this.app.isRecordPlayer?y=setTimeout((function(){n._apply(e,t)}),0):this._apply(e,t)}},{key:"_apply",value:function(e,t){if(!this.transDocPlugin[e.opId]){if(!this.app.room.boards.hasOwnProperty(e.data.boardName))return;this.transDocPlugin[e.opId]=new f.default(e,this.app,this)}var n=this.transDocPlugin[e.opId],a=e.data,r=a.boundary,i=(0,d.getTransformedBoundary)(this.app.scale,{boundary:r}),o=this.app.container.h5El,s=o.querySelector("[id='"+e.opId+"']"),u=null==s;u&&((s=document.createElement("div")).style.position="fixed",s.id=""+e.opId,s.className="transDoc-plugin-container",o.appendChild(s)),s.style.width=i.w+"px",s.style.height=i.h+"px",s.style.left=i.sx+"px",s.style.top=i.sy+"px",u&&n.mountElement(e,t.fromBatch,s,a.transDocUrl),n.onReceiveAttributes(e.data.transDocData,{jump:t.fromBatch})}},{key:"transformOp",value:function(e,t){return(0,h.transformPropertyOverwriteOp)(e,t)}}]),t}(p.default);t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(5)),r=c(n(28)),i=c(n(7)),o=c(n(0)),s=c(n(1)),u=c(n(14)),l=c(n(342));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e,t,n,a){return new(n||(n=u.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},p=function(){function e(t,n,a){var r,s=this;(0,o.default)(this,e),this.summaryReady=!1,this.handlePlayerPause=function(){s.pgReader&&s.data.animPageIndex===s.app.room.currBoard.currPage.getAnimPageIndex()&&s.pgReader.gotoAnimation({animIndex:s.data.animIndex,animState:s.data.animState},!0)},this.handlePlayerPlaySpeed=function(e){s.pgReader&&s.pgReader.setAnimSpeed(e)},this.opId=t.opId,this.type=a.type,this.boardName=t.data.boardName,this.app=n,this.operation=a,this.boundary=t.data.boundary;var u=this.app.room.boards[this.boardName];window.PgReader?(this.pgReader=new window.PgReader({fontDownloadPrefix:null===(r=this.app.serviceConf)||void 0===r?void 0:r.pptFontUrl,pageCount:t.data.pageCount}),this.pgReader.on("event:pptState:change",(function(e,t){"pageImgLoaded"===e?s.removeBlockH5Img(t):"indexLoaded"===e&&(s.summaryReady=!0,s.onAttributeUpdated(s.data,!0))}))):n.logger.error("房间加载了动态ppt，但是应用没有加载pptRenderer脚本。"),this.data=t.data.transDocData||{animIndex:0,animState:"start",animPageIndex:0},this.operation.opsManager.hooks.pageChange.tap("PageChange",this.handlePageChange.bind(this)),this.operation.opsManager.hooks.previewWaiting.tap("PreviewWaitingPlugin",this.handlePreviewWaiting.bind(this));var l=u.payloadOfPages,c=!0,d=!1,p=void 0;try{for(var h,f=(0,i.default)(l);!(c=(h=f.next()).done);c=!0){var g=h.value;if(g&&g.hasOwnProperty("animPageIndex")){var v=u.getPageNameByAnimPageIndex(g.animPageIndex);null!==v&&u.pages[v].addWaitingResource("h5Image")}}}catch(e){d=!0,p=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw p}}this.app.isRecordPlayer&&(this.app.on("event:player:pause",this.handlePlayerPause),this.app.on("event:player:playSpeed",this.handlePlayerPlaySpeed))}return(0,s.default)(e,[{key:"waitTilReady",value:function(){return d(this,void 0,void 0,r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.pgReader)for(n=0;n<this.pgReader.pageCount;n++)t.push(this.pgReader.waitTilPageReady(n)),"function"==typeof this.pgReader.waitTilImgReady&&t.push(this.pgReader.waitTilImgReady(n));return e.next=4,u.default.all(t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"removeBlockH5Img",value:function(e){if(this.pgReader){var t=this.app.room.boards[this.boardName],n=t.getPageNameByAnimPageIndex(e);n&&t.pages[n].removeWaitingResource("h5Image")}}},{key:"mountElement",value:function(e,t,n,r){var i,o,s=this;if(this.container=n,this.pgReader){!function(){if(h)return;h=!0;var e=document.createElement("style");e.type="text/css";e.innerHTML="\n@keyframes __newb__rotate {\nfrom {transform: rotate(0);}\nto {transform: rotate(360deg);}\n}\n    ",document.getElementsByTagName("head")[0].appendChild(e)}();var u=document.createElement("img");u.src=l.default,u.className="__newb__ppt_icon_loading",this.container.appendChild(u),(0,a.default)(u.style,{display:"none",position:"absolute",top:"50%",left:"50%",bottom:"0",right:"0",width:"55px",height:"55px",animation:"2s ease-in-out infinite __newb__rotate",transform:"translate(-50%, -50%)",zIndex:"1000"});var c=Array.isArray(e.data.backupResultUrls)?e.data.backupResultUrls:[];this.pgReader.open(r,{mode:"lazy",backupResultUrls:c}).then((function(){s.pgReader.updateContainer(n);var r=Date.now()+s.app.ntpTimeDiff-e.time;e.uid===s.app.account.toString()&&r<1e3&&!t&&0===s.data.animPageIndex&&"start"===s.data.animState&&0===s.data.animIndex&&s.pgReader.waitTilPageReady(0).then((function(){var e=s.pgReader.getFirstAnimationPosition(0);0===e.animIndex&&"start"===e.animState||s.putAttributes((0,a.default)((0,a.default)({},e),{animPageIndex:0,jump:!1}))}))})),this.app.isRecordPlayer&&(null===(i=this.app.player)||void 0===i?void 0:i.playSpeed)&&this.pgReader.setAnimSpeed(null===(o=this.app.player)||void 0===o?void 0:o.playSpeed)}}},{key:"destroy",value:function(){var e;this.container&&(null===(e=this.container.parentNode)||void 0===e||e.removeChild(this.container)),this.app.isRecordPlayer&&(this.app.off("event:player:pause",this.handlePlayerPause),this.app.off("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.pgReader&&this.pgReader.destroy()}},{key:"hide",value:function(){this.container&&(this.container.style.visibility="hidden")}},{key:"show",value:function(){this.container&&(this.container.style.visibility="visible")}},{key:"hideLoading",value:function(){for(var e,t=(null===(e=this.container)||void 0===e?void 0:e.getElementsByClassName("__newb__ppt_icon_loading"))||[],n=0;n<t.length;n++)t[n].style.display="none"}},{key:"showLoading",value:function(){for(var e,t=(null===(e=this.container)||void 0===e?void 0:e.getElementsByClassName("__newb__ppt_icon_loading"))||[],n=0;n<t.length;n++)t[n].style.display="block"}},{key:"gotoNextPage",value:function(){var e=this,t=this.app.getPageInfos(),n=t.activeIndex;if(n<t.pageNames.length-1){var r=this.app.room.currBoard.getPageByIndex(n+1).getAnimPageIndex();null===r?this.app.gotoPage(n+1):this.pgReader&&(this.showLoading(),this.pgReader.waitTilPageReady(r).then((function(){var t=e.pgReader.getFirstAnimationPosition(r);e.putAttributes((0,a.default)({jump:!1,animPageIndex:r},t)),e.hideLoading()})).catch((function(){e.putAttributes({jump:!1,animPageIndex:r,animIndex:0,animState:"start"}),e.hideLoading()})))}}},{key:"gotoPrevPage",value:function(){var e=this,t=this.app.getPageInfos().activeIndex;if(t>0){var n=this.app.room.currBoard.getPageByIndex(t-1).getAnimPageIndex();null===n?this.app.gotoPage(t-1):this.pgReader&&(this.showLoading(),this.pgReader.waitTilPageReady(n).then((function(){e.putAttributes({jump:!0,animPageIndex:n,animState:"end",animIndex:e.pgReader.getAnimationLengthOfPage(n)}),e.hideLoading()})).catch((function(){e.putAttributes({jump:!0,animPageIndex:n,animState:"end",animIndex:e.pgReader.getAnimationLengthOfPage(n)}),e.hideLoading()})))}}},{key:"gotoAnim",value:function(e){var t=this;if(this.pgReader){if(null===this.app.room.currBoard.getPageNameByAnimPageIndex(e.pageIndex))return this.app.logger.error("ppt中index为"+e.pageIndex+"的页面不存在");this.showLoading(),this.pgReader.waitTilPageReady(e.pageIndex).then((function(){t.putAttributes({jump:!0,animIndex:e.animIndex,animState:e.animState,animPageIndex:e.pageIndex}),t.hideLoading()})).catch((function(){t.hideLoading()}))}}},{key:"nextAnim",value:function(){if(this.pgReader){var e=void 0!==this.data.animPageIndex&&null!==this.data.animPageIndex,t=this.pgReader.getNextAnimationPosition(),n=this.app.room.currBoard;e&&this.data.animPageIndex===n.currPage.getAnimPageIndex()&&t?this.putAttributes((0,a.default)((0,a.default)({},t),{animPageIndex:this.app.room.currBoard.currPage.getAnimPageIndex(),jump:!1})):this.gotoNextPage()}}},{key:"prevAnim",value:function(){if(this.pgReader){var e=void 0!==this.data.animPageIndex&&null!==this.data.animPageIndex,t=this.pgReader.getPrevAnimationPosition();e&&t&&this.data.animPageIndex===this.app.room.currBoard.currPage.getAnimPageIndex()?this.putAttributes((0,a.default)((0,a.default)({},t),{animPageIndex:this.app.room.currBoard.currPage.getAnimPageIndex(),jump:!0})):this.gotoPrevPage()}}},{key:"handlePreviewWaiting",value:function(e){var t=this.app.room.currBoard.getPageByIndex(e);if(t){var n=t.getAnimPageIndex();n&&this.pgReader&&this.boardName===this.app.room.currBoard.boardName&&this.pgReader.waitTilPageReady(n)}}},{key:"handlePageChange",value:function(e){var t=this;if(this.app.isRecordPlayer||e.uid!==this.app.account||"transDoc"===e.data.type){if(this.app.isRecordPlayer||"transDoc"===e.data.type){if(this.app.isRecordPlayer&&this.boardName===this.app.room.currBoard.boardName){var n=this.app.room.currBoard.currPage.getAnimPageIndex();this.onReceiveAttributes({animIndex:0,animState:"start",animPageIndex:n,jump:!0},{jump:!0})}}else if(this.boardName===this.app.room.currBoard.boardName){var a=this.app.room.currBoard.currPage.getAnimPageIndex();this.onReceiveAttributes({animIndex:0,animState:"start",animPageIndex:a,jump:!0},{jump:!0})}}else{var r=Date.now()+this.app.ntpTimeDiff-e.time;if(this.pgReader&&this.boardName===this.app.room.currBoard.boardName&&r<300){var i=this.app.room.currBoard.currPage.getAnimPageIndex();i||0===i?(this.showLoading(),this.pgReader.waitTilPageReady(i).then((function(){var e=t.pgReader.getFirstAnimationPosition(i);t.putAttributes({jump:!1,animIndex:e.animIndex,animState:e.animState,animPageIndex:i}),t.hideLoading()})).catch((function(){t.hideLoading()}))):this.putAttributes({animIndex:0,animState:"start",animPageIndex:i,jump:!0})}}}},{key:"putAttributes",value:function(e){this.operation.dispatch({boardName:this.boardName,dependOn:this.opId,skipUndo:!0,type:this.type,transDocData:(0,a.default)((0,a.default)({},this.data),e)})}},{key:"onReceiveAttributes",value:function(e,t){return d(this,void 0,void 0,r.default.mark((function n(){var i;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=(0,a.default)({},this.data,e||{animState:"start",animIndex:0,animPageIndex:0}),e.jump?this.onAttributeUpdated(i,!0):this.app.isRecordPlayer?this.onAttributeUpdated(i,!1):this.onAttributeUpdated(i,t.jump),this.data=i;case 3:case"end":return n.stop()}}),n,this)})))}},{key:"onAttributeUpdated",value:function(e,t){var n=this;clearTimeout(this.animTimer),this.summaryReady&&(this.animTimer=setTimeout((function(){var a=n.app.room.currBoard.currPage.getAnimPageIndex();null!==a&&a===e.animPageIndex?(n.show(),n.pgReader&&n.pgReader.currPageIndex!==e.animPageIndex&&(n.showLoading(),n.pgReader.waitTilPageReady(e.animPageIndex).then((function(){n.pgReader.gotoPage(e.animPageIndex),n.hideLoading()})).catch((function(){n.pgReader.gotoPage(e.animPageIndex),n.hideLoading()}))),n.pgReader&&(n.showLoading(),n.app.emit("event:appState:change","animation",{pageIndex:e.animPageIndex,animIndex:e.animIndex,animState:e.animState}),n.pgReader.waitTilPageReady(e.animPageIndex).then((function(){n.pgReader.gotoAnimation({animIndex:e.animIndex,animState:e.animState},t),n.hideLoading()})).catch((function(){n.pgReader.gotoAnimation({animIndex:e.animIndex,animState:e.animState},t),n.hideLoading()})))):n.hide()}),20))}},{key:"previewDoc",value:function(e){if(this.pgReader){var t=e.boundary?e.boundary:this.app.camera.getContainerWorldRect(),n=e.ctx.canvas.width,a=e.ctx.canvas.height,r=this.boundary.w;if("fitDoc"===this.app.appConfig.previewMode&&!e.stream&&!e.toDataUrl)return this.pgReader.paintOnCanvas({ctx:e.ctx,pageIndex:e.animPageIndex,keepAnimState:e.keepAnimState});var i,o=[1,0,0,1,0,0];if(n/a>t.width/t.height){var s=a/n*r,u=t.width/t.height*s,l=u/r;o=[l,0,0,l,(r-u)/2,0]}else{o=[1,0,0,1,0,(a/n*r-t.height/t.width*r)/2]}var c=r/t.width;i=[c,0,0,c,(this.boundary.sx-t.centerX+t.width/2)*c,(this.boundary.sy-t.centerY+t.height/2)*c],this.pgReader.paintOnCanvas({ctx:e.ctx,pageIndex:e.animPageIndex,keepAnimState:e.keepAnimState,transforms:[o[0]*i[0],0,0,o[3]*i[3],o[4]+o[0]*i[4],o[5]+o[3]*i[5]]})}}}]),e}(),h=!1;t.default=p},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM1ODM4Mzk1MTM1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MTAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNDgwIDk2YTMyIDMyIDAgMCAxIDY0IDB2MTkyYTMyIDMyIDAgMCAxLTY0IDBWOTZ6IG0yNTAuNjI0IDYwLjY0YTMyIDMyIDAgMSAxIDUxLjc3NiAzNy42MzJsLTExMi44MzIgMTU1LjMyOGEzMiAzMiAwIDAgMS01MS44MDgtMzcuNjMybDExMi44NjQtMTU1LjMyOHogbTE2Ny4xMzYgMTk2LjM4NGEzMiAzMiAwIDEgMSAxOS43NzYgNjAuODY0bC0xODIuNjI0IDU5LjMyOGEzMiAzMiAwIDAgMS0xOS43NzYtNjAuODY0bDE4Mi42MjQtNTkuMzI4eiBtMTkuNzc2IDI1Ny4wODhhMzIgMzIgMCAxIDEtMTkuNzc2IDYwLjg2NGwtMTgyLjYyNC01OS4zMjhhMzIgMzIgMCAwIDEgMTkuNzc2LTYwLjg2NGwxODIuNjI0IDU5LjMyOHpNNzgyLjQgODI5Ljc2YTMyIDMyIDAgMCAxLTUxLjc3NiAzNy42MzJsLTExMi44NjQtMTU1LjMyOGEzMiAzMiAwIDEgMSA1MS44MDgtMzcuNjMybDExMi44MzIgMTU1LjMyOHpNNTQ0IDkyOGEzMiAzMiAwIDAgMS02NCAwdi0xOTJhMzIgMzIgMCAwIDEgNjQgMHYxOTJ6IG0tMjUwLjYyNC02MC42NGEzMiAzMiAwIDAgMS01MS43NzYtMzcuNjMybDExMi44MzItMTU1LjMyOGEzMiAzMiAwIDAgMSA1MS44MDggMzcuNjMybC0xMTIuODY0IDE1NS4zMjh6IG0tMTY3LjEzNi0xOTYuMzg0YTMyIDMyIDAgMSAxLTE5Ljc3Ni02MC44NjRsMTgyLjYyNC01OS4zMjhhMzIgMzIgMCAwIDEgMTkuNzc2IDYwLjg2NGwtMTgyLjYyNCA1OS4zMjh6IG0tMTkuNzc2LTI1Ny4wODhhMzIgMzIgMCAwIDEgMTkuNzc2LTYwLjg2NGwxODIuNjI0IDU5LjMyOGEzMiAzMiAwIDEgMS0xOS43NzYgNjAuODY0bC0xODIuNjI0LTU5LjMyOHpNMjQxLjYgMTk0LjI0YTMyIDMyIDAgMSAxIDUxLjc3Ni0zNy42MzJsMTEyLjg2NCAxNTUuMzI4YTMyIDMyIDAgMSAxLTUxLjgwOCAzNy42MzJMMjQxLjYgMTk0LjI0eiIgcC1pZD0iMjkxMSIgZmlsbD0iIzJjMmMyYyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(5)),r=f(n(18)),i=f(n(2)),o=f(n(0)),s=f(n(1)),u=f(n(3)),l=f(n(4)),c=n(13),d=f(n(9)),p=n(16),h=f(n(344));function f(e){return e&&e.__esModule?e:{default:e}}var g=void 0,v=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="pagePlugin",e.description="外部页面插件",e.plugins={},e.DefMap={},e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("MousedownPlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.click.tap("ClickPlugin",this.handleMouseUp.bind(this)),this.opsManager.hooks.mouseup.tap("MouseupPlugin",this.handleMouseUp.bind(this)),this.opsManager.hooks.pageChange.tap("pageChangePlugin",this.onPageChange.bind(this)),this.opsManager.hooks.opChange.tap("toolChangePlugin",this.handleToolChange.bind(this)),this.opsManager.hooks.cleanNonCanvasEle.tap("cleanNonCanvasElePlugin",this.handleCleanEle.bind(this))}},{key:"eventsToListen",value:function(){return{"pagePlugin:insert":{value:this.addPlugin.bind(this),information:{args:"opt",message:"添加ppt转码文档页面"}}}}},{key:"definePlugin",value:function(e){this.DefMap[e.pluginType]=e.PluginClass}},{key:"addPlugin",value:function(e){var t=this.app.room.currBoard,n=this.opsManager.currPage;if(e&&void 0!==e.boardName&&void 0!==e.pageName){var a=this.app.room.getPage(e.boardName,e.pageName);a&&(n=a)}else if(e&&void 0!==e.pageName){var r=this.app.room.getPage(t.boardName,e.pageName);r&&(n=r)}n?this.dispatchFromPage({type:this.type,pluginType:e.pluginType,attributes:e.attributes,boundary:{sx:e.cameraBound.centerX-e.cameraBound.width/2,sy:e.cameraBound.centerY-e.cameraBound.height/2,w:e.cameraBound.width,h:e.cameraBound.height}},n):this.app.logger.error("addPlugin: 调用失败。参数中的board: "+e.boardName+", page: "+e.pageName+"所指定的page找不到")}},{key:"handleCleanEle",value:function(e){for(var t in this.plugins){var n=this.plugins[t];n.boardName===e.boardName&&n.pageName===e.pageIndex&&this.destroyPlugin(n)}}},{key:"handleMouseDown",value:function(){this.lastFocusPlugin&&this.lastFocusPlugin.setClickable(!1)}},{key:"handleMouseUp",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.checkPluginClickable()}),0),this.checkPluginClickable()}},{key:"handleToolChange",value:function(e){"select"===e&&this.lastFocusPlugin?this.lastFocusPlugin.setClickable(!0):this.lastFocusPlugin&&this.lastFocusPlugin.setClickable(!1)}},{key:"checkPluginClickable",value:function(){var e=this.opsManager.selectedOpIds,t=void 0;1===e.length&&(t=this.plugins[e[0]]),this.lastFocusPlugin!==t&&(this.lastFocusPlugin&&this.lastFocusPlugin.setClickable(!1),t&&t.setClickable(!0),this.lastFocusPlugin=t)}},{key:"onPageChange",value:function(){var e=this;this.lastFocusPlugin&&(this.lastFocusPlugin.setClickable(!1),this.lastFocusPlugin=void 0),clearTimeout(g),g=setTimeout((function(){for(var t=(0,r.default)(e.app.room.boards),n=e.app.room.currBoard.pageNames,a=e.app.room.currIndex,i=e.app.room.currBoard.currIndex.toString(),o=(0,r.default)(e.plugins),s=o.length-1;s>=0;s--){var u=o[s],l=e.plugins[u];if(-1!==t.indexOf(l.boardName)){if(a!==l.boardName&&l.visible)l.hide();else if(a===l.boardName){if(-1===n.indexOf(i)){e.destroyPlugin(e.plugins[u]);continue}i!==l.pageName||l.visible?i!==l.pageName&&l.visible&&l.hide():l.show()}}else e.destroyPlugin(e.plugins[u])}}),0)}},{key:"destroy",value:function(){for(var e in this.plugins)this.destroyPlugin(this.plugins[e])}},{key:"destroyPlugin",value:function(e){e.destroy(),delete this.plugins[e.opId]}},{key:"updateDocClipPath",value:function(){for(var e=this.app.room.currIndex,t=(0,r.default)(this.plugins),n=t.length-1;n>=0;n--){var a=t[n],i=this.plugins[a];i.boardName===e&&(0,p.updateDocClipPath)(i.boundary,this.app.camera,i.container)}}},{key:"hide",value:function(e){var t=this.plugins[e.opId];t&&this.destroyPlugin(t)}},{key:"draw",value:function(e){if(!this.plugins[e.opId]){var t=this.DefMap[e.data.pluginType];if(!t)return void this.logger.error("你插入了类型为: "+e.data.pluginType+"的插件，但是该插件类型未定义");this.plugins[e.opId]=new h.default({snapshot:e,app:this.app,pagePluginOp:this,HandlerConstructor:t})}var n=this.plugins[e.opId],r=e.data,i=(0,c.getTransformedBoundary)(this.app.scale,r),o=n.container;(0,a.default)(o.style,{transformOrigin:"0 0",left:i.sx+"px",top:i.sy+"px",width:i.w*this.app.scale+"px",height:i.h*this.app.scale+"px",transform:"scale("+1/this.app.scale+")"}),(0,p.updateDocClipPath)({sx:i.sx,sy:i.sy,w:i.w,h:i.h},this.app.camera,o,1/this.app.scale),n.receiveAttributes(e.data.transDocData)}},{key:"transformOp",value:function(e,t){return(0,p.transformPropertyOverwriteOp)(e,t)}}]),t}(d.default);t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(0)),r=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t){(0,a.default)(this,e),this.visible=!1;var n=t.snapshot,r=t.app,i=t.pagePluginOp,o=t.HandlerConstructor;this.handler=new o,this.opId=n.opId,this.boardName=n.board,this.pageName=n.page.toString(),this.app=r,this.op=i,this.boundary=n.data.boundary,this.container=document.createElement("div"),this.container.style.position="fixed",this.container.id=""+n.opId,this.container.className="plugin-container",this.app.container.h5El.appendChild(this.container),this.mountElement({snapshot:n})}return(0,r.default)(e,[{key:"setClickable",value:function(e){this.container&&e!==this.clickable&&(this.clickable=e,this.container.style.pointerEvents=e?"auto":"unset")}},{key:"mountElement",value:function(e){var t=e.snapshot;this.attributes=t.data.attributes,this.visible=!0,this.handler.onMount&&this.handler.onMount({container:this.container,attributes:this.attributes,recordPlayer:this.app.isRecordPlayer})}},{key:"destroy",value:function(){var e;this.visible=!1,this.container&&(null===(e=this.container.parentNode)||void 0===e||e.removeChild(this.container)),this.handler.onDestroy&&this.handler.onDestroy({container:this.container,attributes:this.attributes,recordPlayer:this.app.isRecordPlayer})}},{key:"hide",value:function(){this.visible=!1,this.container&&(this.container.style.visibility="hidden"),this.handler.onHide&&this.handler.onHide({container:this.container,attributes:this.attributes,recordPlayer:this.app.isRecordPlayer})}},{key:"show",value:function(){this.visible=!0,this.container&&(this.container.style.visibility="visible"),this.handler.onShow&&this.handler.onShow({attributes:this.attributes,container:this.container,recordPlayer:this.app.isRecordPlayer})}},{key:"receiveAttributes",value:function(e){var t=this.attributes;this.handler.onReceiveAttributes&&this.handler.onReceiveAttributes({container:this.container,attributes:e,prevAttribtues:t,recordPlayer:this.app.isRecordPlayer})}},{key:"_putAttributes",value:function(e){this.op.dispatch({reuseOpType:"edit-"+this.opId,dependOn:this.opId,skipUndo:!0,type:this.op.type,attributes:e})}},{key:"putAttributes",value:function(e){this._putAttributes(e)}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=k(n(7)),r=k(n(5)),i=k(n(2)),o=k(n(0)),s=k(n(1)),u=k(n(3)),l=k(n(25)),c=k(n(4)),d=k(n(75)),p=n(30),h=k(n(58)),f=n(13),g=n(346),v=k(n(23)),y=n(140),m=n(66),M=n(29),x=n(65),w=n(98),I=n(143),b=n(16);function k(e){return e&&e.__esModule?e:{default:e}}var T=(0,m.deviceOS)(),_=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="shape",e.shouldSaniteEp=!0,e.description="绘制图形。\n首先使用op:shape:activate设置画布为矩形模式",e.defType="rect",e.currTextAttr={value:""},e.currOpId=void 0,e.lastDragMx=0,e.lastDragMy=0,e.lastOpId="",e.auxLock={pos:[0,0],lockX:0,lockY:0,unlockXCount:0,unlockYCount:0},e.enterTextEditMode=function(t){e.currOpId=t.opId,e.currTextAttr=(0,r.default)({},t.data.text||{})||{value:""},e.currEditor=(0,g.setupTextEditor)(e.app,(0,r.default)((0,r.default)({},t.data),{maxTxtLen:x.MAX_SHAPE_TXT_LEN}),{container:e.app.container.domEl,onchange:function(t){e.handleTextChange(t,!0)},onblur:function(t,n){n&&e.handleTextChange(t,!1),e.currEditor=null,e.currTextAttr={value:""},e.app.room.refresh()}}),e.app.emit("event:textEditor:show")},e.handleTextChange=function(t,n){e.currTextAttr||(e.currTextAttr={value:""}),e.currTextAttr.value=t;var a=e.opsManager.opMap.modify;"string"==typeof e.currOpId&&e.dispatch(a.getSnapshot([e.currOpId],[{k:"text",v:(0,r.default)({},e.currTextAttr)}],n))},e.getSnapshot=function(t){var n=v.default.shapeDef;return{type:e.type,boundary:e.getBoundaryRectOfLine(),lineWidth:n.lineWidth,inProgress:t,stroke:n.stroke,fill:n.fill,dash:M.IDashType.Solid,text:{value:"",stroke:n.text.stroke,fontSize:n.text.fontSize,fill:n.text.fill,textAlign:n.text.textAlign,verticalAlign:n.text.verticalAlign,fontFamily:n.text.fontFamily},shape:e.defType}},e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){(0,l.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"registerHooks",this).call(this),this.opsManager.hooks.opAdd.tap("OpAdd",this.onOpAdded.bind(this)),this.opsManager.hooks.click.tap("MouseClick",this.MouseClickHook.bind(this))}},{key:"eventsToListen",value:function(){return{"shape:dragShapeIn":{value:this.dragShapeIn.bind(this),information:{args:"ids: Array<string>, attrs:{key:string, value: any}[], inProgress: boolean",message:"更改选中元素的属性"}}}}},{key:"dragShapeIn",value:function(e,t,n,a){var r=v.default.shapeDef,i=void 0,o=void 0;if(a||0===this.lastDragMx&&0===this.lastDragMy){var s=t-this.app.container.left,u=n-this.app.container.top,l=this.app.camera.convertToPointInWorld(s,u);this.lastDragMx=l[0],this.lastDragMy=l[1]}i=this.lastDragMx,o=this.lastDragMy;var c=(0,I.getMoveInAuxiliaryLine)(this.app,i,o,this.auxLock);if(!c&&a)return!0;c&&(i=c.mx,o=c.my);var d={type:this.type,boundary:{sx:i-75,sy:o-75,w:150,h:150},lineWidth:r.lineWidth,inProgress:a,stroke:r.stroke,fill:r.fill,dash:M.IDashType.Solid,text:{value:"",stroke:r.text.stroke,fontSize:r.text.fontSize,fontFamily:r.text.fontFamily,fill:r.text.fill,textAlign:r.text.textAlign,verticalAlign:r.text.verticalAlign},shape:e};if(this.lastOpId){var p=this.opsManager.auxiliaryOp.calcAuxiliaryLine({bound:{sx:i-75,sy:o-75,w:150,h:150},ids:[this.lastOpId],action:"move"});(0,I.updateAuxLock)(this.auxLock,i,o,p)}this.lastOpId=this.dispatch(d),a||(this.opsManager.auxiliaryOp.clean(),this.app.setTool("select"),this.lastDragMx=0,this.lastDragMy=0,this.lastOpId="")}},{key:"dispatchClickSnap",value:function(e,t,n){return this.points=[[t-75,n-75],[t+75,n+75]],this.dispatch(this.getSnapshot(!1)),this.points=[],this.opsManager.setCurrOp("select"),!0}},{key:"handleMouseUp",value:function(e,n,a,r,o,s){(0,l.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"handleMouseUp",this).call(this,e,n,a,r,o,s),this.points=[],this.opsManager.setCurrOp("select")}},{key:"onOpAdded",value:function(e){if("shape"===e.data.type&&e.uid===this.app.account&&!e.data.inProgress){var t=e.time,n=Date.now()+this.app.ntpTimeDiff;Math.abs(n-t)<100&&this.currOpId!==e.opId&&(this.dispatch(this.opsManager.selectOp.getSnapshot([e.opId])),T.isDesktop&&this.enterTextEditMode(e))}}},{key:"MouseClickHook",value:function(e,t,n){var a=this;if(this.opsManager.currOp instanceof h.default){var r=this.opsManager.selectedOpIds.filter((function(e){return a.drawOpsOfPage.hasOwnProperty(e)}));if(1===r.length){var i=this.drawOpsOfPage[r[0]];if("shape"===i.data.type&&!(0,m.isIosDevice)()){var o=(0,f.getTransformedVertices)(i.data);if((0,f.pointInVertices)(o,[t,n]))return this.currOpId===i.opId&&this.currEditor||(this.enterTextEditMode(i),this.app.room.refresh()),!0}}}}},{key:"isTxtContained",value:function(e){var t=e.data;if(this.app.ShapeDesc[t.shape]&&t.text){var n=(0,w.getEditorPos)(this.app,t),a=n.w,r=n.h,i=t.text.fontSize||32;return r>(0,y.getTextLines)({ctx:this.app.container.ctx,txt:t.text.value||"",fontSize:i,w:a,fontFamily:t.text.fontFamily}).length*i*1.25-.28*i}return!0}},{key:"setSubType",value:function(e){this.defType=e}},{key:"draw",value:function(e,t){var n,a=e.data;a.shape&&this.app.ShapeDesc.hasOwnProperty(a.shape)?(this.drawPath(t,a.shape,a),this.strokeOrFill(t,{stroke:a.stroke,fill:a.fill,lineWidth:a.lineWidth,opacity:a.opacity,isShape:!0,dash:a.dash}),(null===(n=e.data.text)||void 0===n?void 0:n.value)&&(this.currOpId===e.opId&&this.currEditor?(this.currTextAttr=e.data.text||{value:""},(0,g.updateEditor)(this.app,this.currEditor,a)):a.text&&(0,y.drawTextOnCanvas)(this.app,t,a,this.app.scale))):console.warn("[白板], 未定义类型: "+a.shape)}},{key:"drawPath",value:function(e,t,n){var r=[n.boundary.sx,n.boundary.sy],i=[n.boundary.sx+n.boundary.w,n.boundary.sy+n.boundary.h],o=n.mat,s=this.app.ShapeDesc[t].path;e.beginPath();var u=!0,l=this.app.scale,c=(0,f.getTransformedSize)(n);s="function"==typeof s?s(c.w,c.h):s;var d=!0,h=!1,g=void 0;try{for(var v,y=(0,a.default)(s);!(d=(v=y.next()).done);d=!0){var m=v.value,M=m.pos.map((function(e){var t=C(r,i,e);return t=(0,p.getTransPoint)(t,o),(0,b.padPt)(t,l)}));u&&(e.moveTo(M[0][0],M[0][1]),u=!1),"l"===m.t?e.lineTo(M[1][0],M[1][1]):"b"===m.t&&(4===M.length?e.bezierCurveTo(M[1][0],M[1][1],M[2][0],M[2][1],M[3][0],M[3][1]):3===M.length&&e.quadraticCurveTo(M[1][0],M[1][1],M[2][0],M[2][1]))}}catch(e){h=!0,g=e}finally{try{!d&&y.return&&y.return()}finally{if(h)throw g}}e.closePath()}}]),t}(d.default);function C(e,t,n){return[e[0]*(1-n[0])+t[0]*n[0],e[1]*(1-n[1])+t[1]*n[1]]}t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateEditor=t.setupTextEditor=void 0;var a,r=n(5),i=(a=r)&&a.__esModule?a:{default:a},o=n(66),s=n(23),u=n(98);var l=1,c=(t.setupTextEditor=function(e,t,n){var a=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div");r.appendChild(i),i.contentEditable="true",i.dataset.editorId="shape-"+(l++).toString();var s=0;a.ontouchstart=function(e){s=Date.now(),e.stopPropagation()},a.onmousedown=function(e){s=Date.now(),e.stopPropagation()},a.onmousemove=function(e){document.body.style.cursor="auto",e.stopPropagation()};var p=!1;return i.oninput=function(e){p=!0,(0,u.inputHandler)(e,(function(e){var i;n.onchange(e),d(null===(i=t.text)||void 0===i?void 0:i.verticalAlign,a,r)}),t.maxTxtLen)},i.onblur=function(e){Date.now()-s<100?e.target.focus():(n.onblur((0,u.htmlToText)(e.target),p),n.container.removeChild(a))},i.onfocus=function(e){var n;if(!(Date.now()-s<100)){var l=(0,o.deviceOS)();(0,u.setTextRange)(i,l.isDesktop?"all":"end"),d(null===(n=t.text)||void 0===n?void 0:n.verticalAlign,a,r)}},i.onkeydown=function(e){return(0,u.preventOverLen)(e,t.maxTxtLen)},i.onpaste=function(e){return(0,u.preventOverLen)(e,t.maxTxtLen)},i.addEventListener("beforeinput",u.beforeInputHandler),i.addEventListener("compositionstart",u.beforeInputHandler),i.addEventListener("compositionend",(function(e){(0,u.inputHandler)(e,n.onchange,t.maxTxtLen)})),t.text&&(i.innerText=t.text.value),c(e,{container:a,wrapper:r,core:i},t),n.container.appendChild(a),a.appendChild(r),i.focus(),{container:a,wrapper:r,core:i}},t.updateEditor=function(e,t,n){var a,r,o,l,c,d,p=(0,u.getEditorPos)(e,n),h=(null===(a=n.text)||void 0===a?void 0:a.fontSize)||32,f=(null===(r=n.text)||void 0===r?void 0:r.fontFamily)||s.DefaultFont,g=1.25*h;(0,u.setEditorTxt)(t.core,(null===(o=n.text)||void 0===o?void 0:o.value)||""),(0,i.default)(t.container.style,{position:"absolute",left:p.sx+"px",top:p.sy+"px",width:p.w+1+"px",height:p.h+"px",transform:"rotate("+180*p.angle/Math.PI+"deg)",transformOrigin:"0 0",padding:0,outline:"none",resize:"none",overflow:"hidden",pointerEvents:"auto",textAlign:(null===(l=n.text)||void 0===l?void 0:l.textAlign)||"left"}),(0,i.default)(t.wrapper.style,{width:"100%",height:"fit-content",fontFamily:f,fontSize:h+"px",fontWeight:"normal",lineHeight:g+"px",padding:0}),(0,i.default)(t.core.style,(0,i.default)({display:"inline",outline:"none","-webkit-font-smoothing":"antialiased",userSelect:"text",webkitUserSelect:"text",paddingLeft:"1px",color:(null===(c=n.text)||void 0===c?void 0:c.stroke)||"rgb(0,0,0)",background:"transparent"},(null===(d=n.text)||void 0===d?void 0:d.fill)?{backgroundColor:n.text.fill}:{}))}),d=function(e,t,n){var a=n.clientHeight<t.clientHeight,r=a&&("middle"===e||"bottom"===e),o=a&&"middle"===e,s=t.getElementsByClassName("pre"),u=t.getElementsByClassName("aft");if(r&&0===s.length){var l=document.createElement("div");l.className="pre",t.prepend(l),(0,i.default)(l.style,{height:"100%"})}else if(!r&&s.length>0)for(var c=s.length-1;c>=0;c--)s[c].remove();if(o&&0===u.length){var d=document.createElement("div");d.className="aft",t.appendChild(d),(0,i.default)(d.style,{height:"100%"})}else if(!o&&u.length>0)for(var p=u.length-1;p>=0;p--)u[p].remove();"bottom"===e?t.scrollTop=t.scrollHeight:"middle"===e&&(t.childNodes.length>1?t.scrollTop=(t.clientHeight+n.clientHeight)/2:t.scrollTop=(n.clientHeight-t.clientHeight)/2)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=b(n(19)),r=b(n(7)),i=b(n(5)),o=b(n(2)),s=b(n(0)),u=b(n(1)),l=b(n(3)),c=b(n(4)),d=b(n(141)),p=b(n(75)),h=n(29),f=b(n(58)),g=n(140),v=n(229),y=n(13),m=n(64),M=n(39),x=n(65),w=n(23),I=n(139);function b(e){return e&&e.__esModule?e:{default:e}}var k=function(e){function t(){(0,s.default)(this,t);var e=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="link",e.description="流程图连接",e._handleMoveText=function(t,n,a){if(e.movingText)for(var r=(0,m.getNearestLinkInfo)({mx:t,my:n,data:e.movingText.linkSnap.data}),i=r.per,o=r.dist,s=e.movingText.linkSnap.data,u=s.text||{arr:[],stroke:"black",fontSize:12,fontFamily:w.DefaultFont},l=u.arr,c=(0,d.default)(u),p=0;p<l.length;p++)if(l[p]._id===e.movingText._id){var h=x.TEXT_REMOVE_THRES/e.app.scale;if(o>h&&!a)c.arr.splice(p,1);else if(o>h){var f=(0,m.getLinkPosByPer)({data:s,per:i,op:e}),g=t-f[0],v=n-f[1],y=Math.sqrt(g*g+v*v);g=g/y*(.5*h+Math.pow(y,.7)),v=v/y*(.5*h+Math.pow(y,.7)),c.arr[p].per=i,c.arr[p].rm=!0,c.arr[p].dx=g,c.arr[p].dy=v}else c.arr[p].per=i;return void e.dispatch(e.opsManager.modifyOp.getSnapshot([e.movingText.linkSnap.opId],[{k:"text",v:c}],a))}},e._handleMoveP=function(t,n,a){var r;if(e.movingEle){var o=void 0,s=(0,i.default)({},e.movingEle.start),u=(0,i.default)({},e.movingEle.end);if("conn"===e.movingEle.type)o=(0,m.graphAftConnM)({start:e.movingEle.start,end:e.movingEle.end,startPos:e.movingEle.startPos,endPos:e.movingEle.endPos,connPs:e.movingEle.connPs,index:e.movingEle.index,linkType:e.movingEle.linkType,x:t,y:n,op:e}),s.dir=o.start.dir,u.dir=o.end.dir;else{var l=e.drawOpsOfPage[e.movingEle.opId].data;l=l&&"link"===l.type?l:void 0;var c={linkType:e.movingEle.linkType,sFrom:e.movingEle.startPos,eFrom:e.movingEle.endPos,sTo:e.movingEle.startPos,eTo:e.movingEle.endPos,connPs:e.movingEle.connPs,data:e.drawOpsOfPage[e.movingEle.opId].data},d=(0,M.findEndPoint)(e.app,{drawOps:e.drawOpsOfPage,scale:e.app.scale,mx:t,my:n}),p="start"===e.movingEle.type?e.movingEle.endPos:e.movingEle.startPos,f=d?d.dir:(0,M.getInitDir)(p,{x:t,y:n}),g={x:t,y:n};if(d){var v=null===(r=e.drawOpsOfPage[d.opId])||void 0===r?void 0:r.data;v&&(g=(0,M.getEndPointInfo)(e.app,v,d.per))}"start"===e.movingEle.type?c.sTo=(0,i.default)((0,i.default)({},g),{dir:f}):c.eTo=(0,i.default)((0,i.default)({},g),{dir:f}),o=(0,m.graphAftEndM)((0,i.default)((0,i.default)({},c),{op:e})),"start"===e.movingEle.type?s=d?{id:d.opId,type:h.IEndPointType.ATTACH,per:d.per,aType:e.movingEle.start.aType,dir:o.start.dir,reset:!0}:{type:h.IEndPointType.COORD,x:t,y:n,aType:e.movingEle.start.aType,dir:o.start.dir,reset:!0}:u=d?{id:d.opId,type:h.IEndPointType.ATTACH,per:d.per,aType:e.movingEle.end.aType,dir:o.end.dir,reset:!0}:{type:h.IEndPointType.COORD,x:t,y:n,aType:e.movingEle.end.aType,dir:o.end.dir,reset:!0}}return e.dispatch(e.opsManager.modifyOp.getSnapshot([e.movingEle.opId],[{k:"connPs",v:o.connPs},{k:"start",v:s},{k:"end",v:u}],a)),!0}},e.addT=function(t){var n=e.drawOpsOfPage[t];if(n&&"link"===n.data.type){var a=n.data;if(!(a.text.arr.length>=7)){var r=(0,M.getLinkNewTextPer)(a.text.arr);if(r>0&&r<1){var i=(0,m.getLinkPosByPer)({per:r,data:a,op:e});e.enterTextEditMode({x:i[0],y:i[1],linkSnap:n,per:r})}}}},e.enterTextEditMode=function(t){clearTimeout(e.textEditTimer),e.textEditTimer=setTimeout((function(){clearTimeout(e.textEditTimer),e._enterTextEditMode(t)}),100)},e._enterTextEditMode=function(t){var n,a,r,i,o;e.app.room.refresh();var s=t.per,u=t.x,l=t.y,c=t._id,d=t.linkSnap;e.textEditInfo={_id:c,linkSnap:d,per:s};var p=d.data,h=((null===(n=p.text)||void 0===n?void 0:n.arr)||[]).filter((function(e){return e._id===c}))[0];e.currEditor=(0,v.setupTextEditor)(e.app,{text:(null==h?void 0:h.value)||"",stroke:(null===(a=p.text)||void 0===a?void 0:a.stroke)||"black",fontSize:(null===(r=p.text)||void 0===r?void 0:r.fontSize)||12,fontFamily:(null===(i=p.text)||void 0===i?void 0:i.fontFamily)||w.DefaultFont,textAlign:"center",maxTxtLen:x.MAX_LINK_TXT_LEN},{sx:u-I.MIN_TXT_W/2,sy:l-1.5*((null===(o=p.text)||void 0===o?void 0:o.fontSize)||12)/2,angle:0},{container:e.app.container.domEl,onchange:function(t){e.handleTextChange(t,!0)},onblur:function(t,n){e.handleTextBlur(t,n),e.app.room.refresh()}}),e.app.emit("event:textEditor:show")},e.handleTextChange=function(t,n){if(e.textEditInfo){e.textEditInfo._id||(e.textEditInfo._id=Date.now()+Math.ceil(1e3*Math.random()));for(var a=e.textEditInfo.linkSnap.data.text||{arr:[],stroke:"black",fontSize:12},r=a.arr,o=(0,d.default)(a),s=!1,u=0;u<r.length;u++)if(r[u]._id===e.textEditInfo._id){o.arr[u].value=t;var l=e.getTextBoundRect();o.arr[u]=(0,i.default)((0,i.default)((0,i.default)({},o.arr[u]),{value:t}),l),s=!0;break}if(!s){var c=e.getTextBoundRect();o.arr.push((0,i.default)({_id:e.textEditInfo._id,value:t,per:e.textEditInfo.per},c))}o.arr=o.arr.filter((function(e){return e.value})),e.dispatch(e.opsManager.modifyOp.getSnapshot([e.textEditInfo.linkSnap.opId],[{k:"text",v:o}],n))}},e.getTextBoundRect=function(){var t=e.currEditor.container.getBoundingClientRect(),n=t.width,a=t.height;return{w:n/=e.app.scale,h:a/=e.app.scale}},e.handleTextBlur=function(t,n){n&&e.handleTextChange(t,!1),e.textEditInfo=void 0,e.currEditor=void 0},e}return(0,c.default)(t,e),(0,u.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("md",this.handleMouseDown.bind(this)),this.opsManager.hooks.mousemove.tap("mm",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseup.tap("mc",this.handleMouseUp.bind(this)),this.opsManager.hooks.dblClick.tap("dblClick",this.handleDblClick.bind(this)),this.opsManager.hooks.click.tap("click",this.handleClick.bind(this))}},{key:"eventsToListen",value:function(){return{"link:addT":{value:this.addT,information:{args:"id: string",message:""}}}}},{key:"getMouseHandleIds",value:function(e){var t=this,n=[];if(this.opsManager.currOp instanceof f.default){var a=this.opsManager.selectedOpIds;for(var r in this.drawOpsOfPage)"link"===this.drawOpsOfPage[r].data.type&&-1===a.indexOf(r)&&n.push(r);1===a.length&&"link"===this.drawOpsOfPage[a[0]].data.type&&n.push(a[0]);var i=this.app.getCameraBound();n=n.filter((function(e){var n=t.drawOpsOfPage[e],a=(0,y.getTransformedBoundary)(t.app.scale,{boundary:n.data.boundary});return a.sx<i.centerX+i.width/2&&a.sy<i.centerX+i.width/2&&a.sx+a.w>i.centerX-i.width/2&&a.sy+a.h>i.centerX-i.width/2}))}return n}},{key:"handleMouseDown",value:function(e,t,n){var a;this.movingEle=void 0,this.movingText=void 0;var i=this.getMouseHandleIds(e),o=this.opsManager.selectedOpIds,s=!0,u=!1,l=void 0;try{for(var c,d=(0,r.default)(i);!(s=(c=d.next()).done);s=!0){var p=c.value,h=this.drawOpsOfPage[p],f=h.data,g=f.start,v=f.end,y=f.connPs,m=f.linkType,x=this.getPosToMouse({mx:t,my:n,data:f}),w=(0,M.getLinkEndPos)(this.app,g,this),I=(0,M.getLinkEndPos)(this.app,v,this);if(w&&I&&x){if("start"===x.type)return this.movingEle={opId:p,type:"start",index:-1,connPs:y.slice(),startPos:w,endPos:I,start:g,end:v,linkType:m},!0;if("end"===x.type)return this.movingEle={opId:p,type:"end",index:-1,connPs:y.slice(),startPos:w,endPos:I,start:g,end:v,linkType:m},!0;if("conn"===x.type&&-1!==o.indexOf(p))return this.movingEle={opId:p,type:"conn",index:x.payload.index,connPs:y.slice(),startPos:w,endPos:I,start:g,end:v,linkType:m},!0;if("text"===x.type){var b=(null===(a=f.text)||void 0===a?void 0:a.arr)||[],k=!0,T=!1,_=void 0;try{for(var C,N=(0,r.default)(b);!(k=(C=N.next()).done);k=!0){var A=C.value;if(A._id===x.payload._id)return this.movingText={linkSnap:h,_id:A._id,per:A.per},!0}}catch(e){T=!0,_=e}finally{try{!k&&N.return&&N.return()}finally{if(T)throw _}}}}}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default){if(this.movingEle&&this.isMouseDown)return this._handleMoveP(t,n,!0);if(this.movingText&&this.isMouseDown)return this._handleMoveText(t,n,!0),!0;if(!this.isMouseDown&&1===this.opsManager.selectedOpIds.length){var a=this.drawOpsOfPage[this.opsManager.selectedOpIds[0]].data;if("link"===a.type){var r=this.getPosToMouse({mx:t,my:n,data:a});if(r)return"start"===r.type&&a.start.type===h.IEndPointType.COORD||"end"===r.type&&a.end.type===h.IEndPointType.COORD||"conn"===r.type||"text"===r.type?(document.body.style.cursor="pointer",!0):(document.body.style.cursor="auto",!0)}}}}},{key:"handleMouseUp",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default&&this.movingEle&&this.isMouseDown){var a=this._handleMoveP(t,n,!1);return this.movingEle=void 0,this.movingText=void 0,a}if(this.opsManager.currOp instanceof f.default&&this.movingText&&this.isMouseDown)return this._handleMoveText(t,n,!1),this.movingEle=void 0,this.movingText=void 0,!0}},{key:"handleClick",value:function(e,t,n){var a;if(this.opsManager.currOp instanceof f.default){var i=this.opsManager.currOp.selectedOpIds;if(1===i.length){var o=this.drawOpsOfPage[i[0]];if("link"===o.data.type){var s=o.data,u=(null===(a=s.text)||void 0===a?void 0:a.arr)||[],l=!0,c=!1,d=void 0;try{for(var p,h=(0,r.default)(u);!(l=(p=h.next()).done);l=!0){var g=p.value,v=(0,m.getLinkPosByPer)({data:s,per:g.per,op:this});if((0,y.pointInRect)({sx:v[0]-g.w/2,sy:v[1]-g.h/2,w:g.w,h:g.h},0,[t,n]))return this.enterTextEditMode({x:v[0]-g.w/2,y:v[1]-g.h/2,_id:g._id,per:g.per,linkSnap:o}),!0}}catch(e){c=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw d}}}}}}},{key:"getPosToMouse",value:function(e){var t,n=e.mx,a=e.my,i=e.data;if("link"===i.type){var o=i.connPs,s=i.start,u=i.end,l=(0,M.getLinkEndPos)(this.app,s,this),c=(0,M.getLinkEndPos)(this.app,u,this);if(!l||!c)return;var d=Math.abs(c.x-n)+Math.abs(c.y-a)<x.END_POINT_TEST_RADIUS/this.app.scale;if(Math.abs(l.x-n)+Math.abs(l.y-a)<x.END_POINT_TEST_RADIUS/this.app.scale)return{type:"start"};if(d)return{type:"end"};for(var p=0;p<o.length;p++){if(Math.abs(o[p].x-n)+Math.abs(o[p].y-a)<x.CONN_TEST_RADIUS/this.app.scale)return{type:"conn",payload:{index:p,per:(0,m.getNearestLinkInfo)({mx:n,my:a,data:i}).per}}}var h=(null===(t=i.text)||void 0===t?void 0:t.arr)||[],f=!0,g=!1,v=void 0;try{for(var w,I=(0,r.default)(h);!(f=(w=I.next()).done);f=!0){var b=w.value,k=(0,m.getLinkPosByPer)({data:i,per:b.per,op:this});if((0,y.pointInRect)({sx:k[0]-b.w/2,sy:k[1]-b.h/2,w:b.w,h:b.h},0,[n,a]))return{type:"text",payload:{_id:b._id}}}}catch(e){g=!0,v=e}finally{try{!f&&I.return&&I.return()}finally{if(g)throw v}}if((0,m.isUnderPoint)({data:i,p:[n,a],op:this}))return{type:"link",payload:{per:(0,m.getNearestLinkInfo)({mx:n,my:a,data:i}).per}}}}},{key:"handleDblClick",value:function(e,t,n){var a,o,s=this.getMouseHandleIds(e),u=this.opsManager.selectedOpIds,l=!0,c=!1,d=void 0;try{for(var p,f=(0,r.default)(s);!(l=(p=f.next()).done);l=!0){var g=p.value,v=this.drawOpsOfPage[g],y=v.data,x=this.getPosToMouse({data:y,mx:t,my:n});if(x){if("start"===x.type&&y.start.type===h.IEndPointType.COORD)return(0,M.selectShapeForLink)({app:this.app,op:this,linkData:y,linkId:v.opId,where:"start"}),!0;if("end"===x.type&&y.end.type===h.IEndPointType.COORD)return(0,M.selectShapeForLink)({app:this.app,op:this,linkData:y,linkId:v.opId,where:"end"}),!0;if("conn"===x.type){if((null===(a=y.connPs[x.payload.index])||void 0===a?void 0:a.type)===h.IConnPointType.Anchor&&-1!==u.indexOf(g)){var w=(0,M.getLinkEndPos)(this.app,y.start,this),I=(0,M.getLinkEndPos)(this.app,y.end,this);if(!w||!I)continue;var b=(0,m.graphAftConnD)({start:w,end:I,data:y,index:x.payload.index,op:this});return this.dispatch(this.opsManager.modifyOp.getSnapshot([v.opId],[{k:"connPs",v:b.connPs},{k:"start",v:(0,i.default)((0,i.default)({},y.start),{dir:b.start.dir})},{k:"end",v:(0,i.default)((0,i.default)({},y.end),{dir:b.end.dir})}],!1)),!0}if(y.text.arr.length<7){var k=(0,m.getLinkPosByPer)({per:x.payload.per,data:y,op:this});return this.enterTextEditMode({x:k[0],y:k[1],linkSnap:v,per:x.payload.per}),!0}}else if("link"===x.type){if(y.text.arr.length<7){var T=(0,m.getLinkPosByPer)({per:x.payload.per,data:y,op:this});return this.enterTextEditMode({x:T[0],y:T[1],linkSnap:v,per:x.payload.per}),!0}}else if("text"===x.type){var _=(null===(o=y.text)||void 0===o?void 0:o.arr)||[],C=!0,N=!1,A=void 0;try{for(var P,O=(0,r.default)(_);!(C=(P=O.next()).done);C=!0){var D=P.value;if(D._id===x.payload._id){var S=(0,m.getLinkPosByPer)({data:y,per:D.per,op:this});return console.log("pos",S,"entry w h",D.w,D.h),this.enterTextEditMode({x:S[0]-D.w/2,y:S[1]-D.h/2,_id:D._id,per:D.per,linkSnap:v}),!0}}}catch(e){N=!0,A=e}finally{try{!C&&O.return&&O.return()}finally{if(N)throw A}}}}}}catch(e){c=!0,d=e}finally{try{!l&&f.return&&f.return()}finally{if(c)throw d}}}},{key:"drawSelectedLink",value:function(e,t){var n=t.data,a=n.start,i=n.end,o=n.connPs,s=(0,M.getLinkEndPos)(this.app,a,this),u=(0,M.getLinkEndPos)(this.app,i,this);if(s&&u){this.drawWhiteDot(e,s),this.drawWhiteDot(e,u);var l=!0,c=!1,d=void 0;try{for(var p,f=(0,r.default)(o);!(l=(p=f.next()).done);l=!0){var g=p.value;if(e.beginPath(),g.type===h.IConnPointType.Split)Math.min((0,y.dist)([s.x,s.y],[g.x,g.y]),(0,y.dist)([u.x,u.y],[g.x,g.y]))>x.CONN_DISP_THRES/this.app.scale&&this.drawBlueDot(e,g);else this.drawWhiteDot(e,g)}}catch(e){c=!0,d=e}finally{try{!l&&f.return&&f.return()}finally{if(c)throw d}}}}},{key:"drawBlueDot",value:function(e,t){e.beginPath(),e.fillStyle="blue",e.arc(t.x,t.y,2/this.app.scale,0,2*Math.PI),e.fill()}},{key:"drawWhiteDot",value:function(e,t){e.beginPath(),e.fillStyle="white",e.arc(t.x,t.y,4/this.app.scale,0,2*Math.PI),e.fill(),e.strokeStyle="black",e.arc(t.x,t.y,4/this.app.scale,0,2*Math.PI),e.stroke()}},{key:"draw",value:function(e,t){var n=e.data,a=n.dash,r=n.start,i=n.end,o=this.app.room.getPage(e.board,e.page.toString(),!1),s=(0,M.getLinkEndPos)(this.app,r,this,o),u=(0,M.getLinkEndPos)(this.app,i,this,o);if(s&&u){if(a===h.IDashType.Dashed){var l=2/this.app.scale;t.lineCap="butt",t.lineWidth=1/this.app.scale,t.setLineDash([l,2*l])}else t.lineWidth=n.lineWidth;t.strokeStyle=n.stroke,(0,m.drawLink)({ctx:t,data:n,op:this});var c=(0,m.getArrowPts)({data:n,op:this,startPos:s,endPos:u});r.aType===h.IArrowType.Arrow&&this.drawArrow(t,c.start,n.stroke),i.aType===h.IArrowType.Arrow&&this.drawArrow(t,c.end,n.stroke),this.drawText(e,t,o)}}},{key:"drawArrow",value:function(e,t,n){e.beginPath(),e.moveTo.apply(e,(0,a.default)(t[0])),e.lineTo.apply(e,(0,a.default)(t[1])),e.lineTo.apply(e,(0,a.default)(t[2])),e.fillStyle=n,e.fill()}},{key:"drawText",value:function(e,t,n){var a,i=e.data,o=i.text;if(o){t.fillStyle=o.stroke;var s=!0,u=!1,l=void 0;try{for(var c,d=(0,r.default)(o.arr);!(s=(c=d.next()).done);s=!0){var p=c.value;if(p._id===(null===(a=this.textEditInfo)||void 0===a?void 0:a._id)&&this.currEditor){var h=(0,m.getLinkPosByPer)({per:p.per,data:i,op:this});(0,v.updateEditor)({sx:h[0]-p.w/2,sy:h[1]-p.h/2,angle:0},this.currEditor,{text:p.value,stroke:o.stroke,fontSize:o.fontSize,fontFamily:o.fontFamily,textAlign:"center"})}else{var f=(0,m.getLinkPosByPer)({per:p.per,data:i,op:this,page:n}),y=(0,g.getTextLines)({ctx:t,txt:p.value,fontSize:o.fontSize,fontFamily:o.fontFamily});p.rm||(t.fillStyle=this.app.appConfig.canvasBgColor,t.fillRect(f[0]-p.w/2,f[1]-p.h/2,p.w,p.h)),t.translate(f[0]-p.w/2,f[1]-p.h/2),p.rm&&(t.globalAlpha=.3,t.translate(p.dx||0,p.dy||0)),(0,g.drawText)({ctx:t,textArr:y,fontSize:o.fontSize,fontFamily:o.fontFamily,lineHeightF:1.25,w:p.w,h:p.h,fill:void 0,stroke:o.stroke,clip:!0,align:"center",vAlign:"middle"}),p.rm&&(t.globalAlpha=1,t.translate(-(p.dx||0),-(p.dy||0))),t.translate(-f[0]+p.w/2,-f[1]+p.h/2)}}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}}}},{key:"patchOp",value:function(e){var t=this.app.room.getPage(e.board,e.page.toString(),!1);(0,m.patchLink)({data:e.data,op:this,page:t})}},{key:"getUpdatedTxtProps",value:function(e,t){var n=t.fontFamily,a=t.fontSize,i=(0,d.default)(e.text),o=i.arr,s=!0,u=!1,l=void 0;try{for(var c,p=(0,r.default)(o);!(s=(c=p.next()).done);s=!0){var h=c.value;if(a)h.w=a/i.fontSize*h.w,h.h=a/i.fontSize*h.h;else if(n){var f=this.opsManager.textOp.getTextSize({text:h.value,fontFamily:n,fontSize:i.fontSize});h.w=f.w,h.h=f.h}}}catch(e){u=!0,l=e}finally{try{!s&&p.return&&p.return()}finally{if(u)throw l}}return a?i.fontSize=a:n&&(i.fontFamily=n),i}}]),t}(p.default);t.default=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=x(n(7)),r=x(n(5)),i=x(n(2)),o=x(n(0)),s=x(n(1)),u=x(n(3)),l=x(n(4)),c=n(13),d=n(65),p=n(30),h=x(n(9)),f=x(n(58)),g=n(16),v=x(n(23)),y=n(64),m=n(39),M=n(29);function x(e){return e&&e.__esModule?e:{default:e}}var w=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="graph",e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("md",this.handleMouseDown.bind(this)),this.opsManager.hooks.mouseup.tap("mu",this.handleMouseUp.bind(this)),this.opsManager.hooks.mousemove.tap("mm",this.handleMouseMove.bind(this)),this.opsManager.hooks.click.tap("mc",this.handleClick.bind(this))}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default&&(this.hintInfo||this.setHintInfo(t,n),this.hintInfo))return this.dispatch(this.opsManager.selectOp.getSnapshot([])),!0}},{key:"handleMouseUp",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default&&this.hintInfo){if(this.isMouseMoved){var a=this.genLink(t,n,!1);if(!a)return;(0,m.selectShapeForLink)({linkData:a.linkData,linkId:a.opId,app:this.app,op:this,where:"end"})}else this.handleClick(e,t,n);return this.hintInfo=void 0,this.hideHintShape(),!0}}},{key:"setHintInfo",value:function(e,t){var n,a,r=null===(n=this.opsManager.selectOp.selectInfo)||void 0===n?void 0:n.hintPos,i=null===(a=this.opsManager.drawOpsOfPage[this.opsManager.selectedOpIds[0]])||void 0===a?void 0:a.data;if(r&&i){var o=this.app.scale,s=d.HINT_TEST_RADIUS/o;(0,c.dist)([e,t],r.p1)<s?this.hintInfo={data:i,id:r.id,p:r.p1,sp:r.sp1,dir:M.DIRECTION.UP}:(0,c.dist)([e,t],r.p2)<s?this.hintInfo={data:i,id:r.id,p:r.p2,sp:r.sp2,dir:M.DIRECTION.RIGHT}:(0,c.dist)([e,t],r.p3)<s?this.hintInfo={data:i,id:r.id,p:r.p3,sp:r.sp3,dir:M.DIRECTION.DOWN}:(0,c.dist)([e,t],r.p4)<s?this.hintInfo={data:i,id:r.id,p:r.p4,sp:r.sp4,dir:M.DIRECTION.LEFT}:this.hintInfo=void 0}else this.hintInfo=void 0}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default&&!this.isMouseDown)this.setHintInfo(t,n);else if(this.opsManager.currOp instanceof f.default&&this.hintInfo)return this.genLink(t,n,!0),this.hideHintShape(),!0;this.hintInfo?this.showHintShape(this.hintInfo.data,this.hintInfo.id,this.hintInfo.sp,this.hintInfo.dir,!1):this.hideHintShape()}},{key:"handleClick",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default){if(this.hintInfo||this.setHintInfo(t,n),this.hintInfo)return this.showHintShape(this.hintInfo.data,this.hintInfo.id,this.hintInfo.sp,this.hintInfo.dir,!0),this.hintInfo=void 0,this.hideHintShape(),!0;this.hideHintShape()}}},{key:"genLink",value:function(e,t,n){if(this.hintInfo){var a=1/8;switch(this.hintInfo.dir){case M.DIRECTION.DOWN:a=5/8;break;case M.DIRECTION.LEFT:a=7/8;break;case M.DIRECTION.RIGHT:a=3/8}var i={id:this.hintInfo.id,type:M.IEndPointType.FLEX,per:a,aType:v.default.linkDef.startArrow,dir:this.hintInfo.dir},o=(0,m.findEndPoint)(this.app,{mx:e,my:t,drawOps:this.drawOpsOfPage,scale:this.app.scale}),s=o?o.dir:(0,m.getInitDir)({x:this.hintInfo.sp[0],y:this.hintInfo.sp[1]},{x:e,y:t}),u=o?{id:o.opId,type:M.IEndPointType.FLEX,per:o.per,aType:v.default.linkDef.endArrow,dir:s}:{type:M.IEndPointType.COORD,x:e,y:t,aType:v.default.linkDef.endArrow,dir:s},l=(0,m.getLinkEndPos)(this.app,i,this.opsManager.linkOp),c=(0,m.getLinkEndPos)(this.app,u,this.opsManager.linkOp);if(l&&c){var d=(0,y.graphInit)({linkType:v.default.linkDef.linkType,start:l,end:c,op:this,data:{start:i,end:u}}),p={type:"link",start:(0,r.default)((0,r.default)({},i),{dir:d.start.dir}),end:(0,r.default)((0,r.default)({},u),{dir:d.end.dir}),connPs:d.connPs,dash:v.default.linkDef.dash,linkType:v.default.linkDef.linkType,stroke:v.default.linkDef.stroke,lineWidth:v.default.linkDef.lineWidth,inProgress:n,text:{arr:[],fontSize:v.default.linkDef.text.fontSize,stroke:v.default.linkDef.text.stroke,fontFamily:v.default.linkDef.text.fontFamily}};return{linkData:p,opId:this.dispatch(p)}}}}},{key:"connToExistShape",value:function(e){var t=e.data,n=e.id,a=e.sp,i=e.dir,o=e.per,s=e.otherPer,u=e.dirAftRotate,l=e.send,h=1/0,f=void 0,g=d.SUGGEST_SHAPE_DIST,x=(0,c.getTransformedBoundary)(this.app.scale,{mat:t.mat,boundary:t.boundary}),w=i===M.DIRECTION.LEFT||i===M.DIRECTION.RIGHT?x.w:x.h,I=[];for(var b in this.drawOpsOfPage){var k=this.drawOpsOfPage[b].data;"link"===k.type&&k.start.type!==M.IEndPointType.COORD&&k.end.type!==M.IEndPointType.COORD&&(k.start.id===n&&-1===I.indexOf(k.end.id)&&I.push(k.end.id),k.end.id===n&&-1===I.indexOf(k.start.id)&&I.push(k.start.id))}for(var T in this.drawOpsOfPage){var _=this.drawOpsOfPage[T].data;if(-1===M.exLinkTypes.indexOf(_.type)&&T!==n&&-1===I.indexOf(T)){var C=_.boundary,N=(0,p.getTransPoint)([C.sx+C.w/2,C.sy],_.mat),A=(0,p.getTransPoint)([C.sx+C.w,C.sy+C.h/2],_.mat),P=(0,p.getTransPoint)([C.sx+C.w/2,C.sy+C.h],_.mat),O=(0,p.getTransPoint)([C.sx,C.sy+C.h/2],_.mat),D=(0,c.distSqrt)(N,a),S=(0,c.distSqrt)(A,a),E=(0,c.distSqrt)(P,a),j=(0,c.distSqrt)(O,a),L=D,z=N;L>S&&(L=S,z=A),L>E&&(L=E,z=P),L>j&&(L=j,z=O);var R=(0,m.getDistDivideByDir)(z,a,u),B=R.v1,F=R.v2;B>0&&B<g&&B<h&&Math.abs(F)<w&&(h=B,f=T)}}if(f){var Y=this.drawOpsOfPage[f].data,U=(0,r.default)((0,r.default)({},(0,m.getEndPointInfo)(this.app,Y,s)),{dir:3-u}),W=(0,r.default)((0,r.default)({},(0,m.getEndPointInfo)(this.app,t,o)),{dir:u}),H=(0,y.graphInit)({linkType:v.default.linkDef.linkType,start:W,end:U,op:this}),Q={type:"link",start:{id:n,type:M.IEndPointType.FLEX,per:o,aType:v.default.linkDef.startArrow,dir:u},end:{id:f,type:M.IEndPointType.FLEX,per:s,aType:v.default.linkDef.endArrow,dir:3-u},connPs:H.connPs,linkType:v.default.linkDef.linkType,dash:l?v.default.linkDef.dash:M.IDashType.Dashed,stroke:l?v.default.linkDef.stroke:"rgba(132, 176, 245)",lineWidth:l?v.default.linkDef.lineWidth:1,inProgress:!1,text:{arr:[],stroke:v.default.linkDef.text.stroke,fontSize:v.default.linkDef.text.fontSize,fontFamily:v.default.linkDef.text.fontFamily}};return l?this.dispatch(Q):this.opsManager.currPage.setLocalOp("link",this.getLocalSnapshot(Q)),{id:f,data:Y}}}},{key:"connToEmptyArea",value:function(e){var t=e.data,n=e.id,a=e.sp,i=e.per,o=e.otherPer,s=e.dirAftRotate,u=e.send,l=d.SUGGEST_SHAPE_DIST,h=(0,c.getTransformedBoundary)(this.app.scale,{mat:t.mat,boundary:t.boundary}),f=l+(s===M.DIRECTION.LEFT||s===M.DIRECTION.RIGHT?h.w:h.h),g=s===M.DIRECTION.LEFT||s===M.DIRECTION.RIGHT?h.h:h.w,x=d.SUGGEST_SHAPE_GAP,w=[];for(var I in this.drawOpsOfPage){var b=this.drawOpsOfPage[I].data;if(I!==n&&"link"!==b.type){var k=b.boundary,T=(0,p.getTransPoint)([k.sx,k.sy],b.mat),_=(0,p.getTransPoint)([k.sx+k.w,k.sy],b.mat),C=(0,p.getTransPoint)([k.sx+k.w,k.sy+k.h],b.mat),N=(0,p.getTransPoint)([k.sx,k.sy+k.h],b.mat),A=(0,m.getDistDivideByDir)(T,a,s),P=(0,m.getDistDivideByDir)(_,a,s),O=(0,m.getDistDivideByDir)(C,a,s),D=(0,m.getDistDivideByDir)(N,a,s),S=A.v1<l&&P.v1<l&&O.v1<l&&D.v1<l,E=A.v1>f&&P.v1>f&&O.v1>f&&D.v1>f;S||E||w.push([Math.min(A.v2,P.v2,O.v2,D.v2)-x,Math.max(A.v2,P.v2,O.v2,D.v2)+x])}}for(var j=(w=(0,m.mergeIntervals)(w)).length>0?Math.abs(w[0][0]-g/2):0,L=w.length>0?Math.min(w[0][0]-g/2,0):0,z=0;z<w.length;z++){var R=w[z][1],B=z<w.length-1?w[z+1][0]:1/0;if(B-R>g){if(R<-g/2&&B>g/2){L=0;break}if(g/2>B){var F=Math.abs(B-g/2);F<j&&(j=F,L=B-g/2)}else if(-g/2<R){var Y=Math.abs(R+g/2);Y<j&&(j=Y,L=R+g/2)}}}var U=(0,c.getTransformedSize)(t),W=d.SUGGEST_SHAPE_DIST,H=t.shape?t.shape:"rect",Q=a.slice();switch(s){case M.DIRECTION.UP:Q[1]-=W+U.h/2,Q[0]+=L;break;case M.DIRECTION.DOWN:Q[1]+=W+U.h/2,Q[0]+=L;break;case M.DIRECTION.LEFT:Q[0]-=W+U.w/2,Q[1]+=L;break;case M.DIRECTION.RIGHT:Q[0]+=W+U.w/2,Q[1]+=L}var Z=(0,m.getShapeDataFromExist)({sx:Q[0]-U.w/2,sy:Q[1]-U.h/2,w:U.w,h:U.h,shapeType:H,another:t});u||(Z=(0,r.default)((0,r.default)({},Z),{stroke:"rgba(132, 176, 245)",lineWidth:1,fill:void 0,dash:M.IDashType.Dashed}));var G=void 0;if(u)G=this.dispatch(Z);else{var V=this.getLocalSnapshot(Z);this.opsManager.currPage.setLocalOp("shape",V),G=V.opId}var X=(0,r.default)((0,r.default)({},(0,m.getEndPointInfo)(this.app,Z,o)),{dir:3-s}),J=(0,r.default)((0,r.default)({},(0,m.getEndPointInfo)(this.app,t,i)),{dir:s}),K=(0,y.graphInit)({linkType:v.default.linkDef.linkType,start:J,end:X,op:this}),q={type:"link",start:{id:n,type:M.IEndPointType.FLEX,per:i,aType:v.default.linkDef.startArrow,dir:s},end:{id:G,type:M.IEndPointType.FLEX,per:o,aType:v.default.linkDef.endArrow,dir:3-s},connPs:K.connPs,linkType:v.default.linkDef.linkType,dash:u?v.default.linkDef.dash:M.IDashType.Dashed,stroke:u?v.default.linkDef.stroke:"rgba(132, 176, 245)",lineWidth:u?v.default.linkDef.lineWidth:1,inProgress:!1,text:{arr:[],stroke:v.default.linkDef.text.stroke,fontSize:v.default.linkDef.text.fontSize,fontFamily:v.default.linkDef.text.fontFamily}};return u?this.dispatch(q):this.opsManager.currPage.setLocalOp("link",this.getLocalSnapshot(q)),{id:G,data:Z}}},{key:"showHintShape",value:function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=1/8,o=5/8;switch(a){case M.DIRECTION.DOWN:i=5/8;break;case M.DIRECTION.LEFT:i=7/8;break;case M.DIRECTION.RIGHT:i=3/8}var s=(0,m.getDirAftRotate)(a,e.rAngle,e.xFactor,e.yFactor);switch(s){case M.DIRECTION.UP:break;case M.DIRECTION.DOWN:o=1/8;break;case M.DIRECTION.LEFT:o=3/8;break;case M.DIRECTION.RIGHT:o=7/8}var u=this.connToExistShape({id:t,per:i,otherPer:o,dirAftRotate:s,sp:n,data:e,send:r,dir:a});if(u||(u=this.connToEmptyArea({id:t,per:i,otherPer:o,dirAftRotate:s,sp:n,data:e,send:r,dir:a})),r){var l=u.id,c=u.data;this.dispatch(this.opsManager.selectOp.getSnapshot([l]));var d=(0,g.extendCameraToSnap)({app:this.app,boundary:c.boundary}),p=d.needAdjust,h=d.camera;p&&this.app.setCameraBound(h,!0)}}},{key:"hideHintShape",value:function(){this.opsManager.currPage.setLocalOp(["shape","link"],void 0)}},{key:"handleElePosChange",value:function(e,t,n,i){var o=[];for(var s in e)"link"===e[s].data.type&&o.push(e[s]);var u=t.dependOn||[],l=[],c=!0,d=!1,p=void 0;try{for(var h,f=(0,a.default)(o);!(c=(h=f.next()).done);c=!0){var g=h.value,v=g.data,x=void 0,w=void 0,I=void 0,b=void 0,k=v.start.id,T=v.end.id,_=e[k],C=e[T],N=this.opsManager.opMap[t.type],A=_?N.transformOp(_,t).data:void 0,P=C?N.transformOp(C,t).data:void 0;if(x=v.start.type===M.IEndPointType.COORD?v.start:(0,r.default)((0,r.default)({},(0,m.getEndPointInfo)(this.app,_.data,v.start.per)),{dir:v.start.dir}),w=v.end.type===M.IEndPointType.COORD?v.end:(0,r.default)((0,r.default)({},(0,m.getEndPointInfo)(this.app,C.data,v.end.per)),{dir:v.end.dir}),-1!==u.indexOf(k)||-1!==u.indexOf(g.opId)&&!k){var O=void 0,D=x.dir;if(k&&A){var S=(0,m.getEndPointInfo)(this.app,A,v.start.per);O=[S.x,S.y]}else O=(0,m.getPosAftMove)([x.x,x.y],t);I={dir:D,x:O[0],y:O[1]}}else I=(0,r.default)({},x);if(-1!==u.indexOf(T)||-1!==u.indexOf(g.opId)&&!T){var E=void 0,j=w.dir;if(T&&P){var L=(0,m.getEndPointInfo)(this.app,P,v.end.per);E=[L.x,L.y]}else E=(0,m.getPosAftMove)([w.x,w.y],t);b={dir:j,x:E[0],y:E[1]}}else b=(0,r.default)({},w);var z=[],R=void 0;if(-1!==u.indexOf(k)&&-1!==u.indexOf(T)){var B=v.connPs.map((function(e){var n=(0,m.getPosAftMove)([e.x,e.y],t);return(0,r.default)((0,r.default)({},e),{x:n[0],y:n[1]})}));R=(0,y.tidyGraph)({linkType:g.data.linkType,start:I,end:b,connPs:B,op:this,data:v})}else if(-1!==u.indexOf(g.opId)){var F=v.connPs.filter((function(e){return e.type===M.IConnPointType.Anchor})).map((function(e){var n=(0,m.getPosAftMove)([e.x,e.y],t);return(0,r.default)((0,r.default)({},e),{x:n[0],y:n[1]})}));R=(0,y.graphFromAnchors)({anchors:F,start:I,end:b,linkType:v.linkType,op:this})}else-1===u.indexOf(k)&&-1===u.indexOf(T)||(R=(0,y.graphAftEndM)({linkType:v.linkType,sFrom:x,eFrom:w,sTo:I,eTo:b,connPs:v.connPs,op:this,data:v}));R&&z.push({k:"connPs",v:R.connPs},{k:"start",v:{dir:R.start.dir}},{k:"end",v:{dir:R.end.dir}}),k||z.push({k:"start",v:(0,r.default)((0,r.default)({},v.start),{x:I.x,y:I.y})}),T||z.push({k:"end",v:(0,r.default)((0,r.default)({},v.end),{x:b.x,y:b.y})}),z.length>0&&l.push({changes:z,linkId:g.opId})}}catch(e){d=!0,p=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw p}}var Y=[],U={common:[],sub:[]},W=!0,H=!1,Q=void 0;try{for(var Z,G=(0,a.default)(l);!(W=(Z=G.next()).done);W=!0){var V=Z.value;Y.push(V.linkId),U.sub.push({ids:[V.linkId],attrs:V.changes})}}catch(e){H=!0,Q=e}finally{try{!W&&G.return&&G.return()}finally{if(H)throw Q}}this.dispatch(t,!1,n),Y.length>0&&this.dispatch({type:"modify",dependOn:Y,attrs:U,inProgress:t.inProgress},!1,i)}}]),t}(h.default);t.default=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(5)),r=c(n(18)),i=c(n(2)),o=c(n(0)),s=c(n(1)),u=c(n(3)),l=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="visible",e.description="",e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{"visible:eles":{value:this.setOpsVisibility.bind(this),information:{args:"opIds: string[] | undefined, visible: boolean",message:"锁定元素"}}}}},{key:"setOpsVisibility",value:function(e,t){var n=this,a=[];if(e){if(0===(a=e.filter((function(e){return t?n.opsManager.hiddenOpsOfPage[e]:n.opsManager.drawOpsOfPage[e]}))).length)return this.logger.error("[白板] setOpsVisibility, 设置visible："+t+", 但是传入的ids均为visible: "+t+"，或者当前页面不存在的元素")}else if(t?a=(0,r.default)(this.opsManager.hiddenOpsOfPage):t||(a=(0,r.default)(this.opsManager.drawOpsOfPage)),0===a.length)return this.logger.error("[白板] setOpsVisibility 设置画布所有元素visible: "+t+", 但是当前页面元素均为visible: "+t+"，或者当前页面不存在元素");this.dispatch(this.getSnapshot(a,t))}},{key:"getSnapshot",value:function(e,t){return{type:this.type,visible:t,dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,a.default)({},e.data,{hidden:!t.visible});return(0,a.default)({},e,{data:n})}}]),t}(c(n(9)).default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(5)),r=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4)),l=p(n(9)),c=n(13),d=n(30);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="crop",e.description="",e.inCropMode=!1,e.isCropping=!1,e.cropHotRegion={sp:[0,0],ep:[0,0],r:12},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("MousedownPlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseup.tap("MouseupPlugin",this.handleMouseUp.bind(this)),this.opsManager.hooks.click.tap("ClickPlugin",this.handleClick.bind(this))}},{key:"eventsToListen",value:function(){return{"crop:image":{value:this.startCrop.bind(this),information:{args:"id: string",message:""}}}}},{key:"startCrop",value:function(e){var t=this.drawOpsOfPage[e];if(!t||"image"!==t.data.type)return this.logger.error("CropOp.startCrop: 图片不存在");var n=t.data;this.inCropMode=!0,this.isCropping=!1,this.cropId=e;var a=n.crop?n.crop.sp:[0,0],r=n.crop?n.crop.ep:[1,1];this.opsManager.currPage.setLocalOp("crop",this.getLocalSnapshot({inProgress:!0,dependOn:[e],sp:a,ep:r,type:"crop"}),!0)}},{key:"handleMouseDown",value:function(e,t,n){if(this.inCropMode){var a=this.mousePosTest(t,n);return"default"!==a.cursorSuggestion&&(this.isCropping=!0,this.cropAnchor=a.cropAnchor,this.moveAnchor=a.moveAnchor),!0}}},{key:"handleMouseMove",value:function(e,t,n){if(this.inCropMode){var a=this.drawOpsOfPage[this.cropId||""];if(this.isCropping&&a&&(this.moveAnchor||this.cropAnchor)){var r=this.getCropBoundary(t,n,a.data),i=r.sp,o=r.ep;this.opsManager.currPage.setLocalOp("crop",this.getLocalSnapshot({inProgress:!0,dependOn:[this.cropId],sp:i,ep:o,type:"crop"}),!0),this.lastSp=i,this.lastEp=o}else if(this.isMouseDown)document.body.style.cursor="default";else{var s=this.mousePosTest(t,n);document.body.style.cursor=s.cursorSuggestion}return!0}}},{key:"handleClick",value:function(e,t,n){this.handleMouseUp(e,t,n)}},{key:"handleMouseUp",value:function(e,t,n){if(this.inCropMode){if(this.isCropping)this.isCropping=!1;else{var a=this.drawOpsOfPage[this.cropId||""];if(a){var r=(0,c.getTransformedVertices)(a.data);(0,c.pointInVertices)(r,[t,n])||(this.isCropping=!1,this.inCropMode=!1,this.opsManager.currPage.setLocalOp("crop",void 0,!0),this.lastSp&&this.lastEp&&this.dispatch({inProgress:!1,dependOn:[this.cropId],sp:this.lastSp,ep:this.lastEp,type:"crop"}),this.lastSp=void 0,this.lastEp=void 0)}}return!0}}},{key:"drawCrop",value:function(e,t){if(t.crop){var n=t.crop,a=n.sp,r=n.ep,i=this.getCropPoint(a,t,!1),o=this.getCropPoint(r,t,!1);e.fillStyle="rgb(255, 255, 255)";var s=1/this.app.scale/Math.abs(t.xFactor||1),u=12*s;e.fillRect(i[0]-u/2,i[1]-u/2,u,u),e.fillRect(o[0]-u/2,i[1]-u/2,u,u),e.fillRect(o[0]-u/2,o[1]-u/2,u,u),e.fillRect(i[0]-u/2,o[1]-u/2,u,u),e.strokeStyle="rgb(150, 150, 150)",e.lineWidth=1*s,e.strokeRect(i[0]-u/2,i[1]-u/2,u,u),e.strokeRect(o[0]-u/2,i[1]-u/2,u,u),e.strokeRect(o[0]-u/2,o[1]-u/2,u,u),e.strokeRect(i[0]-u/2,o[1]-u/2,u,u),this.cropHotRegion={sp:a,ep:r,r:u}}}},{key:"getCropPoint",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.crop?t.crop.boundary:t.boundary,r=[a.sx+a.w*e[0],a.sy+a.h*e[1]];return n?(0,d.getTransPoint)(r,t.mat):r}},{key:"mousePosTest",value:function(e,t){var n=this.drawOpsOfPage[this.cropId||""];if(!this.cropHotRegion||!n)return{value:!1,cursorSuggestion:"default",cropAnchor:[0,0]};var a=n.data,r=this.cropHotRegion.sp,i=[this.cropHotRegion.ep[0],this.cropHotRegion.sp[1]],o=this.cropHotRegion.ep,s=[this.cropHotRegion.sp[0],this.cropHotRegion.ep[1]],u=this.cropHotRegion.r/this.app.scale,l=n.data.rAngle||0,d=0;n&&n.data.xFactor&&(d+=n.data.xFactor>0?0:Math.PI/2),n&&n.data.yFactor&&(d+=n.data.yFactor>0?0:-Math.PI/2);var p=this.getCropPoint(r,a),h=this.getCropPoint(i,a),f=this.getCropPoint(o,a),g=this.getCropPoint(s,a);return(0,c.pointCollideWithPoint)([e,t],f,u)?{value:!0,cursorSuggestion:(0,c.getScaleCursor)(Math.PI/4+l+d),cropAnchor:r}:(0,c.pointCollideWithPoint)([e,t],g,u)?{value:!0,cursorSuggestion:(0,c.getScaleCursor)(Math.PI/4*3+l+d),cropAnchor:i}:(0,c.pointCollideWithPoint)([e,t],p,u)?{value:!0,cursorSuggestion:(0,c.getScaleCursor)(Math.PI/4*5+l+d),cropAnchor:o}:(0,c.pointCollideWithPoint)([e,t],h,u)?{value:!0,cursorSuggestion:(0,c.getScaleCursor)(Math.PI/4*7+l+d),cropAnchor:s}:(0,c.pointInVertices)([p,h,f,g],[e,t])?{value:!0,cursorSuggestion:"move",moveAnchor:{sp:r,ep:o,anchor:[e,t]}}:{value:!1,cursorSuggestion:"default",cropAnchor:[0,0]}}},{key:"getCropBoundary",value:function(e,t,n){var a=n.crop?n.crop.boundary:n.boundary,r=(0,d.getTransPoint)([a.sx,a.sy],n.mat),i=(0,d.getTransPoint)([a.sx+a.w,a.sy],n.mat),o=(0,d.getTransPoint)([a.sx,a.sy+a.h],n.mat),s=(0,c.dist)(r,i),u=(0,c.dist)(r,o),l=[i[0]-r[0],i[1]-r[1]],p=[o[0]-r[0],o[1]-r[1]],h=[e-r[0],t-r[1]],f=(h[0]*l[0]+h[1]*l[1])/(l[0]*l[0]+l[1]*l[1]),g=(h[0]*p[0]+h[1]*p[1])/(p[0]*p[0]+p[1]*p[1]),v=(this.cropAnchor,void 0),y=void 0;if(this.cropAnchor)v=[Math.max(0,Math.min(this.cropAnchor[0],f,1)),Math.max(Math.min(this.cropAnchor[1],g,1),0)],y=[Math.min(1,Math.max(this.cropAnchor[0],f,0)),Math.min(Math.max(this.cropAnchor[1],g,0),1)];else{var m=this.moveAnchor,M=(e-m.anchor[0])/Math.max(s,1),x=(t-m.anchor[1])/Math.max(u,1);M+m.sp[0]<0?M=-m.sp[0]:M+m.ep[0]>1&&(M=1-m.ep[0]),x+m.sp[1]<0?x=-m.sp[1]:x+m.ep[1]>1&&(x=1-m.ep[1]),v=[m.sp[0]+M,m.sp[1]+x],y=[m.ep[0]+M,m.ep[1]+x]}return{sp:v,ep:y}}},{key:"transformOp",value:function(e,t){var n=e.data.crop?e.data.crop.boundary:e.data.boundary,r={sx:n.sx+t.sp[0]*n.w,sy:n.sy+t.sp[1]*n.h,w:(t.ep[0]-t.sp[0])*n.w,h:(t.ep[1]-t.sp[1])*n.h};return(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)({},e.data),{boundary:r,crop:{sp:t.sp,ep:t.ep,inProgress:t.inProgress,boundary:n}})})}}]),t}(l.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(7)),r=p(n(19)),i=p(n(2)),o=p(n(0)),s=p(n(1)),u=p(n(3)),l=p(n(4)),c=p(n(9)),d=n(13);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="auxiliary",e.description="",e.calcAuxiliaryLine=function(t){var n=void 0,a=[],i=t.action;if("snap"in t){if(0===t.ids.length)return{lockX:0,lockY:0};n=e.getCombinedBound(t.ids,t.opsBeforeChange,t.snap)}else n=t.bound;var o=t.ids,s=e.app.getCameraBound(),u=[];for(var l in e.drawOpsOfPage){var c=e.drawOpsOfPage[l].data;if(-1===o.indexOf(l)&&"link"!==c.type&&"pen"!==c.type&&"line"!==c.type){var p=c.rAngle||0;if(Math.abs(p%(Math.PI/2))<.02||Math.abs(Math.PI/2-p%(Math.PI/2))<.02){var h=(0,d.getTransformedBoundary)(e.app.scale,{mat:c.mat,boundary:c.boundary});if(h.sx>s.centerX+s.width/2||h.sx+h.w<s.centerX-s.width/2||h.sy>s.centerY+s.height/2||h.sy+h.h<s.centerY-s.height/2)continue;u.push(h)}}}return a=a.concat(e.calcAlignLines(n,u,t.exclude||[])),"scale"===i?a=a.concat(e.calcSizeLines(n,u)):"move"===i&&(a=a.concat(e.calcPadLines(n,u))),e.opsManager.currPage.setLocalOp("auxiliary",e.getLocalSnapshot({type:e.type,lines:a})),{lockX:Math.max.apply(Math,(0,r.default)(a.map((function(e){return e.lockX}))).concat([0])),lockY:Math.max.apply(Math,(0,r.default)(a.map((function(e){return e.lockY}))).concat([0]))}},e.setRotateLine=function(t){var n=t.id,a=t.snap,r=t.opsBeforeChange,i=e.opsManager.opMap[a.type],o=r[n],s=i.transformOp(o,a).data,u=(0,d.getTransformedBoundary)(e.app.scale,{mat:s.mat,boundary:s.boundary}),l=16/e.app.scale;e.opsManager.currPage.setLocalOp("auxiliary",e.getLocalSnapshot({type:e.type,lines:[{pos:[[u.sx-l,u.sy-l],[u.sx,u.sy-l]]},{pos:[[u.sx-l,u.sy-l],[u.sx-l,u.sy]]},{pos:[[u.sx+u.w+l,u.sy-l],[u.sx+u.w,u.sy-l]]},{pos:[[u.sx+u.w+l,u.sy-l],[u.sx+u.w+l,u.sy]]},{pos:[[u.sx+u.w+l,u.sy+u.h+l],[u.sx+u.w+l,u.sy+u.h]]},{pos:[[u.sx+u.w+l,u.sy+u.h+l],[u.sx+u.w,u.sy+u.h+l]]},{pos:[[u.sx-l,u.sy+u.h+l],[u.sx-l,u.sy+u.h]]},{pos:[[u.sx-l,u.sy+u.h+l],[u.sx,u.sy+u.h+l]]}]}))},e.calcAlignLines=function(t,n,r){var i=[],o=1/e.app.scale,s=3/e.app.scale,u={},l=!1,c=!1,d=!0,p=!1,h=void 0;try{for(var f,g=(0,a.default)(n);!(d=(f=g.next()).done);d=!0){var v=f.value;if(l&&c)break;var y=Math.min(v.sy,t.sy),m=Math.max(v.sy+v.h,t.sy+t.h),M=Math.min(v.sx,t.sx),x=Math.max(v.sx+v.w,t.sx+t.w),w=[[v.sx+v.w/2,t.sx+t.w/2,0,1,"middle"],[v.sy+v.h/2,t.sy+t.h/2,0,2,"center"],[v.sx,t.sx,-s,1,"left"],[v.sx,t.sx+t.w,0,1,"left"],[v.sx+v.w,t.sx,0,1,"right"],[v.sx+v.w,t.sx+t.w,s,1,"right"],[v.sy,t.sy,-s,2,"top"],[v.sy,t.sy+t.h,0,2,"top"],[v.sy+v.h,t.sy,0,2,"bottom"],[v.sy+v.h,t.sy+t.h,s,2,"bottom"]],I=c,b=l,k=!0,T=!1,_=void 0;try{for(var C,N=(0,a.default)(w);!(k=(C=N.next()).done);k=!0){var A=C.value;if(1!==A[3]||I){if(2===A[3]&&!b){if(("top"===A[4]||"bottom"===A[4])&&u.center)continue;if(Math.abs(A[0]-A[1])<o){var P=!1,O=!0,D=!1,S=void 0;try{for(var E,j=(0,a.default)(r);!(O=(E=j.next()).done);O=!0){var L=E.value;"h"===L.dir&&Math.abs(A[1]-L.val)<o&&(P=!0)}}catch(e){D=!0,S=e}finally{try{!O&&j.return&&j.return()}finally{if(D)throw S}}if(P)continue;var z=Math.abs(t.sx+t.w/2-v.sx-v.w/2);u[A[4]]||(u[A[4]]={pos:[[M,A[0]+A[2]],[x,A[0]+A[2]]],dist:z,lockX:0,lockY:20},l=!0)}}}else{if(("left"===A[4]||"right"===A[4])&&u.middle)continue;if(Math.abs(A[0]-A[1])<o){var R=!1,B=!0,F=!1,Y=void 0;try{for(var U,W=(0,a.default)(r);!(B=(U=W.next()).done);B=!0){var H=U.value;"v"===H.dir&&Math.abs(A[1]-H.val)<o&&(R=!0)}}catch(e){F=!0,Y=e}finally{try{!B&&W.return&&W.return()}finally{if(F)throw Y}}if(R)continue;var Q=Math.abs(t.sy+t.h/2-v.sy-v.h/2);u[A[4]]||(u[A[4]]={pos:[[A[0]+A[2],y],[A[0]+A[2],m]],dist:Q,lockX:20,lockY:0},c=!0)}}}}catch(e){T=!0,_=e}finally{try{!k&&N.return&&N.return()}finally{if(T)throw _}}}}catch(e){p=!0,h=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw h}}for(var Z in u)i.push(u[Z]);return i},e.calcSizeLines=function(t,n){var r=[],i=2/e.app.scale,o=16/e.app.scale,s=!1,u=!1,l=!0,c=!1,d=void 0;try{for(var p,h=(0,a.default)(n);!(l=(p=h.next()).done);l=!0){var f=p.value;Math.abs(f.w-t.w)<i&&(s=!0,r.push({pos:[[f.sx,f.sy+f.h+o],[f.sx+f.w,f.sy+f.h+o]],h:!0,lockX:8,lockY:0})),Math.abs(f.h-t.h)<i&&(u=!0,r.push({pos:[[f.sx+f.w+o,f.sy],[f.sx+f.w+o,f.sy+f.h]],h:!1,lockX:0,lockY:8}))}}catch(e){c=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw d}}return s&&r.push({pos:[[t.sx,t.sy+t.h+o],[t.sx+t.w,t.sy+t.h+o]],h:!0,lockX:8,lockY:0}),u&&r.push({pos:[[t.sx+t.w+o,t.sy],[t.sx+t.w+o,t.sy+t.h]],h:!1,lockX:0,lockY:8}),r},e.calcPadLines=function(t,n){var a=[];return a=(a=a.concat(e._calcPadLines(t,n,"h"))).concat(e._calcPadLines(t,n,"v"))},e._calcPadLines=function(t,n,a){for(var r=3/e.app.scale,i=n.map((function(n){return e.getPadAndIntersect(t,n,a,!0)})).filter((function(t){return null!=t&&t.pad>25/e.app.scale})),o=(i=(i=i.sort((function(e,t){return e.pad-t.pad}))).slice(0,10)).slice(),s=0;s<i.length;s++)for(var u=s+1;u<i.length;u++){var l=e.getPadAndIntersect(i[s].b2,i[u].b2,a,!1);l&&o.push(l)}o=o.sort((function(e,t){return e.pad-t.pad}));for(var c=0;c<o.length;c++){var d=o[c].inter.slice(),p=[c];if(o[c].hasBase){for(var h=c+1;h<o.length;h++)if(o[h].pad-o[c].pad<=r){var f=[Math.max(d[0],o[h].inter[0]),Math.min(d[1],o[h].inter[1])];if(f[0]<f[1])p.push(h),d=f;else if(p.length>1)return e.getPadRes(o,p,a,d[0]/2+d[1]/2)}else if(p.length>1)return e.getPadRes(o,p,a,d[0]/2+d[1]/2);if(p.length>1)return e.getPadRes(o,p,a,d[0]/2+d[1]/2)}}return[]},e.getPadRes=function(t,n,r,i){var o=[],s=4/e.app.scale,u=!0,l=!1,c=void 0;try{for(var d,p=(0,a.default)(n);!(u=(d=p.next()).done);u=!0){var h=d.value;"h"===r?o.push({pos:[[t[h].s+s,i],[t[h].e-s,i]],h:!0,lockX:20,lockY:0}):o.push({pos:[[i,t[h].s+s],[i,t[h].e-s]],h:!1,lockX:0,lockY:20})}}catch(e){l=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(l)throw c}}return o},e.getPadAndIntersect=function(e,t,n,a){if("h"===n){if(e.sy+e.h>t.sy&&e.sy<t.sy+t.h)return e.sx+e.w<t.sx?{b1:e,b2:t,pad:Math.abs(t.sx-(e.sx+e.w)),inter:[Math.max(e.sy,t.sy),Math.min(e.sy+e.h,t.sy+t.h)],hasBase:a,s:e.sx+e.w,e:t.sx}:e.sx>t.sx+t.w?{b1:e,b2:t,pad:Math.abs(e.sx-(t.sx+t.w)),inter:[Math.max(e.sy,t.sy),Math.min(e.sy+e.h,t.sy+t.h)],hasBase:a,s:t.sx+t.w,e:e.sx}:void 0}else if("v"===n&&e.sx+e.w>t.sx&&e.sx<t.sx+t.w)return e.sy+e.h<t.sy?{b1:e,b2:t,pad:Math.abs(t.sy-(e.sy+e.h)),inter:[Math.max(e.sx,t.sx),Math.min(e.sx+e.w,t.sx+t.w)],hasBase:a,s:e.sy+e.h,e:t.sy}:e.sy>t.sy+t.h?{b1:e,b2:t,pad:Math.abs(e.sy-(t.sy+t.h)),inter:[Math.max(e.sx,t.sx),Math.min(e.sx+e.w,t.sx+t.w)],hasBase:a,s:t.sy+t.h,e:e.sy}:void 0},e.clean=function(){e.opsManager.currPage.setLocalOp(["auxiliary"],void 0)},e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"getCombinedBound",value:function(e,t,n){var a=this;e=e.filter((function(e){return t.hasOwnProperty(e)}));var r=this.opsManager.opMap[n.type];return e.map((function(e){var i=t[e],o=r.transformOp(i,n).data;return(0,d.getTransformedBoundary)(a.app.scale,o)})).reduce((function(e,t){return(0,d.combineBoundary)(e,t)}))}},{key:"draw",value:function(e,t){var n=e.data;t.strokeStyle="rgba(25, 64, 250, 0.5)",t.lineWidth=1.2/this.app.scale;var r=6/this.app.scale,i=!0,o=!1,s=void 0;try{for(var u,l=(0,a.default)(n.lines);!(i=(u=l.next()).done);i=!0){var c=u.value,d=c.pos;t.beginPath(),t.moveTo(d[0][0],d[0][1]),t.lineTo(d[1][0],d[1][1]),!0===c.h?(t.moveTo(d[0][0],d[0][1]-r),t.lineTo(d[0][0],d[0][1]),t.moveTo(d[1][0],d[1][1]-r),t.lineTo(d[1][0],d[1][1])):!1===c.h&&(t.moveTo(d[0][0]-r,d[0][1]),t.lineTo(d[0][0],d[0][1]),t.moveTo(d[1][0]-r,d[1][1]),t.lineTo(d[1][0],d[1][1])),t.stroke()}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}}}]),t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(5)),r=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="layer",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"删除当前选中的元素"}},"layer:update":{value:this.updateLayers.bind(this),information:{args:"opIds: Array<string>, dir: 'top' | 'bottom'",message:"删除ops"}}}}},{key:"updateLayers",value:function(e,t){if(console.log("updateLayers",e,t),0!==e.length){var n=Date.now()+this.app.ntpTimeDiff;this.dispatch({type:"layer",inProgress:!1,dependOn:e,layer:"top"===t?n:-n})}}},{key:"transformOp",value:function(e,t){var n=(0,a.default)({},e.data,{layer:t.layer});return(0,a.default)({},e,{data:n})}}]),t}(l(n(9)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(7)),r=d(n(72)),i=d(n(37)),o=d(n(2)),s=d(n(0)),u=d(n(1)),l=d(n(3)),c=d(n(4));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,s.default)(this,t);var e=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="group",e}return(0,c.default)(t,e),(0,u.default)(t,[{key:"eventsToListen",value:function(){return{group:{value:this.group.bind(this),information:{args:"group: boolean, opIds: Array<string>",message:"删除ops"}}}}},{key:"group",value:function(e,t){0!==t.length&&this.dispatch({type:"group",group:e,dependOn:t.slice()})}},{key:"getOpIdsInGroups",value:function(e){var t=new i.default,n=this.opsManager.currPage,o=!0,s=!1,u=void 0;try{for(var l,c=(0,a.default)(e);!(o=(l=c.next()).done);o=!0){var d=l.value;t.add(d);var p=n.idToGroup.get(d);if(p){var h=n.groups.get(p);if(h){var f=!0,g=!1,v=void 0;try{for(var y,m=(0,a.default)(h);!(f=(y=m.next()).done);f=!0){var M=y.value;t.add(M)}}catch(e){g=!0,v=e}finally{try{!f&&m.return&&m.return()}finally{if(g)throw v}}}}}}catch(e){s=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}return(0,r.default)(t)}},{key:"reset",value:function(e){e.idToGroup.clear(),e.groups.clear()}},{key:"process",value:function(e,t){var n=t.data,r=!0,o=!1,s=void 0;try{for(var u,l=(0,a.default)(n.dependOn);!(r=(u=l.next()).done);r=!0){var c=u.value,d=e.idToGroup.get(c);d&&(e.idToGroup.delete(c),m(d,c))}}catch(e){o=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw s}}if(n.group){e.groups.set(t.opId,new i.default(n.dependOn));var p=!0,h=!1,f=void 0;try{for(var g,v=(0,a.default)(n.dependOn);!(p=(g=v.next()).done);p=!0){var y=g.value;e.idToGroup.set(y,t.opId)}}catch(e){h=!0,f=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw f}}}function m(t,n){var a=e.groups.get(t);a&&(a.delete(n),a.size<=1&&e.groups.delete(t))}}}]),t}(d(n(9)).default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=w(n(5)),r=w(n(7)),i=w(n(22)),o=w(n(18)),s=w(n(37)),u=w(n(0)),l=w(n(1)),c=w(n(241)),d=n(45),p=n(147),h=n(356),f=n(245),g=n(357),v=n(97),y=n(103),m=n(76),M=n(31),x=w(n(33));function w(e){return e&&e.__esModule?e:{default:e}}var I=0,b=function(){function e(t,n){var a=this;(0,u.default)(this,e),this.executedClientIdSet=new s.default,this.currIndex="whiteboard",this.isReceivingBatchSnapshots=!1,this.boards={},this.pkgIdOpIdMap={},this.pageToRefresh=void 0,this.pageToIncRefresh=void 0,this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={},this.delayedSnaps=[],this.mergeFailCache={},this._startRefreshLoop2=function(){cancelAnimationFrame(a.refreshAnimationTimer);try{a.refreshAnimationTimer=requestAnimationFrame((function(){return a._startRefreshLoop2()}))}catch(e){I<10&&(I+=1,a.logger.error("[白板] requestAnimationFrame error")),(0,g.polyfillRaf)(),a._startRefreshLoop()}a.pageToRefresh&&a.pageToRefresh===a.currBoard.currPage&&(a.pageToRefresh=void 0,a.currBoard.currPage.refresh()),a.pageToIncRefresh&&a.pageToIncRefresh===a.currBoard.currPage&&(a.pageToIncRefresh=void 0,a.currBoard.currPage.incRefresh()),a.currBoard.currPage.refreshOnStreamCanvas()},this.app=t,this.dataHub=n,this._init()}return(0,l.default)(e,[{key:"getBoardSnapshots",value:function(){var e=this;return this.boardsSnapshotIds.map((function(t){return e.opIdSnapshotMap[t]})).filter((function(e){return"goto"!==e.snapshot.data.action}))}},{key:"getBoardDisplayNames",value:function(){var e=this;return(0,o.default)(this.boards).map((function(t){return e.boards[t].displayName}))}},{key:"getPageWithFallback",value:function(e,t){e=void 0===e?this.currBoard.boardName:e;var n=this.boards[e],a=void 0;if(n){if(a=void 0===t?n.pages[n.currIndex]:n.pages[t])return a;this.logger.warn("[白板] getPageWithFallback 找不到boardName为"+e+"，pageName为"+t+"的白板页")}else this.logger.warn("[白板] getPageWithFallback 找不到boardName为"+e+"的文档")}},{key:"getPage",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.boards[e];if(!a)return n&&this.app.dataReportUtil("v3_run_error",{error:{code:m.DataReportRunError.Board_Lost,message:(0,i.default)({snaps:this.getBoardSnapshots(),board:e,page:t})}}),void this.logger.warn("[白板] getPage: 找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,o.default)(this.app.room.boards).join(","));var r=a.pages[t];return r||(n&&this.app.dataReportUtil("v3_run_error",{error:{code:m.DataReportRunError.Page_Lost,message:(0,i.default)({snaps:a.getPageSnapshots(),board:e,page:t})}}),void this.logger.warn("[白板] getPage: 找不到boardName: "+e+", pageName: "+t+"的白板页，当前房间白板页码为: "+a.pageNames.join(",")))}},{key:"getPageByBoardNameAndIndex",value:function(e,t){var n=this.boards[e];if(n){var a=n.pageNames[t];if(a){if(n.pages[a])return n.pages[a];this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到找不到boardName: "+e+", pageName: "+a+"的的白板页，当前房间白板页码为: "+n.pageNames.join(","))}else this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到找不到boardName: "+e+", pageIndex: "+t+"的的白板页，当前房间白板页码为: "+n.pageNames.join(","))}else this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,o.default)(this.app.room.boards).join(","))}},{key:"getPageNameFromIndex",value:function(e,t){if(void 0!==t){e=e||this.currBoard.boardName;var n=this.getPageByBoardNameAndIndex(e,t);return null==n?void 0:n.pageIndex}}},{key:"recoverFullSnapshot",value:function(e){var t=this.opIdSnapshotMap[e.opId]&&this.opIdSnapshotMap[e.opId].snapshot.data.type,n=e.data.type;if(t&&n)return this.app.opsManager.mergePartial(this.opIdSnapshotMap[e.opId].snapshot,e);if(n){var a=this.mergeFailCache[e.opId],i=e;if(a){var o=!0,s=!1,u=void 0;try{for(var l,c=(0,r.default)(a);!(o=(l=c.next()).done);o=!0){var d=l.value;i=this.app.opsManager.mergePartial(i,d)}}catch(e){s=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}delete this.mergeFailCache[e.opId]}return i}return t?(delete this.mergeFailCache[e.opId],this.app.opsManager.mergePartial(this.opIdSnapshotMap[e.opId].snapshot,e)):(this.mergeFailCache[e.opId]=this.mergeFailCache[e.opId]||[],this.mergeFailCache[e.opId].push(e),e)}},{key:"reset",value:function(){var e,t,n;y.LOG&&this.logger.log("[白板]","room.reset"),this._init(),null===(t=null===(e=this.currBoard)||void 0===e?void 0:e.currPage)||void 0===t||t.cleanNonCanvasElements(),this.pageToRefresh=null===(n=this.currBoard)||void 0===n?void 0:n.currPage}},{key:"beginReceiveBatchSnapshots",value:function(e){this.batchSource=e,this.isReceivingBatchSnapshots=!0}},{key:"endReceiveBatchSnapshots",value:function(e){var t,n,a,r=this,i=e.boundaries,o=e.hasBoardAction,s=e.cb,u=e.batchSource;if(this.batchSource=void 0,this.isReceivingBatchSnapshots=!1,this.currBoard.currPage.calcDrawOpQueue(),i.length>0){var l=i[i.length-1];l.boundary.width>0&&l.boundary.height>0?!l.animate||"sync"===u&&"function"==typeof s?((0,p.stopTransitionToCameraBound)(),this.app.camera.setCameraBound(l.boundary),null===(t=this.app.previewFactory)||void 0===t||t.refreshPreviewsOfCurrBoard(),"function"==typeof s&&s(!0)):(0,p.transitionToCameraBound)(this.app.camera,l.boundary,(function(){var e;null===(e=r.app.previewFactory)||void 0===e||e.refreshPreviewsOfCurrBoard(),"function"==typeof s&&s(!0)})):"function"==typeof s&&s(!1)}else this.pageToRefresh=this.currBoard.currPage,o?null===(n=this.app.previewFactory)||void 0===n||n.refreshPreviewsOfCurrBoard():null===(a=this.app.previewFactory)||void 0===a||a.refreshPreviewsOfCurrPage(),"function"==typeof s&&s(!1)}},{key:"dispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=-1!==d.cameraSnapshotTypes.indexOf(e.data.type);if("camera-bound"!==e.data.type||e.data.boundary.width&&e.data.boundary.height){if(!this.app.editable&&!n){if(this.app.isRecordPlayer)return;if(!this.app.editEnabled)return this.logger.error("[白板] 请设置enableDraw(true)后，再修改白板");var a=(0,f.shouldCacheSnapshot)(e);if(a){this.logger.log("[白板] 白板恢复后会上传数据: "+e.data.type);var r=e.data.type,o="文档";return"video"===r?o="视频":"audio"===r?o="音频":"image"===r&&(o="图片"),(0,M.showToast)({time:30,type:"warn",msg:"目前网络不稳定，若30s内恢复网络，将自动添加"+o,msgType:x.default.SYNCHRONIZING,args:{name:o}}),void this.delayedSnaps.push({snap:e,time:Date.now()})}if(!this.app.isConnected)return this.logger.error("[白板] 请在joinRoom时监听onconnected, 等待网络恢复后再修改白板");if(this.dataHub.isSynchronizing)return this.logger.error("[白板] 请在joinRoom时监听onSyncFinish，等待同步结束后再修改白板")}if(this.dataHub.isSynchronizing)"camera-bound"!==e.data.type&&this.logger.error("请等待同步结束后再修改白板");else if(n&&"broadcaster"!==this.app.vision.mode)(0,h.addGlobalOp)(this,e);else{var s=this.dataHub.sendSnapshot(e,t);this.execSnapshot({snapshot:e,pkgId:s})}}else this.logger.warn("[白板] error, dispatch camera-bound的宽高无效",(0,i.default)(e.data))}},{key:"execCachedSnapshots",value:function(e){var t=(0,o.default)(e.pkgIdOpIdMap).map((function(e){return Number(e)})).sort((function(e,t){return e-t})),n=[],a=!0,i=!1,s=void 0;try{for(var u,l=(0,r.default)(t);!(a=(u=l.next()).done);a=!0){var c=u.value;if(Number(c)<=e.lastConfirmId){var d=e.pkgIdOpIdMap[c],p=!0,h=!1,f=void 0;try{for(var g,v=(0,r.default)(d);!(p=(g=v.next()).done);p=!0){var y=g.value;n.push(e.opIdSnapshotMap[y])}}catch(e){h=!0,f=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw f}}}}}catch(e){i=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw s}}this.execBatchSnapshots(n,"sync")}},{key:"getCachedTil",value:function(e){for(var t=(0,o.default)(this.pkgIdOpIdMap).map((function(e){return Number(e)})).sort((function(e,t){return e-t})),n=t.length-1;n>=0;n--)if(t[n]<=e)return t[n];return-1}},{key:"executeDelayedSnaps",value:function(){if(this.app.editEnabled)for(;this.delayedSnaps.length>0;){var e=this.delayedSnaps.shift(),t=Date.now();if(t-e.time<3e4){if(("video"===e.snap.data.type||"audio"===e.snap.data.type)&&this.app.hasMediaOnPage(!1))continue;e.snap.time=t,this.dispatch(e.snap)}}else this.delayedSnaps=[]}},{key:"execSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromBatch:!1,batchSource:"data"},n=(0,a.default)((0,a.default)({},e),{snapshot:this.recoverFullSnapshot(e.snapshot)});t.fromBatch||(this.cacheSnapshot(n,!0),this.pushSnapshotToQueue(n));var r=n.snapshot;if("inPageOp"===r.category){var i=this.getPage(r.board,r.page.toString(),!(-1!==v.overwritableTypes.indexOf(r.data.type)));i&&i.addOpInPage(r)}else if("pageOp"===r.category){var o=this.boards[r.board];o&&o.addOpInBoard(r)}else"globalOp"===r.category?(0,h.addGlobalOp)(this,r):(0,h.addOpInRoom)(this,r,{fromBatch:t.fromBatch&&"data"!==t.batchSource})}},{key:"execBatchSnapshots",value:function(e,t,n){var i=this,o=e.map((function(e){var t=(0,a.default)((0,a.default)({},e),{snapshot:i.recoverFullSnapshot(e.snapshot)});return i.cacheSnapshot(t,!0),i.pushSnapshotToQueue(t),t})),s=0===o.filter((function(e){return"inPageOp"!==e.snapshot.category})).length,u=o.filter((function(e){return"boardOp"===e.snapshot.category})).length>0,l=o.filter((function(e){return"globalOp"===e.snapshot.category&&"camera-bound"===e.snapshot.data.type})).map((function(e){return{animate:e.snapshot.data.animate,boundary:(0,f.getCameraBoundFromGlobalOp)(i,e.snapshot)}})).filter((function(e){return e.boundary})),c=o.filter((function(e){return"globalOp"!==e.snapshot.category||"camera-bound"!==e.snapshot.data.type}));if(s){var d=!1;c.forEach((function(e){var t=e.snapshot,n=i.getPage(t.board,t.page.toString());n&&(d=n.addOpInPage(t,!1)||d)})),d?this.endReceiveBatchSnapshots({boundaries:[],hasBoardAction:!1,batchSource:t,cb:n}):"function"==typeof n&&n(!1)}else{this.beginReceiveBatchSnapshots(t);try{var p={},h=!0,g=!1,y=void 0;try{for(var m,M=(0,r.default)(c);!(h=(m=M.next()).done);h=!0){var x=m.value,w=x.snapshot.data.type;-1===v.overwritableTypes.indexOf(w)?this.execSnapshot(x,{fromBatch:!0,batchSource:t}):p[x.snapshot.opId]=x}}catch(e){g=!0,y=e}finally{try{!h&&M.return&&M.return()}finally{if(g)throw y}}for(var I in p)this.execSnapshot(p[I],{fromBatch:!0,batchSource:t});this.endReceiveBatchSnapshots({boundaries:l,hasBoardAction:u,batchSource:t,cb:n})}catch(e){this.logger.error("[白板] error",e),this.endReceiveBatchSnapshots({boundaries:l,hasBoardAction:u,batchSource:t,cb:n})}}}},{key:"cacheOrExecAckPkg",value:function(e,t){var n=this.pkgIdOpIdMap[e.pkgId],a=this.pkgIdOpIdMap[t];n&&-1!==n.indexOf(e.snapshot.opId)?this.cacheSnapshot(e):a&&-1!==a.indexOf(e.snapshot.opId)?"inPageOp"===e.snapshot.category&&t!==e.pkgId?this.execSnapshot(e):"pageOp"!==e.snapshot.category&&"boardOp"!=e.snapshot.category||"goto"!==e.snapshot.data.action?this.cacheSnapshot(e):this.execSnapshot(e):this.execSnapshot(e)}},{key:"cacheSnapshot",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.snapshot.opId,r=e.pkgId;if(this.opIdSnapshotMap[a]){n||(e.snapshot=this.recoverFullSnapshot(e.snapshot));var i=this.opIdSnapshotMap[a].pkgId,o=this.pkgIdOpIdMap[i].indexOf(a);this.pkgIdOpIdMap[i].splice(o,1),0===this.pkgIdOpIdMap[i].length&&delete this.pkgIdOpIdMap[i]}this.opIdSnapshotMap[a]=e,(t=this.pkgIdOpIdMap)[r]||(t[r]=[]),this.pkgIdOpIdMap[r].push(a)}},{key:"pushSnapshotToQueue",value:function(e){var t,n,a=e.snapshot.category,r=e.snapshot.opId,i=e.pkgId;if("globalOp"===a)this._pushSnapshotInArray(r,i,this.globalSnapshotIds);else if("boardOp"===a)this._pushSnapshotInArray(r,i,this.boardsSnapshotIds);else if("pageOp"===e.snapshot.category){var o=e.snapshot.board;this.boardOps.hasOwnProperty(o)||(this.boardOps[o]={pageSnapshotIds:[],pages:{}}),(t=this.boardOps[o]).pageSnapshotIds||(t.pageSnapshotIds=[]),this._pushSnapshotInArray(r,i,this.boardOps[o].pageSnapshotIds)}else if("inPageOp"===e.snapshot.category){var s=e.snapshot.board,u=e.snapshot.page;this.boardOps.hasOwnProperty(s)||(this.boardOps[s]={pageSnapshotIds:[],pages:{}}),this.boardOps[s].pages.hasOwnProperty(u)||(this.boardOps[s].pages[u]={inPageSnapshotIds:[]}),(n=this.boardOps[s].pages[u]).inPageSnapshotIds||(n.inPageSnapshotIds=[]),this._pushSnapshotInArray(r,i,this.boardOps[s].pages[u].inPageSnapshotIds)}}},{key:"_pushSnapshotInArray",value:function(e,t,n){var a=n.indexOf(e);-1!==a&&n.splice(a,1);for(var r=n.length;r>=0;r--){if(0===r){n.splice(r,0,e);break}if(this.opIdSnapshotMap[n[r-1]].pkgId<=t){n.splice(r,0,e);break}}}},{key:"mergeDebouncedData",value:function(e,t){if("snapshot"!==t&&e.length>0)return e[e.length-1];if("snapshot"!==t)throw new Error("[白板] mergeDebounceData, dataArr is empty!!");var n={},a=!0,i=!1,s=void 0;try{for(var u,l=(0,r.default)(e);!(a=(u=l.next()).done);a=!0){var c=u.value;"vision"===c.type?n.vision=c:n.hasOwnProperty(c.value.opId)?c.value.hasOwnProperty("category")?n[c.value.opId]=c.value:n[c.value.opId].hasOwnProperty("category")?n[c.value.opId]=this.app.opsManager.mergePartial(n[c.value.opId],c.value):n[c.value.opId]=this.app.opsManager.mergeTwoPartial(n[c.value.opId],c.value):n[c.value.opId]=c.value}}catch(e){i=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw s}}return 1===(0,o.default)(n).length?{type:"snapshot",value:(0,o.default)(n).map((function(e){return n[e]}))[0]}:{type:"snapshotArr",value:(0,o.default)(n).map((function(e){return n[e]}))}}},{key:"_init",value:function(){var e=new c.default(this.app,"whiteboard","whiteboard");this.boards={whiteboard:e},this.currIndex="whiteboard",this.pkgIdOpIdMap={},this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={},this.mergeFailCache={},this.executedClientIdSet.clear(),this._startRefreshLoop()}},{key:"_startRefreshLoop",value:function(){cancelAnimationFrame(this.refreshAnimationTimer),this._startRefreshLoop2()}},{key:"refresh",value:function(){this.pageToRefresh=this.currBoard.currPage}},{key:"currBoard",get:function(){return this.boards[this.currIndex]}},{key:"logger",get:function(){return this.app.logger}}]),e}();t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addIncrementSnapshot=void 0;var a=n(45),r=n(243),i=n(96),o=(t.addIncrementSnapshot=function(e,t){"text"===t.data.type?o(e,t):s(e,t)},function(e,t){if(e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString()){if(t.data.dependOn){var n=t.data.dependOn,a=e.drawOpQueue[n];a&&(a=(0,i.transformOp)(e,a,t),e.drawOpQueue[n]=a,u(e,a))}else e.drawOpQueue[t.opId]=t,u(e,t);e.app.room.pageToIncRefresh=e}}),s=function(e,t){if(e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString()){var n=t;if(-1===a.snapshotOutOfNormalFlowTypes.indexOf(t.data.type)){if(!t.data.dependOn&&e.opQueueMap.hasOwnProperty(t.opId)){var o=e.opQueueMap[t.opId];o[0].opId===t.opId&&(o[0]=t),n=(0,r.getDrawOpFromSnapshotQueue)(e,t.opId),(0,i.patchOp)(e,n)}e.drawOpQueue[t.opId]=n}else"laser"===t.data.type&&(e.lastLaserOfUser[t.uid]=t);u(e,t),e.app.room.pageToIncRefresh=e}},u=function(e,t){"select"===t.data.type?t.data.inProgress&&(e.lastInProgressSelectOfUser[t.uid]=t):"mouse-pointer"===t.data.type?e.lastMousePointerOfUser[t.uid]=t:e.lastInProgressSnapshotOfUser.hasOwnProperty(t.uid)&&e.lastInProgressSnapshotOfUser[t.uid].snapshot.opId===t.opId?e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:e.lastInProgressSnapshotOfUser[t.uid].beginAt}:e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:Date.now()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gotoBoard=t.addTransDocBoard=t.addBoard=t.deleteBoard=t.addOpInRoom=t.addGlobalOp=void 0;var a=u(n(18)),r=n(147),i=u(n(241)),o=n(244),s=n(245);function u(e){return e&&e.__esModule?e:{default:e}}t.addGlobalOp=function(e,t){var n,a=e.app.camera,i=(0,s.getCameraBoundFromGlobalOp)(e,t);i&&(t.data.animate||t.uid!==e.app.account?(0,r.transitionToCameraBound)(a,i,(function(){var t;null===(t=e.app.previewFactory)||void 0===t||t.refreshPreviewsOfCurrBoard()})):((0,r.stopTransitionToCameraBound)(),e.app.camera.setCameraBound(i),null===(n=e.app.previewFactory)||void 0===n||n.refreshPreviewsOfCurrBoard()))},t.addOpInRoom=function(e,t,n){var a,r=t.data,i=r.action,o=r.boardName,s=r.type;"goto"===i&&p(e,o,t),"delete"===i&&l(e,o,t),"add"===i&&c(e,o,t),"transDoc"===s&&("addTransDoc"===i&&d(e,o,t),e.boards[o].addTransDocOp(t,n)),e.app.opsManager.hooks.opAdd.call(t,!0),"transDoc"===s&&"addTransDoc"!==i||null===(a=e.app.previewFactory)||void 0===a||a.refreshPreviewsOfCurrBoard()};var l=t.deleteBoard=function(e,t,n){if(e.boards.hasOwnProperty(t))if(1===(0,a.default)(e.boards).length)e.logger.error("[白板]","不能删除最后一个board");else{var r=(0,a.default)(e.boards),i=r.indexOf(t);delete e.boards[t];var u=i;i===r.length-1&&(u=i-1),e.currIndex=(0,a.default)(e.boards)[u];var l=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,o.gotoPage)(l,l.currIndex,n),(0,s.fitToContentAfterBoardChange)(e)}else e.logger.error("[白板]","删除board:"+t+", 但是board不存在")},c=t.addBoard=function(e,t,n){var a=n.data.displayName?n.data.displayName:t;e.boards[t]=new i.default(e.app,t,a),e.currIndex=t;var r=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call();for(var u=1;u<n.data.pageCount;u++)(0,o.addPage)(r,void 0,n);if(n.data.tmpl)for(var l=function(e){var a=r.pages[e],i=(n.data.backupResultUrls||[]).map((function(t){return t.replace("{index}",n.data.offset+e)}));a.setBackgroundSnapshot({board:t,page:e,category:"inPageOp",opId:n.opId+"_"+e,time:n.time,uid:n.uid,data:{boundary:{sx:-n.data.w/2,sy:-n.data.h/2,w:n.data.w,h:n.data.h},url:n.data.tmpl.replace("{index}",n.data.offset+e),backupUrls:i,type:"background"}})},c=0;c<n.data.pageCount;c++)l(c);(0,o.gotoPage)(r,0,n),(0,s.fitToContentAfterBoardChange)(e)},d=t.addTransDocBoard=function(e,t,n){var a=n.data.displayName?n.data.displayName:t;e.boards[t]=new i.default(e.app,t,a),e.currIndex=t;var r=e.boards[e.currIndex];r.hasDoc=!0,e.app.opsManager.hooks.boardChange.call(),r.pages[0].setPayload({animPageIndex:0});for(var u=1;u<n.data.pageCount;u++)(0,o.addPage)(r,void 0,n,{animPageIndex:u});(0,o.gotoPage)(r,0,n),(0,s.fitToContentAfterBoardChange)(e)},p=t.gotoBoard=function(e,t,n){e.boards.hasOwnProperty(t)||(e.boards[t]=new i.default(e.app,t,t)),e.currIndex=t;var a=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,o.gotoPage)(a,a.currIndex,n),(0,s.fitToContentAfterBoardChange)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.polyfillRaf=function(){var e=0;window.requestAnimationFrame=function(t,n){var a=window.performance.now(),r=Math.max(e+16,a);return setTimeout((function(){t(e=r)}),r-a)},window.cancelAnimationFrame=clearTimeout}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(28)),r=h(n(7)),i=h(n(72)),o=h(n(74)),s=h(n(0)),u=h(n(1)),l=h(n(14)),c=n(106),d=n(13),p=n(96);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},g=function(){function e(t){(0,s.default)(this,e),this.previewContainerMap=new o.default,this.task=[],this.isLoopBusy=!1,this.visiblePages=[],this.app=t,this.app.opsManager.hooks.pageReady.tap("PageReadyPlugin",this.onPageReady.bind(this)),this.app.opsManager.hooks.opAdd.tap("OpAdd",this.onOpAdded.bind(this))}return(0,u.default)(e,[{key:"getPagePreviewCtx",value:function(e){return this.pagePreviewCtx&&this.pagePreviewCanvas||(this.pagePreviewCanvas=document.createElement("canvas"),this.pagePreviewCtx=this.pagePreviewCanvas.getContext("2d"),this.pagePreviewCanvas.style.visibility="hidden",this.pagePreviewCanvas.style.position="absolute",this.app.container.el.appendChild(this.pagePreviewCanvas)),e.width<8192&&e.height<8192?(this.pagePreviewCanvas.width=e.width,this.pagePreviewCanvas.height=e.height):e.width>e.height?(this.pagePreviewCanvas.width=8192,this.pagePreviewCanvas.height=Math.floor(8192*e.height/e.width)):(this.pagePreviewCanvas.height=8192,this.pagePreviewCanvas.width=Math.floor(8192*e.width/e.height)),this.pagePreviewCtx.lineJoin="round",this.pagePreviewCtx.lineCap="round",this.pagePreviewCtx}},{key:"reset",value:function(){this.previewContainerMap.clear()}},{key:"bindPreviewContainer",value:function(e){var t=this,n=!e.hasOwnProperty("reset")||e.reset,a=!e.hasOwnProperty("keepPrevContainer")||e.keepPrevContainer,o=e.previewContainerSettings.map((function(e){return t.getContainerKey(e)})),s=(0,i.default)(this.previewContainerMap.keys());if(n){var u=!0,l=!1,c=void 0;try{for(var d,p=(0,r.default)(s);!(u=(d=p.next()).done);u=!0){var h=d.value;-1!==o.indexOf(h)&&a||this.previewContainerMap.delete(h)}}catch(e){l=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(l)throw c}}this.task=[]}var f=[];e.previewContainerSettings.forEach((function(e){var n=t.getContainerKey(e);if(!a||!t.previewContainerMap.has(n)||t.previewContainerMap.get(n).id!==e.id){var r=t.setupPreviewElements(e.container),i=r.ctx,o=r.canvasContainer,s=e.container.getBoundingClientRect();f.push({pageIndex:e.pageIndex,boardName:e.boardName}),t.previewContainerMap.set(n,{id:e.id,container:o,ctx:i,width:s.width,height:s.height})}})),this.addPreviewTask(f),this.setBackgroundColor()}},{key:"preparePreview",value:function(e){for(var t=this.app.room.currIndex,n=[],a=0;a<e.length;a++){var r=this.app.room.currBoard.pageNames[e[a]];void 0!==r&&(this.app.opsManager.hooks.previewWaiting.call(e[a]),n.push({pageIndex:r,boardName:t}))}this.visiblePages=n.slice(),this.setPreviewTask(n)}},{key:"generateElesToDataUrl",value:function(e){var t=this,n=this.app.room.currBoard.currPage;n.calcDrawOpQueue();var a=e.map((function(e){return n.drawOpQueue[e]})).filter((function(e){return e&&!e.data.deleted&&!e.data.hidden}));if(0===a.length)return null;var i=void 0,o=a.map((function(e){return(0,d.getTransformedBoundary)(t.app.scale,e.data)})).reduce((function(e,t){return(0,d.combineBoundary)(e,t)}));if(!(i=this.getPagePreviewCtx({width:o.w,height:o.h})))return null;i.fillStyle=n.app.appConfig.canvasBgColor,(0,p.fillCtx)(i),n.app.camera.convertPreviewCanvas(i,{centerX:o.sx+o.w/2,centerY:o.sy+o.h/2,width:o.w,height:o.h});var s=!0,u=!1,l=void 0;try{for(var c,h=(0,r.default)(a);!(s=(c=h.next()).done);s=!0){var f=c.value;n.opsManager.preview(f,i,{page:n,supportToDataUrl:!0})}}catch(e){u=!0,l=e}finally{try{!s&&h.return&&h.return()}finally{if(u)throw l}}var g=i.canvas.toDataURL();return this.app.room.refresh(),g}},{key:"generatePreviewToDataUrl",value:function(e,t,n){var a=this.app.room.getPage(e.boardName,e.pageIndex);if(!a)return null;var r=void 0,i=void 0,o=this.app.room.boards[a.boardName],s=a.backgroundSnapshot||o&&o.transDocSnapshot;if("clip"===e.content)r=this.ctx;else if("fitToContent"===e.content||"fitToDoc"===e.content&&!s)i=this.app.camera.getCameraBoundFitToContent({padding:4,page:a,fitContainer:!1}),s||(i.width=Math.max(i.width,this.app.container.width),i.height=Math.max(i.height,this.app.container.height)),r=this.getPagePreviewCtx(i);else{if("fitToDoc"!==e.content)return this.app.logger.error("[白板] PreviewFactory.generatePreviewToDataUrl content must be one of clip, fitToContent, fitToDoc"),null;i=this.app.camera.getCameraBoundFitToDoc({page:a,fitContainer:!1}),r=this.getPagePreviewCtx(i)}if(!r)return null;a.calcDrawOpQueue(),"clip"===e.content?a.refresh({ctx:r,preview:!0,supportToDataUrl:!0,omitSelection:e.omitSelection,exportCustomBg:e.customBg,exportBoard:e.exportBoard}):a.refresh({ctx:r,preview:!0,supportToDataUrl:!0,boundary:i,omitSelection:e.omitSelection,exportCustomBg:e.customBg,exportBoard:e.exportBoard});var u=r.canvas.toDataURL(t,n);return this.app.room.refresh(),{content:u,width:r.canvas.width,height:r.canvas.height}}},{key:"setBackgroundColor",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=(0,r.default)(this.previewContainerMap.values());!(e=(a=i.next()).done);e=!0){a.value.container.style.backgroundColor=this.app.appConfig.canvasBgColor}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"refreshPreviewsOfCurrBoard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.app.room.isReceivingBatchSnapshots){this.task=[];var t=this.app.room.currBoard,n=t.pages,a=[];for(var r in n)!e&&"fitContainer"!==this.app.appConfig.previewMode&&this.app.hasBackground(n[r])||a.push({boardName:t.boardName,pageIndex:n[r].pageIndex});this.addPreviewTask(a)}}},{key:"refreshPreviewsOfCurrPage",value:function(){if(!this.app.room.isReceivingBatchSnapshots){var e=this.app.room.currBoard;this.invalidatePreview(e.currPage.pageIndex,e.boardName);var t=[{boardName:e.boardName,pageIndex:e.currIndex.toString()}];this.addPreviewTask(t)}}},{key:"generatePreview",value:function(e){var t=this.getContainerKey(e);if(this.previewContainerMap.has(t)){var n=this.previewContainerMap.get(t),a=this.app.room.getPage(e.boardName,e.pageIndex);if(!a)return;var r=void 0;"fitDoc"===this.app.appConfig.previewMode&&this.app.hasBackground(a)&&(r=this.app.camera.getDocCameraBound(a)),a.calcDrawOpQueue(),a.refresh({ctx:null==n?void 0:n.ctx,preview:!0,boundary:r})}}},{key:"invalidatePreview",value:function(e,t){}},{key:"setPreviewTask",value:function(e){this.task=[],this.addPreviewTask(e)}},{key:"addPreviewTask",value:function(e){var t=this;e=e.filter((function(e){return t.isPageVisible(e)})),setTimeout((function(){e.reverse().forEach((function(e){var n=t.getTaskIndexOfPage(e.pageIndex,e.boardName);-1!==n&&t.task.splice(n,1);var a=t.app.room.boards[e.boardName];if(a){var r=a.pages[e.pageIndex];if(r){var i=t.getContainerKey(e);t.previewContainerMap.has(i)&&t.task.unshift({pageIndex:e.pageIndex,boardName:e.boardName,state:r.blocked?"waiting":"ready"})}}})),t.startLoop()}),0)}},{key:"getTaskIndexOfPage",value:function(e,t){for(var n=0;n<this.task.length;n++)if(this.task[n].pageIndex===e&&this.task[n].boardName===t)return n;return-1}},{key:"getContainerKey",value:function(e){return e.boardName+"129*&^ljdfh893"+e.pageIndex.toString()}},{key:"setupPreviewElements",value:function(e){var t=e.getElementsByClassName("preview-canvas-container"),n=void 0,a=void 0,r=void 0;0===t.length?((r=document.createElement("div")).className="preview-canvas-container",r.style.backgroundColor=this.app.appConfig.canvasBgColor,r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",e.appendChild(r),(n=document.createElement("canvas")).style.imageRendering="optimize-contrast",r.appendChild(n),(a=n.getContext("2d")).lineCap="round",a.lineJoin="round"):(r=t[0],a=(n=t[0].getElementsByTagName("canvas")[0]).getContext("2d"));var i=r.getBoundingClientRect();return n.width=i.width*c.DPI,n.height=i.height*c.DPI,n.style.width=i.width+"px",n.style.height=i.height+"px",{ctx:a,canvasContainer:r}}},{key:"onOpAdded",value:function(e){if("inPageOp"===e.category&&!e.data.inProgress&&"laser"!==e.data.type&&"mouse-pointer"!==e.data.type&&!this.app.room.isReceivingBatchSnapshots){var t=e.board,n=e.page;this.invalidatePreview(n.toString(),t),this.addPreviewTask([{pageIndex:n.toString(),boardName:t}])}}},{key:"onPageReady",value:function(e,t){this.invalidatePreview(t.toString(),e),this.addPreviewTask([{pageIndex:t.toString(),boardName:e}])}},{key:"isPageVisible",value:function(e){for(var t=0;t<this.visiblePages.length;t++)if(this.visiblePages[t].boardName===e.boardName&&this.visiblePages[t].pageIndex===e.pageIndex)return!0;return!1}},{key:"startLoop",value:function(){return f(this,void 0,void 0,a.default.mark((function e(){var t,n=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoopBusy){e.next=2;break}return e.abrupt("return");case 2:return this.isLoopBusy=!0,e.next=5,new l.default((function(e){setTimeout(e,0)}));case 5:t=a.default.mark((function e(){var t,r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.shiftNextTastk();case 2:t=e.sent;case 3:if(null!==t){e.next=11;break}return e.next=6,n.delay(30);case 6:return e.next=8,n.shiftNextTastk();case 8:t=e.sent,e.next=3;break;case 11:if(r=n.getContainerKey(t),n.previewContainerMap.has(r)){e.next=14;break}return e.abrupt("return","continue");case 14:return e.next=16,new l.default((function(e){try{t&&n.isPageVisible(t)&&n.generatePreview(t),e()}catch(t){n.app.logger.error("[白板]",t),e()}}));case 16:return e.next=18,n.delay(100);case 18:case"end":return e.stop()}}),e,n)}));case 6:if(!(this.task.length>0)){e.next=13;break}return e.delegateYield(t(),"t0",8);case 8:if("continue"!==e.t0){e.next=11;break}return e.abrupt("continue",6);case 11:e.next=6;break;case 13:this.isLoopBusy=!1;case 14:case"end":return e.stop()}}),e,this)})))}},{key:"shiftNextTastk",value:function(){return f(this,void 0,void 0,a.default.mark((function e(){var t,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<this.task.length)){e.next=21;break}if(n=this.task[t],this.task.splice(t,1),e.prev=4,!this.app.room.getPage(n.boardName,n.pageIndex)){e.next=10;break}return e.abrupt("return",n);case 10:return t--,e.abrupt("continue",18);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),t--,e.abrupt("continue",18);case 18:t++,e.next=1;break;case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,this,[[4,14]])})))}},{key:"delay",value:function(e){return f(this,void 0,void 0,a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new l.default((function(t){setTimeout((function(){t()}),e)})));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"ctx",get:function(){return this.app.container.ctx}}]),e}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(18)),r=c(n(22)),i=c(n(38)),o=c(n(0)),s=c(n(1)),u=n(106),l=n(13);function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,n){(0,o.default)(this,e),this.scale=1,this.cameraBoundByUser={},this.app=t,this.translateX=0,this.translateY=0,this.scale=1,n?(this.width=n.width,this.height=n.height,this.centerX=n.centerX,this.centerY=n.centerY):(this.width=1920,this.height=1080,this.centerX=0,this.centerY=0),this.containerWorldRect={centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}return(0,s.default)(e,[{key:"getContainerWorldRect",value:function(){return this.containerWorldRect}},{key:"_computeContainerWorldRect",value:function(){var e=this.container.el.getBoundingClientRect(),t=e.width,n=e.height,a=this.convertToPointInWorld(0,0),r=(0,i.default)(a,2),o=r[0],s=r[1],u=this.convertToPointInWorld(t,n),l=(0,i.default)(u,2),c=l[0],d=l[1];this.containerWorldRect={centerX:o/2+c/2,centerY:s/2+d/2,width:c-o,height:d-s}}},{key:"getContainerWorldRectByCameraBound",value:function(e,t){if(e.width<=0||e.height<=0)return this.app.logger.warn("[白板] camera.getContainerWorldRectByCameraBound opts width or height less or equal to 0. \n            from: "+t+", width: "+e.width+", height: "+e.height),{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height};var n=this.container.width,a=this.container.height;return n/a>e.width/e.height?e.width=e.height/a*n:e.height=e.width/n*a,e}},{key:"convertToPointInWorld",value:function(e,t){return[e=(e-this.translateX)/this.scale,t=(t-this.translateY)/this.scale]}},{key:"convertWorldPointInContainer",value:function(e,t){return[e=e*this.scale+this.translateX,t=t*this.scale+this.translateY]}},{key:"convertDom",value:function(e){e.style.transform="translate("+this.translateX+"px, "+this.translateY+"px) scale("+this.scale+")",this.app.emit("event:camera:transform",this.scale)}},{key:"convertDomAndRefresh",value:function(){var e,t;this.convertDom(this.container.domEl),this.convertDom(this.container.h5El),this.app.room.pageToRefresh=null===(t=null===(e=this.app.room)||void 0===e?void 0:e.currBoard)||void 0===t?void 0:t.currPage}},{key:"convertCanvas",value:function(e){e.translate(this.translateX*u.DPI,this.translateY*u.DPI),e.scale(this.scale*u.DPI,this.scale*u.DPI)}},{key:"convertPreviewCanvas",value:function(e,t){var n=e.canvas.width,a=e.canvas.height,r=this.getTransParam(n,a,t),i=r.scale,o=r.translateX,s=r.translateY;e.translate(o,s),e.scale(i,i)}},{key:"setCameraBound",value:function(e){e.width&&e.height?(this.centerX=e.centerX,this.centerY=e.centerY,this.width=e.width,this.height=e.height,this.updateTransParamAndRefresh()):this.app.logger.warn("[白板] camera.setCameraBound 宽高无效",(0,r.default)(e))}},{key:"getNextCameraBound",value:function(e){return this.cameraLockParam?this.getCameraBoundLockWithContent(this.cameraLockParam):"pan"===e.type?this._roundBoundary(this.getCameraBoundPan(e)):"zoom"===e.type?this._roundBoundary(this.getCameraBoundZoom(e)):"reset-camera"===e.type?this._roundBoundary(this.getCameraBoundReset()):"fit-to-content"===e.type?this._roundBoundary(this.getCameraBoundFitToContent({fitContainer:!0,padding:0})):"fit-to-doc"===e.type?this._roundBoundary(this.getCameraBoundFitToDoc({fitContainer:!0})):"resize-camera"===e.type?this._roundBoundary(this.getCameraBoundResize(e)):(console.error("不应该进入此分支(getCameraBound), data类型为："+e),{width:this.width,height:this.height,centerX:this.centerX,centerY:this.centerY})}},{key:"_roundBoundary",value:function(e){return{centerX:Number(e.centerX.toFixed(1)),centerY:Number(e.centerY.toFixed(1)),width:Number(e.width.toFixed(1)),height:Number(e.height.toFixed(1))}}},{key:"getCameraBoundPan",value:function(e){var t=this.centerX,n=this.centerY,a=this.width,r=this.height;return t+=e.dx/this.scale,n+=e.dy/this.scale,this.getContainerWorldRectByCameraBound({centerX:t,centerY:n,width:a,height:r},"pan")}},{key:"getCameraBoundZoom",value:function(e){var t=this.centerX,n=this.centerY,a=this.width,r=this.height,i=void 0;i=e.center?this.convertToPointInWorld(e.center[0],e.center[1]):[t,n];var o=e.scale;return t=i[0]-(i[0]-t)/o,n=i[1]-(i[1]-n)/o,a/=o,r/=o,this.getContainerWorldRectByCameraBound({centerX:t,centerY:n,width:a,height:r},"zoom")}},{key:"getCameraBoundReset",value:function(){return{centerX:0,centerY:0,width:this.container.width,height:this.container.height}}},{key:"getCameraBoundFitToDoc",value:function(e){var t=e.page?e.page:this.app.room.currBoard.currPage,n=this.app.room.boards[t.boardName],a=t.backgroundSnapshot,r=n.transDocSnapshot;if(r&&r.data.boundary){var i=r.data.boundary,o=i.sx,s=i.sy,u=i.w,l=i.h;return e.fitContainer?this.getContainerWorldRectByCameraBound({centerX:o+u/2,centerY:s+l/2,width:u,height:l},"fitToDoc"):{centerX:o+u/2,centerY:s+l/2,width:u,height:l}}if(a){var c=a.data.boundary,d=c.sx,p=c.sy,h=c.w,f=c.h;return e.fitContainer?this.getContainerWorldRectByCameraBound({centerX:d+h/2,centerY:p+f/2,width:h,height:f},"fitToDoc"):{centerX:d+h/2,centerY:p+f/2,width:h,height:f}}return{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}},{key:"getDocCameraBound",value:function(e){var t=e.getBoard(),n=e.backgroundSnapshot,a=t.transDocSnapshot;if(a&&a.data.boundary){var r=a.data.boundary,i=r.sx,o=r.sy,s=r.w,u=r.h;return{centerX:i+s/2,centerY:o+u/2,width:s,height:u}}if(n){var l=n.data.boundary,c=l.sx,d=l.sy,p=l.w,h=l.h;return{centerX:c+p/2,centerY:d+h/2,width:p,height:h}}return{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}},{key:"getCameraBoundFitToContent",value:function(e){var t=e&&e.page?e.page:this.app.room.currBoard.currPage,n=t.drawOpQueue,r=t.backgroundSnapshot,i=this.app.room.currBoard.transDocSnapshot;if(0===(0,a.default)(n).length&&!r&&!i)return this.getCameraBoundReset();var o={sx:1e7,sy:1e7,ex:-1e7,ey:-1e7};if(r){var s=r.data.boundary,u=s.sx,c=s.sy,d=s.w,p=s.h;o.sx=Math.min(o.sx,u),o.sy=Math.min(o.sy,c),o.ex=Math.max(o.ex,u+d),o.ey=Math.max(o.ey,c+p)}if(i&&i.data.boundary){var h=i.data.boundary,f=h.sx,g=h.sy,v=h.w,y=h.h;o.sx=Math.min(o.sx,f),o.sy=Math.min(o.sy,g),o.ex=Math.max(o.ex,f+v),o.ey=Math.max(o.ey,g+y)}for(var m in n){var M=n[m].data;if(M.boundary&&null!==M.boundary.sx&&void 0!==M.boundary.sx&&null!==M.boundary.sy&&void 0!==M.boundary.sy&&null!==M.boundary.w&&void 0!==M.boundary.w&&null!==M.boundary.h&&void 0!==M.boundary.h){var x=(0,l.getTransformedBoundary)(this.scale,M),w=x.sx,I=x.sy,b=x.w,k=x.h;o.sx=Math.min(o.sx,w),o.sy=Math.min(o.sy,I),o.ex=Math.max(o.ex,w+b),o.ey=Math.max(o.ey,I+k)}}if(o.ex-o.sx<100&&o.ey-o.sy<100){var T=100-(o.ex-o.sx),_=100-(o.ey-o.sy);o.sx=o.sx-T/2,o.ex=o.ex+T/2,o.sy=o.sy-_/2,o.ey=o.ey+_/2}var C=e?e.padding:0;return e.fitContainer?this.getContainerWorldRectByCameraBound({centerX:o.sx/2+o.ex/2,centerY:o.sy/2+o.ey/2,width:o.ex-o.sx+2*C,height:o.ey-o.sy+2*C},"fitToContent"):{centerX:o.sx/2+o.ex/2,centerY:o.sy/2+o.ey/2,width:o.ex-o.sx+2*C,height:o.ey-o.sy+2*C}}},{key:"getCameraBoundResize",value:function(e){return this.app.appConfig.disableAutoResize?{centerX:this.centerX,centerY:this.centerY,width:e.width/this.zoomFactor,height:e.height/this.zoomFactor}:{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.width/e.width*e.height}}},{key:"getTransParam",value:function(e,t,n){var a=n?n.width:this.width,r=n?n.height:this.height,i=n?n.centerX:this.centerX,o=n?n.centerY:this.centerY,s=void 0,u=void 0,l=void 0;return u=e/2-i*(s=e/t>a/r?t/r:e/a),l=t/2-o*s,s&&isFinite(s)||(this.app.logger.warn("[白板] scale无效:",s,"参数为width: "+e+", height: "+t+", cameraW: "+a+", cameraH: "+r+", centerX: "+i+", centerY: "+o,"重置scale为1"),u=e/2-i*(s=1),l=t/2-o*s),{scale:s,translateX:u,translateY:l}}},{key:"updateTransParamAndRefresh",value:function(){var e=this.getTransParam(this.container.width,this.container.height),t=e.scale,n=e.translateX,a=e.translateY;this.scale=t,this.translateX=n,this.translateY=a,this._computeContainerWorldRect(),this.convertDomAndRefresh(),this.app.emit("event:appState:change","zoomFactor",this.zoomFactor)}},{key:"getCameraBoundLockWithContent",value:function(e){var t=e.width,n=e.height,a=e.height/e.width*1920,r=void 0,i=void 0;return this.container.width/this.container.height>t/n?(i=a,r=this.container.width/this.container.height*a):(r=1920,i=this.container.height/this.container.width*1920),{centerX:0,centerY:0,width:r/2,height:i/2}}},{key:"lockCameraWithContent",value:function(e){this.cameraLockParam=e,this.setCameraBound(this.getCameraBoundLockWithContent(e))}},{key:"unlockCameraWithContent",value:function(){this.cameraLockParam=void 0}},{key:"zoomFactor",get:function(){return this.scale}},{key:"container",get:function(){return this.app.container}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(7)),r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,r.default)(this,e),this.state="pause",this.playSpeed=1,this.records=[],this.nextRecordIndex=0,this.lastTime=0,this.lastRealTime=0,this.offsetBegin=0,this.pkgId=0,this.app=t}return(0,i.default)(e,[{key:"addRecordData",value:function(e){this.records=e.slice(),this.app.resetState(),this.nextRecordIndex=0}},{key:"setViewer",value:function(e){this.app.account=e;var t=this.lastTime;this.lastTime=1/0,this.seekTo(t)}},{key:"play",value:function(){"pause"===this.state&&(this.state="play",this.app.emit("event:player:play"))}},{key:"pause",value:function(){"play"===this.state&&(this.state="pause",this.app.emit("event:player:pause"))}},{key:"setPlaySpeed",value:function(e){this.playSpeed!==e&&(this.playSpeed=e,this.app.emit("event:player:playSpeed",this.playSpeed))}},{key:"seekTo",value:function(e){var t=Date.now(),n=Math.abs(t-this.lastRealTime-(e-this.lastTime));this.lastRealTime=t;var r=e>=this.lastTime;this.lastTime=e;for(var i=r?this.nextRecordIndex:0,o=i;o<this.records.length;o++){if(this.records[o].time+this.offsetBegin>e)break}var s=this.records.slice(i,o);this.nextRecordIndex=o,r||(this.app.resetState(),this.pkgId=0);for(var u=[],l=void 0,c=void 0,d=[],p=0;p<s.length;p++)if("snapshot"===s[p].record.type)u.push({snapshot:s[p].record.value,pkgId:this.pkgId}),this.pkgId+=1;else if("snapshotArr"===s[p].record.type){var h=!0,f=!1,g=void 0;try{for(var v,y=(0,a.default)(s[p].record.value);!(h=(v=y.next()).done);h=!0){var m=v.value;u.push({snapshot:m,pkgId:this.pkgId}),this.pkgId+=1}}catch(e){f=!0,g=e}finally{try{!h&&y.return&&y.return()}finally{if(f)throw g}}}else"broadcaster"===s[p].record.type?l=s[p].record.value:"observeMode"===s[p].record.type?s[p].record.value.account===this.app.account&&(c=s[p].record.value):"alive"===s[p].record.type&&d.push(s[p]);this.app.aliveManager.receiveSyncData(d),l&&this.app.vision.receiveBroadcasterAfterSync(l),c&&this.app.vision.receiveObserveModeAfterSync(c),this.app.room.execBatchSnapshots(u,"player"),n>100&&this.app.emit("event:player:seekTo")}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(38)),r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,r.default)(this,e),this._lastDirection=0,this._interruptFreeDraw=!1,this.task=[],this.lNo=0,this.dNo=0,this.rNo=0,this.repeat=100,this.dInterval=15,this.lInterval=1e3,this.taskGenerator=function(){},this.app=t}return(0,i.default)(e,[{key:"reconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("DEV--\x3e 模拟重连， 是否清空数据: "+t+", 是否重新创建socket连接: "+e),t&&this.app.resetState(),e?this.app.dataHub.handler._simulateReconnect():this.app.readyToSyncData()}},{key:"generateRandomLines",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this._interruptFreeDraw=!1,this.app.disableInteraction(),this._generateRandomLines(e,t,n,a)}},{key:"generateZheng",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this._interruptFreeDraw=!1,this.app.disableInteraction(),this.app.setTool("pen"),this._generateZheng(e,t,n,a)}},{key:"interruptRandomLines",value:function(){clearTimeout(this.timer),this.finish(),this._interruptFreeDraw=!0,this.app.enableInteraction()}},{key:"next",value:function(){var e=this;clearTimeout(this.timer);var t=this.task[this.lNo];if(t)if(t.length>2){var n=t[this.dNo],a=void 0,r=void 0;0===this.dNo?(a="mousedown",r=this.dInterval,this.dNo+=1):this.dNo===t.length-1?(a="mouseup",r=this.lInterval,this.dNo=0,this.lNo+=1):(a="mousemove",r=this.dInterval,this.dNo+=1);var i=new MouseEvent(a,{clientX:n.x,clientY:n.y});this.app.container[a](i,!0),this.timer=setTimeout((function(){e.next()}),r)}else this.lNo+=1,this.next();else this.timer=setTimeout((function(){e.nextTask()}),this.lInterval)}},{key:"nextTask",value:function(){this.lNo=0,this.dNo=0,this.isFinish()?(this.task=[],this._interruptFreeDraw=!0,this.app.enableInteraction()):(this.task=this.taskGenerator(),this.rNo+=1,this.next())}},{key:"isFinish",value:function(){return this._interruptFreeDraw||this.rNo>=this.repeat}},{key:"finish",value:function(){var e=new MouseEvent("mousedown",{clientX:0,clientY:0});this.app.container.mousedown(e,!0),e=new MouseEvent("mouseup",{clientX:0,clientY:0}),this.app.container.mouseup(e,!0)}},{key:"_generateZheng",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.dInterval=Number(a)||15,this.lInterval=Number(r)||1e3,this.repeat=t||100;var i=Math.ceil(Math.sqrt(t)),o=Math.ceil(Math.sqrt(t));this.taskParam={x:0,y:0,row:o,col:i},this.rNo=0,this.taskGenerator=function(){var t=n.app.container.el.getBoundingClientRect(),a=t.width,r=t.height,s=.9*a/Math.max(i,15),u=.9*r/Math.max(o,15),l=t.left+.05*a+n.taskParam.x*s,c=t.top+.05*r+n.taskParam.y*u,d=t.left+.05*a+(n.taskParam.x+.8)*s,p=t.top+.05*r+(n.taskParam.y+.8)*u,h=[];return h.push(n._generateLine(e,l,c,d,c)),h.push(n._generateLine(e,l/2+d/2,c,l/2+d/2,p)),h.push(n._generateLine(e,l/2+d/2,c/2+p/2,d,c/2+p/2)),h.push(n._generateLine(e,.75*l+.25*d,c/2+p/2,.75*l+.25*d,p)),h.push(n._generateLine(e,l,p,d,p)),n.taskParam.x<o-1?n.taskParam.x+=1:(n.taskParam.y+=1,n.taskParam.x=0),h},this.nextTask()}},{key:"_generateLine",value:function(e,t,n,a,r){for(var i=[],o=0;o<e;o++)i.push({x:t+o/e*(a-t)+Math.random(),y:n+o/e*(r-n)+Math.random()});return i}},{key:"_generateRandomLines",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.dInterval=Number(r)||15,this.lInterval=Number(i)||1e3,this.repeat=Number(t)||100,this.taskParam=e||100,this.rNo=0,this.taskGenerator=function(){var e=n.app.container.el.getBoundingClientRect(),t=e.width,r=e.height,i=Math.random()*t+e.left,o=Math.random()*r+e.top,s=[];s.push({x:i,y:o});for(var u=0;u<n.taskParam;u++){var l=n._getDxDy(u),c=(0,a.default)(l,2);i+=c[0],o+=c[1],s.push({x:i,y:o})}return[s]},this.nextTask()}},{key:"_getDxDy",value:function(e){return e%30==0&&(this._lastDirection=Math.floor(4*Math.random())),0===this._lastDirection?[10*Math.random(),10*Math.random()]:1===this._lastDirection?[10*Math.random(),-10*Math.random()]:2===this._lastDirection?[-10*Math.random(),10*Math.random()]:[-10*Math.random(),-10*Math.random()]}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(7)),r=c(n(0)),i=c(n(1)),o=n(31),s=c(n(33)),u=n(240),l=n(147);function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){var n=this;(0,r.default)(this,e),this.mode="freeObserver",this.unsetWhenDisconnecting=function(){n.broadcaster===n.app.account.toString()&&n.unsetSelfAsBroadcaster()},this.handleBroadcasterOffline=function(e){n.app.logger.log("[白板] vision broadcaster offline",e,"broadcaster",n.broadcaster);var t=!0,r=!1,i=void 0;try{for(var u,l=(0,a.default)(e);!(t=(u=l.next()).done);t=!0){var c=u.value;if(c.toString()===n.broadcaster&&c.toString()===n.app.account)return n.unsetSelfAsBroadcaster();if(c.toString()===n.broadcaster){var d=n.broadcasterName,p=n.broadcaster;n.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}});var h=d+"取消了视角同步",f=s.default.RECEIVE_STOP_BROADCAST;(0,o.showToast)({msg:h,type:"success",time:3,msgType:f,args:{broadcasterName:n.broadcasterName,broadcaster:n.broadcaster,prevBroadcasterName:d,prevBroadcaster:p}})}}}catch(e){r=!0,i=e}finally{try{!t&&l.return&&l.return()}finally{if(r)throw i}}},this.app=t,this.camera=this.app.camera,this.app.on("aliveManager:offline",this.handleBroadcasterOffline),this.unregistExit=(0,u.regExitListener)(this.unsetWhenDisconnecting,t)}return(0,i.default)(e,[{key:"destroy",value:function(){this.app.off("aliveManager:offline",this.handleBroadcasterOffline),"function"==typeof this.unregistExit&&this.unregistExit()}},{key:"setVisionData",value:function(e){e.mode&&(this.mode=e.mode),e.broadcaster&&(this.broadcaster=e.broadcaster.value,this.broadcasterNickname=e.broadcaster.nickname),this.app.emit("event:appState:change","vision",{mode:this.mode,broadcasterName:this.broadcasterName,broadcaster:this.broadcaster})}},{key:"setSelfAsBroadcaster",value:function(){if(this.app.appConfig.allowReplaceActiveBroadcaster||!this.broadcaster||this.broadcaster===this.app.account.toString()){if(this.broadcaster!==this.app.account.toString())if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else{var e=this.app.account,t=this.app.nickname;this.setVisionData({mode:"broadcaster",broadcaster:{value:e,nickname:t}}),(0,o.showToast)({type:"success",msg:"其他用户将与您保持视角同步",time:3,msgType:s.default.START_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({broadcaster:e,nickname:t},"broadcaster"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!0)}}else(0,o.showToast)({type:"error",msg:"其他参会人已开启视角同步",time:3,msgType:s.default.NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}},{key:"unsetSelfAsBroadcaster",value:function(){if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else if("broadcaster"===this.mode){this.broadcaster!==this.app.account&&this.app.logger.error("[白板] unsetSelfAsBroadcaster: 取消广播。但事实上目前用户并不是房间的广播者",this.broadcaster,this.app.account);var e=this.broadcasterName,t=this.broadcaster;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),(0,o.showToast)({type:"success",msg:"其他用户将停止与您保持视角同步",msgType:s.default.STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:e,prevBroadcaster:t}}),this.app.dataHub.broadcastRoomState({broadcaster:void 0},"broadcaster")}}},{key:"setSelfAsFollower",value:function(){if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else if("broadcaster"===this.mode)this.app.logger.error("[白板] setSelfAsFollower: 请先停止广播");else if("freeObserver"===this.mode){this.setVisionData({mode:"follower"});var e=this.camera.cameraBoundByUser[this.broadcaster];(0,l.transitionToCameraBound)(this.camera,e),(0,o.showToast)({type:"success",msg:"与"+this.broadcasterName+"保持视角同步",msgType:s.default.SWITCH_TO_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"follower"},"observeMode")}}},{key:"setSelfAsFreeObserver",value:function(){this.app.dataHub.isSynchronizing?this.app.logger.warn("正在同步数据，请同步后再设置"):"broadcaster"===this.mode?this.app.logger.error("[白板] setSelfAsFreeObserver: 请先停止广播"):"follower"===this.mode&&(this.setVisionData({mode:"freeObserver"}),(0,o.showToast)({type:"success",msg:"与"+this.broadcasterName+"解除视角同步",msgType:s.default.SWITCH_TO_FREE_OBSERVER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"freeObserver"},"observeMode"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!1))}},{key:"receiveBroadcaster",value:function(e){var t=e.broadcaster,n=e.nickname;if(t)this.setVisionData({mode:"follower",broadcaster:{value:t,nickname:n}}),(0,o.showToast)({msg:"正在与"+this.broadcasterName+"保持视角同步",type:"success",time:3,msgType:s.default.RECEIVE_START_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}});else{var a=this.broadcasterName,r=this.broadcaster;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),(0,o.showToast)({msg:a+"取消了视角同步",type:"success",time:3,msgType:s.default.RECEIVE_STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:a,prevBroadcaster:r}})}}},{key:"receiveBroadcasterAfterSync",value:function(e){var t=this.app.aliveManager.isAlive(e.broadcaster);if(t&&e.broadcaster===this.app.account)"broadcaster"!==this.mode&&(this.setVisionData({mode:"broadcaster",broadcaster:{value:this.app.account,nickname:this.app.nickname}}),(0,o.showToast)({type:"success",msg:"其他用户正与您保持视角同步",time:3,msgType:s.default.CURRENT_USER_IS_BROADCASTER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}));else if(t&&e.broadcaster)"follower"===this.mode&&this.broadcaster===e.broadcaster||(this.setVisionData({mode:"follower",broadcaster:{value:e.broadcaster,nickname:e.nickname}}),(0,o.showToast)({msg:"正在与"+this.broadcasterName+"保持视角同步",type:"success",time:3,msgType:s.default.CURRENT_USER_IS_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}));else if("freeObserver"!==this.mode||this.broadcaster){var n=this.broadcaster,a=this.broadcasterName;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),this.app.account===n?(0,o.showToast)({type:"success",msg:"其他用户将停止与您保持视角同步",msgType:s.default.STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:a,prevBroadcaster:n}}):n&&(0,o.showToast)({msg:a+"取消了视角同步",type:"success",time:3,msgType:s.default.RECEIVE_STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:a,prevBroadcaster:n}})}}},{key:"receiveObserveModeAfterSync",value:function(e){if(e.account===this.app.account)if("follower"===e.mode){this.setVisionData({mode:"follower"});var t=this.camera.cameraBoundByUser[this.broadcaster];(0,l.transitionToCameraBound)(this.camera,t),(0,o.showToast)({type:"success",msg:"正在与"+this.broadcasterName+"保持视角同步",msgType:s.default.CURRENT_USER_IS_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}else{this.setVisionData({mode:"freeObserver"});var n=this.camera.cameraBoundByUser[this.app.account];(0,l.transitionToCameraBound)(this.camera,n),(0,o.showToast)({type:"success",msg:"与"+this.broadcasterName+"解除视角同步",msgType:s.default.CURRENT_USER_IS_FREE_OBSERVER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}}},{key:"broadcasterName",get:function(){return this.broadcasterNickname?this.broadcasterNickname:this.broadcaster}}]),e}();t.default=d},function(e,t,n){!function(n){"use strict";function a(e,t){if(e instanceof Boolean||"boolean"==typeof e)return!1;if(t instanceof Object||(t={}),!1===t.allowEmpty&&""===e)return!1;var n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?",a="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)";return!0===t.mimeRequired?n=a+n:!0===t.allowMime&&(n=a+"?"+n),!1===t.paddingRequired&&(n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+n+"$","gi").test(e)}e.exports&&(t=e.exports=a),t.isBase64=a}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(7)),r=s(n(0)),i=s(n(1)),o=s(n(23));function s(e){return e&&e.__esModule?e:{default:e}}var u=["embedded-opentype","woff","truetype","svg","opentype","woff2"],l=void 0,c=function(){function e(t){var n,i,s,u,c,d,p=this;(0,r.default)(this,e),this.setFontFamilies=function(e){clearTimeout(l),l=setTimeout((function(){p._setFontFamilies(e)}),1e3)},this._setFontFamilies=function(e){p.fontFamilies=e;var t=void 0,n=!0,r=!1,i=void 0;try{for(var s,u=(0,a.default)(e);!(n=(s=u.next()).done);n=!0){var l=s.value;l.fontFace&&(t||((t=document.createElement("style")).setAttribute("type","text/css"),document.head.appendChild(t)),p.appendFontFaceStyle(t,l.fontFace,l.displayName))}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}o.default.updateFontFamily(p.app,e[0].displayName)},this.app=t,this.fontFamilies=[{displayName:"Helvetica",fontName:"Helvetica"},{displayName:"Times New Roman",fontName:"Times New Roman"},{displayName:"Garamond",fontName:"Garamond"},{displayName:"Courier New",fontName:"Courier New"},{displayName:"Noto Sans SC",fontFace:{url:(null===(n=t.serviceConf)||void 0===n?void 0:n.textFontUrl)+"/Noto_Sans_SC/NotoSansSC-Regular.otf"}},{displayName:"Open Sans",fontFace:{url:(null===(i=t.serviceConf)||void 0===i?void 0:i.textFontUrl)+"/Open_Sans/OpenSans-VariableFont_wdth,wght.ttf"}},{displayName:"ZOOL KuaiLe",fontFace:{url:(null===(s=t.serviceConf)||void 0===s?void 0:s.textFontUrl)+"/ZCOOL_KuaiLe/ZCOOLKuaiLe-Regular.ttf"}},{displayName:"Caveat",fontFace:{url:(null===(u=t.serviceConf)||void 0===u?void 0:u.textFontUrl)+"/Caveat/Caveat-VariableFont_wght.ttf"}},{displayName:"Long Cang",fontFace:{url:(null===(c=t.serviceConf)||void 0===c?void 0:c.textFontUrl)+"/Long_Cang/LongCang-Regular.ttf"}},{displayName:"Ma Sang Zheng",fontFace:{url:(null===(d=t.serviceConf)||void 0===d?void 0:d.textFontUrl)+"/Ma_Shan_Zheng/MaShanZheng-Regular.ttf"}}],this.setFontFamilies(this.fontFamilies)}return(0,i.default)(e,[{key:"getFontFamilies",value:function(){return this.fontFamilies}},{key:"appendFontFaceStyle",value:function(e,t,n){Array.isArray(t)||(t=[t]);var a=t.map((function(e){return e.format&&-1===u.indexOf(e.format)?(console.error("[白板] 字体format应该为以下值中的一个: "+u.join(",")+", 或者不设置format"),'url("'+e.url+'")'):e.format?'url("'+e.url+'") format("'+e.format+'")':'url("'+e.url+'")'})).join(",\n");e.appendChild(document.createTextNode('\n@font-face {\n    font-family: "'+n+'";\n    src: '+a+";\n}\n"))}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(7)),r=l(n(37)),i=l(n(74)),o=l(n(0)),s=l(n(1)),u=n(132);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=this;(0,o.default)(this,e),this.isBroadcaster=!1,this.aliveMap=new i.default,this.aliveSet=new r.default,this.visionChangeCb=function(e,t){if("vision"===e){var a=n.shouldKeepAlive;t&&"broadcaster"===t.mode?n.isBroadcaster=!0:n.isBroadcaster=!1,n.update(a)}},this.sendAlive=function(){clearTimeout(n.aliveTimer);var e=Date.now()+n.app.ntpTimeDiff;if(n.aliveMap.has(n.app.account)&&!n.isAlive(n.app.account))return n.app.logger.warn("[白板] alive manager not active after: "+(e-n.aliveMap.get(n.app.account))),void n.checkAlive();n.app.dataHub.broadcastData({data:{type:"alive",value:{uid:n.app.account,t:e}}},"alive","alive",!0),n.aliveMap.set(n.app.account,e),n.aliveSet.add(n.app.account),n.aliveTimer=setTimeout(n.sendAlive,7e3)},this.checkAlive=function(){if(!n.app.dataHub.isSynchronizing&&n.app.isConnected){var e=[],t=n.aliveMap.keys(),r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(t);!(r=(s=u.next()).done);r=!0){var l=s.value;n.isAlive(l)||(e.push(l),n.aliveMap.delete(l))}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}e.length>0&&n.app.emit("aliveManager:offline",e)}clearTimeout(n.checkTimer),n.checkTimer=setTimeout(n.checkAlive,7e3)},this.app=t,this.app.isRecordPlayer||this.app.on("event:appState:change",this.visionChangeCb),this.checkAlive(),this.visHandlerUnregist=(0,u.registerVisibleChangeHandler)((function(){clearTimeout(n.checkTimer),n.checkTimer=setTimeout(n.checkAlive,7e3)}),(function(){clearTimeout(n.checkTimer)}))}return(0,s.default)(e,[{key:"destroy",value:function(){this.app.isRecordPlayer||this.app.off("event:appState:change",this.visionChangeCb),clearTimeout(this.aliveTimer),clearTimeout(this.checkTimer),"function"==typeof this.visHandlerUnregist&&this.visHandlerUnregist()}},{key:"update",value:function(e){e!==this.shouldKeepAlive&&(this.shouldKeepAlive?(this.aliveMap.delete(this.app.account),clearTimeout(this.aliveTimer),this.sendAlive()):clearTimeout(this.aliveTimer))}},{key:"receiveAlive",value:function(e){this.aliveMap.set(e.uid,e.t),this.aliveSet.add(e.uid.toString())}},{key:"receiveSyncData",value:function(e){var t;if(this.app.isRecordPlayer){var n=null===(t=this.app.player)||void 0===t?void 0:t.lastTime;if(n){var r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(e);!(r=(s=u.next()).done);r=!0){var l=s.value;n-l.time<2e4&&(this.aliveMap.set(l.record.value.uid.toString(),l.time),this.aliveSet.add(l.record.value.uid.toString()))}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}}}else{var c=Date.now()+this.app.ntpTimeDiff,d=!0,p=!1,h=void 0;try{for(var f,g=(0,a.default)(e);!(d=(f=g.next()).done);d=!0){var v=f.value;c-v.t<2e4&&(this.aliveMap.set(v.uid.toString(),v.t),this.aliveSet.add(v.uid.toString()))}}catch(e){p=!0,h=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw h}}}}},{key:"isAlive",value:function(e){var t;if(e&&!this.aliveSet.has(e))return!0;if(e&&this.aliveMap.has(e)){var n=this.aliveMap.get(e);if(this.app.isRecordPlayer){var a=null===(t=this.app.player)||void 0===t?void 0:t.lastTime;if(a&&a>n&&a-n<2e4)return!0}else{var r=Date.now()+this.app.ntpTimeDiff;if(Math.abs(r-n)<2e4)return!0}}return!1}},{key:"shouldKeepAlive",get:function(){return this.isBroadcaster}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=m(n(367)),r=m(n(27)),i=m(n(18)),o=m(n(5)),s=m(n(371)),u=m(n(19)),l=m(n(7)),c=m(n(0)),d=m(n(1)),p=m(n(107)),h=m(n(375)),f=n(66),g=n(437);n(442);var v=n(444),y=n(29);function m(e){return e&&e.__esModule?e:{default:e}}var M=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof p.default){var r=0;for(a=(0,p.default)(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},x=(0,f.deviceOS)(),w={text:["typeChange","divider","fontFamily","fontStroke","fontSize","fontFill","divider","textAlign","divider"],link:["linkArrow","divider","linkType","divider","lineProp","divider","addT","divider","fontFamily","fontStroke","fontSize","divider"],pen:["lineWidth","stroke","divider"],image:["imgCrop","divider","resDownload","divider"],shape:["typeChange","divider","lineProp","fill","divider","fontFamily","fontStroke","fontSize","fontFill","divider","textAlign","divider"]},I=[{optionName:"bringToFront",text:"置于顶部",hotKeyText:""},{optionName:"sendToBack",text:"置于底部",hotKeyText:""},{optionName:"copyToClipboard",text:"复制为图片",hotKeyText:""},{optionName:"copy",text:"复制",hotKeyText:""},{optionName:"delete",text:"删除",hotKeyText:"Delete"}],b=function(){function e(t){var n=this;(0,c.default)(this,e),this.selectedOpIds=[],this.isMouseDown=!1,this.isShow=!1,this.delayHide=function(){clearTimeout(n.delayTimer),n.delayTimer=setTimeout((function(){n.hide()}),100)},this.hide=function(){clearTimeout(n.delayTimer),n.isShow=!1,n.floatToolbar.hide()},this.onSnapshotAdd=function(e){var t=e.data.type,a=e.data.dependOn||[],r=n.drawPlugin.getSelectedIds();if("scale"===t&&r.length&&n.syncData(r),"move"===t||"scale"===t||"rotate"===t)for(var i=0;i<a.length;i++)-1!==r.indexOf(a[i])&&n.delayShow(e.data.inProgress?{delay:1e3}:{delay:100});if("text"===t||"modify"===t||"undo"===t||"redo"===t||"group"===t){if("modify"===t&&e.uid===n.drawPlugin.account){if(e.data.inProgress)return;var o=!0,s=!1,u=void 0;try{for(var c,d=(0,l.default)(e.data.attrs.sub);!(o=(c=d.next()).done);o=!0){var p=c.value,h=!0,f=!1,g=void 0;try{for(var v,y=(0,l.default)(p.attrs);!(h=(v=y.next()).done);h=!0){var m=v.value;if("fontSize"===m.k||"fontFamily"===m.k)return}}catch(e){f=!0,g=e}finally{try{!h&&y.return&&y.return()}finally{if(f)throw g}}}}catch(e){s=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw u}}var M=!0,x=!1,w=void 0;try{for(var I,b=(0,l.default)(e.data.attrs.common);!(M=(I=b.next()).done);M=!0){var k=I.value;if("fontSize"===k.k||"fontFamily"===k.k)return;"_reset"===k.k&&n.syncData(r)}}catch(e){x=!0,w=e}finally{try{!M&&b.return&&b.return()}finally{if(x)throw w}}}if("undo"!==t&&"redo"!==t&&"group"!==t||n.syncData(r),"text"===t)return;n.delayShow({isHide:!1,delay:30,opids:r})}},this.delayShow=function(e){if(!n.isMouseDown){var t=null!=e?e:{},a=t.isHide,r=void 0===a||a,i=t.delay,o=void 0===i?200:i,s=t.opids,u=void 0===s?[]:s;clearTimeout(n.delayTimer),r&&n.hide(),n.delayTimer=setTimeout(n.updateToolbarPosAndShow,o,u)}},this.updateToolbarPosAndShow=function(e){clearTimeout(n.delayTimer);var t=e.length?[].concat((0,u.default)(e)):n.drawPlugin.getSelectedIds();if(t.length){if(1===t.length)if(!n.drawPlugin.opsManager.drawOpsOfPage[t[0]])return;var a=n.drawPlugin.opsManager.selectOp.selectInfo;if(!a)return;var r=void 0;if(a.boundary.isCombined)r=a.boundary;else{var i=a.boundary.p1,o=a.boundary.p2,s=a.boundary.p3,l=a.boundary.p4,c=a.rotateIcon?a.rotateIcon.x-15/n.drawPlugin.scale:i[0],d=a.rotateIcon?a.rotateIcon.x+15/n.drawPlugin.scale:i[0],p=a.rotateIcon?a.rotateIcon.y-15/n.drawPlugin.scale:i[1],h=a.rotateIcon?a.rotateIcon.y+15/n.drawPlugin.scale:i[1],f=a.hintPos?a.hintPos.p1:i,g=a.hintPos?a.hintPos.p2:o,v=a.hintPos?a.hintPos.p3:s,y=a.hintPos?a.hintPos.p4:l,m=Math.min(i[0],o[0],s[0],l[0],c,d,f[0],g[0],v[0],y[0]),M=Math.max(i[0],o[0],s[0],l[0],c,d,f[0],g[0],v[0],y[0]),x=Math.min(i[1],o[1],s[1],l[1],p,h,f[1],g[1],v[1],y[1]);r={sx:m,sy:x,w:M-m,h:Math.max(i[1],o[1],s[1],l[1],p,h,f[1],g[1],v[1],y[1])-x}}var w=n.drawPlugin.container.containerRect,I=n.getClientBoundRect(r),b=!1;(I.x>w.right||I.y>w.bottom||I.x+I.width<w.left||I.y+I.height<w.top)&&(b=!0),b||(n.isShow=!0,n.floatToolbar.show(I))}},this.syncData=function(e,t){if(e.length){var a=[];e.forEach((function(e){var t=n.getOpData(e);t&&a.push(t)})),n.selectedOpIds=e,n.setItems(a,t)}},this.changeHandler=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.toolName,r=e.value,i=[];if("selectFilter"!==a){if("fontSize"===a){var o=Number(r);r&&!(0,s.default)(o)&&(o=Math.max(10,o),o=Math.min(300,o),i.push({k:a,v:o}))}else if("linkArrow"===a)i.push({k:"start",v:{aType:0===r||2===r?y.IArrowType.None:y.IArrowType.Arrow}}),i.push({k:"end",v:{aType:0===r||1===r?y.IArrowType.None:y.IArrowType.Arrow}});else if("typeChange"===a)i.push({k:"typeChange",v:r});else if("textAlign"===a)for(var u in r)i.push({k:u,v:r[u]});else"lineProp"===a?(i.push({k:"stroke",v:r.color}),i.push({k:"lineWidth",v:r.lineWidth})):-1!==["stroke","fill","fontStroke","fontFill"].indexOf(a)?i.push({k:a,v:r.color}):i.push({k:a,v:r});n.drawPlugin.emit("op:modify:change",n.selectedOpIds,i,t)}else{var l="pen"===r?["pen","pen-arrow","line","line-arrow"]:[r];n.drawPlugin.emit("op:select:filterType",l)}},this.clickHandler=function(e){var t,a=e.toolName;a&&(null===(t=n[a])||void 0===t||t.call(n,e),"addT"===a&&1===n.selectedOpIds.length?n.drawPlugin.emit("op:link:addT",n.selectedOpIds[0]):"resDownload"===a&&1===n.selectedOpIds.length?n.drawPlugin.downloadRes(n.selectedOpIds[0]):"imgCrop"===a&&1===n.selectedOpIds.length?n.drawPlugin.emit("op:crop:image",n.selectedOpIds[0]):"group"===a?n.drawPlugin.emit("op:group",!0,n.selectedOpIds):"ungroup"===a&&n.drawPlugin.emit("op:group",!1,n.selectedOpIds))},this.contextMenu=function(e){var t,a={delete:function(){n.drawPlugin.emit("op:delete:exec")},copy:function(){n.drawPlugin.emit("op:duplicate:exec")},copyToClipboard:function(){n.drawPlugin.copySelectedElesToClipboard()},bringToFront:function(){n.drawPlugin.emit("op:layer:update",n.selectedOpIds,"top")},sendToBack:function(){n.drawPlugin.emit("op:layer:update",n.selectedOpIds,"bottom")}};e.optionName&&(null===(t=a[e.optionName])||void 0===t||t.call(a))};var a=t.drawPlugin,r=t.onChange,i=t.onClick,d=M(t,["drawPlugin","onChange","onClick"]);this.drawPlugin=a,this.floatToolbar=new h.default((0,o.default)((0,o.default)({items:[],contextMenu:g.DefaultContextMenu},d),{onChange:function(e,t){n.changeHandler(e,t),null==r||r(e,t)},onClick:function(e){n.clickHandler(e),null==i||i(e)}})),this.register()}return(0,d.default)(e,[{key:"getOpData",value:function(e){var t=this.drawPlugin.opsManager;if(t.drawOpsOfPage.hasOwnProperty(e)){var n=t.drawOpsOfPage[e].data;return n.hasGroup=this.drawPlugin.room.currBoard.currPage.idToGroup.has(e),n}return null}},{key:"getClientBoundRect",value:function(e){var t=this.drawPlugin,n=t.camera,a=t.container.containerRect,r=n.convertWorldPointInContainer(e.sx,e.sy);return{x:r[0]+(null==a?void 0:a.x),y:r[1]+(null==a?void 0:a.y),width:e.w*n.scale,height:e.h*n.scale}}},{key:"register",value:function(){var e=this;x.isMobile||(this.drawPlugin.opsManager.hooks.selectChange.tap("ToolbarChange",(function(t,n){e.delayShow(),e.syncData(n)})),this.drawPlugin.on("event:textEditor:show",(function(){e.syncData(e.selectedOpIds,{editText:!0}),e.isShow?e.updateToolbarPosAndShow(e.selectedOpIds):e.delayShow()})),this.drawPlugin.on("event:mousedown",(function(){e.isMouseDown=!0,e.delayHide()})),this.drawPlugin.on("event:mouseup",(function(){e.isMouseDown=!1,clearTimeout(e.delayTimer),e.isShow||e.delayShow()})),this.drawPlugin.on("event:camera:transform",(function(){e.delayShow({isHide:!0})})),this.drawPlugin.opsManager.hooks.opAdd.tap("ToolbarOpAdd",this.onSnapshotAdd))}},{key:"setItems",value:function(e,t){for(var n=this,o=[],s=I.slice(),l=["pen","pen-arrow","line","line-arrow"],c={},d=!1,p=!1,h=!1,f=!!t&&t.editText,m=!1,M=!1,x=[],b=0;b<e.length;b++){var k=-1!==l.indexOf(e[b].type)?"pen":e[b].type;if(c[k]=(c[k]||0)+1,e[b].hasGroup?m=!0:M=!0,"audio"!==k&&"video"!==k||1!==e.length||(s=s.filter((function(e){return"copyToClipboard"!==e.optionName&&"copy"!==e.optionName}))),"link"===k?(d=!0,e[b].text&&(e[b].text.arr||[]).length>0&&(f=!0)):p=!0,"shape"===k&&e[b].text&&(e[b].text.value||"").length>0&&(f=!0),"text"===k&&(h=!0,f=!0),0===b)o=(w[k]||[]).slice();else if(-1===x.indexOf(k)){x.push(k);for(var T=(w[k]||[]).slice(),_=o.length-1;_>=0;_--)-1===T.indexOf(o[_])&&o.splice(_,1)}}e.length>1&&(M&&o.push("group"),m&&o.push("ungroup"),(M||m)&&o.push("divider")),(0,i.default)(c).length>1&&(o=["selectFilter","divider"].concat((0,u.default)(o))),1!==e.length&&(0,v.arrayRemove)(o,["typeChange","resDownload","imgCrop","addT"]),1===e.length&&"link"===e[0].type&&e[0].text.arr.length>=7&&(0,v.arrayRemove)(o,["addT"]),d&&p&&(0,v.arrayRemove)(o,["fontSize"]),f||(0,v.arrayRemove)(o,["fontSize","fontFamily","textAlign","fontStroke","fontFill"]);for(var C=o.length-1;C>=0;C--)("divider"===o[C]&&"divider"===o[C-1]||0===C&&"divider"===o[C])&&o.splice(C,1);var N=o.map((function(t){var a,o,s,u,l,p=g.DEFAULT_TOOL_MAP[t],f=e[0],v="text"===f.type?f.stroke:null===(a=f.text)||void 0===a?void 0:a.stroke;v=v||"rgb(0,0,0)";var m="text"===f.type?f.fill:null===(o=f.text)||void 0===o?void 0:o.fill;switch(t){case"selectFilter":p.value="",p.options=(0,i.default)(c).map((function(e){return{type:e,count:c[e]}}));break;case"lineWidth":p.value=f.lineWidth||5;break;case"stroke":p.value={color:f.stroke},p.hasNull=!0;break;case"lineProp":p.value={lineWidth:f.lineWidth||5,color:f.stroke},p.hasNull=!0;break;case"fill":p.value={color:f.fill};break;case"fontSize":p.value=f.fontSize||((null===(s=f.text)||void 0===s?void 0:s.fontSize)?f.text.fontSize:32),d&&(p.max=88);break;case"fontStroke":p.value={color:v};break;case"fontFamily":p.value="object"===(0,r.default)(f.text)?f.text.fontFamily:f.fontFamily,p.options=n.drawPlugin.getFontFamilies().map((function(e){return{value:e.fontName||e.displayName,label:e.displayName}}));break;case"fontFill":p.value={color:m};break;case"textAlign":p.value={textAlign:f.textAlign||((null===(u=f.text)||void 0===u?void 0:u.textAlign)?f.text.textAlign:"left"),verticalAlign:f.verticalAlign||((null===(l=f.text)||void 0===l?void 0:l.verticalAlign)?f.text.verticalAlign:"top")},p.hasVAlign=!h;break;case"linkType":p.value=f.linkType;break;case"linkArrow":f.start.aType===y.IArrowType.Arrow&&f.end.aType===y.IArrowType.Arrow?p.value=3:f.start.aType===y.IArrowType.Arrow?p.value=1:f.end.aType===y.IArrowType.Arrow?p.value=2:p.value=0;break;case"typeChange":var M=n.drawPlugin.shapeManager.getFloatShapes(),x="shape"===f.type?f.shape:f.type;p.value=x,p.shapeIcons=M}return p}));this.floatToolbar.setItems((0,a.default)(N)),this.floatToolbar.setContextMenuOptions(s)}}]),e}(),k={getInstance:function(e){return new b(e).floatToolbar}};t.default=k},function(e,t,n){e.exports={default:n(368),__esModule:!0}},function(e,t,n){n(369),e.exports=n(8).Object.values},function(e,t,n){var a=n(10),r=n(370)(!1);a(a.S,"Object",{values:function(e){return r(e)}})},function(e,t,n){var a=n(21),r=n(49),i=n(41),o=n(61).f;e.exports=function(e){return function(t){for(var n,s=i(t),u=r(s),l=u.length,c=0,d=[];l>c;)n=u[c++],a&&!o.call(s,n)||d.push(e?[n,s[n]]:s[n]);return d}}},function(e,t,n){e.exports={default:n(372),__esModule:!0}},function(e,t,n){n(373),e.exports=n(8).Number.isNaN},function(e,t,n){var a=n(10);a(a.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){n(134),e.exports=n(8).Object.getOwnPropertySymbols},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(5)),r=l(n(0)),i=l(n(1)),o=l(n(107)),s=l(n(6)),u=l(n(376));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof o.default){var r=0;for(a=(0,o.default)(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},d=function(){function e(t){(0,r.default)(this,e),this.domid=Math.random()+"",this.ref=s.default.createRef(),this._container=null;var n=null!=t?t:{},i=n.container,o=c(n,["container"]);this.floatToolBar=s.default.createElement(u.default,(0,a.default)({},o,{ref:this.ref})),this.container=null!=i?i:null}return(0,i.default)(e,[{key:"show",value:function(e){var t;null===(t=this.toolbar)||void 0===t||t.show(e)}},{key:"hide",value:function(){var e;null===(e=this.toolbar)||void 0===e||e.show(!1)}},{key:"setItems",value:function(e){var t;null===(t=this.toolbar)||void 0===t||t.setItems(e)}},{key:"setContextMenuOptions",value:function(e){var t;null===(t=this.toolbar)||void 0===t||t.setContextMenuOptions(e)}},{key:"addOrSetTool",value:function(){}},{key:"render",value:function(){this.container&&s.default.render(this.floatToolBar,this.container)}},{key:"unRender",value:function(){if(this.container){var e=this.domNode;e&&s.default.render(null,this.container,e)}}},{key:"toolbar",get:function(){return this.ref.current}},{key:"domNode",get:function(){return this.container?this.container.querySelector("[data-domid='"+this.domid+"']"):null}},{key:"container",get:function(){return this._container},set:function(e){this.container!==e&&(this.unRender(),this._container=e,this.render())}},{key:"isShow",get:function(){var e,t;return null!==(t=null===(e=this.toolbar)||void 0===e?void 0:e.isShow)&&void 0!==t&&t}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=k(n(5)),r=k(n(2)),i=k(n(0)),o=k(n(1)),s=k(n(3)),u=k(n(4)),l=k(n(107)),c=k(n(6)),d=n(377),p=n(59),h=n(388),f=n(249),g=n(395),v=n(400),y=n(404),m=n(413),M=n(419),x=n(425),w=n(426),I=n(429),b=n(434);function k(e){return e&&e.__esModule?e:{default:e}}var T=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof l.default){var r=0;for(a=(0,l.default)(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},_={Click:p.ClickItem,Input:h.InputItem,Slider:f.SliderItem,TextAlign:y.TextAlign,LinkType:m.LinkType,LinkArrow:M.LinkArrow,TypeChange:x.TypeChange,LineProp:g.LineProp,Divider:b.Divider,Select:w.Select,SelectFilter:I.SelectFilter},C=function(e){function t(){var e,n,a;(0,i.default)(this,t);var o=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return o.state={openItem:void 0,isShow:null!==(e=o.props.isShow)&&void 0!==e&&e,items:null!==(n=o.props.items)&&void 0!==n?n:[],contextMenu:null!==(a=o.props.contextMenu)&&void 0!==a?a:{},boundRect:{x:0,y:0,width:0,height:0}},o.setOpenItem=function(e){o.setState({openItem:e})},o}return(0,u.default)(t,e),(0,o.default)(t,[{key:"initClickItem",value:function(e){var t=this,n=e.toolType,r=e.onClick,i=T(e,["toolType","onClick"]),o=_[n];return c.default.createElement(o,(0,a.default)({onClick:function(e){var n,a;null===(a=(n=t.props).onClick)||void 0===a||a.call(n,e),null==r||r(e)}},i))}},{key:"initValuedItem",value:function(e){var t=this,n=e.toolType,r=e.onChange,i=T(e,["toolType","onChange"]),o=_[n];return c.default.createElement(o,(0,a.default)({onChange:function(n,a){var i,o;null===(o=(i=t.props).onChange)||void 0===o||o.call(i,n,a),null==r||r(n,a),"value"in e&&(e.value=n.value,t.forceUpdate()),t.setState({openItem:void 0})}},i))}},{key:"initCommonItem",value:function(e){var t=this,n=e.toolType,r=e.onChange,i=T(e,["toolType","onChange"]),o=_[n];return c.default.createElement(o,(0,a.default)({onChange:function(n,a){var i,o;null===(o=(i=t.props).onChange)||void 0===o||o.call(i,n,a),null==r||r(n),e.value=n.value,t.forceUpdate()}},i))}},{key:"initItems",value:function(e){var t=this,n=[];return e.forEach((function(e){e.openItem=t.state.openItem,e.onToolClick=function(e){t.setState({openItem:e.toolName===t.state.openItem?void 0:e.toolName})},"Click"===e.toolType?n.push(t.initClickItem(e)):-1!==["Input","Slider","Select","SelectFilter"].indexOf(e.toolType)?n.push(t.initValuedItem(e)):"Divider"===e.toolType?n.push(c.default.createElement(b.Divider,null)):-1!==["TextAlign","LinkType","LinkArrow","TypeChange","LineProp"].indexOf(e.toolType)&&n.push(t.initCommonItem(e))})),n}},{key:"render",value:function(){var e=this.props,t=(e.onClick,e.onChange,T(e,["onClick","onChange"]));return c.default.createElement(d.Toolbar,(0,a.default)({},t,{unrendered:!this.isShow,items:this.items,contextMenu:this.contextMenu,boundRect:this.state.boundRect,setOpenItem:this.setOpenItem}))}},{key:"show",value:function(e){!1===e?this.setState({isShow:!1}):this.setState({isShow:!0,boundRect:e})}},{key:"setItems",value:function(e){this.setState({items:e,openItem:void 0})}},{key:"setContextMenuOptions",value:function(e){this.setState({contextMenu:(0,a.default)((0,a.default)({},this.state.contextMenu),{options:e})})}},{key:"items",get:function(){return this.initItems(this.state.items)}},{key:"contextMenu",get:function(){var e=this,t=this.state.contextMenu,n=t.onClick,r=T(t,["onClick"]);return c.default.createElement(v.ContextMenu,(0,a.default)({openItem:this.state.openItem,onToolClick:function(t){e.setState({openItem:t.toolName===e.state.openItem?void 0:t.toolName})},onClick:function(t){var a,r;null===(r=(a=e.props).onClick)||void 0===r||r.call(a,t),null==n||n(t),e.setState({openItem:void 0})}},r))}},{key:"isShow",get:function(){return this.state.isShow}}]),t}(c.default.Component);t.default=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Toolbar=void 0;var a=h(n(19)),r=h(n(5)),i=h(n(2)),o=h(n(0)),s=h(n(1)),u=h(n(3)),l=h(n(4)),c=h(n(25)),d=h(n(6)),p=n(248);function h(e){return e&&e.__esModule?e:{default:e}}n(378);t.Toolbar=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.ref=d.default.createRef(),e.containerRef=d.default.createRef(),e.state=(0,r.default)((0,r.default)({},(0,c.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"state",e)),{left:0,top:0,tbAlign:"up"}),e.mousedown=function(t){for(var n=t.target;n;){if(n===e.ref.current)return;n=n.parentNode}e.props.setOpenItem(void 0)},e}return(0,l.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){window.addEventListener("mousedown",this.mousedown,{capture:!0})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousedown",this.mousedown,{capture:!0})}},{key:"propsFilter",value:function(){(0,c.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"propsFilter",this).call(this,["className","style","items","contextMenu","boundRect"])}},{key:"componentDidUpdate",value:function(e){var t=this.props.unrendered,n=this.pickedProps.boundRect;if((e.unrendered!==t||e.boundRect!==n)&&!t&&n){var a=this.ref.current;if(a){var r=a.parentElement;if(r){var i=r.getBoundingClientRect(),o=a.getBoundingClientRect();o.height*=1.4;var s,u,l,c,d,p={left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,width:n.width,height:n.height},h=Math.max(p.top,i.top),f=p.left+.5*(p.width-o.width),g=!1,v="up";if(h-o.height>=i.top?(h-=o.height,v="up"):p.bottom+o.height<i.bottom?(s=p.bottom+.2*o.height,u=i.bottom+o.height,l=i.top,(c=u)>(d=l)&&(d=u,c=l),h=s<c?c:s>d?d:s,v="down"):g=!0,g)if(p.right+o.width<i.right)f=p.right;else if(p.left-o.width>i.left)f=p.left-o.width;else{f=p.left+.5*p.width<i.left+.5*i.width?i.right-o.width:i.left}else i.width<o.width||f<i.left?f=i.left:f+o.width>i.right&&(f=i.right-o.width);this.setState({left:f-i.left,top:h-i.top,tbAlign:v})}}}}},{key:"innerStyle",get:function(){var e=this.state,t=e.top;return{pointerEvents:"all",position:"absolute",left:e.left+"px",top:t+"px"}}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.className,i=t.style,o=t.items,s=t.contextMenu;o=[].concat((0,a.default)(null!=o?o:[])),s&&o.push(s);for(var u=[],l=0,c=(o=o.map((function(t){return d.default.cloneElement(t,{tbAlign:e.state.tbAlign})}))).length-1;l<=c;l++)u.push(o[l]);var p=u.length?u:d.default.createElement("span",{className:"tip"},"工具栏未设置");return d.default.createElement("div",{className:"yunxin-whiteboard-float",style:{position:"absolute",pointerEvents:"none"},ref:this.containerRef},d.default.createElement("div",(0,r.default)({className:"toolbar"+(n?" "+n:""),style:(0,r.default)((0,r.default)({},i),this.innerStyle)},this.nativeProps,{ref:this.ref}),p))}}]),t}(p.FloatComponent)},function(e,t,n){var a=n(379);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n}\n    .yunxin-whiteboard-float .toolbar{\n        position: absolute;\n        display: flex;\n        align-items: center;\n        background-color: white; \n        box-shadow: rgba(5, 0, 50, 0.14) 0px 4px 16px 0;\n        border-radius: 4px; \n        padding: 0 8px;\n        grid-gap: 8px;\n        gap: 8px;\n        height: 50px;\n    }\n    .yunxin-whiteboard-float .toolbar .tip{\n            color: #9d9d9d; font-size: 13px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\n            padding: 2px;\n        }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Hint=void 0;var a=l(n(2)),r=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(6));function l(e){return e&&e.__esModule?e:{default:e}}n(381);t.Hint=function(e){function t(){var e;(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return n.state={isShow:null!==(e=n.props.isShow)&&void 0!==e&&e,showTransClasss:!1},n.transTimeout=null,n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"componentDidUpdate",value:function(e){var t,n=this;if(e.isShow!==this.props.isShow){clearTimeout(this.transTimeout);var a=null!==(t=this.props.isShow)&&void 0!==t&&t;a?this.transTimeout=setTimeout((function(){n.setState({isShow:a},(function(){setTimeout((function(){n.setState({showTransClasss:!0})}),1e3/30)}))}),500):(this.setState({showTransClasss:!1}),this.transTimeout=setTimeout((function(){n.setState({isShow:a})}),500))}}},{key:"render",value:function(){var e=this.props.hint;return this.state.isShow?u.default.createElement("div",{className:"hint arrow-down"+(this.state.showTransClasss?" default-hint-trans":"")},u.default.createElement("span",{className:"default-hint-text"},null!=e?e:"No Hint")):null}}]),t}(u.default.Component)},function(e,t,n){var a=n(382);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .hint{\n        position: absolute;\n        width: 0;\n        height: 0;\n        left: 50%;\n        bottom: 50%;\n        transform: translate(0, -24px);\n        font-size: 14px;\n        color: white;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: flex-end;\n        opacity: 0;\n        transition: opacity 0.5s;\n    }\n        .yunxin-whiteboard-float .hint .default-hint-text{\n            background-color: rgb(32, 32, 32);\n            padding: 0.5em 1em;\n            border-radius: 0.25em;\n            white-space: nowrap;\n            z-index: 1;\n        }\n    .yunxin-whiteboard-float .arrow-down::after{\n        content: ' ';\n        border-width: 0.5em 0.5em 0;\n        border-style:solid;\n        border-color:rgb(32, 32, 32) transparent transparent ;\n    }\n    .yunxin-whiteboard-float .default-hint-trans{\n        opacity: 1;\n    }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjQ3MzExNjY4ODA1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjcyOTAiIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTI1OS42NTUxMTEgNDkwLjE1NDY2N2wtNDQuNjU3Nzc4IDQ0LjYyOTMzM0MxMzIuODM1NTU2IDYxNC4zNTczMzMgMTE3Ljg1OTU1NiA2OTcuNDU3Nzc4IDE3MS42NjIyMjIgNzc1LjA1NDIyMmExNC4xOTM3NzggMTQuMTkzNzc4IDAgMCAwIDE5Ljc5NzMzNCAzLjYyNjY2N2M2LjQ0MjY2Ny00LjUwODQ0NCA4LjA0OTc3OC0xMy4zNjg4ODkgMy41ODQtMTkuODI1Nzc4LTQ1LjQ0LTY1LjUzNi0zMi4wNzExMTEtMTM0LjA4NzExMSAzOS45MjE3NzctMjAzLjgwNDQ0NGw0NC44LTQ0Ljc4NTc3OGExNC4yMDggMTQuMjA4IDAgMSAwLTIwLjExMDIyMi0yMC4xMTAyMjJ6TTIyMC43MTQ2NjcgNzkxLjgzNjQ0NGExNC4yMDggMTQuMjA4IDAgMSAwLTIwLjA5NiAyMC4xMTAyMjNsNi42NDE3NzcgNi42MTMzMzNhMTQuMjIyMjIyIDE0LjIyMjIyMiAwIDAgMCAyMC4wOTYtMjAuMTEwMjIybC02LjY0MTc3Ny02LjYxMzMzNHpNNTc3LjU3ODY2NyA0MjUuNjI4NDQ0bC01MC4yNzU1NTYgNTAuMzA0YTE0LjIwOCAxNC4yMDggMCAxIDAgMjAuMTEwMjIyIDIwLjExMDIyM2w1MC4yNzU1NTYtNTAuMzA0YTE0LjIwOCAxNC4yMDggMCAxIDAtMjAuMTEwMjIyLTIwLjExMDIyM3oiIGZpbGw9IiIgcC1pZD0iNzI5MSI+PC9wYXRoPjxwYXRoIGQ9Ik05NTEuMTUzNzc4IDQzLjYzMzc3OGEyOC41MTU1NTYgMjguNTE1NTU2IDAgMCAwLTM1LjExNDY2NyAxOS42NDA4ODljLTAuMjEzMzMzIDAuNzY4LTIyLjE1ODIyMiA3Ni4wNzQ2NjctODguMTc3Nzc4IDEwOC41NDQtNjEuOTIzNTU2IDMwLjQ3ODIyMi05MS44MzI4ODkgNjcuNTI3MTExLTEwNi4yOTY4ODkgOTcuNjc4MjIyYTI4Mi41OTU1NTYgMjgyLjU5NTU1NiAwIDAgMC0xODQuMTkyLTY3Ljc2ODg4OSAyODMuMDIyMjIyIDI4My4wMjIyMjIgMCAwIDAtMjAxLjQ3MiA4My40NTZMMTM1LjQ1MjQ0NCA0ODUuNjMyYy0xMTEuMTA0IDExMS4xMDQtMTExLjEwNCAyOTEuODY4NDQ0IDAgNDAyLjk1ODIyMmw5LjM1ODIyMyA5LjM1ODIyMmM1My44MTY4ODkgNTMuODMxMTExIDEyNS4zNjg4ODkgODMuNDcwMjIyIDIwMS40ODYyMjIgODMuNDcwMjIzczE0Ny42NTUxMTEtMjkuNjM5MTExIDIwMS40ODYyMjItODMuNDcwMjIzTDc0OC4yMzExMTEgNjk3LjUwMDQ0NGMxMDQuODMyLTEwNC44MzIgMTEwLjYyMDQ0NC0yNzEuNjQ0NDQ0IDE3LjU5Mjg4OS0zODMuNDczNzc3IDIuODcyODg5LTE2LjI5ODY2NyAxNy4xMDkzMzMtNTYuNjc1NTU2IDg3LjE1Mzc3OC05MS4xNTAyMjMgODguNTE5MTExLTQzLjU0ODQ0NCAxMTYuNjY0ODg5LTE0MC4wNDYyMjIgMTE3LjgxNjg4OS0xNDQuMTI4YTI4LjQ0NDQ0NCAyOC40NDQ0NDQgMCAwIDAtMTkuNjQwODg5LTM1LjExNDY2NnpNNTA3LjU0ODQ0NCA4NTcuNzI4YTIyNi41MTczMzMgMjI2LjUxNzMzMyAwIDAgMS0xNjEuMjUxNTU1IDY2LjgwMTc3OCAyMjYuNTYgMjI2LjU2IDAgMCAxLTE2MS4yNjU3NzgtNjYuODAxNzc4bC05LjM1ODIyMi05LjM1ODIyMmMtODguOTE3MzMzLTg4LjkxNzMzMy04OC45MTczMzMtMjMzLjYxNDIyMiAwLTMyMi41MzE1NTZMMzI2LjIwMDg4OSAzNzUuMzI0NDQ0YzM1LjI1Njg4OSA2Ni4yMDQ0NDQgMTMzLjY0NjIyMiAyMTkuNzkwMjIyIDMzMi44NDI2NjcgMzMwLjkwODQ0NUw1MDcuNTQ4NDQ0IDg1Ny43Mjh6IG0yMDAuNDE5NTU2LTIwMC40NDhsLTI4LjAwMzU1NiAyOC4wMTc3NzhjLTIwMy45NDY2NjctMTExLjUxNjQ0NC0zMDIuMjUwNjY3LTI3My4wNjY2NjctMzMyLjUyOTc3Ny0zMzEuMjA3MTExbDI4LjY4NjIyMi0yOC42ODYyMjNhMjI2LjU2IDIyNi41NiAwIDAgMSAxNjEuMjM3MzMzLTY2Ljc4NzU1NWM2MC45MTM3NzggMCAxMTguMjAwODg5IDIzLjcyMjY2NyAxNjEuMjY1Nzc4IDY2Ljc4NzU1NWw5LjM0NCA5LjM1ODIyM2M4OC45MzE1NTYgODguOTE3MzMzIDg4LjkzMTU1NiAyMzMuNiAwIDMyMi41MTczMzN6IiBmaWxsPSIiIHAtaWQ9IjcyOTIiPjwvcGF0aD48L3N2Zz4="},function(e,t,n){var a=n(385);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .item{\n        display: flex;\n        align-items: center;\n        height: -webkit-fit-content;\n        height: -moz-fit-content;\n        height: fit-content;\n        width: -webkit-fit-content;\n        width: -moz-fit-content;\n        width: fit-content;\n        grid-column-gap: 2px;\n        -moz-column-gap: 2px;\n             column-gap: 2px;\n        padding: 4px;\n        background-color: transparent;\n    }\n        .yunxin-whiteboard-float .item .text{\n            font-size: 16px;\n            color: rgb(64, 64, 64);\n            transition: color 0.3s;\n        }\n        .yunxin-whiteboard-float .item .icon{\n            display: block;\n            font-size: 18px;\n            -webkit-mask-position: center;\n                    mask-position: center;\n            -webkit-mask-size: contain;\n                    mask-size: contain;\n            -webkit-mask-repeat: no-repeat;\n                    mask-repeat: no-repeat;\n            background-color:rgb(64, 64, 64);\n            transition: background-color 0.3s;\n        }\n@media (any-hover: hover) {\n        .yunxin-whiteboard-float .item:hover{\n            cursor: pointer;\n        }\n            .yunxin-whiteboard-float .item:hover .text{\n                font-size: 16px;\n                color: black;\n                transition: color 0.3s;\n            }\n            .yunxin-whiteboard-float .item:hover .icon{\n                background-color: black;\n            }\n    }\n.yunxin-whiteboard-float .item:active .icon{\n            background-color: black;\n        }\n.yunxin-whiteboard-float .item-disabled{\n        cursor: not-allowed !important;\n        background-color: transparent !important;\n        opacity: 0.5 !important;\n    }\n.yunxin-whiteboard-float .item-disabled >*{\n            cursor: not-allowed !important;\n        }",""])},function(e,t,n){var a=n(387);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .click-item{\n        font-family: inherit;\n        margin: 0;\n        border: none;\n        outline: none;\n    }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputItem=void 0;var a=v(n(5)),r=v(n(2)),i=v(n(0)),o=v(n(1)),s=v(n(3)),u=v(n(4)),l=v(n(25)),c=n(6),d=v(c),p=n(40),h=n(59),f=v(n(389)),g=v(n(390));function v(e){return e&&e.__esModule?e:{default:e}}n(391);t.InputItem=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.state=(0,a.default)((0,a.default)({},(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"state",e)),{isFocus:!1}),e.ref=(0,c.createRef)(),e.changeHandler=function(t){var n=e.pickedProps,a=n.onChange,r=n.toolName,i=n.type,o=n.max,s=n.value,u=Number(t.target.value);"number"===i&&(""!==t.target.value&&isNaN(u)||""!==t.target.value&&o&&u>o?null==a||a({type:"change",target:t.target,toolName:r,value:s||""}):null==a||a({type:"change",target:t.target,toolName:r,value:t.target.value}),e.forceUpdate())},e.stepHandler=function(t){var n,a=e.pickedProps.value,r=e.ref.current;if(r){var i=Number((null!==(n=e.nativeProps.step)&&void 0!==n?n:0)+"")||1,o=Number((null!=a?a:r.value||0)+"")+t*i;o=1===t?Math.floor(o/i)*i:Math.ceil(o/i)*i,r.value=e.clampNumVal(o),r.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))}},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["type","onChange","min","max","maxLength"],{type:"text",icon:void 0,value:void 0})}},{key:"clampNumVal",value:function(e){var t=this.pickedProps,n=t.type,a=t.min,r=t.max;if("number"!==n)return e;if(void 0===a&&void 0===r)return e;if((a=Number(a+""))>(r=Number(r+""))){var i=[r,a];a=i[0],r=i[1]}var o=Number(e+"");return o<a?a:o>r?r:o}},{key:"defaultClassNames",get:function(){return(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"defaultClassNames",this).concat("input-item")}},{key:"defaultStyle",get:function(){return(0,a.default)((0,a.default)({},(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"defaultStyle",this)),{pointerEvents:"none"})}},{key:"inputStyle",get:function(){return{pointerEvents:"all"}}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.type,r=t.value,i=t.disabled;if(""!==r){var o=Number(r);isNaN(o)||(r=Math.ceil(o))}return d.default.createElement("label",(0,a.default)({className:this.className,style:this.style},this.state.isFocus?{}:this.hoverProps),this.itemChildren,d.default.createElement("input",(0,a.default)({type:"text",style:this.inputStyle},void 0!==r?{value:r}:{},{disabled:i},this.nativeProps,{ref:this.ref,onChange:this.changeHandler,onInput:this.changeHandler,onFocus:function(){e.setState({isFocus:!0}),e.isHover=!1},onBlur:function(){e.setState({isFocus:!1})}})),"number"===n?d.default.createElement("div",{className:"default-number-input-buttons"},d.default.createElement(h.ClickItem,{icon:f.default,onClick:function(){e.stepHandler(1)},disabled:i}),d.default.createElement(h.ClickItem,{icon:g.default,onClick:function(){e.stepHandler(-1)},disabled:i})):null)}}]),t}(p.Item)},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjQ3NDgxODc5MDUxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIzMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTU0MS44NjY2NjcgMjg1Ljg2NjY2N2wzNDUuNiAzNDUuNmMxNy4wNjY2NjcgMTcuMDY2NjY3IDE3LjA2NjY2NyA0Mi42NjY2NjcgMCA1OS43MzMzMzMtOC41MzMzMzMgOC41MzMzMzMtMTkuMiAxMi44LTI5Ljg2NjY2NyAxMi44SDE2OC41MzMzMzNjLTIzLjQ2NjY2NyAwLTQyLjY2NjY2Ny0xOS4yLTQyLjY2NjY2Ni00Mi42NjY2NjcgMC0xMC42NjY2NjcgNC4yNjY2NjctMjEuMzMzMzMzIDEyLjgtMjkuODY2NjY2bDM0My40NjY2NjYtMzQ1LjZjMTcuMDY2NjY3LTE3LjA2NjY2NyA0Mi42NjY2NjctMTcuMDY2NjY3IDU5LjczMzMzNCAweiIgcC1pZD0iMjMzMyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjQ3NDgxODY5NTI0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxODgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTQ4Mi4xMzMzMzMgNzM4LjEzMzMzM0wxMzYuNTMzMzMzIDM5Mi41MzMzMzNjLTE3LjA2NjY2Ny0xNy4wNjY2NjctMTcuMDY2NjY3LTQyLjY2NjY2NyAwLTU5LjczMzMzMyA4LjUzMzMzMy04LjUzMzMzMyAxOS4yLTEyLjggMjkuODY2NjY3LTEyLjhoNjg5LjA2NjY2N2MyMy40NjY2NjcgMCA0Mi42NjY2NjcgMTkuMiA0Mi42NjY2NjYgNDIuNjY2NjY3IDAgMTAuNjY2NjY3LTQuMjY2NjY3IDIxLjMzMzMzMy0xMi44IDI5Ljg2NjY2Nkw1NDEuODY2NjY3IDczOC4xMzMzMzNjLTE3LjA2NjY2NyAxNy4wNjY2NjctNDIuNjY2NjY3IDE3LjA2NjY2Ny01OS43MzMzMzQgMHoiIHAtaWQ9IjIxODkiPjwvcGF0aD48L3N2Zz4="},function(e,t,n){var a=n(392);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .input-item input{\n            background-color: transparent;\n            border: none;\n            padding: none;\n            outline: 1px solid rgb(164, 164, 164);\n            height: -webkit-fit-content;\n            height: -moz-fit-content;\n            height: fit-content;\n            font-family: inherit;\n            width: 40px;\n            text-align: center;\n            font-size: 14px;\n            border-radius: 3px;\n        }\n        .yunxin-whiteboard-float .input-item input:focus{\n            border: none;\n            padding: none;\n        }\n        .yunxin-whiteboard-float .input-item input::-webkit-outer-spin-button,\n        .yunxin-whiteboard-float .input-item input::-webkit-inner-spin-button {\n            -webkit-appearance: none;\n            margin: 0;\n        }\n        .yunxin-whiteboard-float .input-item input[type=number]{\n            -webkit-appearance: textfield;\n               -moz-appearance: textfield;\n                    appearance: textfield;\n        }\n        .yunxin-whiteboard-float .input-item .default-number-input-buttons{\n            display: flex;\n            flex-direction: column;\n            margin-left: 4px;\n        }\n        .yunxin-whiteboard-float .input-item .default-number-input-buttons button{\n                pointer-events: all;\n                background-color: transparent;\n                padding: 0;\n            }\n        .yunxin-whiteboard-float .input-item .default-number-input-buttons button .icon{\n                    font-size: 14px;\n                }",""])},function(e,t,n){var a=n(394);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .slider-item input,#yunxin-whiteboard-toolCollection .slider-item input{\n            -webkit-appearance: none;\n            -moz-appearance: none;\n                 appearance: none;\n            border: none;\n            outline: none;\n            padding: none;\n            margin: 0;\n            width: 80px;\n            cursor: pointer;\n        }\n        .yunxin-whiteboard-float .slider-item input[type='range']::-webkit-slider-runnable-track,#yunxin-whiteboard-toolCollection .slider-item input[type='range']::-webkit-slider-runnable-track{\n            background-color: rgb(200, 200, 200);\n            height: 6px;\n            border-radius: 8px;\n        }\n        .yunxin-whiteboard-float .slider-item input[type=range]::-moz-range-track, #yunxin-whiteboard-toolCollection .slider-item input[type=range]::-moz-range-track {\n            background-color: rgb(200, 200, 200);\n            height: 6px;\n            border-radius: 8px;\n        }\n        .yunxin-whiteboard-float .slider-item input[type='range']::-webkit-slider-thumb,#yunxin-whiteboard-toolCollection .slider-item input[type='range']::-webkit-slider-thumb{  \n            -webkit-appearance: none;\n            height: 18px;\n            width: 18px;\n            margin-top: -6px;\n            border-radius: 50%;\n            background: black;\n            border: 1px solid rgb(200, 200, 200);\n            padding: 0;\n            outline: none;\n        }\n        .yunxin-whiteboard-float .slider-item input[type='range']::-moz-range-thumb,#yunxin-whiteboard-toolCollection .slider-item input[type='range']::-moz-range-thumb{\n            height: 16px;\n            width: 16px;\n            border-radius: 50%;\n            background: black;\n            border: 1px solid rgb(200, 200, 200);\n            outline: none;\n            padding: 0;\n        }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineProp=void 0;var a=x(n(5)),r=x(n(2)),i=x(n(0)),o=x(n(1)),s=x(n(3)),u=x(n(4)),l=x(n(25)),c=x(n(6)),d=n(40),p=n(59),h=n(100),f=n(60),g=n(249),v=n(250),y=x(n(398)),m=x(n(399)),M=x(n(251));function x(e){return e&&e.__esModule?e:{default:e}}t.LineProp=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.state=(0,a.default)((0,a.default)({},(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"state",e)),{color:void 0,opacity:1}),e.widthChangeHandler=function(t){var n=e.pickedProps,r=n.onChange,i=n.toolName;null==r||r({type:t.type,target:t.target,toolName:i,value:(0,a.default)((0,a.default)({},e.props.value||{}),{lineWidth:t.value})})},e.colorChangeHandler=function(t){var n=e.pickedProps,r=n.onChange,i=n.toolName,o=t.value?(0,v.mixColorAndOpacity)(t.value,e.state.opacity):"";null==r||r({type:t.type,target:t.target,toolName:i,value:(0,a.default)((0,a.default)({},e.props.value||{}),{color:o})})},e.opacityChangeHandler=function(t,n){var r=e.pickedProps,i=r.onChange,o=r.toolName;if(e.state.color){var s=e.state.color,u=(0,v.mixColorAndOpacity)("rgb("+s.r+", "+s.g+", "+s.b+")",t.value);null==i||i({type:t.type,target:t.target,toolName:o,value:(0,a.default)((0,a.default)({},e.props.value||{}),{color:u})},n)}},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange","colorStyle","value","colors","panelOffset","opacity","openItem","tbAlign"],{colorStyle:"background",colors:[],panelOffset:{x:0,y:0},tbAlign:"up",hasNull:!0,hasLineWidth:!1})}},{key:"componentDidMount",value:function(){this.setInitialState(this.props.value.color)}},{key:"componentWillReceiveProps",value:function(e){this.setInitialState(e.value.color)}},{key:"setInitialState",value:function(e){var t=(0,v.getRGBvalues)(e),n=e?t&&"number"==typeof t.a&&!isNaN(t.a)?t.a:1:this.state.opacity?this.state.opacity:1;this.setState({opacity:n,color:t?{r:t.r,g:t.g,b:t.b}:t})}},{key:"renderFontFillIcon",value:function(){var e=this.props.value.color;return c.default.createElement("div",{style:{width:"24px",height:"18px",background:"url("+M.default+") center center no-repeat",position:"relative",top:-1}},e&&c.default.createElement("div",{style:{width:"100%",height:2,backgroundColor:e,border:"1px solid rgba(0,0,0,.1)",position:"relative",top:18}}))}},{key:"renderFontStrokeIcon",value:function(){var e=this.props.value.color;return c.default.createElement("div",{style:{width:"24px",height:"18px"}},c.default.createElement("span",{style:{fontSize:24,position:"relative",top:-7}},"A"),c.default.createElement("div",{style:{width:"100%",height:2,backgroundColor:e||"black",border:"1px solid rgba(0,0,0,.1)",position:"relative",top:-11}}))}},{key:"renderStrokeIcon",value:function(){var e=this.state.color,t=e&&e.r>245&&e.g>245&&e.b>245?"rgb(245, 245, 245)":this.props.value.color;return t?c.default.createElement("div",{style:{width:"22px",height:"22px",borderRadius:"50%",border:"2px solid "+t}}):c.default.createElement("div",{style:{width:"22px",height:"22px",borderRadius:"50%",opacity:.1,border:"2px dashed black"}})}},{key:"renderFillIcon",value:function(){return this.state.color?c.default.createElement("div",{style:{width:"24px",height:"24px",borderRadius:"50%",backgroundColor:""+this.props.value.color,border:"1px solid rgba(0,0,0,.1)"}}):this.emptyIcon()}},{key:"emptyIcon",value:function(){return c.default.createElement("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:"url("+m.default+") center center no-repeat"}})}},{key:"defaultClassNames",get:function(){return(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"defaultClassNames",this).concat("color-platte")}},{key:"options",get:function(){var e=this,t=this.pickedProps,n=t.toolName,a=t.colors,r=t.panelOffset,i=this.props,o=i.value,s=i.min,u=i.max,l=i.step,d=i.hasLineWidth,p=i.hasNull,m=o.lineWidth,M=[];return a=a||[],(p?[""].concat(a):a).forEach((function(t){var a=(0,v.getRGBvalues)(t),r=!a&&!e.state.color||a&&e.state.color&&a.r===e.state.color.r&&a.b===e.state.color.b&&a.g===e.state.color.g,i=t?{backgroundColor:t}:{background:"url("+y.default+") center center no-repeat"},o=c.default.createElement(h.RadioItem,{className:"radio-item color",name:n,value:t,style:i,checked:r,onChange:e.colorChangeHandler},"");M.push(o)})),c.default.createElement(f.SubsPanel,{style:{maxWidth:144},className:"panel",isShow:this.pickedProps.openItem===n,offset:r,tbAlign:this.pickedProps.tbAlign},c.default.createElement("div",null,d&&c.default.createElement(g.SliderItem,{className:"slider",min:s,max:u,step:l,value:m,onChange:this.widthChangeHandler},c.default.createElement("div",{className:"tips"},c.default.createElement("span",null,"细"),c.default.createElement("span",null,"粗")))),c.default.createElement("div",null,c.default.createElement(g.SliderItem,{className:"slider",min:.1,max:1,step:.01,value:this.state.opacity,onChange:this.opacityChangeHandler},c.default.createElement("div",{className:"tips"},c.default.createElement("span",null,"透明"),c.default.createElement("span",null,"不透明")))),M.length?M:c.default.createElement("span",null,"颜色未设置"))}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.disabled,r=t.hint,i=t.toolName;return c.default.createElement("div",(0,a.default)({className:this.className,style:this.style},this.hoverProps),c.default.createElement(p.ClickItem,{disabled:n,hint:r,onClick:function(){e.props.onToolClick&&e.props.onToolClick({toolName:i})}},("stroke"===i||"lineProp"===i)&&this.renderStrokeIcon(),"fill"===i&&this.renderFillIcon(),"fontStroke"===i&&this.renderFontStrokeIcon(),"fontFill"===i&&this.renderFontFillIcon()),this.options)}}]),t}(d.Item)},function(e,t,n){var a=n(397);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .radio-item input{\n            position: absolute;\n            border: none;\n            outline: none;\n            padding: none;\n            margin: 0;\n            -webkit-appearance: none;\n               -moz-appearance: none;\n                    appearance: none;\n            cursor: pointer;\n        }\n        .yunxin-whiteboard-float .radio-item input:checked ~ .icon{\n                background-color: #1890ff;\n            }\n        .yunxin-whiteboard-float .radio-item input:checked ~ .text{\n                color: #1890ff;\n            }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjUwODcxNjMwMDc3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI2ODciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+QGZvbnQtZmFjZSB7IGZvbnQtZmFtaWx5OiBmZWVkYmFjay1pY29uZm9udDsgc3JjOiB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LndvZmYyP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZjIiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZiIpLCB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LnR0Zj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoInRydWV0eXBlIik7IH0KPC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiAxMjhjLTIxMy4zMzMzMzMgMC0zODQgMTcwLjY2NjY2Ny0zODQgMzg0czE3MC42NjY2NjcgMzg0IDM4NCAzODQgMzg0LTE3MC42NjY2NjcgMzg0LTM4NC0xNzAuNjY2NjY3LTM4NC0zODQtMzg0eiBtMCA0Mi42NjY2NjdjODUuMzMzMzMzIDAgMTY2LjQgMzQuMTMzMzMzIDIyNi4xMzMzMzMgODUuMzMzMzMzTDI1NiA3MzguMTMzMzMzQzIwNC44IDY3OC40IDE3MC42NjY2NjcgNTk3LjMzMzMzMyAxNzAuNjY2NjY3IDUxMmMwLTE4Ny43MzMzMzMgMTUzLjYtMzQxLjMzMzMzMyAzNDEuMzMzMzMzLTM0MS4zMzMzMzN6IG0wIDY4Mi42NjY2NjZjLTg1LjMzMzMzMyAwLTE2Ni40LTM0LjEzMzMzMy0yMjYuMTMzMzMzLTg1LjMzMzMzM0w3NjggMjg1Ljg2NjY2N2M1MS4yIDU5LjczMzMzMyA4NS4zMzMzMzMgMTQwLjggODUuMzMzMzMzIDIyNi4xMzMzMzMgMCAxODcuNzMzMzMzLTE1My42IDM0MS4zMzMzMzMtMzQxLjMzMzMzMyAzNDEuMzMzMzMzeiIgcC1pZD0iMjY4OCIgZmlsbD0iI2JmYmZiZiI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY2MDU1NjIxMDAzMSIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iNzA2MSIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPgogICAgPHBhdGgKICAgICAgICBkPSJNMzYzLjk1MSA2MC42NTZhOCA4IDAgMCAwLTExLjMxNCAwbC0zMy45NDEgMzMuOTRhOCA4IDAgMCAwIDAgMTEuMzE0bDk1Ljg3MyA5NS44NzRMNzUuMTU4IDU0MS4xOTVjLTEyLjQ5NyAxMi40OTctMTIuNDk3IDMyLjc1OCAwIDQ1LjI1NWwzNjIuMDM4IDM2Mi4wMzhjMTIuNDk3IDEyLjQ5NyAzMi43NTggMTIuNDk3IDQ1LjI1NSAwTDg0NC40OSA1ODYuNDVjMTIuNDk3LTEyLjQ5NyAxMi40OTctMzIuNzU4IDAtNDUuMjU1TDM2My45NTEgNjAuNjU1eiBtMTU3LjY5IDI0OC4xOTlsMjU0Ljk2NyAyNTQuOTY3LTAuNzA3IDAuNzA3SDE0My43NDdsLTAuNzA3LTAuNzA3IDMxNi43ODQtMzE2Ljc4NCA2MS44MTIgNjEuODEyYTAuMDEyIDAuMDEyIDAgMCAwIDAuMDA1IDAuMDA1ek05MjggODQ2LjY4N2MwLTQ4LjYzNC01Ny41LTExMi42ODgtNjQtMTI2LjY4OC02IDE0LjUtNjQgODAuMDk0LTY0IDEyNi42ODggMCAzNi4wNjQgMjguNjU0IDY1LjMgNjQgNjUuMyAzNS4zNDYgMCA2NC0yOS4yMzYgNjQtNjUuM3oiCiAgICAgICAgZmlsbD0iIzQwNDA0MCIgcC1pZD0iNzA2MiI+PC9wYXRoPgo8L3N2Zz4="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContextMenu=void 0;var a=g(n(5)),r=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(25)),l=g(n(4)),c=g(n(6)),d=n(40),p=n(59),h=n(60),f=g(n(401));function g(e){return e&&e.__esModule?e:{default:e}}n(402);t.ContextMenu=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.clickHandler=function(t){var n=e.pickedProps,a=n.onClick,r=n.toolName,i=t.toolName;null==a||a({type:t.type,target:t.target,toolName:r,optionName:i})},e}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onClick","options","openItem","panelOffset","tbAlign"],{icon:f.default,options:[],panelOffset:{x:0,y:0},tbAlign:"up"})}},{key:"defaultClassNames",get:function(){return(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"defaultClassNames",this).concat("context-menu")}},{key:"options",get:function(){var e=this,t=this.pickedProps,n=t.options,a=t.panelOffset,r=[];return null==n||n.forEach((function(t){var n=t.text,a=t.hotKeyText,i=t.optionName,o=t.disabled,s=c.default.createElement(p.ClickItem,{className:"menu-option",toolName:i,disabled:o,onClick:e.clickHandler},c.default.createElement("span",{className:"text option-text"},n),a?c.default.createElement("span",{className:"text option-text"},a):null);r.push(s)})),c.default.createElement(h.SubsPanel,{className:"menu-options-panel",isShow:"contextMenu"===this.pickedProps.openItem,offset:a,tbAlign:this.pickedProps.tbAlign},r.length?r:c.default.createElement("span",null,"Options 未设置"))}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.icon,r=t.text,i=t.disabled,o=t.hint;return c.default.createElement("div",(0,a.default)({className:this.className,style:this.style},this.hoverProps),c.default.createElement(p.ClickItem,{icon:null!=n?n:f.default,text:r,disabled:i,hint:o,onClick:function(){e.props.onToolClick&&e.props.onToolClick({toolName:"contextMenu"})}}),this.options)}}]),t}(d.Item)},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjQ3NTc4ODc5NzE0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjU2ODIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiAzNDMuMDRjODcuNjQ0MTYgMCAxNTguNzIgNzEuMDQ1MTIgMTU4LjcyIDE1OC43MiAwIDg3LjY0NDE2LTcxLjA3NTg0IDE1OC43Mi0xNTguNzIgMTU4LjcyLTg3LjY0NDE2IDAtMTU4LjcyLTcxLjA3NTg0LTE1OC43Mi0xNTguNzIgMC04Ny42NzQ4OCA3MS4wNzU4NC0xNTguNzIgMTU4LjcyLTE1OC43MnogbTQxNy4yOCA4MS45MmM0Ni42NDgzMiAwIDg0LjQ4IDM3LjgxMTIgODQuNDggODQuNDggMCA0Ni42NDgzMi0zNy44MzE2OCA4NC40OC04NC40OCA4NC40OFM4NDQuOCA1NTYuMDg4MzIgODQ0LjggNTA5LjQ0YzAtNDYuNjY4OCAzNy44MzE2OC04NC40OCA4NC40OC04NC40OHpNMTc5LjIgNTExLjE0NDk2YzAgNDYuNjUzNDQtMzcuODMxNjggODQuNDgtODQuNDggODQuNDhTMTAuMjQgNTU3Ljc5ODQgMTAuMjQgNTExLjE0NDk2YzAtNDYuNjYzNjggMzcuODMxNjgtODQuNDggODQuNDgtODQuNDhTMTc5LjIgNDY0LjQ4NjQgMTc5LjIgNTExLjE0NDk2eiIgcC1pZD0iNTY4MyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){var a=n(403);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .context-menu .menu-options-panel{\n            position: fixed;\n            display: inline-flex;\n            flex-direction: column;\n            padding: 16px;\n            background-color: white;\n            box-shadow: rgba(5, 0, 50, 0.14) 0px 4px 16px 0;\n            left: 0;\n            top: 0;\n            grid-row-gap: 12px;\n            row-gap: 12px;\n            cursor: auto;\n        }\n            .yunxin-whiteboard-float .context-menu .menu-options-panel .menu-option{\n                justify-content: space-between;\n                width: 100%;\n                padding: 0;\n                grid-column-gap: 56px;\n                -moz-column-gap: 56px;\n                     column-gap: 56px;\n            }\n            .yunxin-whiteboard-float .context-menu .menu-options-panel .menu-option .option-text{\n                    font-size: 16px;\n                    white-space: nowrap;\n                }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextAlign=void 0;var a=g(n(5)),r=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(25)),l=g(n(4)),c=g(n(6)),d=n(40),p=n(59),h=n(60);n(405);var f=n(100);function g(e){return e&&e.__esModule?e:{default:e}}t.TextAlign=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange","onShow","panelOffset","openItem","tbAlign","hasVAlign"],{panelOffset:{x:0,y:0},tbAlign:"up",hasVAlign:!0})}},{key:"renderAlign",value:function(){var e=this.props.value.textAlign;return c.default.createElement("div",{style:{width:"26px",height:"26px"},className:"align-"+e})}},{key:"options",get:function(){var e=this,t=this.pickedProps,n=t.panelOffset,r=t.toolName,i=t.onChange,o=this.props.hasVAlign,s=[];return(o?["left","center","right","top","middle","bottom"]:["left","center","right"]).forEach((function(t){var n=e.props.value.textAlign===t||e.props.value.verticalAlign===t,o=c.default.createElement(f.RadioItem,{className:"radio-item align-"+t+" "+(n?"selected":""),name:"textAlignment",value:t,checked:!1,onChange:function(t){var n=t.value,o=["left","center","right"].indexOf(n)>-1?{textAlign:n}:{verticalAlign:n};null==i||i({type:t.type,target:t.target,toolName:r,value:(0,a.default)((0,a.default)({},e.props.value),o)}),e.forceUpdate()}},"");s.push(o)})),c.default.createElement(h.SubsPanel,{style:{maxWidth:144},className:"panel",isShow:this.pickedProps.openItem===r,offset:n,tbAlign:this.pickedProps.tbAlign},s)}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.disabled,r=t.hint,i=t.toolName;return c.default.createElement("div",(0,a.default)({className:this.className,style:this.style},this.hoverProps),c.default.createElement(p.ClickItem,{disabled:n,hint:r,onClick:function(){e.props.onToolClick&&e.props.onToolClick({toolName:i})}},this.renderAlign()),this.options)}}]),t}(d.Item)},function(e,t,n){var a=n(406);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){t=e.exports=n(11)(!1);var a=n(62),r=a(n(407)),i=a(n(408)),o=a(n(409)),s=a(n(410)),u=a(n(411)),l=a(n(412));t.push([e.i,".yunxin-whiteboard-float .align-left, .yunxin-whiteboard-float .align-right, .yunxin-whiteboard-float .align-center, .yunxin-whiteboard-float .align-top, .yunxin-whiteboard-float .align-bottom, .yunxin-whiteboard-float .align-middle {\n        width: 20px;\n        height: 20px;\n    }\n    .yunxin-whiteboard-float .align-left {\n        background: url("+r+") center center no-repeat;\n    }\n    .yunxin-whiteboard-float .align-right {\n        background: url("+i+") center center no-repeat;\n    }\n    .yunxin-whiteboard-float .align-center {\n        background: url("+o+") center center no-repeat;\n    }\n    .yunxin-whiteboard-float .align-top {\n        background: url("+s+") center center no-repeat;\n    }\n    .yunxin-whiteboard-float .align-middle {\n        background: url("+u+") center center no-repeat;\n    }\n    .yunxin-whiteboard-float .align-bottom {\n        background: url("+l+") center center no-repeat;\n    }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1MDc4NDMyNTIxMSIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMjAxNiIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPgogICAgPHBhdGgKICAgICAgICBmaWxsPSIjMzMzIgogICAgICAgIGQ9Ik0xMjAgMjMwaDQ5NmM0LjQgMCA4LTMuNiA4LTh2LTU2YzAtNC40LTMuNi04LTgtOEgxMjBjLTQuNCAwLTggMy42LTggOHY1NmMwIDQuNCAzLjYgOCA4IDh6TTEyMCA2NTRoNDk2YzQuNCAwIDgtMy42IDgtOHYtNTZjMC00LjQtMy42LTgtOC04SDEyMGMtNC40IDAtOCAzLjYtOCA4djU2YzAgNC40IDMuNiA4IDggOHpNOTA0IDc5NEgxMjBjLTQuNCAwLTggMy42LTggOHY1NmMwIDQuNCAzLjYgOCA4IDhoNzg0YzQuNCAwIDgtMy42IDgtOHYtNTZjMC00LjQtMy42LTgtOC04ek05MDQgMzcwSDEyMGMtNC40IDAtOCAzLjYtOCA4djU2YzAgNC40IDMuNiA4IDggOGg3ODRjNC40IDAgOC0zLjYgOC04di01NmMwLTQuNC0zLjYtOC04LTh6IgogICAgICAgIHAtaWQ9IjIwMTciPjwvcGF0aD4KPC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1MDc4NDM0NjM1MiIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMjE2NiIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPgogICAgPHBhdGgKICAgICAgICBmaWxsPSIjMzMzIgogICAgICAgIGQ9Ik05MDQgMTU4SDQwOGMtNC40IDAtOCAzLjYtOCA4djU2YzAgNC40IDMuNiA4IDggOGg0OTZjNC40IDAgOC0zLjYgOC04di01NmMwLTQuNC0zLjYtOC04LTh6TTkwNCA1ODJINDA4Yy00LjQgMC04IDMuNi04IDh2NTZjMCA0LjQgMy42IDggOCA4aDQ5NmM0LjQgMCA4LTMuNiA4LTh2LTU2YzAtNC40LTMuNi04LTgtOHpNOTA0IDc5NEgxMjBjLTQuNCAwLTggMy42LTggOHY1NmMwIDQuNCAzLjYgOCA4IDhoNzg0YzQuNCAwIDgtMy42IDgtOHYtNTZjMC00LjQtMy42LTgtOC04ek05MDQgMzcwSDEyMGMtNC40IDAtOCAzLjYtOCA4djU2YzAgNC40IDMuNiA4IDggOGg3ODRjNC40IDAgOC0zLjYgOC04di01NmMwLTQuNC0zLjYtOC04LTh6IgogICAgICAgIHAtaWQ9IjIxNjciPjwvcGF0aD4KPC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1MDc4NDM1MjQzOCIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMjMxNiIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPgogICAgPHBhdGgKICAgICAgICBmaWxsPSIjMzMzIgogICAgICAgIGQ9Ik0yNjQgMjMwaDQ5NmM0LjQgMCA4LTMuNiA4LTh2LTU2YzAtNC40LTMuNi04LTgtOEgyNjRjLTQuNCAwLTggMy42LTggOHY1NmMwIDQuNCAzLjYgOCA4IDh6TTc2MCA2NTRjNC40IDAgOC0zLjYgOC04di01NmMwLTQuNC0zLjYtOC04LThIMjY0Yy00LjQgMC04IDMuNi04IDh2NTZjMCA0LjQgMy42IDggOCA4aDQ5NnpNOTA0IDc5NEgxMjBjLTQuNCAwLTggMy42LTggOHY1NmMwIDQuNCAzLjYgOCA4IDhoNzg0YzQuNCAwIDgtMy42IDgtOHYtNTZjMC00LjQtMy42LTgtOC04ek05MDQgMzcwSDEyMGMtNC40IDAtOCAzLjYtOCA4djU2YzAgNC40IDMuNiA4IDggOGg3ODRjNC40IDAgOC0zLjYgOC04di01NmMwLTQuNC0zLjYtOC04LTh6IgogICAgICAgIHAtaWQ9IjIzMTciPjwvcGF0aD4KPC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjUwNzg4MzA4NjE4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI0NjYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+QGZvbnQtZmFjZSB7IGZvbnQtZmFtaWx5OiBmZWVkYmFjay1pY29uZm9udDsgc3JjOiB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LndvZmYyP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZjIiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZiIpLCB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LnR0Zj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoInRydWV0eXBlIik7IH0KPC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTg1OS45IDE2OEgxNjQuMWMtNC41IDAtOC4xIDMuNi04LjEgOHY2MGMwIDQuNCAzLjYgOCA4LjEgOGg2OTUuOGM0LjUgMCA4LjEtMy42IDguMS04di02MGMwLTQuNC0zLjYtOC04LjEtOHpNNTE4LjMgMzU1Yy0zLjItNC4xLTkuNC00LjEtMTIuNiAwbC0xMTIgMTQxLjdjLTQuMSA1LjItMC40IDEyLjkgNi4zIDEyLjloNzMuOVY4NDhjMCA0LjQgMy42IDggOCA4aDYwYzQuNCAwIDgtMy42IDgtOFY1MDkuN0g2MjRjNi43IDAgMTAuNC03LjcgNi4zLTEyLjlMNTE4LjMgMzU1eiIgcC1pZD0iMjQ2NyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjUwNzg4MzIyMTMxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI2MTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+QGZvbnQtZmFjZSB7IGZvbnQtZmFtaWx5OiBmZWVkYmFjay1pY29uZm9udDsgc3JjOiB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LndvZmYyP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZjIiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZiIpLCB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LnR0Zj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoInRydWV0eXBlIik7IH0KPC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTg1OS45IDQ3NEgxNjQuMWMtNC41IDAtOC4xIDMuNi04LjEgOHY2MGMwIDQuNCAzLjYgOCA4LjEgOGg2OTUuOGM0LjUgMCA4LjEtMy42IDguMS04di02MGMwLTQuNC0zLjYtOC04LjEtOHpNNTA2LjMgMzk5LjNjMi45IDMuNyA4LjUgMy43IDExLjMgMGwxMDAuOC0xMjcuNWMzLjctNC43IDAuNC0xMS43LTUuNy0xMS43SDU1MFYxMDRjMC00LjQtMy42LTgtOC04aC02MGMtNC40IDAtOCAzLjYtOCA4djE1NmgtNjIuOGMtNiAwLTkuNCA3LTUuNyAxMS43bDEwMC44IDEyNy42ek01MTcuNyA2MjQuN2MtMi45LTMuNy04LjUtMy43LTExLjMgMEw0MDUuNiA3NTIuM2MtMy43IDQuNy0wLjQgMTEuNyA1LjcgMTEuN0g0NzR2MTU2YzAgNC40IDMuNiA4IDggOGg2MGM0LjQgMCA4LTMuNiA4LThWNzY0aDYyLjhjNiAwIDkuNC03IDUuNy0xMS43TDUxNy43IDYyNC43eiIgcC1pZD0iMjYxNyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjUwNzg4MzI4MDIxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI3NjYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+QGZvbnQtZmFjZSB7IGZvbnQtZmFtaWx5OiBmZWVkYmFjay1pY29uZm9udDsgc3JjOiB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LndvZmYyP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZjIiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmP3Q9MTYzMDAzMzc1OTk0NCIpIGZvcm1hdCgid29mZiIpLCB1cmwoIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LnR0Zj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoInRydWV0eXBlIik7IH0KPC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTg1OS45IDc4MEgxNjQuMWMtNC41IDAtOC4xIDMuNi04LjEgOHY2MGMwIDQuNCAzLjYgOCA4LjEgOGg2OTUuOGM0LjUgMCA4LjEtMy42IDguMS04di02MGMwLTQuNC0zLjYtOC04LjEtOHpNNTA1LjcgNjY5YzMuMiA0LjEgOS40IDQuMSAxMi42IDBsMTEyLTE0MS43YzQuMS01LjIgMC40LTEyLjktNi4zLTEyLjloLTc0LjFWMTc2YzAtNC40LTMuNi04LTgtOGgtNjBjLTQuNCAwLTggMy42LTggOHYzMzguM0g0MDBjLTYuNyAwLTEwLjQgNy43LTYuMyAxMi45bDExMiAxNDEuOHoiIHAtaWQ9IjI3NjciPjwvcGF0aD48L3N2Zz4="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkType=void 0;var a=g(n(5)),r=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(25)),l=g(n(4)),c=g(n(6)),d=n(40),p=n(59),h=n(60);n(414);var f=n(100);function g(e){return e&&e.__esModule?e:{default:e}}t.LinkType=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange","onShow","panelOffset","openItem","value"],{panelOffset:{x:0,y:0},value:2})}},{key:"renderAlign",value:function(){var e=this.props.value;return c.default.createElement("div",{style:{width:"26px",height:"26px"},className:"linkType-"+e})}},{key:"options",get:function(){var e=this,t=this.pickedProps,n=t.panelOffset,a=t.toolName,r=t.onChange,i=[];return[0,1,2].forEach((function(t){var n=e.props.value===t,o=c.default.createElement(f.RadioItem,{className:"radio-item linkType-"+t+" "+(n?"selected":""),name:"textAlignment",value:t,checked:!1,onChange:function(t){var n=t.value;null==r||r({type:t.type,target:t.target,toolName:a,value:n}),e.forceUpdate()}},"");i.push(o)})),c.default.createElement(h.SubsPanel,{style:{maxWidth:144},className:"panel",isShow:this.pickedProps.openItem===a,offset:n},i)}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.disabled,r=t.hint,i=t.toolName;return c.default.createElement("div",(0,a.default)({className:this.className,style:this.style},this.hoverProps),c.default.createElement(p.ClickItem,{disabled:n,hint:r,onClick:function(){e.props.onToolClick&&e.props.onToolClick({toolName:i})}},this.renderAlign()),this.options)}}]),t}(d.Item)},function(e,t,n){var a=n(415);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){t=e.exports=n(11)(!1);var a=n(62),r=a(n(416)),i=a(n(417)),o=a(n(418));t.push([e.i,".yunxin-whiteboard-float .linkType-0, .yunxin-whiteboard-float .linkType-1, .yunxin-whiteboard-float .linkType-2 {\n        width: 20px;\n        height: 20px;\n    }\n    .yunxin-whiteboard-float .linkType-0 {\n        background: url("+r+") center center no-repeat;\n    }\n    .yunxin-whiteboard-float .linkType-1 {\n        background: url("+i+") center center no-repeat;\n    }\n    .yunxin-whiteboard-float .linkType-2 {\n        background: url("+o+") center center no-repeat;\n    }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NDUwMTQ1OTczMyIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iODIwNiIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiPgogICAgPHBhdGgKICAgICAgICBkPSJNODUgOTU1bDcwIDcwbDg1My04NTNsLTcwIC03MEw4NSA5NTV6IgogICAgICAgIHAtaWQ9IjgyMDciPjwvcGF0aD4KPC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NDUwMTM3MjIwOSIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iODQyMyIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiPgogICAgPHBhdGgKICAgICAgICBzdHJva2U9InJnYmEoMCwwLDAsLjgpIiBzdHJva2Utd2lkdGg9IjExMCIKICAgICAgICBkPSJNNjQgODgwYzgwMCAwIDAgLTgwMCA4MDAtODAwIiAgZmlsbD0ibm9uZSI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NDUwMTQ5NDI4MiIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iOTA2MyIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiPgogICAgPHBhdGgKICAgICAgICBkPSJNNDAwIDgzMHYtNzAwaDUwMHY5MGgtNDEwdjcwMGgtNTAwdi05MHoiCiAgICAgICAgcC1pZD0iOTA2NCI+PC9wYXRoPgo8L3N2Zz4="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkArrow=void 0;var a=g(n(5)),r=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(25)),l=g(n(4)),c=g(n(6)),d=n(40),p=n(59),h=n(60);n(420);var f=n(100);function g(e){return e&&e.__esModule?e:{default:e}}t.LinkArrow=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange","onShow","panelOffset","openItem","value"],{panelOffset:{x:0,y:0}})}},{key:"renderAlign",value:function(){var e;return c.default.createElement("div",{style:{width:"26px",height:"26px"},className:"linkArrow-"+(null===(e=this.props.value)||void 0===e?void 0:e.toString())})}},{key:"options",get:function(){var e=this,t=this.pickedProps,n=t.panelOffset,a=t.toolName,r=t.onChange,i=[],o=this.props.value;return[0,1,2,3].forEach((function(t){var n=o===t,s=c.default.createElement(f.RadioItem,{className:"linkArrow-"+t+" radio-item "+(n?"selected":""),name:"textAlignment",value:t,checked:!1,onChange:function(t){var n=t.value;null==r||r({type:t.type,target:t.target,toolName:a,value:n}),e.forceUpdate()}},"");i.push(s)})),c.default.createElement(h.SubsPanel,{className:"panel linkArrow",isShow:this.pickedProps.openItem===a,offset:n},i)}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.disabled,r=t.hint,i=t.toolName;return c.default.createElement("div",(0,a.default)({className:this.className,style:this.style},this.hoverProps),c.default.createElement(p.ClickItem,{disabled:n,hint:r,onClick:function(){e.props.onToolClick&&e.props.onToolClick({toolName:i})}},this.renderAlign()),this.options)}}]),t}(d.Item)},function(e,t,n){var a=n(421);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){t=e.exports=n(11)(!1);var a=n(62),r=a(n(422)),i=a(n(423)),o=a(n(252)),s=a(n(424));t.push([e.i,".yunxin-whiteboard-float .linkArrow.panel .radio-item {\n        width: 20px;\n        height: 20px;\n    }\n\n    .yunxin-whiteboard-float .linkArrow-0 {\n        background: url("+r+") center center no-repeat;\n    }\n\n    .yunxin-whiteboard-float .linkArrow-1 {\n        background: url("+i+") center center no-repeat;\n    }\n\n    .yunxin-whiteboard-float .linkArrow-2 {\n        background: url("+o+") center center no-repeat;\n    }\n\n    .yunxin-whiteboard-float .linkArrow-3 {\n        background: url("+s+") center center no-repeat;\n    }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTAwMjIxNTc4MSIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iODQ4NiIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiPgogICAgPHBhdGggZD0iTTExMDAgNDc2aC05MDB2MTEwaDkwMHoiIHAtaWQ9Ijg0ODciPgogICAgPC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTAwMjU5MDkxNCIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMTIyNDAiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij4KICAgIDxwYXRoCiAgICAgICAgZD0iTTEwMjQgNDU3djExMGgtNzUwdjExMGwtMjIwLTE2NWwyMjAtMTY1djExMHoiCiAgICAgICAgZmlsbD0iIiBwLWlkPSIxMjI0MSI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTAwMjU5MDkxNCIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMTIyNDAiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij4KICAgIDxwYXRoCiAgICAgICAgZD0iTTAgNDkybDE1MC0xNjV2MTEwaDc1MHYtMTEwbDE1MCAxNjVsLTE1MCAxNjV2LTExMGgtNzUwdjExMHoiCiAgICAgICAgZmlsbD0iIiBwLWlkPSIxMjI0MSI+PC9wYXRoPgo8L3N2Zz4="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeChange=void 0;var a=g(n(5)),r=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(25)),l=g(n(4)),c=g(n(6)),d=n(40),p=n(59),h=n(60),f=n(100);function g(e){return e&&e.__esModule?e:{default:e}}t.TypeChange=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange","onShow","panelOffset","openItem","value","shapeIcons"],{panelOffset:{x:0,y:0},shapeIcons:{}})}},{key:"renderIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:26,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:26,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return c.default.createElement("div",{style:{width:t,height:n,background:"url("+e+")",backgroundSize:"cover",transform:"scale("+a+")"}})}},{key:"options",get:function(){var e=this.pickedProps,t=e.toolName,n=e.panelOffset,a=e.onChange,r=this.props.shapeIcons,i=[],o=this.props.value;for(var s in r){var u=o===s,l=c.default.createElement(f.RadioItem,{className:"radio-item "+(u?"selected":""),value:s,checked:!1,onChange:function(e){var n=e.value;null==a||a({type:e.type,target:e.target,toolName:t,value:n})}},this.renderIcon(r[s].icon,20,20,2));i.push(l)}return c.default.createElement(h.SubsPanel,{style:{maxWidth:132,padding:4},className:"panel",isShow:this.pickedProps.openItem===t,offset:n},i)}},{key:"children",get:function(){var e=this,t=this.pickedProps,n=t.disabled,r=t.hint,i=t.toolName,o=this.props,s=o.value,u=o.shapeIcons;return c.default.createElement("div",(0,a.default)({className:this.className,style:this.style},this.hoverProps),c.default.createElement(p.ClickItem,{disabled:n,hint:r,onClick:function(){e.props.onToolClick&&e.props.onToolClick({toolName:i})}},this.renderIcon(u[s].icon,24,24,2.1)),this.options)}}]),t}(d.Item)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0;var a=h(n(5)),r=h(n(2)),i=h(n(0)),o=h(n(1)),s=h(n(3)),u=h(n(25)),l=h(n(4)),c=h(n(6)),d=n(40),p=n(60);function h(e){return e&&e.__esModule?e:{default:e}}n(427);t.Select=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange"])}},{key:"inputStyle",get:function(){return{position:"absolute",left:0,right:0,top:0,bottom:0,appearance:"none",pointerEvents:"all"}}},{key:"options",get:function(){var e=this,t=this.props,n=t.options,a=t.toolName,r=t.panelOffset;return c.default.createElement(p.SubsPanel,{className:"panel",offset:r,isShow:this.props.openItem===a,style:{padding:"0 0 4px 0"}},c.default.createElement("div",{className:"select"},n.map((function(t){var n="fontFamily"===a?{fontFamily:t.value}:{};return c.default.createElement("div",{onClick:function(){var n,r;null===(r=(n=e.props).onChange)||void 0===r||r.call(n,{toolName:a,value:t.value})},className:"option",style:n},t.label)}))))}},{key:"children",get:function(){var e,t=this,n=this.props,r=n.value,i=n.toolName,o=(null===(e=n.options.find((function(e){return e.value===r})))||void 0===e?void 0:e.label)||" ",s="fontFamily"===i?{fontFamily:r}:{};return c.default.createElement("div",(0,a.default)({className:this.className,style:this.style},this.hoverProps),c.default.createElement("div",{onClick:function(){t.props.onToolClick&&t.props.onToolClick({toolName:i})},style:(0,a.default)({width:"100px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",minHeight:"18px",lineHeight:"18px",textAlign:"center"},s)},o),this.options)}}]),t}(d.Item)},function(e,t,n){var a=n(428);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .panel .select {\n        max-height: 350px;\n        overflow: auto;\n        \n        /* Works on Chrome/Edge/Safari */\n    }\n        .yunxin-whiteboard-float .panel .select .option {\n            margin: 12px;\n            width: 140px;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            overflow-x: hidden;\n            cursor: pointer;\n        }\n        .yunxin-whiteboard-float .panel .select {\n\n        scrollbar-width: thin;\n        scrollbar-color: black white;\n}\n    .yunxin-whiteboard-float .panel .select::-webkit-scrollbar {\n            width: 12px;\n        }\n    .yunxin-whiteboard-float .panel .select::-webkit-scrollbar-track {\n            background: white;\n        }\n    .yunxin-whiteboard-float .panel .select::-webkit-scrollbar-thumb {\n            background-color: #d9d9de;\n            border-radius: 20px;\n            border: 3px solid white;\n        }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SelectFilter=void 0;var a=w(n(5)),r=w(n(2)),i=w(n(0)),o=w(n(1)),s=w(n(3)),u=w(n(25)),l=w(n(4)),c=w(n(6)),d=n(40),p=n(60),h=w(n(430)),f=w(n(251)),g=w(n(252)),v=w(n(148)),y=w(n(253)),m=w(n(254)),M=w(n(431)),x=w(n(149));function w(e){return e&&e.__esModule?e:{default:e}}n(432);t.SelectFilter=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"propsFilter",value:function(){(0,u.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"propsFilter",this).call(this,["onChange"])}},{key:"inputStyle",get:function(){return{position:"absolute",left:0,right:0,top:0,bottom:0,appearance:"none",pointerEvents:"all"}}},{key:"options",get:function(){var e=this,t=this.props,n=t.options,a=t.toolName,r=t.panelOffset,i={audio:m.default,video:M.default,pen:f.default,text:v.default,image:y.default,shape:x.default,link:g.default},o={audio:"音频",video:"视频",pen:"涂鸦、直线",text:"文字",image:"图片",shape:"图形",link:"连接"};return c.default.createElement(p.SubsPanel,{className:"panel",offset:r,isShow:this.props.openItem===a,style:{padding:"0 0 4px 0"}},c.default.createElement("div",{className:"select"},n.map((function(t){return c.default.createElement("div",{onClick:function(){var n,r;null===(r=(n=e.props).onChange)||void 0===r||r.call(n,{toolName:a,value:t.type})},className:"option"},c.default.createElement("div",{className:"symbol",style:{backgroundImage:"url("+i[t.type]+")"}}),c.default.createElement("div",{className:"type"},o[t.type]),c.default.createElement("div",{className:"count"},t.count))}))))}},{key:"children",get:function(){var e=this,t=this.props.toolName;return c.default.createElement("div",(0,a.default)({className:this.className+" select-filter",style:this.style},this.hoverProps),c.default.createElement("div",{onClick:function(){e.props.onToolClick&&e.props.onToolClick({toolName:t})},className:"select-filter-div"},c.default.createElement("div",{style:{display:"inline-block"}},"筛选"),c.default.createElement("div",{className:"symbol",style:{backgroundImage:"url("+h.default+")",marginLeft:"8px"}})),this.options)}}]),t}(d.Item)},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPgogICAgPHBhdGggZD0iTTIwMCAzMDBsMzEyIDQwMGwzMTIgLTQwMGgtNTBsLTI2MiAzNTBsLTI2MiAtMzUweiI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPScjNTU1NTU1JyB0PSIxNjIwMjY4NDg1MTU0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTMwMCAtMzAwIDE2MjQgMTYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMzciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMTI4IDIxMy4zMzMzMzNsNDY5LjMzMzMzMyAwcTUyLjk5MiAwIDkwLjQ5NiAzNy41MDR0MzcuNTA0IDkwLjQ5NmwwIDc3LjY1MzMzMyAyOTguNjY2NjY3LTE2Mi45ODY2NjcgMCA1MTItMjk4LjY2NjY2Ny0xNjIuOTg2NjY3IDAgNzcuNjUzMzMzcTAgNTIuOTkyLTM3LjUwNCA5MC40OTZ0LTkwLjQ5NiAzNy41MDRsLTQ2OS4zMzMzMzMgMHEtNTIuOTkyIDAtOTAuNDk2LTM3LjUwNHQtMzcuNTA0LTkwLjQ5NmwwLTM0MS4zMzMzMzNxMC01Mi45OTIgMzcuNTA0LTkwLjQ5NnQ5MC40OTYtMzcuNTA0ek01OTcuMzMzMzMzIDI5OC42NjY2NjdsLTQ2OS4zMzMzMzMgMHEtMTcuNjY0IDAtMzAuMTY1MzMzIDEyLjUwMTMzM3QtMTIuNTAxMzMzIDMwLjE2NTMzM2wwIDM0MS4zMzMzMzNxMCAxNy42NjQgMTIuNTAxMzMzIDMwLjE2NTMzM3QzMC4xNjUzMzMgMTIuNTAxMzMzbDQ2OS4zMzMzMzMgMHExNy42NjQgMCAzMC4xNjUzMzMtMTIuNTAxMzMzdDEyLjUwMTMzMy0zMC4xNjUzMzNsMC0zNDEuMzMzMzMzcTAtMTcuNjY0LTEyLjUwMTMzMy0zMC4xNjUzMzN0LTMwLjE2NTMzMy0xMi41MDEzMzN6TTkzOC42NjY2NjcgNjI0LjM0MTMzM2wwLTIyNC42ODI2NjctMjA1LjY1MzMzMyAxMTIuMzQxMzMzeiIgcC1pZD0iMjAzOCI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){var a=n(433);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .select-filter .select-filter-div {\n            width: 70px;\n            overflow: hidden;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            text-align: center;\n        }\n        .yunxin-whiteboard-float .select-filter .option {\n            display: flex;\n            overflow: hidden;\n        }\n        .yunxin-whiteboard-float .select-filter .option .type {\n                display: inline-block;\n                flex: 1;\n                text-align: center;\n            }\n        .yunxin-whiteboard-float .select-filter .option .count {\n                display: inline-block;\n                vertical-align: bottom;\n                opacity: 0.3;\n                vertical-align: bottom;\n                font-size: 14px;\n                position: relative;\n                top: 6px;\n            }\n        .yunxin-whiteboard-float .select-filter .symbol {\n            display: inline-block;\n            width: 22px;\n            height: 28px;\n            line-height: 28px;\n            vertical-align: middle;\n            background-repeat: no-repeat;\n            background-position: center;\n            background-size: cover;\n            background-color: white;\n        }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Divider=void 0;var a=l(n(2)),r=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(6));function l(e){return e&&e.__esModule?e:{default:e}}n(435);t.Divider=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return u.default.createElement("div",{className:"divider"})}}]),t}(u.default.Component)},function(e,t,n){var a=n(436);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float .divider{\n        width: 1px;\n        height: 100%;\n        border-left: 1px solid rgb(164, 164, 164, 0.15);\n    }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_TOOL_MAP=t.DefaultContextMenu=t.DefaultColors=void 0;var a=u(n(6)),r=u(n(438)),i=u(n(439)),o=u(n(440)),s=u(n(441));function u(e){return e&&e.__esModule?e:{default:e}}var l=t.DefaultColors=["rgb(0,0,0)","rgb(255,255,255)","rgb(224,32,32)","rgb(250,100,0)","rgb(247,181,0)","rgb(109,212,0)","rgb(68,215,182)","rgb(50,197,255)","rgb(0,145,255)","rgb(98,54,255)","rgb(182,32,224)","rgb(109,114,120)"];t.DefaultContextMenu={toolName:"contextMenu",hint:"更多操作",panelOffset:{x:10,y:10},options:[]},t.DEFAULT_TOOL_MAP={lineWidth:{toolType:"Slider",toolName:"lineWidth",hint:"线宽",min:1,max:30,step:1},stroke:{toolType:"LineProp",toolName:"stroke",hint:"线段、边框颜色",colors:l,panelOffset:{x:12,y:12},hasNull:!0,hasLineWidth:!1},lineProp:{toolType:"LineProp",toolName:"lineProp",hint:"粗细、颜色",colors:l,panelOffset:{x:12,y:12},hasNull:!0,min:1,max:30,step:1,hasLineWidth:!0},fontSize:{toolType:"Input",toolName:"fontSize",type:"number",hint:"字体大小",min:10,max:300,step:8},selectFilter:{toolType:"SelectFilter",toolName:"selectFilter",hint:"过滤选择类型",panelOffset:{x:12,y:12},options:[]},fontFamily:{toolType:"Select",toolName:"fontFamily",hint:"字体",options:[],panelOffset:{x:0,y:12}},fontStroke:{toolType:"LineProp",toolName:"fontStroke",hint:"字体颜色",colors:l,panelOffset:{x:12,y:12},hasNull:!1,hasLineWidth:!1},fontFill:{toolType:"LineProp",toolName:"fontFill",hint:"字体背景颜色",colors:l,panelOffset:{x:12,y:12},hasNull:!0,hasLineWidth:!1},fill:{toolType:"LineProp",toolName:"fill",hint:"填充颜色",colors:l,panelOffset:{x:12,y:12},hasNull:!0,hasLineWidth:!1},textAlign:{toolType:"TextAlign",toolName:"textAlign",hint:"水平对齐",panelOffset:{x:12,y:12},hasVAlign:!0},linkType:{toolType:"LinkType",toolName:"linkType",hint:"曲线类型",panelOffset:{x:12,y:12}},linkArrow:{toolType:"LinkArrow",toolName:"linkArrow",hint:"箭头类型",panelOffset:{x:12,y:12}},addT:{toolType:"Click",toolName:"addT",hint:"添加文本",icon:a.default.createElement("span",{style:{display:"inline-block",width:30,height:24,lineHeight:"24px",fontSize:"22px"}},"+T")},group:{toolType:"Click",toolName:"group",hint:"组合元素",icon:o.default},ungroup:{toolType:"Click",toolName:"ungroup",hint:"解除组合",icon:s.default},divider:{toolType:"Divider"},resDownload:{toolType:"Click",toolName:"resDownload",hint:"下载图片",icon:r.default},imgCrop:{toolType:"Click",toolName:"imgCrop",hint:"剪裁",icon:i.default},typeChange:{toolType:"TypeChange",toolName:"typeChange",hint:"类型转换",shapeIcons:{},panelOffset:{x:12,y:12}}}},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1ODc0NjMxMjg1OSIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIxNTAgMTUwIDcyNCA3MjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBwLWlkPSIyMjcyIgogICAgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiI+CiAgICA8ZGVmcz4KICAgICAgICA8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgogICAgICAgICAgICBAZm9udC1mYWNlIHsKICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBmZWVkYmFjay1pY29uZm9udDsKICAgICAgICAgICAgICAgIHNyYzogdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmMj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoIndvZmYyIiksIHVybCgiLy9hdC5hbGljZG4uY29tL3QvZm9udF8xMDMxMTU4X3U2OXc4eWh4ZHUud29mZj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoIndvZmYiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS50dGY/dD0xNjMwMDMzNzU5OTQ0IikgZm9ybWF0KCJ0cnVldHlwZSIpOwogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgIDwvZGVmcz4KICAgIDxwYXRoCiAgICAgICAgZD0iTTcwNCAzNDEuMzMzMzMzaDY0YTY0IDY0IDAgMCAxIDY0IDY0djM2Mi42NjY2NjdhNjQgNjQgMCAwIDEtNjQgNjRIMjU2YTY0IDY0IDAgMCAxLTY0LTY0VjQwNS4zMzMzMzNhNjQgNjQgMCAwIDEgNjQtNjRoNjR2NjRoLTY0djM2Mi42NjY2NjdoNTEyVjQwNS4zMzMzMzNoLTY0di02NHogbS0xNTQuNzk0NjY3LTIxMi4yNjY2NjZsMC4wNDI2NjcgMzQ3LjQ1NiA3NC4wMDUzMzMtNzQuMDI2NjY3IDQ1LjIyNjY2NyA0NS4yNDgtMTUwLjgyNjY2NyAxNTAuODQ4LTE1MC44NDgtMTUwLjgyNjY2NyA0NS4yNDgtNDUuMjY5MzMzIDczLjE3MzMzNCA3My4xNzMzMzNWMTI5LjA2NjY2N2g2NHoiCiAgICAgICAgcC1pZD0iMjI3MyI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0icHJlZml4X19pY29uIiB2aWV3Qm94PSIxMDAgMTAwIDgyNCA4MjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj4KICAgIDxkZWZzPgogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgQGZvbnQtZmFjZSB7CiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogZmVlZGJhY2staWNvbmZvbnQ7CiAgICAgICAgICAgICAgICBzcmM6IHVybCgvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmMj90PTE2MzAwMzM3NTk5NDQpIGZvcm1hdCgmcXVvdDsgd29mZjImcXVvdDsgKSwgdXJsKC8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LndvZmY/dD0xNjMwMDMzNzU5OTQ0KSBmb3JtYXQoJnF1b3Q7IHdvZmYmcXVvdDsgKSwgdXJsKC8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTAzMTE1OF91Njl3OHloeGR1LnR0Zj90PTE2MzAwMzM3NTk5NDQpIGZvcm1hdCgmcXVvdDsgdHJ1ZXR5cGUmcXVvdDsgKQogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgIDwvZGVmcz4KICAgIDxwYXRoCiAgICAgICAgZD0iTTcyNS4zMzMgNjQwaDg1LjMzNFYyOTguNjY3YzAtNDYuOTM0LTM4LjQtODUuMzM0LTg1LjMzNC04NS4zMzRIMzg0djg1LjMzNGgzNDEuMzMzVjY0MHptLTQyNi42NjYgODUuMzMzVjQyLjY2N2gtODUuMzM0djE3MC42NjZINDIuNjY3djg1LjMzNGgxNzAuNjY2djQyNi42NjZjMCA0Ni45MzQgMzguNCA4NS4zMzQgODUuMzM0IDg1LjMzNGg0MjYuNjY2djE3MC42NjZoODUuMzM0VjgxMC42NjdoMTcwLjY2NnYtODUuMzM0SDI5OC42Njd6IiAvPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjU5MDg1NDExMTM0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE3MDE5IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPkBmb250LWZhY2UgeyBmb250LWZhbWlseTogZmVlZGJhY2staWNvbmZvbnQ7IHNyYzogdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmMj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoIndvZmYyIiksIHVybCgiLy9hdC5hbGljZG4uY29tL3QvZm9udF8xMDMxMTU4X3U2OXc4eWh4ZHUud29mZj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoIndvZmYiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS50dGY/dD0xNjMwMDMzNzU5OTQ0IikgZm9ybWF0KCJ0cnVldHlwZSIpOyB9Cjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik0xMjggNDIuNjY2NjY3QzgwLjY0IDQyLjY2NjY2NyA0Mi42NjY2NjcgODAuNjQgNDIuNjY2NjY3IDEyOEw0Mi42NjY2NjcgNTk3LjMzMzMzM0M0Mi42NjY2NjcgNjQ0LjY5MzMzMyA4MC42NCA2ODIuNjY2NjY3IDEyOCA2ODIuNjY2NjY3IDE4NC43NDY2NjcgNjgyLjY2NjY2NyAyOTguNjY2NjY3IDY4Mi42NjY2NjcgMjk4LjY2NjY2NyA2ODIuNjY2NjY3IDI5OC42NjY2NjcgNjgyLjY2NjY2NyAyOTguNjY2NjY3IDc5Ni41ODY2NjcgMjk4LjY2NjY2NyA4NTMuMzMzMzMzIDI5OC42NjY2NjcgOTAwLjY5MzMzMyAzMzYuNjQgOTM4LjY2NjY2NyAzODQgOTM4LjY2NjY2N0w4NTMuMzMzMzMzIDkzOC42NjY2NjdDOTAwLjY5MzMzMyA5MzguNjY2NjY3IDkzOC42NjY2NjcgOTAwLjY5MzMzMyA5MzguNjY2NjY3IDg1My4zMzMzMzNMOTM4LjY2NjY2NyAzODRDOTM4LjY2NjY2NyAzMzYuNjQgOTAwLjY5MzMzMyAyOTguNjY2NjY3IDg1My4zMzMzMzMgMjk4LjY2NjY2NyA3OTYuNTg2NjY3IDI5OC42NjY2NjcgNjgyLjY2NjY2NyAyOTguNjY2NjY3IDY4Mi42NjY2NjcgMjk4LjY2NjY2NyA2ODIuNjY2NjY3IDI5OC42NjY2NjcgNjgyLjY2NjY2NyAxODQuNzQ2NjY3IDY4Mi42NjY2NjcgMTI4IDY4Mi42NjY2NjcgODAuNjQgNjQ0LjY5MzMzMyA0Mi42NjY2NjcgNTk3LjMzMzMzMyA0Mi42NjY2NjdMMTI4IDQyLjY2NjY2N00xMjggMTI4IDU5Ny4zMzMzMzMgMTI4QzU5Ny4zMzMzMzMgMTg0Ljc0NjY2NyA1OTcuMzMzMzMzIDI5OC42NjY2NjcgNTk3LjMzMzMzMyAyOTguNjY2NjY3TDM4NCAyOTguNjY2NjY3QzMzNi42NCAyOTguNjY2NjY3IDI5OC42NjY2NjcgMzM2LjY0IDI5OC42NjY2NjcgMzg0TDI5OC42NjY2NjcgNTk3LjMzMzMzM0MyOTguNjY2NjY3IDU5Ny4zMzMzMzMgMTg0Ljc0NjY2NyA1OTcuMzMzMzMzIDEyOCA1OTcuMzMzMzMzTDEyOCAxMjhNMzg0IDM4NCA1OTcuMzMzMzMzIDM4NCA1OTcuMzMzMzMzIDU5Ny4zMzMzMzMgMzg0IDU5Ny4zMzMzMzMgMzg0IDM4NE02ODIuNjY2NjY3IDM4NEM2ODIuNjY2NjY3IDM4NCA3OTYuNTg2NjY3IDM4NCA4NTMuMzMzMzMzIDM4NEw4NTMuMzMzMzMzIDg1My4zMzMzMzMgMzg0IDg1My4zMzMzMzNDMzg0IDc5Ni41ODY2NjcgMzg0IDY4Mi42NjY2NjcgMzg0IDY4Mi42NjY2NjdMNTk3LjMzMzMzMyA2ODIuNjY2NjY3QzY0NC42OTMzMzMgNjgyLjY2NjY2NyA2ODIuNjY2NjY3IDY0NC42OTMzMzMgNjgyLjY2NjY2NyA1OTcuMzMzMzMzTDY4Mi42NjY2NjcgMzg0WiIgcC1pZD0iMTcwMjAiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjU5MDg1MzkxNTUzIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE2ODc1IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPkBmb250LWZhY2UgeyBmb250LWZhbWlseTogZmVlZGJhY2staWNvbmZvbnQ7IHNyYzogdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS53b2ZmMj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoIndvZmYyIiksIHVybCgiLy9hdC5hbGljZG4uY29tL3QvZm9udF8xMDMxMTU4X3U2OXc4eWh4ZHUud29mZj90PTE2MzAwMzM3NTk5NDQiKSBmb3JtYXQoIndvZmYiKSwgdXJsKCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzEwMzExNThfdTY5dzh5aHhkdS50dGY/dD0xNjMwMDMzNzU5OTQ0IikgZm9ybWF0KCJ0cnVldHlwZSIpOyB9Cjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik0xMjggNDIuNjY2NjY3QzgwLjY0IDQyLjY2NjY2NyA0Mi42NjY2NjcgODAuNjQgNDIuNjY2NjY3IDEyOEw0Mi42NjY2NjcgMjEzLjMzMzMzMyAxMjggMjEzLjMzMzMzMyAxMjggMTI4IDIxMy4zMzMzMzMgMTI4IDIxMy4zMzMzMzMgNDIuNjY2NjY3IDEyOCA0Mi42NjY2NjdNMjk4LjY2NjY2NyA0Mi42NjY2NjcgMjk4LjY2NjY2NyAxMjggNDI2LjY2NjY2NyAxMjggNDI2LjY2NjY2NyA0Mi42NjY2NjcgMjk4LjY2NjY2NyA0Mi42NjY2NjdNNTEyIDQyLjY2NjY2NyA1MTIgMTI4IDU5Ny4zMzMzMzMgMTI4IDU5Ny4zMzMzMzMgMjEzLjMzMzMzMyA2ODIuNjY2NjY3IDIxMy4zMzMzMzMgNjgyLjY2NjY2NyAxMjhDNjgyLjY2NjY2NyA4MC42NCA2NDQuNjkzMzMzIDQyLjY2NjY2NyA1OTcuMzMzMzMzIDQyLjY2NjY2N0w1MTIgNDIuNjY2NjY3TTQyLjY2NjY2NyAyOTguNjY2NjY3IDQyLjY2NjY2NyA0MjYuNjY2NjY3IDEyOCA0MjYuNjY2NjY3IDEyOCAyOTguNjY2NjY3IDQyLjY2NjY2NyAyOTguNjY2NjY3TTU5Ny4zMzMzMzMgMjk4LjY2NjY2N0M1OTcuMzMzMzMzIDI5OC42NjY2NjcgNTk3LjMzMzMzMyA0OTcuOTIgNTk3LjMzMzMzMyA1OTcuMzMzMzMzIDQ5Ny45MiA1OTcuMzMzMzMzIDI5OC42NjY2NjcgNTk3LjMzMzMzMyAyOTguNjY2NjY3IDU5Ny4zMzMzMzMgMjk4LjY2NjY2NyA1OTcuMzMzMzMzIDI5OC42NjY2NjcgNzY4IDI5OC42NjY2NjcgODUzLjMzMzMzMyAyOTguNjY2NjY3IDkwMC42OTMzMzMgMzM2LjY0IDkzOC42NjY2NjcgMzg0IDkzOC42NjY2NjdMODUzLjMzMzMzMyA5MzguNjY2NjY3QzkwMC42OTMzMzMgOTM4LjY2NjY2NyA5MzguNjY2NjY3IDkwMC42OTMzMzMgOTM4LjY2NjY2NyA4NTMuMzMzMzMzTDkzOC42NjY2NjcgMzg0QzkzOC42NjY2NjcgMzM2LjY0IDkwMC42OTMzMzMgMjk4LjY2NjY2NyA4NTMuMzMzMzMzIDI5OC42NjY2NjcgNzY4IDI5OC42NjY2NjcgNTk3LjMzMzMzMyAyOTguNjY2NjY3IDU5Ny4zMzMzMzMgMjk4LjY2NjY2N002ODIuNjY2NjY3IDM4NCA4NTMuMzMzMzMzIDM4NCA4NTMuMzMzMzMzIDg1My4zMzMzMzMgMzg0IDg1My4zMzMzMzMgMzg0IDY4Mi42NjY2NjcgNTk3LjMzMzMzMyA2ODIuNjY2NjY3QzY0NC42OTMzMzMgNjgyLjY2NjY2NyA2ODIuNjY2NjY3IDY0NC42OTMzMzMgNjgyLjY2NjY2NyA1OTcuMzMzMzMzTDY4Mi42NjY2NjcgMzg0TTQyLjY2NjY2NyA1MTIgNDIuNjY2NjY3IDU5Ny4zMzMzMzNDNDIuNjY2NjY3IDY0NC42OTMzMzMgODAuNjQgNjgyLjY2NjY2NyAxMjggNjgyLjY2NjY2N0wyMTMuMzMzMzMzIDY4Mi42NjY2NjcgMjEzLjMzMzMzMyA1OTcuMzMzMzMzIDEyOCA1OTcuMzMzMzMzIDEyOCA1MTIgNDIuNjY2NjY3IDUxMloiIHAtaWQ9IjE2ODc2Ij48L3BhdGg+PC9zdmc+"},function(e,t,n){var a=n(443);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".yunxin-whiteboard-float {\n    position: absolute;\n    left: 56px;\n    top: 56px;\n    bottom: 56px;\n}\n\n    .yunxin-whiteboard-float .panel {\n        position: fixed;\n        display: inline-flex;\n        flex-direction: row;\n        flex-wrap: wrap;\n        justify-content: center;\n        padding: 12px;\n        background-color: white;\n        box-shadow: rgba(5, 0, 50, 0.14) 0px 4px 16px 0;\n        left: 0;\n        top: 0;\n        max-width: 192px;\n        z-index: 10;\n        cursor: auto;\n    }\n\n    .yunxin-whiteboard-float .panel .selected::after{\n            content: '';\n            position: absolute;\n            width: 100%;\n            height: 100%;\n            top: -4px;\n            left: -4px;\n            padding: 3px;\n            border: 1px solid blue;\n        }\n\n    .yunxin-whiteboard-float .panel .slider {\n            display: block;\n            height: 42px;\n        }\n\n    .yunxin-whiteboard-float .panel .slider input{\n                top: 4px;\n                width: 100%;\n            }\n\n    .yunxin-whiteboard-float .panel .slider .tips{\n                position: absolute;\n                left: 0;\n                right: 0;\n                bottom: 4px;\n                display: flex;\n                justify-content: space-between;\n                font-size: 14px;\n            }\n\n    .yunxin-whiteboard-float .panel .radio-item {\n            margin: 8px;\n        }\n\n    .yunxin-whiteboard-float .color-platte .color-style-background{\n            border: 1px solid rgba(0,0,0,.1);\n            width: 24px;\n            height: 24px;\n            border-radius: 50%;\n            padding: 1px;\n        }\n\n    .yunxin-whiteboard-float .color-platte .color-style-border{\n            border: 4px solid rgba(0,0,0,.1);\n            width: 24px;\n            height: 24px;\n            border-radius: 50%;\n            padding: 1px;\n        }\n\n    .yunxin-whiteboard-float .color-platte .color-style-border::before{\n            content: '';\n            position: absolute;\n            width: 16px;\n            height: 16px;\n            border-radius: 50%;\n            left: -1px;\n            top: -1px;\n            border: 1px solid rgba(0,0,0,.1);\n        }\n\n    .yunxin-whiteboard-float .color-platte .color-style-border::after{\n            content: '';\n            position: absolute;\n            width: 24px;\n            height: 24px;\n            border-radius: 50%;\n            left: -5px;\n            top: -5px;\n            border: 1px solid rgba(0,0,0,.1);\n        }\n\n    .yunxin-whiteboard-float .color-platte .color-style-icon{\n            display: inline-flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            padding-top: 0;\n            padding-bottom: 0;\n        }\n\n    .yunxin-whiteboard-float .color-platte .color-style-icon i{\n                font-size: 16px;\n            }\n\n    .yunxin-whiteboard-float .color-platte .color-style-icon .default-icon-color-block{\n                border: 1px solid rgba(0,0,0,.1);\n                background-color: gray;\n                width: 120%;\n                height: 3px;\n            }\n\n    .yunxin-whiteboard-float .color-platte .panel{\n            justify-content: space-between;\n        }\n\n    .yunxin-whiteboard-float .color-platte .panel .opacity{\n                display: block;\n                height: 42px;\n            }\n\n    .yunxin-whiteboard-float .color-platte .panel .opacity input{\n                    top: 4px;\n                    width: 100%;\n                }\n\n    .yunxin-whiteboard-float .color-platte .panel .opacity .tips{\n                    position: absolute;\n                    left: 0;\n                    right: 0;\n                    bottom: 4px;\n                    display: flex;\n                    justify-content: space-between;\n                    font-size: 14px;\n                }\n\n    .yunxin-whiteboard-float .color-platte .panel .color{\n                border: 1px solid rgba(0,0,0,.1);\n                width: 16px;\n                height: 16px;\n                margin: 4px;\n                border-radius: 50%;\n            }\n\n    .yunxin-whiteboard-float .color-platte .panel .radio-item-checked::after{\n                content: '';\n                position: absolute;\n                width: 100%;\n                height: 100%;\n                top: -4px;\n                left: -4px;\n                padding: 3px;\n                border: 1px solid blue;\n                border-radius: 50%;\n            }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayRemove=void 0;var a,r=n(7),i=(a=r)&&a.__esModule?a:{default:a};t.arrayRemove=function(e,t){var n="string"==typeof t?[t]:t,a=!0,r=!1,o=void 0;try{for(var s,u=(0,i.default)(n);!(a=(s=u.next()).done);a=!0){var l=s.value,c=e.indexOf(l);-1!==c&&e.splice(c,1)}}catch(e){r=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw o}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(5)),r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){var n=this;(0,r.default)(this,e),this.showPopup=function(e){var t=e.x,r=e.y,i=n.app.container.el,o=u(t,r,i);n.hidePopup();var s=document.createElement("div");s.id="yx-shape-popup",i.appendChild(s),(0,a.default)(s.style,{background:"white",width:"130px",position:"absolute",left:o.x+"px",top:o.y+"px",boxShadow:"0 8px 24px -4px rgba(0,0,0,0.1)",padding:"5px",display:"flex",justifyContent:"space-around",flexWrap:"wrap"});var l=n.app.shapeManager.getPopupShapes(),c=function(t){var r=document.createElement("div");(0,a.default)(r.style,{width:"40px",height:"40px",display:"inline-block",background:"url("+l[t].icon+") center center no-repeat",marginBottom:"2px",cursor:"pointer"}),r.onclick=function(){n.hidePopup(),e.onSelect(t)},s.appendChild(r)};for(var d in l)c(d)},this.onSelectChange=function(e,t){clearTimeout(n.timer),n.timer=setTimeout(n.hidePopup,100)},this.hidePopup=function(){var e=n.app.container.el.querySelector("#yx-shape-popup");e&&e.remove()},this.app=t,t.opsManager.hooks.selectChange.tap("selectChange",this.onSelectChange),t.on("event:camera:transform",this.hidePopup)}return(0,i.default)(e,[{key:"destroy",value:function(){this.app.off("event:camera:transform",this.hidePopup),this.hidePopup()}}]),e}(),u=function(e,t,n){return t+=10,e=Math.max(e,0),e=Math.min(e,n.clientWidth-130),t=Math.max(t,0),{x:e,y:t=Math.min(t,n.clientHeight-100)}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(7)),r=d(n(0)),i=d(n(1)),o=n(31),s=d(n(33)),u=d(n(447)),l=d(n(254)),c=d(n(448));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){var n=this;(0,r.default)(this,e),this.resourceCache={},this.mediaResourceCache={},this.crossOriginResourceCache={},this.resourceReadyListeners={},this.retryCount={},this.resourceTimer={},this.lastSuccessImgIndex=0,this.fetchResource=function(e,t){var a=(e=Array.isArray(e)?e:[e])[0],r=n.retryCount[a]||0,i=e[(0===r?n.lastSuccessImgIndex:r)%e.length],o=!n.resourceCache.hasOwnProperty(a);(o&&(r>=e.length&&!n.app.appConfig.resRetryCors?n.resourceCache[a]=new Image:(n.crossOriginResourceCache[a]=new Image,n.crossOriginResourceCache[a].crossOrigin="anonymous",n.resourceCache[a]=n.crossOriginResourceCache[a])),"function"==typeof t)&&(n.resourceLoaded(a)||-1===(n.resourceReadyListeners[a]||[]).indexOf(t)&&n.setResourceLoadedCallback(e,"",t));o&&(n.resourceCache[a].src=i)},this.fetchMediaResource=function(e,t,a,r){var i=void 0,o=void 0;if(!n.mediaResourceCache.hasOwnProperty(e))if(n.mediaResourceCache[e]=document.createElement(a),"audio"===a){var s=document.createElement("source");o=s,i=e,s.setAttribute("type",t),n.mediaResourceCache[e].appendChild(s)}else(o=n.mediaResourceCache[e]).poster=c.default,i=e+"#t=0.1";"function"==typeof r&&(n.mediaResourceLoaded(e,a)||-1===(n.resourceReadyListeners[e]||[]).indexOf(r)&&n.setResourceLoadedCallback(e,t,r,a));o&&i&&(o.src=i)},this.setResourceLoadedCallback=function(e,t,r,i){var u=(e=Array.isArray(e)?e:[e])[0];n.resourceReadyListeners[u]=n.resourceReadyListeners[u]||[],n.resourceReadyListeners[u].push(r);var l=i?n.mediaResourceCache[u]:n.resourceCache[u],c=function(a){var c;clearTimeout(n.resourceTimer[u]),l.onerror=null,(c=n.retryCount)[u]||(c[u]=0),console.error("[白板] "+(i||"image")+"资源 [url: "+l.src+"] 第"+n.retryCount[u]+"加载失败");var d=i?"video"===i?s.default.VIDEO_UPLOAD_FAIL:s.default.AUDIO_UPLOAD_FAIL:s.default.PIC_UPLOAD_FAIL,p=n.retryCount[u]<3,h=i?"video"===i?"视频":"音频":"图片";if(n.retryCount[u]>0&&n.retryCount[u]<=3){var f=Math.ceil(n.app.appConfig.resRetryInterval/1e3);(0,o.showToast)({type:"error",msg:h+"加载失败"+(p?", "+f+"s后将尝试重新加载("+(n.retryCount[u]+1)+"/3)":""),time:3,msgType:d})}var g=n.retryCount[u]>0?n.app.appConfig.resRetryInterval:100;setTimeout((function(){delete n.resourceCache[u],delete n.mediaResourceCache[u],delete n.resourceReadyListeners[u],p&&(i?n.fetchMediaResource(u,t,i,r):n.fetchResource(e,r))}),g),n.retryCount[u]+=1};clearTimeout(n.resourceTimer[u]),n.resourceTimer[u]=setTimeout((function(){c()}),8e3),i?l.onloadedmetadata=function(){clearTimeout(n.resourceTimer[u]);var e=n.resourceReadyListeners[u]||[],t=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(e);!(t=(o=s.next()).done);t=!0){(0,o.value)(l)}}catch(e){r=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw i}}}:l.onload=function(){var t=l.src,r=e.indexOf(t);n.lastSuccessImgIndex=-1===r?n.lastSuccessImgIndex:r,clearTimeout(n.resourceTimer[u]);var i=n.resourceReadyListeners[u]||[],o=!0,s=!1,c=void 0;try{for(var d,p=(0,a.default)(i);!(o=(d=p.next()).done);o=!0){(0,d.value)(l)}}catch(e){s=!0,c=e}finally{try{!o&&p.return&&p.return()}finally{if(s)throw c}}},l.onerror=c},this.resourceLoaded=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t?n.crossOriginResourceCache[e]:n.resourceCache[e];return a&&a.complete&&a.width>0&&a.height>0},this.getResource=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?n.crossOriginResourceCache[e]:n.resourceCache[e]},this.mediaResourceLoaded=function(e,t){var a=n.mediaResourceCache[e];return a&&a.readyState>=1},this.getMediaResource=function(e){return n.mediaResourceCache[e]},this.app=t,this.resourceCache.imageLoading=new Image,this.resourceCache.imageLoading.src=u.default,this.resourceCache.audio=new Image,this.resourceCache.audio.src=l.default,this.crossOriginResourceCache.imageLoading=new Image,this.crossOriginResourceCache.imageLoading.src=u.default,this.crossOriginResourceCache.imageLoading.setAttribute("crossorigin","anonymous")}return(0,i.default)(e,[{key:"destroy",value:function(){this.resourceCache={},this.mediaResourceCache={},this.crossOriginResourceCache={},this.resourceReadyListeners={},this.retryCount={},this.resourceTimer={}}}]),e}();t.default=p},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgwIiBoZWlnaHQ9IjM2MCIgdmlld0JveD0iMCAwIDQ4MCAzNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wIDBINDgwVjM2MEgwVjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQ3OCAySDJWMzU4SDQ3OFYyWk0wIDBWMzYwSDQ4MFYwSDBaIiBmaWxsPSIjRDlEOURCIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTY2LjI5NCAxMjZIMzE1TDMxNSAxODkuMzg2TDI5NS4wNDkgMTY3LjY0QzI5MS4xNDQgMTYzLjM4NCAyODQuNDU2IDE2My4zMTEgMjgwLjQ2IDE2Ny40ODNMMjM4Ljc5MiAyMTAuOTc3TDIxOS45MTcgMTkxLjU3MkMyMTYuNzg0IDE4OC4zNTEgMjExLjYxMyAxODguMzQxIDIwOC40NjggMTkxLjU1MUwxNjcuMzM4IDIzMy41MjlIMTY2LjI5NEwxNjYuMjk0IDEyNlpNMTY2LjI5NCAyNDEuNTI5QzE2NC40NzggMjQxLjUyOSAxNjIuODAzIDI0MC45MjQgMTYxLjQ2IDIzOS45MDRIMTYxLjA5MkwxNjEuMjUyIDIzOS43NDFDMTU5LjQ0NyAyMzguMjc0IDE1OC4yOTQgMjM2LjAzNiAxNTguMjk0IDIzMy41MjlWMTI2QzE1OC4yOTQgMTIxLjU4MiAxNjEuODc2IDExOCAxNjYuMjk0IDExOEgzMTVDMzE5LjQxOCAxMTggMzIzIDEyMS41ODIgMzIzIDEyNlYyMzMuNTI5QzMyMyAyMzcuOTQ4IDMxOS40MTggMjQxLjUyOSAzMTUgMjQxLjUyOUgxNjYuMjk0Wk0yMDEgMTcxLjgwNEMyMDkuMjg0IDE3MS44MDQgMjE2IDE2NS4wODggMjE2IDE1Ni44MDRDMjE2IDE0OC41MiAyMDkuMjg0IDE0MS44MDQgMjAxIDE0MS44MDRDMTkyLjcxNiAxNDEuODA0IDE4NiAxNDguNTIgMTg2IDE1Ni44MDRDMTg2IDE2NS4wODggMTkyLjcxNiAxNzEuODA0IDIwMSAxNzEuODA0WiIgZmlsbD0iI0U2RTdFQiIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARMAAAC3CAMAAAAGjUrGAAAAb1BMVEVPT0/g4OBMTExERERBQUHj4+Pn5+fR0dH///9JSUnp6elAQEDW1taCgoJwcHBSUlJoaGi7u7teXl7GxsacnJypqanc3Nw6OjqhoaFlZWVZWVlycnLv7++WlpaMjIy2traHh4d7e3uvr681NTX19fUTUkkoAAAGsElEQVR4nO2c2ZaqOhCGMRNJmEUQkUHc/f7PeBKQScHeV7pPUt9FLxeLC/i7JipJOQ4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgMwiJBwh9+1n+BYTA6BgGTa1ourgUWNiti8BRl6U5lWzk4CenEGFbZUE4atKDZPSwgjKZt52wURaE4/Ygn/SYdJF+EdmmCsJhuifIAGP3CH/7MT8JLpP3igxOVGDx7Sf9FIicnoPIjq3kHfn2w34GcXTZ3yiikXcrogoJtoyE9myYin80339wIV/iBju4adImSepvpOZDZ3qoxfe1JFQVI81FFW89Igrr5DlDs5vZouB2FUoYba9oVcwjVdre0rWxsMZkUcRKEnYoyq0QKlQ5t1LFZEtB8cJxqC7KdpIKInG6VI9ezQ20aH5T5ofv0iwizSoNleamZNE+LEW24pd/PV6WMdQ113scMqRiWf9eoCKRzKKwzGRRbkoUeRsleesS3iJxy9Bc73FwyKpg/KeLy9va3ZvzFPW9TzzdlxDRVK7jpEpj8kYVbxGUa3Nzj7NwGOKqlNyWb0KF8KfsQw12ngXEpbp0O+3nIHSZDaUwOMzO9JroWiXYDSv4NCefjz7bt3hoohwojfdUwe7oPbIxOqI8INP70t32q+hGQzG6cJuYNdFhpd4OKyQdb2KxBWF2qYkOK93mZ3I3Vm6ssMB51pocqEwvG+4hfJuc50mTPqygF1vAxRRRDP48HnnRRLfeavKkylyjsMB859nQpA8r3tocZucx+ev4waYmQ1hZqoLbx200tVUTHVayaOEloh6dx7fUdwYHOtTzYjG6TvV99M3H/Qj7mihV3KlaQccp8RyNTzzvNFEOlIzVSjQJZX4l+1aTPqw8/Cd/XDG6AznwiyZKg1MvChqTMWiiDGXQADSZFJH3R5syAt95vP9UuaFyvMYuNmvC/GBq6KPYoo/AXU0oXfatRTBqkn/xYT/EjiZUrtc3xNgsoK6ttb1Mn7Yc4LH7SFs7vwGZf3vuQM5lrNlrgT2vmlBavDTa5nDCzE/FL5qoT5zjq3fgZLwrN1+SZ02Ye91o3KPjtAiUmB9O1pqwvNlcC5xb1PJmfjhZaqK/gTffGEWzbJ9+vm8waUJlsrfjAmdTEWtBJp41ke7V2wmfi80W0vyGkjNqwg7bgWRxS28mFjTtneGFVSBx9kMnKWYzuRpsJnMsJS6TWxXJfOu0fm62mZB6bBU5qEs3txKMiHjepCTNbZ0gfJcsHc+bvz9JLC6L6sXcZVHUb7lnafQX1RcO54qOmrsCKMphEz31tzaarMG3ZZEbmqoJivOxSKPNu73COhAvT4Sxk7GeUy7On+xXro4+qnL1Fwd4WGvumdrFp8vwhbMdYhE+Jstjg8zkNCzCdW+AZiV5Hu2BhBeuT6lT1+jxH0qU51199ZFgPQxGIwTGYeHLp66K4ZNiVMnx3FpjfnK6XePjJeyaLM3l0yF1mRptJRoRvZ7Mp9NImNej6DKz4HQ+Evfnk+j7UGrwMdolOMj/cogDSy2YVjAgovvfDPvQe9rM95sRhOP0N1UYvZe2GMmAKlQTtu9BlB3uR4uM5AEixyKXWzNPKJNu7diniAYJHGYuk2yaBqN+MHnQZZxdXrMCYeJc63vq5rqU890ka2LrJ/k5vblgQjwF0WNhrNcDAAAAAAAA+D+w7D/bXMKKcQULY3SZt7yW5h/22wW3+dBkxYn/p+LjZVH8mLva9xso5t1wpI3X+HYa2wLiVNmriePlrn57fOeeQ/SIMUSw8EivCcIe8gYzQoQIz5ZGigi4Dh3iJ8MiS7AjYpdzGdRKExQlnP+0OvKKi7pa2TFYSuH9tEqJhkdIhRQiOu538YnnkqCoqm6XppLIQSE/BHHGbZh5ohEFR4iwlOgw66Gf9CwQLrkkOJUeEcSrEoylq66SmFtwPkWDHH4iVx4jrck5UPaiLpK78h1+74Ig6NoffO39yyEJtcRQcFL9cQ9en47PRXXW10RTeUf+GGDuOzV/XP2xRBOVjm9cn7LQmjS8z8EqF3slDz2iOJ9VHO61wEVliSaO5/NKZ2EdT0re6CR8PlQE00Rbh3fPcMTr/mplxckDjTKDfrCYzjs4483ZE66KseLKs7PnZTwQuFBXz8gfgo0V4GG8C05z4pBMFSI8PanaHgeqUuFcD5glhapUODP/lPWCxyiCUv3BqAtK0v8UIryFw4gcdfV2eb9j1GjQvNa1/RMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4d/kP29xLaKNz9DgAAAAASUVORK5CYII="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=g(n(0)),r=g(n(1)),i=n(29),o=g(n(148)),s=g(n(149)),u=g(n(450)),l=g(n(451)),c=g(n(452)),d=g(n(453)),p=g(n(454)),h=g(n(455)),f=g(n(456));function g(e){return e&&e.__esModule?e:{default:e}}var v=.5522848,y=.1,m=function(){function e(t){(0,a.default)(this,e),this.ShapeDesc={diamond:{hint:"菱形",icon:f.default,path:[{per:[-1/8,1/8],t:"l",pos:[[0,.5],[.5,0]]},{per:[1/8,3/8],t:"l",pos:[[.5,0],[1,.5]]},{per:[3/8,5/8],t:"l",pos:[[1,.5],[.5,1]]},{per:[5/8,7/8],t:"l",pos:[[.5,1],[0,.5]]}],dir:[{per:[0,.25],angle:i.DIRECTION.UP},{per:[.25,.5],angle:i.DIRECTION.RIGHT},{per:[.5,.75],angle:i.DIRECTION.DOWN},{per:[.75,1],angle:i.DIRECTION.LEFT}],textB:[[.23,.25],[.75,.77]]},"round-rect":{hint:"圆角矩形",icon:u.default,path:function(e,t){var n=e>t?y*t/e:y,a=e>t?y:y*e/t;return[{per:[.02,.23],t:"l",pos:[[n,0],[1-n,0]]},{per:[.23,.27],t:"b",pos:[[1-n,0],[1-n+n*v,0],[1,a-a*v],[1,a]]},{per:[.27,.48],t:"l",pos:[[1,a],[1,1-a]]},{per:[.48,.52],t:"b",pos:[[1,1-a],[1,1-a+a*v],[1-n+n*v,1],[1-n,1]]},{per:[.52,.73],t:"l",pos:[[1-n,1],[n,1]]},{per:[.73,.77],t:"b",pos:[[n,1],[n-n*v,1],[0,1-a+a*v],[0,1-a]]},{per:[.77,.98],t:"l",pos:[[0,1-a],[0,a]]},{per:[.98,.02],t:"b",pos:[[0,a],[0,a-a*v],[n-n*v,0],[n,0]]}]},dir:[{per:[0,.25],angle:i.DIRECTION.UP},{per:[.25,.5],angle:i.DIRECTION.RIGHT},{per:[.5,.75],angle:i.DIRECTION.DOWN},{per:[.75,1],angle:i.DIRECTION.LEFT}],textB:[[y-y/Math.SQRT2,y-y/Math.SQRT2],[1-2*(y-y/Math.SQRT2),1-2*(y-y/Math.SQRT2)]]},parallelogram:{hint:"平行四边形",icon:l.default,path:[{per:[0,.125],t:"l",pos:[[.2,0],[.5,0]]},{per:[.125,.25],t:"l",pos:[[.5,0],[1,0]]},{per:[.25,.5],t:"l",pos:[[1,0],[.8,1]]},{per:[.5,.625],t:"l",pos:[[.8,1],[.5,1]]},{per:[.625,.75],t:"l",pos:[[.5,1],[0,1]]},{per:[.75,1],t:"l",pos:[[0,1],[.2,0]]}],dir:[{per:[0,.25],angle:i.DIRECTION.UP},{per:[.25,.5],angle:i.DIRECTION.RIGHT},{per:[.5,.75],angle:i.DIRECTION.DOWN},{per:[.75,1],angle:i.DIRECTION.LEFT}],textB:[[.2,0],[.8,1]]},cloud:{hint:"云状",icon:c.default,path:[{per:[0,.27],t:"b",pos:[[.273,.157],[.333,-.03],[.718,-.058],[.82,.14]]},{per:[.27,.375],t:"b",pos:[[.82,.14],[1.005,.152],[1.067,.368],[.922,.5]]},{per:[.375,.466],t:"b",pos:[[.922,.5],[1.043,.645],[1.018,.8],[.888,.87]]},{per:[.466,.625],t:"b",pos:[[.888,.87],[.902,1.008],[.625,1.053],[.5,.912]]},{per:[.625,.739],t:"b",pos:[[.5,.912],[.35,1.057],[.145,1.018],[.145,.823]]},{per:[.739,.875],t:"b",pos:[[.145,.823],[.01,.783],[-.06,.65],[.082,.5]]},{per:[.875,1],t:"b",pos:[[.082,.5],[-.105,.278],[.092,.098],[.273,.157]]}],dir:[{per:[0,.25],angle:i.DIRECTION.UP},{per:[.25,.5],angle:i.DIRECTION.RIGHT},{per:[.5,.75],angle:i.DIRECTION.DOWN},{per:[.75,1],angle:i.DIRECTION.LEFT}],textB:[[.15,.16],[.89,.88]]},rect:{hint:"矩形",icon:s.default,path:[{per:[0,.25],t:"l",pos:[[0,0],[1,0]]},{per:[.25,.5],t:"l",pos:[[1,0],[1,1]]},{per:[.5,.75],t:"l",pos:[[1,1],[0,1]]},{per:[.75,1],t:"l",pos:[[0,1],[0,0]]}],dir:[{per:[0,.25],angle:i.DIRECTION.UP},{per:[.25,.5],angle:i.DIRECTION.RIGHT},{per:[.5,.75],angle:i.DIRECTION.DOWN},{per:[.75,1],angle:i.DIRECTION.LEFT}],textB:[[.02,.02],[.98,.98]]},triangle:{hint:"等腰三角形",icon:h.default,path:[{per:[0,.125],t:"l",pos:[[1/3,1/3],[.5,0]]},{per:[.125,.25],t:"l",pos:[[.5,0],[2/3,1/3]]},{per:[.25,.5],t:"l",pos:[[2/3,1/3],[1,1]]},{per:[.5,.75],t:"l",pos:[[1,1],[0,1]]},{per:[.75,1],t:"l",pos:[[0,1],[1/3,1/3]]}],dir:[{per:[0,.125],angle:i.DIRECTION.UP},{per:[.125,.25],angle:i.DIRECTION.UP},{per:[.25,.5],angle:i.DIRECTION.RIGHT},{per:[.5,.75],angle:i.DIRECTION.DOWN},{per:[.75,1],angle:i.DIRECTION.LEFT}],textB:[[.25,.5],[.75,1]]},ellipse:{hint:"椭圆",icon:p.default,textB:[[.14,.14],[.86,.86]],path:[{t:"b",pos:[[0,.5],[0,.2238576],[.2238576,0],[.5,0]],per:[-1/8,1/8]},{t:"b",pos:[[.5,0],[.7761424,0],[1,.2238576],[1,.5]],per:[1/8,3/8]},{t:"b",pos:[[1,.5],[1,.7761424],[.7761424,1],[.5,1]],per:[3/8,5/8]},{t:"b",pos:[[.5,1],[.2238576,1],[0,.7761424],[0,.5]],per:[5/8,7/8]}],dir:[{per:[0,1/4],angle:i.DIRECTION.UP},{per:[1/4,.5],angle:i.DIRECTION.RIGHT},{per:[.5,3/4],angle:i.DIRECTION.DOWN},{per:[3/4,1],angle:i.DIRECTION.LEFT}]},star:{hint:"星形",icon:d.default,textB:[[.25,.33],[.75,.8]],path:[{t:"l",per:[.125,.225],pos:[[.5,0],[.655,.329]]},{t:"l",per:[.225,.325],pos:[[.655,.329],[1,.382]]},{t:"l",per:[.325,.425],pos:[[1,.382],[.75,.724]]},{t:"l",per:[.425,.525],pos:[[.75,.724],[.809,1]]},{t:"l",per:[.525,.625],pos:[[.809,1],[.5,.829]]},{t:"l",per:[.625,.725],pos:[[.5,.829],[.191,1]]},{t:"l",per:[.725,.825],pos:[[.191,1],[.25,.724]]},{t:"l",per:[.825,.925],pos:[[.25,.724],[0,.382]]},{t:"l",per:[-.075,.025],pos:[[0,.382],[.345,.329]]},{t:"l",per:[.025,.125],pos:[[.345,.329],[.5,0]]}],dir:[{per:[0,.25],angle:i.DIRECTION.UP},{per:[.25,.5],angle:i.DIRECTION.RIGHT},{per:[.5,.75],angle:i.DIRECTION.DOWN},{per:[.75,1],angle:i.DIRECTION.LEFT}]}},this.popupShapes=["text","rect","round-rect","triangle","parallelogram","cloud","ellipse","star","diamond"],this.floatShapes=["text","rect","round-rect","triangle","parallelogram","cloud","ellipse","star","diamond"],this.tbShapes=["rect","round-rect","triangle","parallelogram","cloud","ellipse","star","diamond"],this.app=t}return(0,r.default)(e,[{key:"getShapeIcons",value:function(e){var t=this,n={};return e.forEach((function(e){t.ShapeDesc.hasOwnProperty(e)?n[e]={icon:t.ShapeDesc[e].icon,hint:t.ShapeDesc[e].hint}:"text"===e?n[e]={icon:o.default,hint:"文本"}:t.app.logger.error("Shape "+e+"未注册")})),n}},{key:"getPopupShapes",value:function(){return this.getShapeIcons(this.popupShapes)}},{key:"getFloatShapes",value:function(){return this.getShapeIcons(this.floatShapes)}},{key:"getTbShapes",value:function(){return this.getShapeIcons(this.tbShapes)}},{key:"getShapeBoundByTextBound",value:function(e,t){var n=(this.ShapeDesc[e]||this.ShapeDesc.rect).textB||[[0,0],[1,1]],a=t.w/(n[1][0]-n[0][0]),r=t.h/(n[1][1]-n[0][1]);return{w:a,h:r,sx:t.sx-a*n[0][0],sy:t.sy-r*n[0][1]}}}]),e}();t.default=m},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHJ4PSI0IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuNiIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTk2NjM5NzIxMyIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAwMCAxMDAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iODQxMiIgd2lkdGg9IjQwIgogICAgaGVpZ2h0PSI0MCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHBhdGgKICAgICAgICBkPSJNMzUwIDMwMGg0MDBsLTEwMCA0MDBoLTQwMHoiCiAgICAgICAgc3Ryb2tlLXdpZHRoPSI0MCIgc3Ryb2tlPSIjMDAwMDAwIiBmaWxsPSJub25lIj48L3BhdGg+Cjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTk2NjM5NzIxMyIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAwMCAxMDAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iODQxMiIgd2lkdGg9IjQwIgogICAgaGVpZ2h0PSI0MCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHBhdGgKICAgICAgICBkPSJNMzYzLjkzIDMzMC4xM0MzOTkuNDcgMjA5LjY3LCA2MTIuNjcgMjIwLjA3LCA2MzMuNDcgMzE1LjQwQzc0NS4yNyAzMDAuNjcsIDc5NS41MyA0MDkuMDAsIDczMS40MCA1MDMuNDdDNzk5LjAwIDU5MS4wMCwgNzM2LjYwIDcyOS42NywgNjUwLjgwIDcwMS45M0M2MjAuNDcgNzcwLjQwLCA1MzIuOTMgNzg2Ljg3LCA0ODcuODcgNzAxLjkzQzQxOC41MyA3ODIuNTMsIDMzMy42MCA3NDIuNjcsIDMxNS40MCA2NjguMTNDMjM1LjY3IDYyOC4yNywgMjE0LjAwIDU0NC4yMCwgMjgxLjYwIDQ3NC4wMEMxOTQuMDcgNDA5Ljg3LCAyOTIuMDAgMjkyLjAwLCAzNjMuOTMgMzMwLjEzIgogICAgICAgIHN0cm9rZS13aWR0aD0iNDAiIHN0cm9rZT0iIzAwMDAwMCIgZmlsbD0ibm9uZSI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHZpZXdCb3g9IjAgMCA0MCA0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiPgogICAgPHBhdGgKICAgIGQ9Ik0yMCA5bDMuMjMgNi41NWw3LjIzIDEuMDVsLTUuMjMgNi44MGwxLjIzIDUuNTBsLTYuNDcgLTMuNDBsLTYuNDcgMy40MGwxLjIzIC01LjUwbC01LjIzIC02LjgwbDcuMjMgLTEuMDV6IgogICAgc3Ryb2tlLXdpZHRoPSIxLjYiIHN0cm9rZT0iIzAwMDAwMCIgZmlsbD0ibm9uZSI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMS44Ii8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTk2NjM5NzIxMyIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAwMCAxMDAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iODQxMiIgd2lkdGg9IjQwIgogICAgaGVpZ2h0PSI0MCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHBhdGgKICAgICAgICBkPSJNNTAwIDI4MGwtMjIwIDQ0MGw0NDAgMHoiCiAgICAgICAgc3Ryb2tlLXdpZHRoPSI0MCIgc3Ryb2tlPSIjMDAwMDAwIiBmaWxsPSJub25lIj48L3BhdGg+Cjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTY1NTk2NjM5NzIxMyIKICAgIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAwMCAxMDAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iODQxMiIgd2lkdGg9IjQwIgogICAgaGVpZ2h0PSI0MCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHBhdGgKICAgICAgICBkPSJNNTAwIDI1MGwtMjUwIDI1MGwyNTAgMjUwbDI1MCAtMjUwbC0yNTAgLTI1MCIKICAgICAgICBzdHJva2Utd2lkdGg9IjQwIiBzdHJva2U9IiMwMDAwMDAiIGZpbGw9Im5vbmUiPjwvcGF0aD4KPC9zdmc+"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(0)),r=l(n(1)),i=l(n(458)),o=l(n(146)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(261)),u=n(255);function l(e){return e&&e.__esModule?e:{default:e}}var c=(new Date).valueOf(),d=function(){function e(t){(0,a.default)(this,e),this.dispatcher=new o.default,this.logger=new i.default("whiteboard-"+t,864e5),this.wrapLog(),this.log(u.SPLITTER)}return(0,r.default)(e,[{key:"getLogTilNow",value:function(){var e=(new Date).valueOf();return this.logger.get({start:0,end:e}).then((function(e){return e}))}},{key:"deleteLogTilNow",value:function(){var e=(new Date).valueOf();this.logger.delete({start:0,end:e})}},{key:"wrapLog",value:function(){this.log=this.wrapLogByType("log"),this.info=this.wrapLogByType("info"),this.error=this.wrapLogByType("error"),this.warn=this.wrapLogByType("warn"),this.debug=this.wrapLogByType("debug")}},{key:"wrapLogByType",value:function(e){var t=this;return function(){for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];var i=Array.prototype.slice.apply(a);i=[t.getLogPrefix()].concat(i);var o=t.argsToString.call(t,i,e);try{t.dispatcher.emit("log",{type:e,msg:o}),"error"===e&&console[e].apply(console,i),t.logger.log(e,o)}catch(e){}}}},{key:"argsToString",value:function(e,t){var n="";try{for(var a=[],r=0;r<e.length;r++)s.isFunction(e[r])?a.push(e[r].toString()):s.isObject(e[r])||s.isArray(e[r])?a.push(s.JSONStringify(e[r])):a.push(e[r]);n=a.join(" ")}catch(e){}return this.padEnd(t,5)+" "+n}},{key:"getLogPrefix",value:function(){var e=new Date,t=e.valueOf()-c,n=e.toLocaleString();return"+"+this.pad(t/1e3,1,6)+"s "+n}},{key:"pad",value:function(e,t,n){for(var a=e.toFixed(t).toString();a.length<n;)a=" "+a;return a}},{key:"padEnd",value:function(e,t){for(;e.length<t;)e+=" ";return e}}]),e}();t.default=d},function(e,t,n){window,e.exports=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=106)}([function(e,t,n){"use strict";var a=n(3),r=n(27).f,i=n(74),o=n(9),s=n(12),u=n(14),l=n(13),c=function(e){var t=function(t,n,a){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,a)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var n,d,p,h,f,g,v,y,m=e.target,M=e.global,x=e.stat,w=e.proto,I=M?a:x?a[m]:(a[m]||{}).prototype,b=M?o:o[m]||(o[m]={}),k=b.prototype;for(p in t)n=!i(M?p:m+(x?".":"#")+p,e.forced)&&I&&l(I,p),f=b[p],n&&(g=e.noTargetGet?(y=r(I,p))&&y.value:I[p]),h=n&&g?g:t[p],n&&typeof f==typeof h||(v=e.bind&&n?s(h,a):e.wrap&&n?c(h):w&&"function"==typeof h?s(Function.call,h):h,(e.sham||h&&h.sham||f&&f.sham)&&u(v,"sham",!0),b[p]=v,w&&(l(o,d=m+"Prototype")||u(o,d,{}),o[d][p]=h,e.real&&k&&!k[p]&&u(k,p,h)))}},function(e,t,n){var a=n(10);e.exports=function(e){if(!a(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){e.exports=!0},function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,n(110))},function(e,t,n){var a=n(1),r=n(116),i=n(29),o=n(12),s=n(82),u=n(117),l=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,n){var c,d,p,h,f,g,v,y=n&&n.that,m=!(!n||!n.AS_ENTRIES),M=!(!n||!n.IS_ITERATOR),x=!(!n||!n.INTERRUPTED),w=o(t,y,1+m+x),I=function(e){return c&&u(c),new l(!0,e)},b=function(e){return m?(a(e),x?w(e[0],e[1],I):w(e[0],e[1])):x?w(e,I):w(e)};if(M)c=e;else{if("function"!=typeof(d=s(e)))throw TypeError("Target is not iterable");if(r(d)){for(p=0,h=i(e.length);h>p;p++)if((f=b(e[p]))&&f instanceof l)return f;return new l(!1)}c=d.call(e)}for(g=c.next;!(v=g.call(c)).done;){try{f=b(v.value)}catch(e){throw u(c),e}if("object"==typeof f&&f&&f instanceof l)return f}return new l(!1)}},function(e,t,n){var a=n(9),r=n(13),i=n(68),o=n(15).f;e.exports=function(e){var t=a.Symbol||(a.Symbol={});r(t,e)||o(t,e,{value:i.f(e)})}},function(e,t,n){var a=n(3),r=n(53),i=n(13),o=n(40),s=n(58),u=n(81),l=r("wks"),c=a.Symbol,d=u?c:c&&c.withoutSetter||o;e.exports=function(e){return i(l,e)&&(s||"string"==typeof l[e])||(s&&i(c,e)?l[e]=c[e]:l[e]=d("Symbol."+e)),l[e]}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){e.exports={}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var a=n(7);e.exports=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,n){var a=n(8);e.exports=function(e,t,n){if(a(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,r){return e.call(t,n,a,r)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var a=n(19),r={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return r.call(a(e),t)}},function(e,t,n){var a=n(11),r=n(15),i=n(22);e.exports=a?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var a=n(11),r=n(73),i=n(1),o=n(37),s=Object.defineProperty;t.f=a?s:function(e,t,n){if(i(e),t=o(t,!0),i(n),r)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var a=n(9),r=n(3),i=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?i(a[e])||i(r[e]):a[e]&&a[e][t]||r[e]&&r[e][t]}},function(e,t,n){var a=n(2),r=n(224);e.exports=a?r:function(e){return Map.prototype.entries.call(e)}},function(e,t,n){var a=n(72),r=n(36);e.exports=function(e){return a(r(e))}},function(e,t,n){var a=n(36);e.exports=function(e){return Object(a(e))}},function(e,t,n){var a,r,i,o=n(89),s=n(3),u=n(10),l=n(14),c=n(13),d=n(54),p=n(39),h=n(30),f=s.WeakMap;if(o||d.state){var g=d.state||(d.state=new f),v=g.get,y=g.has,m=g.set;a=function(e,t){if(y.call(g,e))throw new TypeError("Object already initialized");return t.facade=e,m.call(g,e,t),t},r=function(e){return v.call(g,e)||{}},i=function(e){return y.call(g,e)}}else{var M=p("state");h[M]=!0,a=function(e,t){if(c(e,M))throw new TypeError("Object already initialized");return t.facade=e,l(e,M,t),t},r=function(e){return c(e,M)?e[M]:{}},i=function(e){return c(e,M)}}e.exports={set:a,get:r,has:i,enforce:function(e){return i(e)?r(e):a(e,{})},getterFor:function(e){return function(t){var n;if(!u(t)||(n=r(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t,n){var a=n(9);e.exports=function(e){return a[e+"Prototype"]}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports={}},function(e,t,n){var a=n(59),r=n(15).f,i=n(14),o=n(13),s=n(119),u=n(6)("toStringTag");e.exports=function(e,t,n,l){if(e){var c=n?e:e.prototype;o(c,u)||r(c,u,{configurable:!0,value:t}),l&&!a&&i(c,"toString",s)}}},function(e,t,n){var a=n(12),r=n(72),i=n(19),o=n(29),s=n(63),u=[].push,l=function(e){var t=1==e,n=2==e,l=3==e,c=4==e,d=6==e,p=7==e,h=5==e||d;return function(f,g,v,y){for(var m,M,x=i(f),w=r(x),I=a(g,v,3),b=o(w.length),k=0,T=y||s,_=t?T(f,b):n||p?T(f,0):void 0;b>k;k++)if((h||k in w)&&(M=I(m=w[k],k,x),e))if(t)_[k]=M;else if(M)switch(e){case 3:return!0;case 5:return m;case 6:return k;case 2:u.call(_,m)}else switch(e){case 4:return!1;case 7:u.call(_,m)}return d?-1:l||c?c:_}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterOut:l(7)}},function(e,t,n){e.exports=n(107)},function(e,t,n){var a=n(11),r=n(71),i=n(22),o=n(18),s=n(37),u=n(13),l=n(73),c=Object.getOwnPropertyDescriptor;t.f=a?c:function(e,t){if(e=o(e),t=s(t,!0),l)try{return c(e,t)}catch(e){}if(u(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var a=n(42),r=Math.min;e.exports=function(e){return e>0?r(a(e),9007199254740991):0}},function(e,t){e.exports={}},function(e,t,n){var a=n(14);e.exports=function(e,t,n,r){r&&r.enumerable?e[t]=n:a(e,t,n)}},function(e,t,n){var a=n(1),r=n(8),i=n(6)("species");e.exports=function(e,t){var n,o=a(e).constructor;return void 0===o||null==(n=a(o)[i])?t:r(n)}},function(e,t,n){"use strict";var a=n(8),r=function(e){var t,n;this.promise=new e((function(e,a){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=a})),this.resolve=a(t),this.reject=a(n)};e.exports.f=function(e){return new r(e)}},function(e,t,n){n(128);var a=n(129),r=n(3),i=n(45),o=n(14),s=n(23),u=n(6)("toStringTag");for(var l in a){var c=r[l],d=c&&c.prototype;d&&i(d)!==u&&o(d,u,l),s[l]=s.Array}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var a=n(10);e.exports=function(e,t){if(!a(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!a(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!a(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!a(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){e.exports=n(111)},function(e,t,n){var a=n(53),r=n(40),i=a("keys");e.exports=function(e){return i[e]||(i[e]=r(e))}},function(e,t){var n=0,a=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+a).toString(36)}},function(e,t,n){var a,r=n(1),i=n(76),o=n(57),s=n(30),u=n(80),l=n(51),c=n(39)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},h=function(){try{a=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;h=a?function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t}(a):((t=l("iframe")).style.display="none",u.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F);for(var n=o.length;n--;)delete h.prototype[o[n]];return h()};s[c]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(d.prototype=r(e),n=new d,d.prototype=null,n[c]=e):n=h(),void 0===t?n:i(n,t)}},function(e,t){var n=Math.ceil,a=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?a:n)(e)}},function(e,t,n){var a,r,i=n(3),o=n(44),s=i.process,u=s&&s.versions,l=u&&u.v8;l?r=(a=l.split("."))[0]<4?1:a[0]+a[1]:o&&(!(a=o.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=o.match(/Chrome\/(\d+)/))&&(r=a[1]),e.exports=r&&+r},function(e,t,n){var a=n(16);e.exports=a("navigator","userAgent")||""},function(e,t,n){var a=n(59),r=n(28),i=n(6)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=a?r:function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t){},function(e,t,n){var a=n(31);e.exports=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:a(e,r,t[r],n);return e}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,n){var a=n(30),r=n(10),i=n(13),o=n(15).f,s=n(40),u=n(217),l=s("meta"),c=0,d=Object.isExtensible||function(){return!0},p=function(e){o(e,l,{value:{objectID:"O"+ ++c,weakData:{}}})},h=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,l)){if(!d(e))return"F";if(!t)return"E";p(e)}return e[l].objectID},getWeakData:function(e,t){if(!i(e,l)){if(!d(e))return!0;if(!t)return!1;p(e)}return e[l].weakData},onFreeze:function(e){return u&&h.REQUIRED&&d(e)&&!i(e,l)&&p(e),e}};a[l]=!0},function(e,t,n){var a=n(3),r=n(10),i=a.document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var a=n(13),r=n(19),i=n(39),o=n(114),s=i("IE_PROTO"),u=Object.prototype;e.exports=o?Object.getPrototypeOf:function(e){return e=r(e),a(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?u:null}},function(e,t,n){var a=n(2),r=n(54);(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.1",mode:a?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var a=n(3),r=n(113),i=a["__core-js_shared__"]||r("__core-js_shared__",{});e.exports=i},function(e,t,n){var a=n(1),r=n(115);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,i){return a(n),r(i),t?e.call(n,i):n.__proto__=i,n}}():void 0)},function(e,t,n){var a=n(77),r=n(57);e.exports=Object.keys||function(e){return a(e,r)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){var a=n(43),r=n(7);e.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&a&&a<41}))},function(e,t,n){var a={};a[n(6)("toStringTag")]="z",e.exports="[object z]"===String(a)},function(e,t,n){var a=n(28),r=n(3);e.exports="process"==a(r.process)},function(e,t,n){"use strict";var a=n(126).charAt,r=n(20),i=n(62),o=r.set,s=r.getterFor("String Iterator");i(String,"String",(function(e){o(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=s(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=a(n,r),t.index+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";var a=n(0),r=n(127),i=n(52),o=n(55),s=n(24),u=n(14),l=n(31),c=n(6),d=n(2),p=n(23),h=n(92),f=h.IteratorPrototype,g=h.BUGGY_SAFARI_ITERATORS,v=c("iterator"),y=function(){return this};e.exports=function(e,t,n,c,h,m,M){r(n,t,c);var x,w,I,b=function(e){if(e===h&&N)return N;if(!g&&e in _)return _[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},k=t+" Iterator",T=!1,_=e.prototype,C=_[v]||_["@@iterator"]||h&&_[h],N=!g&&C||b(h),A="Array"==t&&_.entries||C;if(A&&(x=i(A.call(new e)),f!==Object.prototype&&x.next&&(d||i(x)===f||(o?o(x,f):"function"!=typeof x[v]&&u(x,v,y)),s(x,k,!0,!0),d&&(p[k]=y))),"values"==h&&C&&"values"!==C.name&&(T=!0,N=function(){return C.call(this)}),d&&!M||_[v]===N||u(_,v,N),p[t]=N,h)if(w={values:b("values"),keys:m?N:b("keys"),entries:b("entries")},M)for(I in w)(g||T||!(I in _))&&l(_,I,w[I]);else a({target:t,proto:!0,forced:g||T},w);return w}},function(e,t,n){var a=n(10),r=n(64),i=n(6)("species");e.exports=function(e,t){var n;return r(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!r(n.prototype)?a(n)&&null===(n=n[i])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},function(e,t,n){var a=n(28);e.exports=Array.isArray||function(e){return"Array"==a(e)}},function(e,t,n){"use strict";var a=n(37),r=n(15),i=n(22);e.exports=function(e,t,n){var o=a(t);o in e?r.f(e,o,i(0,n)):e[o]=n}},function(e,t,n){var a=n(7),r=n(6),i=n(43),o=r("species");e.exports=function(e){return i>=51||!a((function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,n){var a=n(77),r=n(57).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return a(e,r)}},function(e,t,n){var a=n(6);t.f=a},function(e,t,n){"use strict";var a=n(7);e.exports=function(e,t){var n=[][e];return!!n&&a((function(){n.call(null,t||function(){throw 1},1)}))}},function(e,t,n){"use strict";var a=n(1);e.exports=function(e,t){var n,r=a(this),i=arguments.length>2?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(e)?(n=r.get(e),"function"==typeof t&&(n=t(n),r.set(e,n))):"function"==typeof i&&(n=i(),r.set(e,n)),n}},function(e,t,n){"use strict";var a={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!a.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:a},function(e,t,n){var a=n(7),r=n(28),i="".split;e.exports=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==r(e)?i.call(e,""):Object(e)}:Object},function(e,t,n){var a=n(11),r=n(7),i=n(51);e.exports=!a&&!r((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var a=n(7),r=/#|\.prototype\./,i=function(e,t){var n=s[o(e)];return n==l||n!=u&&("function"==typeof t?a(t):!!t)},o=i.normalize=function(e){return String(e).replace(r,".").toLowerCase()},s=i.data={},u=i.NATIVE="N",l=i.POLYFILL="P";e.exports=i},function(e,t,n){"use strict";var a=n(0),r=n(52),i=n(55),o=n(41),s=n(14),u=n(22),l=n(4),c=function(e,t){var n=this;if(!(n instanceof c))return new c(e,t);i&&(n=i(new Error(void 0),r(n))),void 0!==t&&s(n,"message",String(t));var a=[];return l(e,a.push,{that:a}),s(n,"errors",a),n};c.prototype=o(Error.prototype,{constructor:u(5,c),message:u(5,""),name:u(5,"AggregateError")}),a({global:!0},{AggregateError:c})},function(e,t,n){var a=n(11),r=n(15),i=n(1),o=n(56);e.exports=a?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),s=a.length,u=0;s>u;)r.f(e,n=a[u++],t[n]);return e}},function(e,t,n){var a=n(13),r=n(18),i=n(78).indexOf,o=n(30);e.exports=function(e,t){var n,s=r(e),u=0,l=[];for(n in s)!a(o,n)&&a(s,n)&&l.push(n);for(;t.length>u;)a(s,n=t[u++])&&(~i(l,n)||l.push(n));return l}},function(e,t,n){var a=n(18),r=n(29),i=n(79),o=function(e){return function(t,n,o){var s,u=a(t),l=r(u.length),c=i(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},function(e,t,n){var a=n(42),r=Math.max,i=Math.min;e.exports=function(e,t){var n=a(e);return n<0?r(n+t,0):i(n,t)}},function(e,t,n){var a=n(16);e.exports=a("document","documentElement")},function(e,t,n){var a=n(58);e.exports=a&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var a=n(45),r=n(23),i=n(6)("iterator");e.exports=function(e){if(null!=e)return e[i]||e["@@iterator"]||r[a(e)]}},function(e,t,n){var a=n(3);e.exports=a.Promise},function(e,t,n){"use strict";var a=n(16),r=n(15),i=n(6),o=n(11),s=i("species");e.exports=function(e){var t=a(e),n=r.f;o&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var a=n(54),r=Function.toString;"function"!=typeof a.inspectSource&&(a.inspectSource=function(e){return r.call(e)}),e.exports=a.inspectSource},function(e,t,n){var a,r,i,o=n(3),s=n(7),u=n(12),l=n(80),c=n(51),d=n(87),p=n(60),h=o.location,f=o.setImmediate,g=o.clearImmediate,v=o.process,y=o.MessageChannel,m=o.Dispatch,M=0,x={},w=function(e){if(x.hasOwnProperty(e)){var t=x[e];delete x[e],t()}},I=function(e){return function(){w(e)}},b=function(e){w(e.data)},k=function(e){o.postMessage(e+"",h.protocol+"//"+h.host)};f&&g||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return x[++M]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},a(M),M},g=function(e){delete x[e]},p?a=function(e){v.nextTick(I(e))}:m&&m.now?a=function(e){m.now(I(e))}:y&&!d?(i=(r=new y).port2,r.port1.onmessage=b,a=u(i.postMessage,i,1)):o.addEventListener&&"function"==typeof postMessage&&!o.importScripts&&h&&"file:"!==h.protocol&&!s(k)?(a=k,o.addEventListener("message",b,!1)):a="onreadystatechange"in c("script")?function(e){l.appendChild(c("script")).onreadystatechange=function(){l.removeChild(this),w(e)}}:function(e){setTimeout(I(e),0)}),e.exports={set:f,clear:g}},function(e,t,n){var a=n(44);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(a)},function(e,t,n){var a=n(1),r=n(10),i=n(33);e.exports=function(e,t){if(a(e),r(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){var a=n(3),r=n(85),i=a.WeakMap;e.exports="function"==typeof i&&/native code/.test(r(i))},function(e,t,n){"use strict";var a=n(0),r=n(8),i=n(33),o=n(49),s=n(4);a({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=i.f(t),a=n.resolve,u=n.reject,l=o((function(){var n=r(t.resolve),i=[],o=0,u=1;s(e,(function(e){var r=o++,s=!1;i.push(void 0),u++,n.call(t,e).then((function(e){s||(s=!0,i[r]={status:"fulfilled",value:e},--u||a(i))}),(function(e){s||(s=!0,i[r]={status:"rejected",reason:e},--u||a(i))}))})),--u||a(i)}));return l.error&&u(l.value),n.promise}})},function(e,t,n){"use strict";var a=n(0),r=n(8),i=n(16),o=n(33),s=n(49),u=n(4);a({target:"Promise",stat:!0},{any:function(e){var t=this,n=o.f(t),a=n.resolve,l=n.reject,c=s((function(){var n=r(t.resolve),o=[],s=0,c=1,d=!1;u(e,(function(e){var r=s++,u=!1;o.push(void 0),c++,n.call(t,e).then((function(e){u||d||(d=!0,a(e))}),(function(e){u||d||(u=!0,o[r]=e,--c||l(new(i("AggregateError"))(o,"No one promise resolved")))}))})),--c||l(new(i("AggregateError"))(o,"No one promise resolved"))}));return c.error&&l(c.value),n.promise}})},function(e,t,n){"use strict";var a,r,i,o=n(7),s=n(52),u=n(14),l=n(13),c=n(6),d=n(2),p=c("iterator"),h=!1;[].keys&&("next"in(i=[].keys())?(r=s(s(i)))!==Object.prototype&&(a=r):h=!0);var f=null==a||o((function(){var e={};return a[p].call(e)!==e}));f&&(a={}),d&&!f||l(a,p)||u(a,p,(function(){return this})),e.exports={IteratorPrototype:a,BUGGY_SAFARI_ITERATORS:h}},function(e,t){e.exports=function(){}},function(e,t,n){"use strict";var a=n(0),r=n(7),i=n(64),o=n(10),s=n(19),u=n(29),l=n(65),c=n(63),d=n(66),p=n(6),h=n(43),f=p("isConcatSpreadable"),g=h>=51||!r((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),v=d("concat"),y=function(e){if(!o(e))return!1;var t=e[f];return void 0!==t?!!t:i(e)};a({target:"Array",proto:!0,forced:!g||!v},{concat:function(e){var t,n,a,r,i,o=s(this),d=c(o,0),p=0;for(t=-1,a=arguments.length;t<a;t++)if(y(i=-1===t?o:arguments[t])){if(p+(r=u(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<r;n++,p++)n in i&&l(d,p,i[n])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");l(d,p++,i)}return d.length=p,d}})},function(e,t,n){"use strict";var a=n(0),r=n(3),i=n(16),o=n(2),s=n(11),u=n(58),l=n(81),c=n(7),d=n(13),p=n(64),h=n(10),f=n(1),g=n(19),v=n(18),y=n(37),m=n(22),M=n(41),x=n(56),w=n(67),I=n(147),b=n(96),k=n(27),T=n(15),_=n(71),C=n(14),N=n(31),A=n(53),P=n(39),O=n(30),D=n(40),S=n(6),E=n(68),j=n(5),L=n(24),z=n(20),R=n(25).forEach,B=P("hidden"),F=S("toPrimitive"),Y=z.set,U=z.getterFor("Symbol"),W=Object.prototype,H=r.Symbol,Q=i("JSON","stringify"),Z=k.f,G=T.f,V=I.f,X=_.f,J=A("symbols"),K=A("op-symbols"),q=A("string-to-symbol-registry"),$=A("symbol-to-string-registry"),ee=A("wks"),te=r.QObject,ne=!te||!te.prototype||!te.prototype.findChild,ae=s&&c((function(){return 7!=M(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(e,t,n){var a=Z(W,t);a&&delete W[t],G(e,t,n),a&&e!==W&&G(W,t,a)}:G,re=function(e,t){var n=J[e]=M(H.prototype);return Y(n,{type:"Symbol",tag:e,description:t}),s||(n.description=t),n},ie=l?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof H},oe=function(e,t,n){e===W&&oe(K,t,n),f(e);var a=y(t,!0);return f(n),d(J,a)?(n.enumerable?(d(e,B)&&e[B][a]&&(e[B][a]=!1),n=M(n,{enumerable:m(0,!1)})):(d(e,B)||G(e,B,m(1,{})),e[B][a]=!0),ae(e,a,n)):G(e,a,n)},se=function(e,t){f(e);var n=v(t),a=x(n).concat(de(n));return R(a,(function(t){s&&!ue.call(n,t)||oe(e,t,n[t])})),e},ue=function(e){var t=y(e,!0),n=X.call(this,t);return!(this===W&&d(J,t)&&!d(K,t))&&(!(n||!d(this,t)||!d(J,t)||d(this,B)&&this[B][t])||n)},le=function(e,t){var n=v(e),a=y(t,!0);if(n!==W||!d(J,a)||d(K,a)){var r=Z(n,a);return!r||!d(J,a)||d(n,B)&&n[B][a]||(r.enumerable=!0),r}},ce=function(e){var t=V(v(e)),n=[];return R(t,(function(e){d(J,e)||d(O,e)||n.push(e)})),n},de=function(e){var t=e===W,n=V(t?K:v(e)),a=[];return R(n,(function(e){!d(J,e)||t&&!d(W,e)||a.push(J[e])})),a};u||(N((H=function(){if(this instanceof H)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=D(e),n=function(e){this===W&&n.call(K,e),d(this,B)&&d(this[B],t)&&(this[B][t]=!1),ae(this,t,m(1,e))};return s&&ne&&ae(W,t,{configurable:!0,set:n}),re(t,e)}).prototype,"toString",(function(){return U(this).tag})),N(H,"withoutSetter",(function(e){return re(D(e),e)})),_.f=ue,T.f=oe,k.f=le,w.f=I.f=ce,b.f=de,E.f=function(e){return re(S(e),e)},s&&(G(H.prototype,"description",{configurable:!0,get:function(){return U(this).description}}),o||N(W,"propertyIsEnumerable",ue,{unsafe:!0}))),a({global:!0,wrap:!0,forced:!u,sham:!u},{Symbol:H}),R(x(ee),(function(e){j(e)})),a({target:"Symbol",stat:!0,forced:!u},{for:function(e){var t=String(e);if(d(q,t))return q[t];var n=H(t);return q[t]=n,$[n]=t,n},keyFor:function(e){if(!ie(e))throw TypeError(e+" is not a symbol");if(d($,e))return $[e]},useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),a({target:"Object",stat:!0,forced:!u,sham:!s},{create:function(e,t){return void 0===t?M(e):se(M(e),t)},defineProperty:oe,defineProperties:se,getOwnPropertyDescriptor:le}),a({target:"Object",stat:!0,forced:!u},{getOwnPropertyNames:ce,getOwnPropertySymbols:de}),a({target:"Object",stat:!0,forced:c((function(){b.f(1)}))},{getOwnPropertySymbols:function(e){return b.f(g(e))}}),Q&&a({target:"JSON",stat:!0,forced:!u||c((function(){var e=H();return"[null]"!=Q([e])||"{}"!=Q({a:e})||"{}"!=Q(Object(e))}))},{stringify:function(e,t,n){for(var a,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(a=t,(h(t)||void 0!==e)&&!ie(e))return p(t)||(t=function(e,t){if("function"==typeof a&&(t=a.call(this,e,t)),!ie(t))return t}),r[1]=t,Q.apply(null,r)}}),H.prototype[F]||C(H.prototype,F,H.prototype.valueOf),L(H,"Symbol"),O[B]=!0},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){n(5)("iterator")},function(e,t,n){e.exports=n(174)},function(e,t,n){e.exports=n(182)},function(e,t,n){"use strict";var a=n(0),r=n(3),i=n(50),o=n(7),s=n(14),u=n(4),l=n(48),c=n(10),d=n(24),p=n(15).f,h=n(25).forEach,f=n(11),g=n(20),v=g.set,y=g.getterFor;e.exports=function(e,t,n){var g,m=-1!==e.indexOf("Map"),M=-1!==e.indexOf("Weak"),x=m?"set":"add",w=r[e],I=w&&w.prototype,b={};if(f&&"function"==typeof w&&(M||I.forEach&&!o((function(){(new w).entries().next()})))){g=t((function(t,n){v(l(t,g,e),{type:e,collection:new w}),null!=n&&u(n,t[x],{that:t,AS_ENTRIES:m})}));var k=y(e);h(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in I)||M&&"clear"==e||s(g.prototype,e,(function(n,a){var r=k(this).collection;if(!t&&M&&!c(n))return"get"==e&&void 0;var i=r[e](0===n?0:n,a);return t?this:i}))})),M||p(g.prototype,"size",{configurable:!0,get:function(){return k(this).collection.size}})}else g=n.getConstructor(t,e,m,x),i.REQUIRED=!0;return d(g,e,!1,!0),b[e]=g,a({global:!0,forced:!0},b),M||n.setStrong(g,e,m),g}},function(e,t,n){"use strict";var a=n(8),r=n(12),i=n(4);e.exports=function(e){var t,n,o,s,u=arguments.length,l=u>1?arguments[1]:void 0;return a(this),(t=void 0!==l)&&a(l),null==e?new this:(n=[],t?(o=0,s=r(l,u>2?arguments[2]:void 0,2),i(e,(function(e){n.push(s(e,o++))}))):i(e,n.push,{that:n}),new this(n))}},function(e,t,n){"use strict";e.exports=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}},function(e,t,n){"use strict";var a=n(1),r=n(8);e.exports=function(){for(var e,t=a(this),n=r(t.delete),i=!0,o=0,s=arguments.length;o<s;o++)e=n.call(t,arguments[o]),i=i&&e;return!!i}},function(e,t,n){"use strict";var a=n(1);e.exports=function(e,t){var n=a(this),r=n.has(e)&&"update"in t?t.update(n.get(e),e,n):t.insert(e,n);return n.set(e,r),r}},function(e,t,n){e.exports=n(241)},function(e,t,n){"use strict";var a=n(35),r=a(n(26)),i=a(n(38)),o=a(n(134)),s=a(n(139));(0,r.default)(t,"__esModule",{value:!0});var u=function(e){return e&&e.__esModule?e:{default:e}}(n(143)),l=function(){function e(e,t,n){if(void 0===t&&(t=864e5),this.name=e,this.expire=t,this.onError=n,this.logQueue=[],this.addTimer=-1,this.onError=n||function(){},"undefined"==typeof indexedDB||"undefined"==typeof IDBKeyRange||"undefined"==typeof Proxy)return this.onError("not support indexeddb or Proxy"),this.get=function(){return i.default.resolve([])},this.delete=function(){return i.default.resolve()},void(this.log=function(){});this.db=new u.default(e,t)}return e.prototype.get=function(e){return this.db.getLogs(e)},e.prototype.delete=function(e){return this.db.deleteLogs(e)},e.prototype.log=function(e,t,n){var a,r=this,i={time:+new Date,level:e,type:n,logStr:t};this.logQueue.push(i),clearTimeout(this.addTimer),this.logQueue.length>3e3?this.db.save((0,o.default)(a=this.logQueue).call(a,0)):this.addTimer=(0,s.default)((function(){var e;r.db.save((0,o.default)(e=r.logQueue).call(e,0))}),2e3)},e}();t.default=l},function(e,t,n){var a=n(108);e.exports=a},function(e,t,n){n(109);var a=n(9).Object,r=e.exports=function(e,t,n){return a.defineProperty(e,t,n)};a.defineProperty.sham&&(r.sham=!0)},function(e,t,n){var a=n(0),r=n(11);a({target:"Object",stat:!0,forced:!r,sham:!r},{defineProperty:n(15).f})},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var a=n(112);n(130),n(131),n(132),n(133),e.exports=a},function(e,t,n){n(75),n(46),n(118),n(90),n(91),n(125),n(61),n(34);var a=n(9);e.exports=a.Promise},function(e,t,n){var a=n(3),r=n(14);e.exports=function(e,t){try{r(a,e,t)}catch(n){a[e]=t}return t}},function(e,t,n){var a=n(7);e.exports=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,n){var a=n(10);e.exports=function(e){if(!a(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){var a=n(6),r=n(23),i=a("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){var a=n(1);e.exports=function(e){var t=e.return;if(void 0!==t)return a(t.call(e)).value}},function(e,t,n){"use strict";var a,r,i,o,s=n(0),u=n(2),l=n(3),c=n(16),d=n(83),p=n(31),h=n(47),f=n(55),g=n(24),v=n(84),y=n(10),m=n(8),M=n(48),x=n(85),w=n(4),I=n(120),b=n(32),k=n(86).set,T=n(121),_=n(88),C=n(123),N=n(33),A=n(49),P=n(20),O=n(74),D=n(6),S=n(124),E=n(60),j=n(43),L=D("species"),z="Promise",R=P.get,B=P.set,F=P.getterFor(z),Y=d&&d.prototype,U=d,W=Y,H=l.TypeError,Q=l.document,Z=l.process,G=N.f,V=G,X=!!(Q&&Q.createEvent&&l.dispatchEvent),J="function"==typeof PromiseRejectionEvent,K=!1,q=O(z,(function(){var e=x(U)!==String(U);if(!e&&66===j)return!0;if(u&&!W.finally)return!0;if(j>=51&&/native code/.test(U))return!1;var t=new U((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[L]=n,!(K=t.then((function(){}))instanceof n)||!e&&S&&!J})),$=q||!I((function(e){U.all(e).catch((function(){}))})),ee=function(e){var t;return!(!y(e)||"function"!=typeof(t=e.then))&&t},te=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;T((function(){for(var a=e.value,r=1==e.state,i=0;n.length>i;){var o,s,u,l=n[i++],c=r?l.ok:l.fail,d=l.resolve,p=l.reject,h=l.domain;try{c?(r||(2===e.rejection&&ie(e),e.rejection=1),!0===c?o=a:(h&&h.enter(),o=c(a),h&&(h.exit(),u=!0)),o===l.promise?p(H("Promise-chain cycle")):(s=ee(o))?s.call(o,d,p):d(o)):p(a)}catch(e){h&&!u&&h.exit(),p(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&ae(e)}))}},ne=function(e,t,n){var a,r;X?((a=Q.createEvent("Event")).promise=t,a.reason=n,a.initEvent(e,!1,!0),l.dispatchEvent(a)):a={promise:t,reason:n},!J&&(r=l["on"+e])?r(a):"unhandledrejection"===e&&C("Unhandled promise rejection",n)},ae=function(e){k.call(l,(function(){var t,n=e.facade,a=e.value;if(re(e)&&(t=A((function(){E?Z.emit("unhandledRejection",a,n):ne("unhandledrejection",n,a)})),e.rejection=E||re(e)?2:1,t.error))throw t.value}))},re=function(e){return 1!==e.rejection&&!e.parent},ie=function(e){k.call(l,(function(){var t=e.facade;E?Z.emit("rejectionHandled",t):ne("rejectionhandled",t,e.value)}))},oe=function(e,t,n){return function(a){e(t,a,n)}},se=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,te(e,!0))},ue=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw H("Promise can't be resolved itself");var a=ee(t);a?T((function(){var n={done:!1};try{a.call(t,oe(ue,n,e),oe(se,n,e))}catch(t){se(n,t,e)}})):(e.value=t,e.state=1,te(e,!1))}catch(t){se({done:!1},t,e)}}};if(q&&(W=(U=function(e){M(this,U,z),m(e),a.call(this);var t=R(this);try{e(oe(ue,t),oe(se,t))}catch(e){se(t,e)}}).prototype,(a=function(e){B(this,{type:z,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=h(W,{then:function(e,t){var n=F(this),a=G(b(this,U));return a.ok="function"!=typeof e||e,a.fail="function"==typeof t&&t,a.domain=E?Z.domain:void 0,n.parent=!0,n.reactions.push(a),0!=n.state&&te(n,!1),a.promise},catch:function(e){return this.then(void 0,e)}}),r=function(){var e=new a,t=R(e);this.promise=e,this.resolve=oe(ue,t),this.reject=oe(se,t)},N.f=G=function(e){return e===U||e===i?new r(e):V(e)},!u&&"function"==typeof d&&Y!==Object.prototype)){o=Y.then,K||(p(Y,"then",(function(e,t){var n=this;return new U((function(e,t){o.call(n,e,t)})).then(e,t)}),{unsafe:!0}),p(Y,"catch",W.catch,{unsafe:!0}));try{delete Y.constructor}catch(e){}f&&f(Y,W)}s({global:!0,wrap:!0,forced:q},{Promise:U}),g(U,z,!1,!0),v(z),i=c(z),s({target:z,stat:!0,forced:q},{reject:function(e){var t=G(this);return t.reject.call(void 0,e),t.promise}}),s({target:z,stat:!0,forced:u||q},{resolve:function(e){return _(u&&this===i?U:this,e)}}),s({target:z,stat:!0,forced:$},{all:function(e){var t=this,n=G(t),a=n.resolve,r=n.reject,i=A((function(){var n=m(t.resolve),i=[],o=0,s=1;w(e,(function(e){var u=o++,l=!1;i.push(void 0),s++,n.call(t,e).then((function(e){l||(l=!0,i[u]=e,--s||a(i))}),r)})),--s||a(i)}));return i.error&&r(i.value),n.promise},race:function(e){var t=this,n=G(t),a=n.reject,r=A((function(){var r=m(t.resolve);w(e,(function(e){r.call(t,e).then(n.resolve,a)}))}));return r.error&&a(r.value),n.promise}})},function(e,t,n){"use strict";var a=n(59),r=n(45);e.exports=a?{}.toString:function(){return"[object "+r(this)+"]"}},function(e,t,n){var a=n(6)("iterator"),r=!1;try{var i=0,o={next:function(){return{done:!!i++}},return:function(){r=!0}};o[a]=function(){return this},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var i={};i[a]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(e){}return n}},function(e,t,n){var a,r,i,o,s,u,l,c,d=n(3),p=n(27).f,h=n(86).set,f=n(87),g=n(122),v=n(60),y=d.MutationObserver||d.WebKitMutationObserver,m=d.document,M=d.process,x=d.Promise,w=p(d,"queueMicrotask"),I=w&&w.value;I||(a=function(){var e,t;for(v&&(e=M.domain)&&e.exit();r;){t=r.fn,r=r.next;try{t()}catch(e){throw r?o():i=void 0,e}}i=void 0,e&&e.enter()},f||v||g||!y||!m?x&&x.resolve?((l=x.resolve(void 0)).constructor=x,c=l.then,o=function(){c.call(l,a)}):o=v?function(){M.nextTick(a)}:function(){h.call(d,a)}:(s=!0,u=m.createTextNode(""),new y(a).observe(u,{characterData:!0}),o=function(){u.data=s=!s})),e.exports=I||function(e){var t={fn:e,next:void 0};i&&(i.next=t),r||(r=t,o()),i=t}},function(e,t,n){var a=n(44);e.exports=/web0s(?!.*chrome)/i.test(a)},function(e,t,n){var a=n(3);e.exports=function(e,t){var n=a.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},function(e,t){e.exports="object"==typeof window},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(83),o=n(7),s=n(16),u=n(32),l=n(88),c=n(31);if(a({target:"Promise",proto:!0,real:!0,forced:!!i&&o((function(){i.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,s("Promise")),n="function"==typeof e;return this.then(n?function(n){return l(t,e()).then((function(){return n}))}:e,n?function(n){return l(t,e()).then((function(){throw n}))}:e)}}),!r&&"function"==typeof i){var d=s("Promise").prototype.finally;i.prototype.finally!==d&&c(i.prototype,"finally",d,{unsafe:!0})}},function(e,t,n){var a=n(42),r=n(36),i=function(e){return function(t,n){var i,o,s=String(r(t)),u=a(n),l=s.length;return u<0||u>=l?e?"":void 0:(i=s.charCodeAt(u))<55296||i>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):i:e?s.slice(u,u+2):o-56320+(i-55296<<10)+65536}};e.exports={codeAt:i(!1),charAt:i(!0)}},function(e,t,n){"use strict";var a=n(92).IteratorPrototype,r=n(41),i=n(22),o=n(24),s=n(23),u=function(){return this};e.exports=function(e,t,n){var l=t+" Iterator";return e.prototype=r(a,{next:i(1,n)}),o(e,l,!1,!0),s[l]=u,e}},function(e,t,n){"use strict";var a=n(18),r=n(93),i=n(23),o=n(20),s=n(62),u=o.set,l=o.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){u(this,{type:"Array Iterator",target:a(e),index:0,kind:t})}),(function(){var e=l(this),t=e.target,n=e.kind,a=e.index++;return!t||a>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:a,done:!1}:"values"==n?{value:t[a],done:!1}:{value:[a,t[a]],done:!1}}),"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){n(75)},function(e,t,n){n(90)},function(e,t,n){"use strict";var a=n(0),r=n(33),i=n(49);a({target:"Promise",stat:!0},{try:function(e){var t=r.f(this),n=i(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}})},function(e,t,n){n(91)},function(e,t,n){e.exports=n(135)},function(e,t,n){var a=n(136);e.exports=a},function(e,t,n){var a=n(137),r=Array.prototype;e.exports=function(e){var t=e.splice;return e===r||e instanceof Array&&t===r.splice?a:t}},function(e,t,n){n(138);var a=n(21);e.exports=a("Array").splice},function(e,t,n){"use strict";var a=n(0),r=n(79),i=n(42),o=n(29),s=n(19),u=n(63),l=n(65),c=n(66)("splice"),d=Math.max,p=Math.min;a({target:"Array",proto:!0,forced:!c},{splice:function(e,t){var n,a,c,h,f,g,v=s(this),y=o(v.length),m=r(e,y),M=arguments.length;if(0===M?n=a=0:1===M?(n=0,a=y-m):(n=M-2,a=p(d(i(t),0),y-m)),y+n-a>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(c=u(v,a),h=0;h<a;h++)(f=m+h)in v&&l(c,h,v[f]);if(c.length=a,n<a){for(h=m;h<y-a;h++)g=h+n,(f=h+a)in v?v[g]=v[f]:delete v[g];for(h=y;h>y-a+n;h--)delete v[h-1]}else if(n>a)for(h=y-a;h>m;h--)g=h+n-1,(f=h+a-1)in v?v[g]=v[f]:delete v[g];for(h=0;h<n;h++)v[h+m]=arguments[h+2];return v.length=y-a+n,c}})},function(e,t,n){e.exports=n(140)},function(e,t,n){var a=n(141);e.exports=a},function(e,t,n){n(142);var a=n(9);e.exports=a.setTimeout},function(e,t,n){var a=n(0),r=n(3),i=n(44),o=[].slice,s=function(e){return function(t,n){var a=arguments.length>2,r=a?o.call(arguments,2):void 0;return e(a?function(){("function"==typeof t?t:Function(t)).apply(this,r)}:t,n)}};a({global:!0,bind:!0,forced:/MSIE .\./.test(i)},{setTimeout:s(r.setTimeout),setInterval:s(r.setInterval)})},function(e,t,n){"use strict";var a=n(35),r=a(n(38)),i=a(n(144)),o=a(n(171)),s=a(n(26)),u=a(n(98)),l=a(n(178)),c=a(n(99)),d=function(e,t,n,a){return new(n||(n=r.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},p=function(e,t){var n,a,r,s,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof i.default&&(s[o.default]=function(){return this}),s;function l(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,a=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((r=(r=u.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}};(0,s.default)(t,"__esModule",{value:!0});var h=n(188),f=function(){function e(e,t){void 0===t&&(t=86400),this.name=e,this.expire=t,this.dbVersion=2,this.name=e,this.expire=t,this.dbPromise=this.initDB()}return e.prototype.initDB=function(){return h.openDB(this.name,this.dbVersion,{upgrade:function(e,t,n,a){if(1===t)try{e.deleteObjectStore("log_detail")}catch(e){}e.createObjectStore("log_detail",{keyPath:"id",autoIncrement:!0}).createIndex("time","time")}})},e.prototype.getLogs=function(e){return d(this,void 0,void 0,(function(){var t,n,a,i,o,s,l,c;return p(this,(function(d){switch(d.label){case 0:return t=[],[4,this.dbPromise];case 1:return n=d.sent(),a=h.unwrap(n).transaction("log_detail","readonly").objectStore("log_detail"),i=function(e){var t=e.end,n=e.start,a=e.type,r=e.level,i=IDBKeyRange.bound(n||0,t||+new Date),o=function(e){return!0},s=0;switch(a&&(s+=2),r&&(s+=1),s){case 1:o=function(e){return e.level===r};break;case 2:o=function(e){return e.type===a};break;case 3:o=function(e){return e.type===a&&e.level===r}}return{indexName:"time",filter:o,keyRange:i}}(e),o=i.indexName,s=i.keyRange,l=(0,u.default)(i),c=a.index(o).openCursor(s),[2,new r.default((function(e,n){c.onsuccess=function(n){var a=n.target.result;a?(l(a.value)&&t.push(a.value),a.continue()):e(t)},c.onerror=function(e){n(e)}}))]}}))}))},e.prototype.deleteLogs=function(e){return d(this,void 0,void 0,(function(){var t,n,a,i,o;return p(this,(function(s){switch(s.label){case 0:return[4,this.dbPromise];case 1:return t=s.sent(),n=h.unwrap(t).transaction("log_detail","readwrite").objectStore("log_detail"),a=e.start,i=e.end,o=n.index("time").openKeyCursor(IDBKeyRange.bound(a,i)),[2,new r.default((function(e,t){o.onsuccess=function(){var t=o.result;t?(n.delete(t.primaryKey),t.continue()):e(null)},o.onerror=function(e){t(e)}}))]}}))}))},e.prototype.save=function(e){return d(this,void 0,void 0,(function(){var t,n;return p(this,(function(a){switch(a.label){case 0:return[4,this.dbPromise];case 1:return t=a.sent(),n=[],[2,this.deleteLogs({start:0,end:(0,l.default)()-this.expire}).then((function(){var a=t.transaction("log_detail","readwrite").objectStore("log_detail");return(0,c.default)(e).call(e,(function(e){n.push(a.put(e))})),r.default.all(n)}))]}}))}))},e}();t.default=f},function(e,t,n){e.exports=n(145)},function(e,t,n){var a=n(146);n(164),n(165),n(166),n(167),n(168),n(169),n(170),e.exports=a},function(e,t,n){n(94),n(46),n(95),n(148),n(149),n(150),n(151),n(97),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),n(161),n(162),n(163);var a=n(9);e.exports=a.Symbol},function(e,t,n){var a=n(18),r=n(67).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==i.call(e)?function(e){try{return r(e)}catch(e){return o.slice()}}(e):r(a(e))}},function(e,t,n){n(5)("asyncIterator")},function(e,t){},function(e,t,n){n(5)("hasInstance")},function(e,t,n){n(5)("isConcatSpreadable")},function(e,t,n){n(5)("match")},function(e,t,n){n(5)("matchAll")},function(e,t,n){n(5)("replace")},function(e,t,n){n(5)("search")},function(e,t,n){n(5)("species")},function(e,t,n){n(5)("split")},function(e,t,n){n(5)("toPrimitive")},function(e,t,n){n(5)("toStringTag")},function(e,t,n){n(5)("unscopables")},function(e,t,n){var a=n(3);n(24)(a.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t,n){n(5)("asyncDispose")},function(e,t,n){n(5)("dispose")},function(e,t,n){n(5)("matcher")},function(e,t,n){n(5)("metadata")},function(e,t,n){n(5)("observable")},function(e,t,n){n(5)("patternMatch")},function(e,t,n){n(5)("replaceAll")},function(e,t,n){e.exports=n(172)},function(e,t,n){var a=n(173);e.exports=a},function(e,t,n){n(97),n(61),n(34);var a=n(68);e.exports=a.f("iterator")},function(e,t,n){var a=n(175);e.exports=a},function(e,t,n){var a=n(176),r=Array.prototype;e.exports=function(e){var t=e.filter;return e===r||e instanceof Array&&t===r.filter?a:t}},function(e,t,n){n(177);var a=n(21);e.exports=a("Array").filter},function(e,t,n){"use strict";var a=n(0),r=n(25).filter;a({target:"Array",proto:!0,forced:!n(66)("filter")},{filter:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){e.exports=n(179)},function(e,t,n){var a=n(180);e.exports=a},function(e,t,n){n(181);var a=n(9);e.exports=a.Date.now},function(e,t,n){n(0)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(e,t,n){var a=n(183);e.exports=a},function(e,t,n){n(34);var a=n(184),r=n(45),i=Array.prototype,o={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===i||e instanceof Array&&t===i.forEach||o.hasOwnProperty(r(e))?a:t}},function(e,t,n){var a=n(185);e.exports=a},function(e,t,n){n(186);var a=n(21);e.exports=a("Array").forEach},function(e,t,n){"use strict";var a=n(0),r=n(187);a({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},function(e,t,n){"use strict";var a=n(25).forEach,r=n(69)("forEach");e.exports=r?[].forEach:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,n){"use strict";var a=n(189),r=n(193),i=n(98),o=n(196),s=n(99),u=n(200),l=n(205),c=n(26),d=n(35);c(t,"__esModule",{value:!0}),t.deleteDB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,a=indexedDB.deleteDatabase(e);return n&&a.addEventListener("blocked",(function(){return n()})),(0,y.w)(a).then((function(){}))},t.openDB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.blocked,r=n.upgrade,i=n.blocking,o=n.terminated,s=indexedDB.open(e,t),u=(0,y.w)(s);return r&&s.addEventListener("upgradeneeded",(function(e){r((0,y.w)(s.result),e.oldVersion,e.newVersion,(0,y.w)(s.transaction))})),a&&s.addEventListener("blocked",(function(){return a()})),u.then((function(e){o&&e.addEventListener("close",(function(){return o()})),i&&e.addEventListener("versionchange",(function(){return i()}))})).catch((function(){})),u},c(t,"unwrap",{enumerable:!0,get:function(){return y.u}}),c(t,"wrap",{enumerable:!0,get:function(){return y.w}});var p=d(n(209)),h=d(n(211)),f=d(n(212)),g=d(n(213)),v=d(n(105)),y=n(250);function m(e,t){var n=a(e);if(r){var s=r(e);t&&(s=i(s).call(s,(function(t){return o(e,t).enumerable}))),n.push.apply(n,s)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n,a=null!=arguments[t]?arguments[t]:{};if(t%2)s(n=m(Object(a),!0)).call(n,(function(t){(0,h.default)(e,t,a[t])}));else if(u)l(e,u(a));else{var r;s(r=m(Object(a))).call(r,(function(t){c(e,t,o(a,t))}))}}return e}var x=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],I=new g.default;function b(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(I.get(t))return I.get(t);var n=t.replace(/FromIndex$/,""),a=t!==n,r=(0,v.default)(w).call(w,n);if(n in(a?IDBIndex:IDBObjectStore).prototype&&(r||(0,v.default)(x).call(x,n))){var i=function(){var e=(0,f.default)(p.default.mark((function e(t){var i,o,s,u,l,c,d,h=arguments;return p.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=this.transaction(t,r?"readwrite":"readonly"),s=o.store,u=h.length,l=new Array(u>1?u-1:0),c=1;c<u;c++)l[c-1]=h[c];return a&&(s=s.index(l.shift())),e.next=6,(i=s)[n].apply(i,l);case 6:if(d=e.sent,!r){e.next=10;break}return e.next=10,o.done;case 10:return e.abrupt("return",d);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return I.set(t,i),i}}}(0,y.r)((function(e){return M(M({},e),{},{get:function(t,n,a){return b(t,n)||e.get(t,n,a)},has:function(t,n){return!!b(t,n)||e.has(t,n)}})}))},function(e,t,n){e.exports=n(190)},function(e,t,n){var a=n(191);e.exports=a},function(e,t,n){n(192);var a=n(9);e.exports=a.Object.keys},function(e,t,n){var a=n(0),r=n(19),i=n(56);a({target:"Object",stat:!0,forced:n(7)((function(){i(1)}))},{keys:function(e){return i(r(e))}})},function(e,t,n){e.exports=n(194)},function(e,t,n){var a=n(195);e.exports=a},function(e,t,n){n(95);var a=n(9);e.exports=a.Object.getOwnPropertySymbols},function(e,t,n){e.exports=n(197)},function(e,t,n){var a=n(198);e.exports=a},function(e,t,n){n(199);var a=n(9).Object,r=e.exports=function(e,t){return a.getOwnPropertyDescriptor(e,t)};a.getOwnPropertyDescriptor.sham&&(r.sham=!0)},function(e,t,n){var a=n(0),r=n(7),i=n(18),o=n(27).f,s=n(11),u=r((function(){o(1)}));a({target:"Object",stat:!0,forced:!s||u,sham:!s},{getOwnPropertyDescriptor:function(e,t){return o(i(e),t)}})},function(e,t,n){e.exports=n(201)},function(e,t,n){var a=n(202);e.exports=a},function(e,t,n){n(203);var a=n(9);e.exports=a.Object.getOwnPropertyDescriptors},function(e,t,n){var a=n(0),r=n(11),i=n(204),o=n(18),s=n(27),u=n(65);a({target:"Object",stat:!0,sham:!r},{getOwnPropertyDescriptors:function(e){for(var t,n,a=o(e),r=s.f,l=i(a),c={},d=0;l.length>d;)void 0!==(n=r(a,t=l[d++]))&&u(c,t,n);return c}})},function(e,t,n){var a=n(16),r=n(67),i=n(96),o=n(1);e.exports=a("Reflect","ownKeys")||function(e){var t=r.f(o(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){e.exports=n(206)},function(e,t,n){var a=n(207);e.exports=a},function(e,t,n){n(208);var a=n(9).Object,r=e.exports=function(e,t){return a.defineProperties(e,t)};a.defineProperties.sham&&(r.sham=!0)},function(e,t,n){var a=n(0),r=n(11);a({target:"Object",stat:!0,forced:!r,sham:!r},{defineProperties:n(76)})},function(e,t,n){e.exports=n(210)},function(e,t,n){var a=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,a){var r=t&&t.prototype instanceof d?t:d,i=Object.create(r.prototype),o=new b(a||[]);return i._invoke=function(e,t,n){var a="suspendedStart";return function(r,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw i;return{value:void 0,done:!0}}for(n.method=r,n.arg=i;;){var o=n.delegate;if(o){var s=x(o,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var u=l(e,t,n);if("normal"===u.type){if(a=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c={};function d(){}function p(){}function h(){}var f={};f[r]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(k([])));v&&v!==t&&n.call(v,r)&&(f=v);var y=h.prototype=d.prototype=Object.create(f);function m(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){var a;this._invoke=function(r,i){function o(){return new t((function(a,o){!function a(r,i,o,s){var u=l(e[r],e,i);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,o,s)}),(function(e){a("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,s)}))}s(u.arg)}(r,i,a,o)}))}return a=a?a.then(o,o):o()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var a=l(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,c;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function k(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=y.constructor=h,h.constructor=p,p.displayName=s(h,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,s(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(M.prototype),M.prototype[i]=function(){return this},e.AsyncIterator=M,e.async=function(t,n,a,r,i){void 0===i&&(i=Promise);var o=new M(u(t,n,a,r),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(y),s(y,o,"Generator"),y[r]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=k,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;I(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=a}catch(e){Function("r","regeneratorRuntime = r")(a)}},function(e,t,n){var a=n(26);e.exports=function(e,t,n){return t in e?a(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var a=n(38);function r(e,t,n,r,i,o,s){try{var u=e[o](s),l=u.value}catch(e){return void n(e)}u.done?t(l):a.resolve(l).then(r,i)}e.exports=function(e){return function(){var t=this,n=arguments;return new a((function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,u,"next",e)}function u(e){r(o,a,i,s,u,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){e.exports=n(214)},function(e,t,n){var a=n(215);n(219),n(220),n(221),n(222),n(223),n(225),n(226),n(227),n(228),n(229),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),e.exports=a},function(e,t,n){n(216),n(46),n(61),n(34);var a=n(9);e.exports=a.Map},function(e,t,n){"use strict";var a=n(100),r=n(218);e.exports=a("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r)},function(e,t,n){var a=n(7);e.exports=!a((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,n){"use strict";var a=n(15).f,r=n(41),i=n(47),o=n(12),s=n(48),u=n(4),l=n(62),c=n(84),d=n(11),p=n(50).fastKey,h=n(20),f=h.set,g=h.getterFor;e.exports={getConstructor:function(e,t,n,l){var c=e((function(e,a){s(e,c,t),f(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=a&&u(a,e[l],{that:e,AS_ENTRIES:n})})),h=g(t),v=function(e,t,n){var a,r,i=h(e),o=y(e,t);return o?o.value=n:(i.last=o={index:r=p(t,!0),key:t,value:n,previous:a=i.last,next:void 0,removed:!1},i.first||(i.first=o),a&&(a.next=o),d?i.size++:e.size++,"F"!==r&&(i.index[r]=o)),e},y=function(e,t){var n,a=h(e),r=p(t);if("F"!==r)return a.index[r];for(n=a.first;n;n=n.next)if(n.key==t)return n};return i(c.prototype,{clear:function(){for(var e=h(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=h(this),n=y(this,e);if(n){var a=n.next,r=n.previous;delete t.index[n.index],n.removed=!0,r&&(r.next=a),a&&(a.previous=r),t.first==n&&(t.first=a),t.last==n&&(t.last=r),d?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=h(this),a=o(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(a(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!y(this,e)}}),i(c.prototype,n?{get:function(e){var t=y(this,e);return t&&t.value},set:function(e,t){return v(this,0===e?0:e,t)}}:{add:function(e){return v(this,e=0===e?0:e,e)}}),d&&a(c.prototype,"size",{get:function(){return h(this).size}}),c},setStrong:function(e,t,n){var a=t+" Iterator",r=g(t),i=g(a);l(e,t,(function(e,t){f(this,{type:a,target:e,state:r(e),kind:t,last:void 0})}),(function(){for(var e=i(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),c(t)}}},function(e,t,n){n(0)({target:"Map",stat:!0},{from:n(101)})},function(e,t,n){n(0)({target:"Map",stat:!0},{of:n(102)})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(103);a({target:"Map",proto:!0,real:!0,forced:r},{deleteAll:function(){return i.apply(this,arguments)}})},function(e,t,n){"use strict";n(0)({target:"Map",proto:!0,real:!0,forced:n(2)},{emplace:n(104)})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(12),s=n(17),u=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{every:function(e){var t=i(this),n=s(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return!u(n,(function(e,n,r){if(!a(n,e,t))return r()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,n){var a=n(1),r=n(82);e.exports=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return a(t.call(e))}},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(16),o=n(1),s=n(8),u=n(12),l=n(32),c=n(17),d=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{filter:function(e){var t=o(this),n=c(t),a=u(e,arguments.length>1?arguments[1]:void 0,3),r=new(l(t,i("Map"))),p=s(r.set);return d(n,(function(e,n){a(n,e,t)&&p.call(r,e,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(12),s=n(17),u=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{find:function(e){var t=i(this),n=s(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return u(n,(function(e,n,r){if(a(n,e,t))return r(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(12),s=n(17),u=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{findKey:function(e){var t=i(this),n=s(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return u(n,(function(e,n,r){if(a(n,e,t))return r(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,n){"use strict";var a=n(0),r=n(4),i=n(8);a({target:"Map",stat:!0},{groupBy:function(e,t){var n=new this;i(t);var a=i(n.has),o=i(n.get),s=i(n.set);return r(e,(function(e){var r=t(e);a.call(n,r)?o.call(n,r).push(e):s.call(n,r,[e])})),n}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(17),s=n(230),u=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{includes:function(e){return u(o(i(this)),(function(t,n,a){if(s(n,e))return a()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){"use strict";var a=n(0),r=n(4),i=n(8);a({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;i(t);var a=i(n.set);return r(e,(function(e){a.call(n,t(e),e)})),n}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(17),s=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{keyOf:function(e){return s(o(i(this)),(function(t,n,a){if(n===e)return a(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(16),o=n(1),s=n(8),u=n(12),l=n(32),c=n(17),d=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{mapKeys:function(e){var t=o(this),n=c(t),a=u(e,arguments.length>1?arguments[1]:void 0,3),r=new(l(t,i("Map"))),p=s(r.set);return d(n,(function(e,n){p.call(r,a(n,e,t),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(16),o=n(1),s=n(8),u=n(12),l=n(32),c=n(17),d=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{mapValues:function(e){var t=o(this),n=c(t),a=u(e,arguments.length>1?arguments[1]:void 0,3),r=new(l(t,i("Map"))),p=s(r.set);return d(n,(function(e,n){p.call(r,e,a(n,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(8),s=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{merge:function(e){for(var t=i(this),n=o(t.set),a=0;a<arguments.length;)s(arguments[a++],n,{that:t,AS_ENTRIES:!0});return t}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(8),s=n(17),u=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{reduce:function(e){var t=i(this),n=s(t),a=arguments.length<2,r=a?void 0:arguments[1];if(o(e),u(n,(function(n,i){a?(a=!1,r=i):r=e(r,i,n,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),a)throw TypeError("Reduce of empty map with no initial value");return r}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(12),s=n(17),u=n(4);a({target:"Map",proto:!0,real:!0,forced:r},{some:function(e){var t=i(this),n=s(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return u(n,(function(e,n,r){if(a(n,e,t))return r()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(1),o=n(8);a({target:"Map",proto:!0,real:!0,forced:r},{update:function(e,t){var n=i(this),a=arguments.length;o(t);var r=n.has(e);if(!r&&a<3)throw TypeError("Updating absent value");var s=r?n.get(e):o(a>2?arguments[2]:void 0)(e,n);return n.set(e,t(s,e,n)),n}})},function(e,t,n){"use strict";n(0)({target:"Map",proto:!0,real:!0,forced:n(2)},{upsert:n(70)})},function(e,t,n){"use strict";n(0)({target:"Map",proto:!0,real:!0,forced:n(2)},{updateOrInsert:n(70)})},function(e,t,n){var a=n(242);e.exports=a},function(e,t,n){var a=n(243),r=n(245),i=Array.prototype,o=String.prototype;e.exports=function(e){var t=e.includes;return e===i||e instanceof Array&&t===i.includes?a:"string"==typeof e||e===o||e instanceof String&&t===o.includes?r:t}},function(e,t,n){n(244);var a=n(21);e.exports=a("Array").includes},function(e,t,n){"use strict";var a=n(0),r=n(78).includes,i=n(93);a({target:"Array",proto:!0},{includes:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},function(e,t,n){n(246);var a=n(21);e.exports=a("String").includes},function(e,t,n){"use strict";var a=n(0),r=n(247),i=n(36);a({target:"String",proto:!0,forced:!n(249)("includes")},{includes:function(e){return!!~String(i(this)).indexOf(r(e),arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var a=n(248);e.exports=function(e){if(a(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,n){var a=n(10),r=n(28),i=n(6)("match");e.exports=function(e){var t;return a(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==r(e))}},function(e,t,n){var a=n(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[a]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,n){"use strict";var a=n(26),r=n(35);a(t,"__esModule",{value:!0}),t.r=function(e){M=e(M)},t.w=w,t.u=t.i=t.a=void 0;var i,o,s=r(n(251)),u=r(n(256)),l=r(n(38)),c=r(n(266)),d=r(n(270)),p=r(n(105)),h=function(e,t){return(0,s.default)(t).call(t,(function(t){return e instanceof t}))};t.i=h;var f=new u.default,g=new u.default,v=new u.default,y=new u.default,m=new u.default;t.a=m;var M={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return g.get(e);if("objectStoreNames"===t)return e.objectStoreNames||v.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return w(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function x(e){return"function"==typeof e?function(e){var t;return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(0,p.default)(t=o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).call(t,e)?function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e.apply(I(this),n),w(f.get(this))}:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return w(e.apply(I(this),n))}:function(t){for(var n,a=arguments.length,r=new Array(a>1?a-1:0),i=1;i<a;i++)r[i-1]=arguments[i];var o=e.call.apply(e,(0,c.default)(n=[I(this),t]).call(n,r));return v.set(o,(0,d.default)(t)?(0,d.default)(t).call(t):[t]),w(o)}}(e):(e instanceof IDBTransaction&&function(e){if(!g.has(e)){var t=new l.default((function(t,n){var a=function(){e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=function(){t(),a()},i=function(){n(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));g.set(e,t)}}(e),h(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,M):e)}function w(e){if(e instanceof IDBRequest)return t=e,(n=new l.default((function(e,n){var a=function(){t.removeEventListener("success",r),t.removeEventListener("error",i)},r=function(){e(w(t.result)),a()},i=function(){n(t.error),a()};t.addEventListener("success",r),t.addEventListener("error",i)}))).then((function(e){e instanceof IDBCursor&&f.set(e,t)})).catch((function(){})),m.set(n,t),n;var t,n;if(y.has(e))return y.get(e);var a=x(e);return a!==e&&(y.set(e,a),m.set(a,e)),a}var I=function(e){return m.get(e)};t.u=I},function(e,t,n){e.exports=n(252)},function(e,t,n){var a=n(253);e.exports=a},function(e,t,n){var a=n(254),r=Array.prototype;e.exports=function(e){var t=e.some;return e===r||e instanceof Array&&t===r.some?a:t}},function(e,t,n){n(255);var a=n(21);e.exports=a("Array").some},function(e,t,n){"use strict";var a=n(0),r=n(25).some;a({target:"Array",proto:!0,forced:!n(69)("some")},{some:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){e.exports=n(257)},function(e,t,n){var a=n(258);n(261),n(262),n(263),n(264),n(265),e.exports=a},function(e,t,n){n(46),n(259),n(34);var a=n(9);e.exports=a.WeakMap},function(e,t,n){"use strict";var a,r=n(3),i=n(47),o=n(50),s=n(100),u=n(260),l=n(10),c=n(20).enforce,d=n(89),p=!r.ActiveXObject&&"ActiveXObject"in r,h=Object.isExtensible,f=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},g=e.exports=s("WeakMap",f,u);if(d&&p){a=u.getConstructor(f,"WeakMap",!0),o.REQUIRED=!0;var v=g.prototype,y=v.delete,m=v.has,M=v.get,x=v.set;i(v,{delete:function(e){if(l(e)&&!h(e)){var t=c(this);return t.frozen||(t.frozen=new a),y.call(this,e)||t.frozen.delete(e)}return y.call(this,e)},has:function(e){if(l(e)&&!h(e)){var t=c(this);return t.frozen||(t.frozen=new a),m.call(this,e)||t.frozen.has(e)}return m.call(this,e)},get:function(e){if(l(e)&&!h(e)){var t=c(this);return t.frozen||(t.frozen=new a),m.call(this,e)?M.call(this,e):t.frozen.get(e)}return M.call(this,e)},set:function(e,t){if(l(e)&&!h(e)){var n=c(this);n.frozen||(n.frozen=new a),m.call(this,e)?x.call(this,e,t):n.frozen.set(e,t)}else x.call(this,e,t);return this}})}},function(e,t,n){"use strict";var a=n(47),r=n(50).getWeakData,i=n(1),o=n(10),s=n(48),u=n(4),l=n(25),c=n(13),d=n(20),p=d.set,h=d.getterFor,f=l.find,g=l.findIndex,v=0,y=function(e){return e.frozen||(e.frozen=new m)},m=function(){this.entries=[]},M=function(e,t){return f(e.entries,(function(e){return e[0]===t}))};m.prototype={get:function(e){var t=M(this,e);if(t)return t[1]},has:function(e){return!!M(this,e)},set:function(e,t){var n=M(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=g(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,l){var d=e((function(e,a){s(e,d,t),p(e,{type:t,id:v++,frozen:void 0}),null!=a&&u(a,e[l],{that:e,AS_ENTRIES:n})})),f=h(t),g=function(e,t,n){var a=f(e),o=r(i(t),!0);return!0===o?y(a).set(t,n):o[a.id]=n,e};return a(d.prototype,{delete:function(e){var t=f(this);if(!o(e))return!1;var n=r(e);return!0===n?y(t).delete(e):n&&c(n,t.id)&&delete n[t.id]},has:function(e){var t=f(this);if(!o(e))return!1;var n=r(e);return!0===n?y(t).has(e):n&&c(n,t.id)}}),a(d.prototype,n?{get:function(e){var t=f(this);if(o(e)){var n=r(e);return!0===n?y(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return g(this,e,t)}}:{add:function(e){return g(this,e,!0)}}),d}}},function(e,t,n){"use strict";n(0)({target:"WeakMap",proto:!0,real:!0,forced:n(2)},{emplace:n(104)})},function(e,t,n){n(0)({target:"WeakMap",stat:!0},{from:n(101)})},function(e,t,n){n(0)({target:"WeakMap",stat:!0},{of:n(102)})},function(e,t,n){"use strict";var a=n(0),r=n(2),i=n(103);a({target:"WeakMap",proto:!0,real:!0,forced:r},{deleteAll:function(){return i.apply(this,arguments)}})},function(e,t,n){"use strict";n(0)({target:"WeakMap",proto:!0,real:!0,forced:n(2)},{upsert:n(70)})},function(e,t,n){e.exports=n(267)},function(e,t,n){var a=n(268);e.exports=a},function(e,t,n){var a=n(269),r=Array.prototype;e.exports=function(e){var t=e.concat;return e===r||e instanceof Array&&t===r.concat?a:t}},function(e,t,n){n(94);var a=n(21);e.exports=a("Array").concat},function(e,t,n){e.exports=n(271)},function(e,t,n){var a=n(272);e.exports=a},function(e,t,n){var a=n(273),r=Array.prototype;e.exports=function(e){var t=e.sort;return e===r||e instanceof Array&&t===r.sort?a:t}},function(e,t,n){n(274);var a=n(21);e.exports=a("Array").sort},function(e,t,n){"use strict";var a=n(0),r=n(8),i=n(19),o=n(7),s=n(69),u=[],l=u.sort,c=o((function(){u.sort(void 0)})),d=o((function(){u.sort(null)})),p=s("sort");a({target:"Array",proto:!0,forced:c||!d||!p},{sort:function(e){return void 0===e?l.call(i(this)):l.call(i(this),r(e))}})}]).default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTime=t.fetchBlob=t.getID=t.RECORD_FILE=void 0;var a=i(n(28)),r=i(n(14));function i(e){return e&&e.__esModule?e:{default:e}}t.parseUrl=function(e){var t=s.exec(e||"");if(t)return{uid:t[1],cid:t[2],timestamp:parseInt(t[3]),chunk:parseInt(t[4]),type:t[6],url:e};var n=e.lastIndexOf(".");return{url:e,type:e.slice(n+1)}},t.ab2str=function(e){return o(this,void 0,void 0,a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!u){t.next=4;break}return t.abrupt("return",u.decode(e));case 4:return t.next=6,new r.default((function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.onerror=n,a.readAsText(new Blob([new Uint8Array(e)]))}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))};var o=function(e,t,n,a){return new(n||(n=r.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},s=t.RECORD_FILE=/(\d+)-(\d+)-(\d+)-(\d+)(-mixed)?\.(mp4|aac|flv|gz)$/i;t.getID=function(){return~~(1e4*Math.random())};var u=void 0;"function"==typeof window.TextEncoder&&(u=new window.TextDecoder("utf-8"));t.fetchBlob=function(e){return new r.default((function(t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){t(a.response)},a.onerror=n,a.send()}))};var l=function(e){return e<10?"0"+e:""+e};t.getTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(e=~~(e/1e3))%60,a=(e=~~((e-=n)/60))%60,r=~~(e/60);return 0===r&&!1===t?[l(a)+":"+l(n),r]:[r+":"+l(a)+":"+l(n),r]}},function(e,t){!function(n){"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=n()}((function(){return function e(t,n,a){function r(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return r(t[o][1][e]||e)}),c,c.exports,e,t,n,a)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<a.length;o++)r(a[o]);return r}({1:[function(e,t,n){"use strict";var a=e("./zlib/deflate"),r=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/messages"),s=e("./zlib/zstream"),u=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(o[n]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=a.deflateSetDictionary(this.strm,c)))throw new Error(o[n]);this._dict_set=!0}}function c(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}l.prototype.push=function(e,t){var n,o,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=i.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new r.Buf8(l),s.next_out=0,s.avail_out=l),1!==(n=a.deflate(s,o))&&0!==n)return this.onEnd(n),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(i.buf2binstring(r.shrinkBuf(s.output,s.next_out))):this.onData(r.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==n);return 4===o?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==o||(this.onEnd(0),!(s.avail_out=0))},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=l,n.deflate=c,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(e,t,n){"use strict";var a=e("./zlib/inflate"),r=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/constants"),s=e("./zlib/messages"),u=e("./zlib/zstream"),l=e("./zlib/gzheader"),c=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=a.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(s[n]);if(this.header=new l,a.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=a.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[n])}function p(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}d.prototype.push=function(e,t){var n,s,u,l,d,p=this.strm,h=this.options.chunkSize,f=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?p.input=i.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(h),p.next_out=0,p.avail_out=h),(n=a.inflate(p,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&f&&(n=a.inflateSetDictionary(this.strm,f)),n===o.Z_BUF_ERROR&&!0===g&&(n=o.Z_OK,g=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),!(this.ended=!0);p.next_out&&(0!==p.avail_out&&n!==o.Z_STREAM_END&&(0!==p.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(u=i.utf8border(p.output,p.next_out),l=p.next_out-u,d=i.buf2string(p.output,u),p.next_out=l,p.avail_out=h-l,l&&r.arraySet(p.output,p.output,u,l,0),this.onData(d)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((0<p.avail_in||0===p.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(n=a.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(p.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=d,n.inflate=p,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},n.ungzip=p},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(e,t,n){"use strict";var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t,n,a=Array.prototype.slice.call(arguments,1);a.length;){var r=a.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)t=r,n=i,Object.prototype.hasOwnProperty.call(t,n)&&(e[i]=r[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,a,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+a),r);else for(var i=0;i<a;i++)e[r+i]=t[n+i]},flattenChunks:function(e){var t,n,a,r,i,o;for(t=a=0,n=e.length;t<n;t++)a+=e[t].length;for(o=new Uint8Array(a),t=r=0,n=e.length;t<n;t++)i=e[t],o.set(i,r),r+=i.length;return o}},i={arraySet:function(e,t,n,a,r){for(var i=0;i<a;i++)e[r+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,i))},n.setTyped(a)},{}],4:[function(e,t,n){"use strict";var a=e("./common"),r=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}for(var o=new a.Buf8(256),s=0;s<256;s++)o[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function u(e,t){if(t<65534&&(e.subarray&&i||!e.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,n.string2buf=function(e){var t,n,r,i,o,s=e.length,u=0;for(i=0;i<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new a.Buf8(u),i=o=0;o<u;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[o++]=n:(n<2048?t[o++]=192|n>>>6:(n<65536?t[o++]=224|n>>>12:(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63),t[o++]=128|n>>>6&63),t[o++]=128|63&n);return t},n.buf2binstring=function(e){return u(e,e.length)},n.binstring2buf=function(e){for(var t=new a.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,a,r,i,s=t||e.length,l=new Array(2*s);for(n=a=0;n<s;)if((r=e[n++])<128)l[a++]=r;else if(4<(i=o[r]))l[a++]=65533,n+=i-1;else{for(r&=2===i?31:3===i?15:7;1<i&&n<s;)r=r<<6|63&e[n++],i--;1<i?l[a++]=65533:r<65536?l[a++]=r:(r-=65536,l[a++]=55296|r>>10&1023,l[a++]=56320|1023&r)}return u(l,a)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}},{"./common":3}],5:[function(e,t,n){"use strict";t.exports=function(e,t,n,a){for(var r=65535&e|0,i=e>>>16&65535|0,o=0;0!==n;){for(n-=o=2e3<n?2e3:n;i=i+(r=r+t[a++]|0)|0,--o;);r%=65521,i%=65521}return r|i<<16|0}},{}],6:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(e,t,n){"use strict";var a=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,r){var i=a,o=r+n;e^=-1;for(var s=r;s<o;s++)e=e>>>8^i[255&(e^t[s])];return-1^e}},{}],8:[function(e,t,n){"use strict";var a,r=e("../utils/common"),i=e("./trees"),o=e("./adler32"),s=e("./crc32"),u=e("./messages"),l=-2,c=258,d=262,p=113;function h(e,t){return e.msg=u[t],t}function f(e){return(e<<1)-(4<e?9:0)}function g(e){for(var t=e.length;0<=--t;)e[t]=0}function v(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function y(e,t){i._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,v(e.strm)}function m(e,t){e.pending_buf[e.pending++]=t}function M(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function x(e,t){var n,a,r=e.max_chain_length,i=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-d?e.strstart-(e.w_size-d):0,l=e.window,p=e.w_mask,h=e.prev,f=e.strstart+c,g=l[i+o-1],v=l[i+o];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+o]===v&&l[n+o-1]===g&&l[n]===l[i]&&l[++n]===l[i+1]){i+=2,n++;do{}while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<f);if(a=c-(f-i),i=f-c,o<a){if(e.match_start=t,s<=(o=a))break;g=l[i+o-1],v=l[i+o]}}}while((t=h[t&p])>u&&0!=--r);return o<=e.lookahead?o:e.lookahead}function w(e){var t,n,a,i,u,l,c,p,h,f,g=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-d)){for(r.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=n=e.hash_size;a=e.head[--t],e.head[t]=g<=a?a-g:0,--n;);for(t=n=g;a=e.prev[--t],e.prev[t]=g<=a?a-g:0,--n;);i+=g}if(0===e.strm.avail_in)break;if(l=e.strm,c=e.window,p=e.strstart+e.lookahead,f=void 0,(h=i)<(f=l.avail_in)&&(f=h),n=0===f?0:(l.avail_in-=f,r.arraySet(c,l.input,l.next_in,f,p),1===l.state.wrap?l.adler=o(l.adler,c,f,p):2===l.state.wrap&&(l.adler=s(l.adler,c,f,p)),l.next_in+=f,l.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+3-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<d&&0!==e.strm.avail_in)}function I(e,t){for(var n,a;;){if(e.lookahead<d){if(w(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-d&&(e.match_length=x(e,n)),e.match_length>=3)if(a=i._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else a=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}function b(e,t){for(var n,a,r;;){if(e.lookahead<d){if(w(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-d&&(e.match_length=x(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){for(r=e.strstart+e.lookahead-3,a=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(y(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((a=i._tr_tally(e,0,e.window[e.strstart-1]))&&y(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}function k(e,t,n,a,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=a,this.func=r}function T(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function _(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:p,e.adler=2===t.wrap?0:1,t.last_flush=0,i._tr_init(t),0):h(e,l)}function C(e){var t,n=_(e);return 0===n&&((t=e.state).window_size=2*t.w_size,g(t.head),t.max_lazy_match=a[t.level].max_lazy,t.good_match=a[t.level].good_length,t.nice_match=a[t.level].nice_length,t.max_chain_length=a[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function N(e,t,n,a,i,o){if(!e)return l;var s=1;if(-1===t&&(t=6),a<0?(s=0,a=-a):15<a&&(s=2,a-=16),i<1||9<i||8!==n||a<8||15<a||t<0||9<t||o<0||4<o)return h(e,l);8===a&&(a=9);var u=new T;return(e.state=u).strm=e,u.wrap=s,u.gzhead=null,u.w_bits=a,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new r.Buf8(2*u.w_size),u.head=new r.Buf16(u.hash_size),u.prev=new r.Buf16(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new r.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=o,u.method=n,C(e)}a=[new k(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(w(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+n;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,y(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-d&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(y(e,!1),e.strm.avail_out),1)})),new k(4,4,8,4,I),new k(4,5,16,8,I),new k(4,6,32,32,I),new k(4,4,16,16,b),new k(8,16,32,32,b),new k(8,16,128,128,b),new k(8,32,128,256,b),new k(32,128,258,1024,b),new k(32,258,258,4096,b)],n.deflateInit=function(e,t){return N(e,t,8,15,8,0)},n.deflateInit2=N,n.deflateReset=C,n.deflateResetKeep=_,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?l:(e.state.gzhead=t,0):l},n.deflate=function(e,t){var n,r,o,u;if(!e||!e.state||5<t||t<0)return e?h(e,l):l;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return h(e,0===e.avail_out?-5:l);if(r.strm=e,n=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,m(r,31),m(r,139),m(r,8),r.gzhead?(m(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),m(r,255&r.gzhead.time),m(r,r.gzhead.time>>8&255),m(r,r.gzhead.time>>16&255),m(r,r.gzhead.time>>24&255),m(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),m(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(m(r,255&r.gzhead.extra.length),m(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=s(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(m(r,0),m(r,0),m(r,0),m(r,0),m(r,0),m(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),m(r,3),r.status=p);else{var d=8+(r.w_bits-8<<4)<<8;d|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(d|=32),d+=31-d%31,r.status=p,M(r,d),0!==r.strstart&&(M(r,e.adler>>>16),M(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),v(e),o=r.pending,r.pending!==r.pending_buf_size));)m(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),v(e),o=r.pending,r.pending===r.pending_buf_size)){u=1;break}m(r,u=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0)}while(0!==u);r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),0===u&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),v(e),o=r.pending,r.pending===r.pending_buf_size)){u=1;break}m(r,u=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0)}while(0!==u);r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),0===u&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&v(e),r.pending+2<=r.pending_buf_size&&(m(r,255&e.adler),m(r,e.adler>>8&255),e.adler=0,r.status=p)):r.status=p),0!==r.pending){if(v(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&f(t)<=f(n)&&4!==t)return h(e,-5);if(666===r.status&&0!==e.avail_in)return h(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&666!==r.status){var x=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(w(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,a,r,o,s=e.window;;){if(e.lookahead<=c){if(w(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&0<e.strstart&&(a=s[r=e.strstart-1])===s[++r]&&a===s[++r]&&a===s[++r]){o=e.strstart+c;do{}while(a===s[++r]&&a===s[++r]&&a===s[++r]&&a===s[++r]&&a===s[++r]&&a===s[++r]&&a===s[++r]&&a===s[++r]&&r<o);e.match_length=c-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=i._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}(r,t):a[r.level].func(r,t);if(3!==x&&4!==x||(r.status=666),1===x||3===x)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===x&&(1===t?i._tr_align(r):5!==t&&(i._tr_stored_block(r,0,0,!1),3===t&&(g(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),v(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(m(r,255&e.adler),m(r,e.adler>>8&255),m(r,e.adler>>16&255),m(r,e.adler>>24&255),m(r,255&e.total_in),m(r,e.total_in>>8&255),m(r,e.total_in>>16&255),m(r,e.total_in>>24&255)):(M(r,e.adler>>>16),M(r,65535&e.adler)),v(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?0:1)},n.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&t!==p&&666!==t?h(e,l):(e.state=null,t===p?h(e,-3):0):l},n.deflateSetDictionary=function(e,t){var n,a,i,s,u,c,d,p,h=t.length;if(!e||!e.state)return l;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return l;for(1===s&&(e.adler=o(e.adler,t,h,0)),n.wrap=0,h>=n.w_size&&(0===s&&(g(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new r.Buf8(n.w_size),r.arraySet(p,t,h-n.w_size,n.w_size,0),t=p,h=n.w_size),u=e.avail_in,c=e.next_in,d=e.input,e.avail_in=h,e.next_in=0,e.input=t,w(n);n.lookahead>=3;){for(a=n.strstart,i=n.lookahead-2;n.ins_h=(n.ins_h<<n.hash_shift^n.window[a+3-1])&n.hash_mask,n.prev[a&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=a,a++,--i;);n.strstart=a,n.lookahead=2,w(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=c,e.input=d,e.avail_in=u,n.wrap=s,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(e,t,n){"use strict";t.exports=function(e,t){var n,a,r,i,o,s,u,l,c,d,p,h,f,g,v,y,m,M,x,w,I,b,k,T,_;n=e.state,a=e.next_in,T=e.input,r=a+(e.avail_in-5),i=e.next_out,_=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),u=n.dmax,l=n.wsize,c=n.whave,d=n.wnext,p=n.window,h=n.hold,f=n.bits,g=n.lencode,v=n.distcode,y=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{f<15&&(h+=T[a++]<<f,f+=8,h+=T[a++]<<f,f+=8),M=g[h&y];t:for(;;){if(h>>>=x=M>>>24,f-=x,0==(x=M>>>16&255))_[i++]=65535&M;else{if(!(16&x)){if(0==(64&x)){M=g[(65535&M)+(h&(1<<x)-1)];continue t}if(32&x){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&M,(x&=15)&&(f<x&&(h+=T[a++]<<f,f+=8),w+=h&(1<<x)-1,h>>>=x,f-=x),f<15&&(h+=T[a++]<<f,f+=8,h+=T[a++]<<f,f+=8),M=v[h&m];n:for(;;){if(h>>>=x=M>>>24,f-=x,!(16&(x=M>>>16&255))){if(0==(64&x)){M=v[(65535&M)+(h&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&M,f<(x&=15)&&(h+=T[a++]<<f,(f+=8)<x&&(h+=T[a++]<<f,f+=8)),u<(I+=h&(1<<x)-1)){e.msg="invalid distance too far back",n.mode=30;break e}if(h>>>=x,f-=x,(x=i-o)<I){if(c<(x=I-x)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=p,(b=0)===d){if(b+=l-x,x<w){for(w-=x;_[i++]=p[b++],--x;);b=i-I,k=_}}else if(d<x){if(b+=l+d-x,(x-=d)<w){for(w-=x;_[i++]=p[b++],--x;);if(b=0,d<w){for(w-=x=d;_[i++]=p[b++],--x;);b=i-I,k=_}}}else if(b+=d-x,x<w){for(w-=x;_[i++]=p[b++],--x;);b=i-I,k=_}for(;2<w;)_[i++]=k[b++],_[i++]=k[b++],_[i++]=k[b++],w-=3;w&&(_[i++]=k[b++],1<w&&(_[i++]=k[b++]))}else{for(b=i-I;_[i++]=_[b++],_[i++]=_[b++],_[i++]=_[b++],2<(w-=3););w&&(_[i++]=_[b++],1<w&&(_[i++]=_[b++]))}break}}break}}while(a<r&&i<s);a-=w=f>>3,h&=(1<<(f-=w<<3))-1,e.next_in=a,e.next_out=i,e.avail_in=a<r?r-a+5:5-(a-r),e.avail_out=i<s?s-i+257:257-(i-s),n.hold=h,n.bits=f}},{}],11:[function(e,t,n){"use strict";var a=e("../utils/common"),r=e("./adler32"),i=e("./crc32"),o=e("./inffast"),s=e("./inftrees"),u=-2;function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new a.Buf32(852),t.distcode=t.distdyn=new a.Buf32(592),t.sane=1,t.back=-1,0):u}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):u}function h(e,t){var n,a;return e&&e.state?(a=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?u:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=n,a.wbits=t,p(e))):u}function f(e,t){var n,a;return e?(a=new c,(e.state=a).window=null,0!==(n=h(e,t))&&(e.state=null),n):u}var g,v,y=!0;function m(e){if(y){var t;for(g=new a.Buf32(512),v=new a.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,g,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=g,e.lenbits=9,e.distcode=v,e.distbits=5}function M(e,t,n,r){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new a.Buf8(o.wsize)),r>=o.wsize?(a.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r<(i=o.wsize-o.wnext)&&(i=r),a.arraySet(o.window,t,n-r,i,o.wnext),(r-=i)?(a.arraySet(o.window,t,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}n.inflateReset=p,n.inflateReset2=h,n.inflateResetKeep=d,n.inflateInit=function(e){return f(e,15)},n.inflateInit2=f,n.inflate=function(e,t){var n,c,d,p,h,f,g,v,y,x,w,I,b,k,T,_,C,N,A,P,O,D,S,E,j=0,L=new a.Buf8(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return u;12===(n=e.state).mode&&(n.mode=13),h=e.next_out,d=e.output,g=e.avail_out,p=e.next_in,c=e.input,f=e.avail_in,v=n.hold,y=n.bits,x=f,w=g,D=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;y<16;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(2&n.wrap&&35615===v){L[n.check=0]=255&v,L[1]=v>>>8&255,n.check=i(n.check,L,2,0),y=v=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&v)){e.msg="unknown compression method",n.mode=30;break}if(y-=4,O=8+(15&(v>>>=4)),0===n.wbits)n.wbits=O;else if(O>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<O,e.adler=n.check=1,n.mode=512&v?10:12,y=v=0;break;case 2:for(;y<16;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(n.flags=v,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=v>>8&1),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,n.check=i(n.check,L,2,0)),y=v=0,n.mode=3;case 3:for(;y<32;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}n.head&&(n.head.time=v),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,L[2]=v>>>16&255,L[3]=v>>>24&255,n.check=i(n.check,L,4,0)),y=v=0,n.mode=4;case 4:for(;y<16;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}n.head&&(n.head.xflags=255&v,n.head.os=v>>8),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,n.check=i(n.check,L,2,0)),y=v=0,n.mode=5;case 5:if(1024&n.flags){for(;y<16;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}n.length=v,n.head&&(n.head.extra_len=v),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,n.check=i(n.check,L,2,0)),y=v=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(f<(I=n.length)&&(I=f),I&&(n.head&&(O=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),a.arraySet(n.head.extra,c,p,I,O)),512&n.flags&&(n.check=i(n.check,c,I,p)),f-=I,p+=I,n.length-=I),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;for(I=0;O=c[p+I++],n.head&&O&&n.length<65536&&(n.head.name+=String.fromCharCode(O)),O&&I<f;);if(512&n.flags&&(n.check=i(n.check,c,I,p)),f-=I,p+=I,O)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;for(I=0;O=c[p+I++],n.head&&O&&n.length<65536&&(n.head.comment+=String.fromCharCode(O)),O&&I<f;);if(512&n.flags&&(n.check=i(n.check,c,I,p)),f-=I,p+=I,O)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;y<16;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(v!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}y=v=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;y<32;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}e.adler=n.check=l(v),y=v=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=h,e.avail_out=g,e.next_in=p,e.avail_in=f,n.hold=v,n.bits=y,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){v>>>=7&y,y-=7&y,n.mode=27;break}for(;y<3;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}switch(n.last=1&v,y-=1,3&(v>>>=1)){case 0:n.mode=14;break;case 1:if(m(n),n.mode=20,6!==t)break;v>>>=2,y-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}v>>>=2,y-=2;break;case 14:for(v>>>=7&y,y-=7&y;y<32;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&v,y=v=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(I=n.length){if(f<I&&(I=f),g<I&&(I=g),0===I)break e;a.arraySet(d,c,p,I,h),f-=I,p+=I,g-=I,h+=I,n.length-=I;break}n.mode=12;break;case 17:for(;y<14;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(n.nlen=257+(31&v),v>>>=5,y-=5,n.ndist=1+(31&v),v>>>=5,y-=5,n.ncode=4+(15&v),v>>>=4,y-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;y<3;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}n.lens[z[n.have++]]=7&v,v>>>=3,y-=3}for(;n.have<19;)n.lens[z[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S={bits:n.lenbits},D=s(0,n.lens,0,19,n.lencode,0,n.work,S),n.lenbits=S.bits,D){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;_=(j=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,C=65535&j,!((T=j>>>24)<=y);){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(C<16)v>>>=T,y-=T,n.lens[n.have++]=C;else{if(16===C){for(E=T+2;y<E;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(v>>>=T,y-=T,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}O=n.lens[n.have-1],I=3+(3&v),v>>>=2,y-=2}else if(17===C){for(E=T+3;y<E;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}y-=T,O=0,I=3+(7&(v>>>=T)),v>>>=3,y-=3}else{for(E=T+7;y<E;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}y-=T,O=0,I=11+(127&(v>>>=T)),v>>>=7,y-=7}if(n.have+I>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;I--;)n.lens[n.have++]=O}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,S={bits:n.lenbits},D=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,S),n.lenbits=S.bits,D){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,S={bits:n.distbits},D=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S),n.distbits=S.bits,D){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=f&&258<=g){e.next_out=h,e.avail_out=g,e.next_in=p,e.avail_in=f,n.hold=v,n.bits=y,o(e,w),h=e.next_out,d=e.output,g=e.avail_out,p=e.next_in,c=e.input,f=e.avail_in,v=n.hold,y=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;_=(j=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,C=65535&j,!((T=j>>>24)<=y);){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(_&&0==(240&_)){for(N=T,A=_,P=C;_=(j=n.lencode[P+((v&(1<<N+A)-1)>>N)])>>>16&255,C=65535&j,!(N+(T=j>>>24)<=y);){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}v>>>=N,y-=N,n.back+=N}if(v>>>=T,y-=T,n.back+=T,n.length=C,0===_){n.mode=26;break}if(32&_){n.back=-1,n.mode=12;break}if(64&_){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&_,n.mode=22;case 22:if(n.extra){for(E=n.extra;y<E;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}n.length+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;_=(j=n.distcode[v&(1<<n.distbits)-1])>>>16&255,C=65535&j,!((T=j>>>24)<=y);){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(0==(240&_)){for(N=T,A=_,P=C;_=(j=n.distcode[P+((v&(1<<N+A)-1)>>N)])>>>16&255,C=65535&j,!(N+(T=j>>>24)<=y);){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}v>>>=N,y-=N,n.back+=N}if(v>>>=T,y-=T,n.back+=T,64&_){e.msg="invalid distance code",n.mode=30;break}n.offset=C,n.extra=15&_,n.mode=24;case 24:if(n.extra){for(E=n.extra;y<E;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}n.offset+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===g)break e;if(I=w-g,n.offset>I){if((I=n.offset-I)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}I>n.wnext?(I-=n.wnext,b=n.wsize-I):b=n.wnext-I,I>n.length&&(I=n.length),k=n.window}else k=d,b=h-n.offset,I=n.length;for(g<I&&(I=g),g-=I,n.length-=I;d[h++]=k[b++],--I;);0===n.length&&(n.mode=21);break;case 26:if(0===g)break e;d[h++]=n.length,g--,n.mode=21;break;case 27:if(n.wrap){for(;y<32;){if(0===f)break e;f--,v|=c[p++]<<y,y+=8}if(w-=g,e.total_out+=w,n.total+=w,w&&(e.adler=n.check=n.flags?i(n.check,d,w,h-w):r(n.check,d,w,h-w)),w=g,(n.flags?v:l(v))!==n.check){e.msg="incorrect data check",n.mode=30;break}y=v=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;y<32;){if(0===f)break e;f--,v+=c[p++]<<y,y+=8}if(v!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}y=v=0}n.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return u}return e.next_out=h,e.avail_out=g,e.next_in=p,e.avail_in=f,n.hold=v,n.bits=y,(n.wsize||w!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&M(e,e.output,e.next_out,w-e.avail_out)?(n.mode=31,-4):(x-=e.avail_in,w-=e.avail_out,e.total_in+=x,e.total_out+=w,n.total+=w,n.wrap&&w&&(e.adler=n.check=n.flags?i(n.check,d,w,e.next_out-w):r(n.check,d,w,e.next_out-w)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===x&&0===w||4===t)&&0===D&&(D=-5),D)},n.inflateEnd=function(e){if(!e||!e.state)return u;var t=e.state;return t.window&&(t.window=null),e.state=null,0},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?u:((n.head=t).done=!1,0):u},n.inflateSetDictionary=function(e,t){var n,a=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?u:11===n.mode&&r(1,t,a,0)!==n.check?-3:M(e,t,a,a)?(n.mode=31,-4):(n.havedict=1,0):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(e,t,n){"use strict";var a=e("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,u,l,c,d,p){var h,f,g,v,y,m,M,x,w,I=p.bits,b=0,k=0,T=0,_=0,C=0,N=0,A=0,P=0,O=0,D=0,S=null,E=0,j=new a.Buf16(16),L=new a.Buf16(16),z=null,R=0;for(b=0;b<=15;b++)j[b]=0;for(k=0;k<u;k++)j[t[n+k]]++;for(C=I,_=15;1<=_&&0===j[_];_--);if(_<C&&(C=_),0===_)return l[c++]=20971520,l[c++]=20971520,p.bits=1,0;for(T=1;T<_&&0===j[T];T++);for(C<T&&(C=T),b=P=1;b<=15;b++)if(P<<=1,(P-=j[b])<0)return-1;if(0<P&&(0===e||1!==_))return-1;for(L[1]=0,b=1;b<15;b++)L[b+1]=L[b]+j[b];for(k=0;k<u;k++)0!==t[n+k]&&(d[L[t[n+k]]++]=k);if(0===e?(S=z=d,m=19):1===e?(S=r,E-=257,z=i,R-=257,m=256):(S=o,z=s,m=-1),b=T,y=c,A=k=D=0,g=-1,v=(O=1<<(N=C))-1,1===e&&852<O||2===e&&592<O)return 1;for(;;){for(M=b-A,d[k]<m?(x=0,w=d[k]):d[k]>m?(x=z[R+d[k]],w=S[E+d[k]]):(x=96,w=0),h=1<<b-A,T=f=1<<N;l[y+(D>>A)+(f-=h)]=M<<24|x<<16|w|0,0!==f;);for(h=1<<b-1;D&h;)h>>=1;if(0!==h?(D&=h-1,D+=h):D=0,k++,0==--j[b]){if(b===_)break;b=t[n+d[k]]}if(C<b&&(D&v)!==g){for(0===A&&(A=C),y+=T,P=1<<(N=b-A);N+A<_&&!((P-=j[N+A])<=0);)N++,P<<=1;if(O+=1<<N,1===e&&852<O||2===e&&592<O)return 1;l[g=D&v]=C<<24|N<<16|y-c|0}}return 0!==D&&(l[y+D]=b-A<<24|64<<16|0),p.bits=C,0}},{"../utils/common":3}],13:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,n){"use strict";var a=e("../utils/common");function r(e){for(var t=e.length;0<=--t;)e[t]=0}var i=256,o=286,s=30,u=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],p=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=new Array(576);r(h);var f=new Array(60);r(f);var g=new Array(512);r(g);var v=new Array(256);r(v);var y=new Array(29);r(y);var m,M,x,w=new Array(s);function I(e,t,n,a,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=a,this.max_length=r,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function k(e){return e<256?g[e]:g[256+(e>>>7)]}function T(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function _(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,T(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function C(e,t,n){_(e,n[2*t],n[2*t+1])}function N(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function A(e,t,n){var a,r,i=new Array(16),o=0;for(a=1;a<=u;a++)i[a]=o=o+n[a-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=N(i[s]++,s))}}function P(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function O(e){8<e.bi_valid?T(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function D(e,t,n,a){var r=2*t,i=2*n;return e[r]<e[i]||e[r]===e[i]&&a[t]<=a[n]}function S(e,t,n){for(var a=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&D(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!D(t,a,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=a}function E(e,t,n){var a,r,o,s,u=0;if(0!==e.last_lit)for(;a=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],r=e.pending_buf[e.l_buf+u],u++,0===a?C(e,r,t):(C(e,(o=v[r])+i+1,t),0!==(s=l[o])&&_(e,r-=y[o],s),C(e,o=k(--a),n),0!==(s=c[o])&&_(e,a-=w[o],s)),u<e.last_lit;);C(e,256,t)}function j(e,t){var n,a,r,i=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==i[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=o[2*r+1]);for(t.max_code=c,n=e.heap_len>>1;1<=n;n--)S(e,i,n);for(r=l;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],S(e,i,1),a=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=a,i[2*r]=i[2*n]+i[2*a],e.depth[r]=(e.depth[n]>=e.depth[a]?e.depth[n]:e.depth[a])+1,i[2*n+1]=i[2*a+1]=r,e.heap[1]=r++,S(e,i,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,a,r,i,o,s,l=t.dyn_tree,c=t.max_code,d=t.stat_desc.static_tree,p=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,g=t.stat_desc.max_length,v=0;for(i=0;i<=u;i++)e.bl_count[i]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)g<(i=l[2*l[2*(a=e.heap[n])+1]+1]+1)&&(i=g,v++),l[2*a+1]=i,c<a||(e.bl_count[i]++,o=0,f<=a&&(o=h[a-f]),s=l[2*a],e.opt_len+=s*(i+o),p&&(e.static_len+=s*(d[2*a+1]+o)));if(0!==v){do{for(i=g-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[g]--,v-=2}while(0<v);for(i=g;0!==i;i--)for(a=e.bl_count[i];0!==a;)c<(r=e.heap[--n])||(l[2*r+1]!==i&&(e.opt_len+=(i-l[2*r+1])*l[2*r],l[2*r+1]=i),a--)}}(e,t),A(i,c,e.bl_count)}function L(e,t,n){var a,r,i=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),t[2*(n+1)+1]=65535,a=0;a<=n;a++)r=o,o=t[2*(a+1)+1],++s<u&&r===o||(s<l?e.bl_tree[2*r]+=s:0!==r?(r!==i&&e.bl_tree[2*r]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,i=r,(s=0)===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4))}function z(e,t,n){var a,r,i=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),a=0;a<=n;a++)if(r=o,o=t[2*(a+1)+1],!(++s<u&&r===o)){if(s<l)for(;C(e,r,e.bl_tree),0!=--s;);else 0!==r?(r!==i&&(C(e,r,e.bl_tree),s--),C(e,16,e.bl_tree),_(e,s-3,2)):s<=10?(C(e,17,e.bl_tree),_(e,s-3,3)):(C(e,18,e.bl_tree),_(e,s-11,7));i=r,(s=0)===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4)}}r(w);var R=!1;function B(e,t,n,r){var i,o,s;_(e,0+(r?1:0),3),o=t,s=n,O(i=e),T(i,s),T(i,~s),a.arraySet(i.pending_buf,i.window,o,s,i.pending),i.pending+=s}n._tr_init=function(e){R||(function(){var e,t,n,a,r,i=new Array(16);for(a=n=0;a<28;a++)for(y[a]=n,e=0;e<1<<l[a];e++)v[n++]=a;for(v[n-1]=a,a=r=0;a<16;a++)for(w[a]=r,e=0;e<1<<c[a];e++)g[r++]=a;for(r>>=7;a<s;a++)for(w[a]=r<<7,e=0;e<1<<c[a]-7;e++)g[256+r++]=a;for(t=0;t<=u;t++)i[t]=0;for(e=0;e<=143;)h[2*e+1]=8,e++,i[8]++;for(;e<=255;)h[2*e+1]=9,e++,i[9]++;for(;e<=279;)h[2*e+1]=7,e++,i[7]++;for(;e<=287;)h[2*e+1]=8,e++,i[8]++;for(A(h,287,i),e=0;e<s;e++)f[2*e+1]=5,f[2*e]=N(e,5);m=new I(h,l,257,o,u),M=new I(f,c,0,s,u),x=new I(new Array(0),d,0,19,7)}(),R=!0),e.l_desc=new b(e.dyn_ltree,m),e.d_desc=new b(e.dyn_dtree,M),e.bl_desc=new b(e.bl_tree,x),e.bi_buf=0,e.bi_valid=0,P(e)},n._tr_stored_block=B,n._tr_flush_block=function(e,t,n,a){var r,o,s=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<i;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),j(e,e.l_desc),j(e,e.d_desc),s=function(e){var t;for(L(e,e.dyn_ltree,e.l_desc.max_code),L(e,e.dyn_dtree,e.d_desc.max_code),j(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*p[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?B(e,t,n,a):4===e.strategy||o===r?(_(e,2+(a?1:0),3),E(e,h,f)):(_(e,4+(a?1:0),3),function(e,t,n,a){var r;for(_(e,t-257,5),_(e,n-1,5),_(e,a-4,4),r=0;r<a;r++)_(e,e.bl_tree[2*p[r]+1],3);z(e,e.dyn_ltree,t-1),z(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),E(e,e.dyn_ltree,e.dyn_dtree)),P(e),a&&O(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(v[n]+i+1)]++,e.dyn_dtree[2*k(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){var t;_(e,2,3),C(e,256,h),16===(t=e).bi_valid?(T(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":3}],15:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(e,t,n){"use strict";var a={};(0,e("./lib/utils/common").assign)(a,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=a},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}))},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(28)),r=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),l=d(n(14)),c=d(n(47));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.offsetBegin=0,e.offsetEnd=0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"playUtilBtwTimeAndReady",value:function(e){return p(this,void 0,void 0,a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showTrack();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"isWaiting",value:function(e){return e<this.offsetBegin||this.offsetEnd,!1}},{key:"setViewer",value:function(e){}},{key:"setPlaySpeed",value:function(e){}},{key:"showTrack",value:function(){return p(this,void 0,void 0,a.default.mark((function e(){var t=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state="beforeshow",e.next=3,new l.default((function(e){t.emit("visibleChange","show",t.params,(function(n){t.showTrackCb(n),e()}))}));case 3:this.state="playing",setTimeout((function(){t.emit("showTrack")}));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"hideTrack",value:function(){return p(this,void 0,void 0,a.default.mark((function e(){var t=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state="beforefinish",e.next=3,new l.default((function(e){t.emit("visibleChange","hide",t.params,(function(){t.hideTrackCb(),e()}))}));case 3:setTimeout((function(){t.emit("hideTrack")})),this.state="finished";case 5:case"end":return e.stop()}}),e,this)})))}},{key:"destroy",value:function(){return p(this,void 0,void 0,a.default.mark((function e(){var t=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._awaitTrackHandler();case 2:if("playing"!==this.state){e.next=5;break}return e.next=5,this.hideTrack();case 5:this.eventNames().forEach((function(e){return t.off(e)}));case 6:case"end":return e.stop()}}),e,this)})))}},{key:"update",value:function(e){return p(this,void 0,void 0,a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.seekTo(e,!0,!1);case 2:this.play();case 3:case"end":return t.stop()}}),t,this)})))}},{key:"seekTo",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return p(this,void 0,void 0,a.default.mark((function r(){return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if("init"!==this.state&&"error"!==this.state){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,this._awaitTrackHandler();case 4:if(!(e<this.offsetBegin)){a.next=11;break}if("playing"!==this.state){a.next=8;break}return a.next=8,this.hideTrack();case 8:this.state="ready",a.next=22;break;case 11:if(!(e>this.offsetEnd)){a.next=18;break}if("playing"!==this.state){a.next=15;break}return a.next=15,this.hideTrack();case 15:this.state="finished",a.next=22;break;case 18:if("ready"!==this.state&&"finished"!==this.state){a.next=21;break}return a.next=21,this.showTrack();case 21:this.state="playing";case 22:return a.next=24,this.doSetTrack(e,t,n);case 24:case"end":return a.stop()}}),r,this)})))}},{key:"_awaitTrackHandler",value:function(){return p(this,void 0,void 0,a.default.mark((function e(){var t=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("beforeshow"!==this.state){e.next=4;break}return e.next=3,new l.default((function(e){t.once("showTrack",e)}));case 3:this.state="playing";case 4:if("beforefinish"!==this.state){e.next=8;break}return e.next=7,new l.default((function(e){t.once("hideTrack",e)}));case 7:this.state="finished";case 8:case"end":return e.stop()}}),e,this)})))}},{key:"duration",get:function(){return this.offsetEnd-this.offsetBegin}}]),t}(c.default);t.default=h},function(e,t,n){e.exports=function(e){function t(e){let n;function i(...e){if(!i.enabled)return;const a=i,r=Number(new Date),o=r-(n||r);a.diff=o,a.prev=n,a.curr=r,n=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,r)=>{if("%%"===n)return n;s++;const i=t.formatters[r];if("function"==typeof i){const t=e[s];n=i.call(a,t),e.splice(s,1),s--}return n}),t.formatArgs.call(a,e);(a.log||t.log).apply(a,e)}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=t.selectColor(e),i.destroy=a,i.extend=r,"function"==typeof t.init&&t.init(i),t.instances.push(i),i}function a(){const e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function r(e,n){const a=t(this.namespace+(void 0===n?":":n)+e);return a.log=this.log,a}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.names=[],t.skips=[];const a=("string"==typeof e?e:"").split(/[\s,]+/),r=a.length;for(n=0;n<r;n++)a[n]&&("-"===(e=a[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){const e=t.instances[n];e.enabled=t.enabled(e.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,a;for(n=0,a=t.skips.length;n<a;n++)if(t.skips[n].test(e))return!1;for(n=0,a=t.names.length;n<a;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(508),Object.keys(e).forEach(n=>{t[n]=e[n]}),t.instances=[],t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserManager=void 0;var a=p(n(19)),r=p(n(74)),i=p(n(2)),o=p(n(0)),s=p(n(1)),u=p(n(3)),l=p(n(4)),c=p(n(518)),d=n(47);function p(e){return e&&e.__esModule?e:{default:e}}t.UserManager=function(e){function t(e){var n=e.account,a=e.maxUserHistory;(0,o.default)(this,t);var s=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return s.userKeys=[],s.userMap=new r.default,s.onUndo=function(e){s.emit("undo",e)},s.onRedo=function(e){s.emit("redo",e)},s.account=n,s.maxUserHistory="number"==typeof a?a:10,s}return(0,l.default)(t,e),(0,s.default)(t,[{key:"getUser",value:function(e){return this.userMap.get(e)}},{key:"addUser",value:function(e){if(this.userMap.has(e))return this.userMap.get(e);var t=new c.default(e,this.maxUserHistory);return t.on("undo",this.onUndo),t.on("redo",this.onRedo),this.userMap.set(e,t),t}},{key:"hasUser",value:function(e){return this.userMap.has(e)}},{key:"remove",value:function(e){this.userMap.has(e)&&this.userMap.get(e).removeAllListeners();return this.userMap.delete(e)}},{key:"removeOtherUsers",value:function(){var e=this;this.others.forEach((function(t){t.removeAllListeners(),e.userMap.delete(t.account)}))}},{key:"destroy",value:function(){this.all.forEach((function(e){return e.removeAllListeners()})),this.userMap.clear()}},{key:"toSnapshot",value:function(e){return this.all.map((function(t){return{account:t.account,recycle:t.recycle.map((function(t){return t.toSnapshot(e)})),calibrate:t.getCalibrateAction().toString()}}))}},{key:"myself",get:function(){return this.userMap.get(this.account)}},{key:"others",get:function(){var e=this,t=[];return this.userMap.forEach((function(n,a){a===e.account||t.push(n)})),t}},{key:"uids",get:function(){return[].concat((0,a.default)(this.userMap.keys()))}},{key:"all",get:function(){return[].concat((0,a.default)(this.userMap.values()))}}]),t}(d.EventEmitter)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStandardCursor=function(e){},t.isStandardMode=function(e){if("string"!=typeof e)return[!1,"模式必须是字符串"];if(""===(e=e.trim()))return[!1,"模式不能为空！"];if("player"===e)return[!0];if(!~e.indexOf(":"))return[!1,"模式格式不正确！没有找到分割符-> ："];e.split(":");return[!0]},t.isValidTool=function(e){if("string"!=typeof e)return!1;switch(e){case"fill":case"flag":case"free":case"line":case"rect":case"circle":case"roundRect":case"solidRect":case"solidRoundRect":case"solidCircle":case"text":case"ellipse":case"solidEllipse":case"erase":return!0;default:return!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(28)),r=f(n(7)),i=f(n(2)),o=f(n(0)),s=f(n(1)),u=f(n(3)),l=f(n(4)),c=f(n(14)),d=f(n(469)),p=n(159),h=n(459);function f(e){return e&&e.__esModule?e:{default:e}}var g=function(e,t,n,a){return new(n||(n=c.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},v=function(e){function t(e,n){(0,o.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));a.params=e,a.viewerArr=[],a.urlArray=[],a.type="gz",a.offsetBegin=0,a.offsetEnd=0;var s=void 0;if(Array.isArray(e)){a.originalParams=e.slice(),a.urlArray=e.map((function(e){return e.url})),s=e[0].timestamp;var l=!0,c=!1,d=void 0;try{for(var p,h=(0,r.default)(e);!(l=(p=h.next()).done);l=!0){var f=p.value;s=Math.min(s,f.timestamp)}}catch(e){c=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw d}}}else a.originalParams=[e],s=e.timestamp,a.url=e.url;return a.timestamp=s,a.opt=n,a.state="init",a.nextRecordIndex=0,a.viewer="unknown",a}return(0,l.default)(t,e),(0,s.default)(t,[{key:"fetchData",value:function(){return g(this,void 0,void 0,a.default.mark((function e(){var t,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("init wb track "),t=void 0,e.prev=2,e.next=5,(0,h.fetchBlob)(this.url);case 5:t=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",["error",[]]);case 11:return e.next=13,this.getRawRecordFromBlob(t);case 13:return(n=e.sent).length&&(this.offsetEnd=Math.max(this.offsetBegin+n[n.length-1].time+1e3,this.offsetEnd)),e.abrupt("return",["ready",n]);case 16:case"end":return e.stop()}}),e,this,[[2,8]])})))}},{key:"fetchMultiData",value:function(){return g(this,void 0,void 0,a.default.mark((function e(){var t,n,r,i,o=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],e.prev=1,n=0;case 3:if(!(n<this.urlArray.length)){e.next=10;break}return e.next=6,(0,h.fetchBlob)(this.urlArray[n]);case 6:t[n]=e.sent;case 7:n++,e.next=3;break;case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",["error",[]]);case 15:return e.next=17,c.default.all(t.map((function(e,t){return g(o,void 0,void 0,a.default.mark((function n(){var r,i,o,s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getRawRecordFromBlob(e);case 2:return r=n.sent,i=this.originalParams[t],o=i.timestamp-this.timestamp,s=0,r.length&&(s=r[r.length-1].time,this.offsetEnd=Math.max(o+s+1e3,this.offsetEnd)),o>0&&r.forEach((function(e){e.time=e.time+o})),n.abrupt("return",{cid:i.cid,beginAt:o,endAt:o+s,records:r});case 9:case"end":return n.stop()}}),n,this)})))})));case 17:if(r=e.sent,i=this.mergeRawDataByChannel(r),!this.isChannelOverlapping(i)){e.next=21;break}return e.abrupt("return",["error",[]]);case 21:return e.abrupt("return",["ready",i]);case 22:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"getRawRecordFromBlob",value:function(e){return g(this,void 0,void 0,a.default.mark((function t(){var n,r=this;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new c.default((function(t){var n=[],i=new FileReader;i.readAsBinaryString(e),i.onload=function(){return g(r,void 0,void 0,a.default.mark((function e(){var r,o,s,u,l,c,d,f,g,v;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.pako.ungzip(i.result),o=new DataView(r.buffer),s=o.byteLength,u=0;case 4:if(!(u<s)){e.next=17;break}return l=o.getInt32(u,!0),c=o.getInt32(u+4,!0),d=l-8,f=u+8,g=r.slice(f,f+d),e.next=12,(0,h.ab2str)(g);case 12:v=e.sent,n.push({time:c,str:v}),u+=l,e.next=4;break;case 17:o=null,t(n);case 19:case"end":return e.stop()}}),e,this)})))}}));case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"mergeRawDataByChannel",value:function(e){for(var t={},n=0;n<e.length;n++){var a=e[n];if(t.hasOwnProperty(a.cid)){var r=t[a.cid];t[a.cid]={cid:a.cid,beginAt:Math.min(r.beginAt,a.beginAt),endAt:Math.max(r.endAt,a.endAt),records:r.records.concat(a.records)}}else t[a.cid]=a}var i=[];for(var o in t)t[o].records=t[o].records.sort((function(e,t){return e.time-t.time})),i.push(t[o]);return i}},{key:"isChannelOverlapping",value:function(e){for(var t=e.sort((function(e,t){return e.beginAt-t.beginAt})),n=0;n<t.length-1;n++){var a=t[n],r=t[n+1];if(a.endAt>r.beginAt)return console.error("[白板] \nchannel:"+a.cid+"与channel:"+r.cid+"之间的时间存在重叠区域，\nchannel:"+a.cid+"的开始结束时间为: "+this.formatTimeOffset(a.beginAt)+"-"+this.formatTimeOffset(a.endAt)+",\nchannel:"+r.cid+"的开始结束时间为: "+this.formatTimeOffset(r.beginAt)+"-"+this.formatTimeOffset(r.endAt)+"\n        "),!0}return!1}},{key:"formatTimeOffset",value:function(e){return new Date(e+this.timestamp).toLocaleString()}},{key:"hideTrackCb",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(d.default);t.default=v},,,,,,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(495)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=y(n(28)),r=y(n(2)),i=y(n(0)),o=y(n(1)),s=y(n(3)),u=y(n(4)),l=y(n(14)),c=y(n(47)),d=y(n(496)),p=n(498),h=y(n(503)),f=y(n(504)),g=y(n(521)),v=n(459);function y(e){return e&&e.__esModule?e:{default:e}}var m=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},M=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.speed=1,e.init=function(t){var n=[],a=[];t.videoTracks.forEach((function(e){n.push(new h.default(e))})),t.whiteboardTracks.forEach((function(e){"1.0"===t.version||"2.0"===t.version?(e.hasOwnProperty("account")||(e.account=(Date.now()+1e4*Math.random()).toString()),n.push(new f.default(e,{version:t.version}))):a.push(e)}));var r=void 0;if(a.length>0){var i=new g.default(a,{version:t.version});n.push(i),r=i.drawManager}e.timeline=new d.default(n),e.timeline.on("tick",e._handleTick),e.timeline.on("pause",(function(){return e.emit("pause")})),e.timeline.on("play",(function(){return e.emit("play")})),e.timeline.on("finished",(function(){e.emit("finished")})),e.timeline.on("visibleChange",(function(t,n,a){e._visibleChangeCallHandler(t,n,a),e.emit("visibleChange",t,n)}));var o=e;return new l.default((function(t,n){e.timeline.once("ready",(function(n){e.originalStartTime=n.beginTimeStamp,e.originalEndTime=n.endTimeStamp,t({player:o,params:n,drawPlugin:r})})),e.timeline.once("error",(function(e){n(e)}))}))},e._visibleChangeCallHandler=function(e,t,n){"show"===e?n(t.container):n()},e._handleTick=function(t){e.lastTickRealTime=e.convertUiTimeToRealTime(t),e.emit("tick",t)},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"bindControlContainer",value:function(e){"function"==typeof this.unmount&&this.unmount(),this.unmount=(0,p.mount)(e,this)}},{key:"getDuration",value:function(){return this.originalStartTime&&this.originalEndTime?this.startTime&&this.endTime?Math.max(0,this.endTime-this.startTime):this.startTime?Math.max(0,this.originalEndTime-this.startTime):this.endTime?Math.max(0,this.endTime-this.originalStartTime):Math.max(0,this.originalEndTime-this.originalStartTime):0}},{key:"getTimeOffset",value:function(){return this.startTime&&this.originalStartTime?this.startTime-this.originalStartTime:0}},{key:"getLastUiTime",value:function(){return this.lastTickRealTime?this.convertRealTimeToUiTime(this.lastTickRealTime):0}},{key:"convertUiTimeToRealTime",value:function(e){if(this.startTime)return e+this.startTime;if(this.originalStartTime)return e+this.originalStartTime;throw new Error("convert ui time to real time, start time is unavailable")}},{key:"convertRealTimeToUiTime",value:function(e){var t=void 0;if(e)if(this.startTime)t=e-this.startTime;else{if(!this.originalStartTime)throw new Error("convert real time to ui time, start time is unavailable");t=e-this.originalStartTime}else t=0;return Math.min(Math.max(t,0),this.getDuration())}},{key:"_isTimeRangeValid",value:function(e,t){var n=this.originalStartTime,a=this.originalEndTime;return e=Number(e),isNaN(e)||0===e||(n=e),t=Number(t),isNaN(t)||0===t||(a=t),!(a-n<100)||(console.error("设置timeRange:\n起始时间:"+n+", "+new Date(n).toLocaleString()+"\n终止时间: "+a+", "+new Date(a).toLocaleString()+"\n时间间隔小于100ms, 或者起始时间晚于终止时间，这次设置无效"),!1)}},{key:"setTimeRange",value:function(e,t){var n;if(this._isTimeRangeValid(e,t)){e=Number(e),isNaN(e)||0===e||(this.startTime=e),t=Number(t),isNaN(t)||0===t||(this.endTime=t);var a=this.convertRealTimeToUiTime(this.lastTickRealTime);return a=Math.max(0,a),null===(n=this.timeline)||void 0===n||n.adjustTimeRange(this.getTimeOffset(),this.getDuration()),this.seekTo(a),this.getDuration()>36e6&&console.warn("设置后录像时长超过10小时，请仔细检查的参数是否正确"),this.emit("durationChange",this.getDuration())}}},{key:"setPlaySpeed",value:function(e){var t=Number(e);if(isNaN(t))throw new Error("播放速度必须是数字, 目前是: "+e);if(t<=.1||t>=100)throw new Error("播放速度不能大于100，或者小于0.1");this.timeline&&(this.timeline.setPlaySpeed(t),this.speed=t,this.emit("speedChange",t))}},{key:"setViewer",value:function(e){this.timeline&&this.timeline.setViewer(e)}},{key:"play",value:function(){if(this.timeline)return this.timeline.play()}},{key:"pause",value:function(){if(this.timeline)return this.timeline.pause()}},{key:"seekTo",value:function(e){return m(this,void 0,void 0,a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=Number(e),isNaN(e)&&console.error("[白板] seekTo参数无效",e),e=Math.max(e,0),!this.timeline){t.next=7;break}return this._handleTick(e),t.next=7,this.timeline.seekTo(e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"destroy",value:function(){return m(this,void 0,void 0,a.default.mark((function e(){var t=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.timeline){e.next=3;break}return e.next=3,this.timeline.destroy();case 3:"function"==typeof this.unmount&&(this.unmount(),this.unmount=void 0),delete this.timeline,this.eventNames().forEach((function(e){return t.off(e)}));case 6:case"end":return e.stop()}}),e,this)})))}}],[{key:"getInstance",value:function(e){var n=e.whiteboardParams.urlArr.map((function(t){var n=(0,v.parseUrl)(t);if(n&&e.whiteboardParams.timestamp&&(n.timestamp=e.whiteboardParams.timestamp),!n.timestamp)throw new Error("replay--\x3e 无法获取白板录像文件的开始时间, 请仔细检查你的参数");if(!e.whiteboardParams.container)throw new Error("replay--\x3e 白板容器不可用，请仔细检查你的参数");return n.container=e.whiteboardParams.container,n.drawPluginParams=e.whiteboardParams.drawPluginParams,n})).filter((function(e){return e})),a=void 0;return a=e.videoParams?e.videoParams.map((function(e,t){var n=(0,v.parseUrl)(e.url);if(n&&e.timestamp&&(n.timestamp=e.timestamp),!n.timestamp)throw new Error("[白板] replay--\x3e 无法获取第"+(t+1)+"个视频录像的开始时间, 请仔细检查你的参数");return e.container||console.error("[白板] replay--\x3e 第"+(t+1)+"个录像文件的容器为空，请仔细检查你的参数"),n.container=e.container,n})):[],console.log("replay--\x3e 录像回放参数为",n,a,e.version),(new t).init({whiteboardTracks:n,videoTracks:a,version:e.version||"3.0"})}}]),t}(c.default);t.default=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(28)),r=h(n(2)),i=h(n(0)),o=h(n(1)),s=h(n(3)),u=h(n(4)),l=h(n(14)),c=h(n(47)),d=n(497),p=h(d);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},g=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return n.tracks=e,n.ticker=new p.default,n.timeOffset=0,n.endTimeStamp=0,n.state="pause",n.busy=!1,n.handleTrackVisibleChange=function(e,t,a){n.emit("visibleChange",e,t,a)},n.update=function(e){return f(n,void 0,void 0,a.default.mark((function t(){var n=this;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"play"!==this.state&&console.error("[白板] update应该处于play状态下才调用"),t.next=3,l.default.all(this.tracks.map((function(t){return t.update(e+n.timeOffset)})));case 3:e>=this.endTimeStamp&&setTimeout((function(){n._doPause(),n.state="finished",n.emit("finished")}));case 4:case"end":return t.stop()}}),t,this)})))},n.initTrack(e),n.bindTickerEvents(),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"adjustTimeRange",value:function(e,t){this.timeOffset=e,this.endTimeStamp=t}},{key:"initTrack",value:function(e){var t=this;this.tracks=e.slice();var n=v(e),a=m(e,n);console.log("init every track"),l.default.all(a).then((function(a){console.log("every track inited");var r=t.tracks.filter((function(e,t){return"error"===a[t]}));t.tracks=t.tracks.filter((function(e,t){return"ready"===a[t]})),r.length>0&&t.emit("error","bad track"),t.endTimeStamp=y(e),t.bindTrackEvents(),console.log("timeline ready");var i=[];t.tracks.forEach((function(e){Array.isArray(e.viewerArr)&&e.viewerArr.forEach((function(e){-1===i.indexOf(e)&&i.push(e)}))})),0===i.length&&i.push("unknown"),t.emit("ready",{beginTimeStamp:n,endTimeStamp:t.endTimeStamp+n,duration:t.endTimeStamp,viewerArr:i})}))}},{key:"bindTrackEvents",value:function(){var e=this;this.tracks.forEach((function(t){t.on("visibleChange",e.handleTrackVisibleChange),t.on("waitingToPlay",(function(){return e.handleTrackWaitingToPlay()})),t.on("canplay",(function(){return e.handleTrackCanPlay()}))}))}},{key:"bindTickerEvents",value:function(){var e=this;this.ticker.on("tick",(function(t){e.emit("tick",t),e.update(t)})),this.ticker.on("pause",(function(){e.emit("pause")})),this.ticker.on("play",(function(){e.emit("play")}))}},{key:"handleTrackWaitingToPlay",value:function(){"play"===this.state&&this.hasTrackWaiting()&&(this.state="waitingToPlay",this._doPause())}},{key:"handleTrackCanPlay",value:function(){"waitingToPlay"!==this.state||this.hasTrackWaiting()||(this.state="play",this._doPlay())}},{key:"hasTrackWaiting",value:function(){var e=this;return void 0!==this.tracks.find((function(t){return t.isWaiting(e.ticker.currTimeStamp)}))}},{key:"pause",value:function(){this.busy?console.warn("busy pause"):("play"===this.state&&this._doPause(),"finished"!==this.state&&(this.state="pause"))}},{key:"play",value:function(){this.busy?console.warn("busy play"):"finished"!==this.state?this.hasTrackWaiting()?this.state="waitingToPlay":(this.state="play",this._doPlay()):(this.state="play",this.seekTo(0))}},{key:"setPlaySpeed",value:function(e){this.ticker.rate=e,this.tracks.forEach((function(t){t.setPlaySpeed(e)}))}},{key:"setViewer",value:function(e){this.tracks.forEach((function(t){return t.setViewer(e)}))}},{key:"seekTo",value:function(e){return f(this,void 0,void 0,a.default.mark((function t(){var n=this;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.busy){t.next=2;break}return t.abrupt("return");case 2:if(e=Math.min(Math.max(e,0),this.endTimeStamp),!(this.ticker.currTimeStamp<e&&e<this.ticker.currTimeStamp+2*d.DEFAULT_INTERVAL)){t.next=5;break}return t.abrupt("return");case 5:if(!(e<this.ticker.currTimeStamp)){t.next=20;break}return"finished"===this.state&&(this.state="pause"),this.busy=!0,this.ticker.setCurrentTime(e),t.prev=9,t.next=12,l.default.all(this.tracks.map((function(t){return t.seekTo(e+n.timeOffset,!1)})));case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(9),console.error(t.t0);case 17:this.busy=!1,t.next=31;break;case 20:return this.busy=!0,this.ticker.setCurrentTime(e),t.prev=22,t.next=25,l.default.all(this.tracks.map((function(t){return t.seekTo(e+n.timeOffset,!0)})));case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(22),console.error(t.t1);case 30:this.busy=!1;case 31:"play"===this.state?this._doPlay():this._doPause();case 32:case"end":return t.stop()}}),t,this,[[9,14],[22,27]])})))}},{key:"_doPause",value:function(){this.ticker.pause(),this.tracks.forEach((function(e){return e.pause()}))}},{key:"_doPlay",value:function(){this.ticker.play(),this.tracks.forEach((function(e){return e.play()}))}},{key:"destroy",value:function(){return f(this,void 0,void 0,a.default.mark((function e(){var t=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ticker.destory(),e.next=3,l.default.all(this.tracks.map((function(e){return e.destroy()})));case 3:this.eventNames().forEach((function(e){return t.off(e)}));case 4:case"end":return e.stop()}}),e,this)})))}}]),t}(c.default);t.default=g;var v=function(e){var t=Number.POSITIVE_INFINITY;return e.forEach((function(e){t>e.timestamp&&(t=e.timestamp)})),t},y=function(e){var t=Number.NEGATIVE_INFINITY;return e.forEach((function(e){t<e.offsetEnd&&(t=e.offsetEnd)})),t},m=function(e,t){var n=/iphone/i.test(navigator.userAgent),a=l.default.resolve("got lucky ~");return e.map((function(e){if(e.offsetBegin=e.timestamp-t,n&&("mp4"===e.type||"flv"===e.type||"aac"===e.type)){var r=e.init(a);return a=r,r}return e.init()}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_INTERVAL=void 0;var a=l(n(2)),r=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=n(47);function l(e){return e&&e.__esModule?e:{default:e}}var c=t.DEFAULT_INTERVAL=10,d=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.state="pause",e.currTimeStamp=0,e.lastRealTime=void 0,e.rate=1,e.microTask=function(){"play"===e.state&&e.tick()},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"destory",value:function(){var e=this;this.pause(),this.eventNames().forEach((function(t){return e.off(t)}))}},{key:"tick",value:function(){var e=Date.now();if(void 0!==this.lastRealTime){var t=(e-this.lastRealTime)*this.rate;this.currTimeStamp=this.currTimeStamp+t,this.lastRealTime=e,this.emit("tick",this.currTimeStamp)}else this.lastRealTime=e}},{key:"pause",value:function(){this.timer&&window.clearInterval(this.timer),this.timer=void 0,this.lastRealTime=void 0,this.state="pause",this.emit("pause")}},{key:"play",value:function(){this.timer||(this.timer=setInterval(this.microTask,c)),this.state="play",this.emit("play")}},{key:"setCurrentTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currTimeStamp=e,this.lastRealTime=void 0}}]),t}(u.EventEmitter);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(38)),r=f(n(2)),i=f(n(0)),o=f(n(1)),s=f(n(3)),u=f(n(4));t.mount=function(e,t){if(!e)throw new Error("RecordPlayer mount传入的容器不能为空");if(!t)throw new Error("请传入录制回放实例");var n=(0,l.render)(c.default.createElement(v,{player:t}),e);return function(){(0,l.render)(c.default.createElement(y,null),e,n)}};var l=n(6),c=f(l),d=n(459),p=f(n(499)),h=f(n(500));function f(e){return e&&e.__esModule?e:{default:e}}n(501);var g=/iphone|android/i.test(navigator.userAgent),v=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));n.toolUIEl=(0,l.createRef)(),n.onMouseMove=function(e){var t=n.getCurrentXAndTime(e),r=t.currentX,i=t.currentTime,o=(0,d.getTime)(i),s=(0,a.default)(o,1)[0];n.setState({labelLeft:r,labelText:s})},n.pauseOrPlay=function(e){var t=n.state.paused;t?n.props.player.play():n.props.player.pause(),n.setState({paused:!t})},n.onMouseDown=function(e){"slider"===e.target.getAttribute("role")&&(n.setState({showLabel:!0,drag:!0}),n.onMouseMove(e))},n.onMouseUp=function(e){n.state.drag&&n.seekTo(e),n.hidePosition(e)},n.handleClickSpeed=function(e){n.setState({speedOptionShow:!n.state.speedOptionShow})},n.handleClickSpeedOption=function(e,t){e.stopPropagation(),n.setState({speedOptionShow:!1}),n.props.player.setPlaySpeed(t)},n.showPosition=function(e){n.setState({showLabel:!0}),n.onMouseMove(e)},n.hidePosition=function(e){n.setState({showLabel:!1})},n.seekTo=function(e){var t=n.getCurrentXAndTime(e),a=t.currentX,r=t.currentTime;n.props.player.seekTo(r);var i={labelLeft:a,time:r,drag:!1};g&&(i.showLabel=!1),n.setState(i)},n.getCurrentXAndTime=function(e){var t=0,a=n.toolUIEl.current.getBoundingClientRect().left;t=e.type.search(/mouse|click/)>-1?e.clientX-a:e.touches[0].clientX-a;var r=n.toolUIEl.current.offsetWidth;return t<0&&(t=0),t>r&&(t=r),{currentX:t,currentTime:n.state.duration*(t/r)}},n.renderTimeline=function(e){var t=n.state,a=t.showLabel,r=t.labelLeft,i=t.labelText,o=t.drag;return c.default.createElement("div",{ref:n.toolUIEl,className:"player-timeline",onClick:n.seekTo,onMouseEnter:n.showPosition,onMouseLeave:n.hidePosition,onMouseDown:n.onMouseDown,onMouseMove:n.onMouseMove,onTouchStart:n.onMouseDown,onTouchMove:n.onMouseMove,onTouchEnd:n.onMouseUp,role:"timeline"},c.default.createElement("span",{role:"currentLabel",className:"player-timeline-label",style:{display:a?"inline-block":"none",left:r+"px"}},i),c.default.createElement("span",{role:"label-background",className:"player-timeline-bg",style:{display:a?"inline-block":"none",height:20,left:r+"px"}}),c.default.createElement("div",{role:"blue-line",className:"player-timeline-blueline",style:{width:e+"%"}}),c.default.createElement("div",{role:"slider",className:"player-timeline-slider",style:{left:o?r+"px":e+"%",backgroundClip:o?"border-box":"content-box"}}))},n.renderPlayOrPause=function(){var e=n.state.paused;return c.default.createElement("div",{className:"player-play-icon-wrapper",role:"icon",onClick:n.pauseOrPlay},c.default.createElement("span",{className:"player-play-icon",style:{backgroundImage:"url("+(e?h.default:p.default)+")"}}))};var o=e.player;return n.state={time:o.getLastUiTime(),duration:o.getDuration(),showLabel:!1,labelLeft:0,labelText:"",paused:"pause"===o.timeline.ticker.state,currSpeed:o.speed,speedOptionShow:!1,drag:!1},o.on("tick",(function(e){n.setState({time:e})})),o.on("play",(function(){n.setState({paused:!1})})),o.on("pause",(function(){n.setState({paused:!0})})),o.on("speedChange",(function(e){n.setState({currSpeed:e})})),o.on("durationChange",(function(e){n.setState({duration:e})})),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"renderSpeed",value:function(){var e=this,t=1===this.state.currSpeed?"倍数":this.state.currSpeed+"x";return c.default.createElement("div",{className:"player-speed",onClick:this.handleClickSpeed},c.default.createElement("div",{className:"player-speed-text"},t),this.state.speedOptionShow&&c.default.createElement("div",{className:"player-speed-options"},[2,1.5,1.25,1,.75,.5].map((function(t){return c.default.createElement("div",{className:"option",key:t,onClick:function(n){return e.handleClickSpeedOption(n,t)}},t,"x")}))))}},{key:"render",value:function(e,t){var n=t.time,r=t.duration,i=0;i=n>=r?100:n<=0?0:n/r*100;var o=void 0;if(n>r){var s=(0,d.getTime)(r),u=(0,a.default)(s,1)[0];o=u+"/"+u}else{var l=(0,d.getTime)(r),p=(0,a.default)(l,2),h=p[0],f=p[1],g=(0,d.getTime)(n,f>0);o=(0,a.default)(g,1)[0]+"/"+h}return c.default.createElement("div",{className:"player-container"},this.renderPlayOrPause(),this.renderTimeline(i),this.renderSpeed(),c.default.createElement("div",{role:"duration",className:"player-duration"},o))}}]),t}(c.default.Component);t.default=v;var y=function(){return null}},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTUxOTYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MDgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU5Ljk0NzkyOTA5IDEzMy45MjE4OTNoMTI2LjAyNjAzNDgxYzIzLjMzODE1NDczIDAgNDIuMDA4Njc4MjcgMTguNjcwNTIzNTMgNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZ2NjcyLjEzODg1NzQ4YzAgMjMuMzM4MTU0NzMtMTguNjcwNTIzNTMgNDIuMDA4Njc4MjctNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZIMjU5Ljk0NzkyOTA5Yy0yMy4zMzgxNTQ3MyAwLTQyLjAwODY3ODI3LTE4LjY3MDUyMzUzLTQyLjAwODY3OTU2LTQyLjAwODY3ODI2VjE3NS45MzA1NzEyNmMwLTIzLjMzODE1NDczIDE4LjY3MDUyMzUzLTQyLjAwODY3ODI3IDQyLjAwODY3OTU2LTQyLjAwODY3ODI2ek02MzguMDI2MDM2MSAxMzMuOTIxODkzaDEyNi4wMjYwMzQ4MWMyMy4zMzgxNTQ3MyAwIDQyLjAwODY3ODI3IDE4LjY3MDUyMzUzIDQyLjAwODY3OTU2IDQyLjAwODY3ODI2djY3Mi4xMzg4NTc0OGMwIDIzLjMzODE1NDczLTE4LjY3MDUyMzUzIDQyLjAwODY3ODI3LTQyLjAwODY3OTU2IDQyLjAwODY3ODI2aC0xMjYuMDI2MDM0ODFjLTIzLjMzODE1NDczIDAtNDIuMDA4Njc4MjctMTguNjcwNTIzNTMtNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZWMTc1LjkzMDU3MTI2YzAtMjMuMzM4MTU0NzMgMTguNjcwNTIzNTMtNDIuMDA4Njc4MjcgNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyOTA5Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTI0MjE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTEyLjcyNDg4NCA0MjkuMzU1NjgxTDIwOC43OTc1NDUgMTMuMTk4NjM4QzE1MS42MDM0NDktMjAuNTk3ODc0IDY0LjAxMjQ5IDEyLjE5ODc0MSA2NC4wMTI0OSA5NS43OTAxMTJWOTI3LjkwNDIxOWMwIDc0Ljk5MjI1OSA4MS4zOTE1OTkgMTIwLjE4NzU5NCAxNDQuNzg1MDU1IDgyLjU5MTQ3NWw3MDMuOTI3MzM5LTQxNS45NTcwNjRjNjIuNzkzNTE4LTM2Ljk5NjE4MSA2Mi45OTM0OTgtMTI4LjE4Njc2OCAwLTE2NS4xODI5NDl6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyMTMyIj48L3BhdGg+PC9zdmc+"},function(e,t,n){var a=n(502);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(12)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,".player-container {\n    display: block;\n    position: relative;\n    height: 30px;\n    background: rgba(113, 113, 113, 0.23);\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    display: flex;\n}\n\n    .player-container .player-play-icon-wrapper {\n        cursor: pointer;\n        position: relative;\n        width: 20px;\n        height: 20px;\n        padding: 5px;\n    }\n\n    .player-container .player-play-icon-wrapper .player-play-icon {\n            display:inline-block;\n            height:inherit;\n            width:inherit;\n            background-size:cover;\n        }\n\n    .player-container .player-speed {\n        padding: 5px;\n        height: 20px;\n        font-size: 14px;\n        font-family: sans-serif;\n        cursor: pointer;\n    }\n\n    .player-container .player-speed .player-speed-text {\n            text-align: center;\n        }\n\n    .player-container .player-speed .player-speed-options {\n            position: absolute;\n            bottom: 27px;\n            background: rgba(0,0,0,.8);\n            padding: 0 10px;\n            color: white;\n            text-align: center;\n        }\n\n    .player-container .player-speed .player-speed-options .option {\n                margin: 10px 0;\n            }\n\n    .player-container .player-duration {\n        height:20px;\n        font-size:14px;\n        font-family:sans-serif;\n        padding: 5px;\n    }\n\n    .player-container .player-timeline {\n        flex: 1;\n        height: 6px;\n        cursor: pointer;\n        background: rgba(0,0,0,0.12);\n        margin: 12px 5px;\n        position: relative;\n    }\n\n    .player-container .player-timeline-label {\n        position: absolute;\n        height: 20px;\n        background: white;\n        border-radius: 3px;\n        bottom: 10px;\n        padding: 4px 6px;\n        transform: translateX(-50%);\n    }\n\n    .player-container .player-timeline-bg {\n        position: absolute;\n        height: 20px;\n        background: 'white';\n        width: 2px;\n        bottom: -5px;\n        pointer-events: none;\n    }\n\n    .player-container .player-timeline-blueline {\n        position: absolute;\n        background: rgba(24, 121, 226, 0.7);\n        height: inherit;\n        pointer-events: none;\n    }\n\n    .player-container .player-timeline-slider {\n        position: absolute;\n        top: -5px;\n        bottom: -5px;\n        background: white;\n        box-sizing: content-box;\n        padding:0 4px;\n        width: 4px;\n        transform:translateX(-6px);\n    }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(28)),r=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),l=d(n(14)),c=d(n(469));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,n,a){return new(n||(n=l.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},h=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this));n.params=e,n.offsetBegin=0,n.offsetEnd=0,n.waitingForData=!0;var a=e.type,o=e.url,u=e.timestamp;return n.type=a,n.timestamp=u,n.url=o,n.state="init",n.videoRef=document.createElement("video"),n.videoRef.oncanplay=function(){n.waitingForData=!1,n.emit("canplay")},n.videoRef.onwaiting=function(){n.waitingForData=!0,n.emit("waitingToPlay")},n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"init",value:function(e){return p(this,void 0,void 0,a.default.mark((function t(){var n,r=this;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=3;break}return t.next=3,e;case 3:return console.log("init video track"),t.next=6,new l.default((function(e){var t=r.videoRef;t.src=r.url,f(t),t.preload="metadata",t.onloadeddata=function(n){var a=t.duration;a!=a?a=Number.NEGATIVE_INFINITY:a*=1e3,r.offsetEnd=r.offsetBegin+a,t.pause(),r.state="ready",console.log("init video ready"),e("ready")},t.onerror=function(t){console.error(t),e("error")}}));case 6:return n=t.sent,t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"doSetTrack",value:function(e,t,n){return p(this,void 0,void 0,a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n&&this.setVideoTime(e);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"showTrackCb",value:function(e){e&&(v(e)||e.appendChild(this.videoRef))}},{key:"hideTrackCb",value:function(){this.videoRef&&this.videoRef.pause()}},{key:"setPlaySpeed",value:function(e){this.videoRef&&(this.videoRef.playbackRate=e)}},{key:"pause",value:function(){this.videoRef&&this.videoRef.pause()}},{key:"play",value:function(){this.videoRef&&"playing"===this.state?this.videoRef.play():this.videoRef.pause()}},{key:"setVideoTime",value:function(e){this.videoRef.currentTime=(e-this.offsetBegin)/1e3}},{key:"isWaiting",value:function(e){return!(e<this.offsetBegin||e>this.offsetEnd)&&this.waitingForData}}]),t}(c.default);t.default=h;var f=function(e){e.setAttribute("data-x-4wb","true"),e.setAttribute("playsinline","playsinline"),e.setAttribute("webkit-playsinline","webkit-playsinline")},g=function(e){return"true"===e.getAttribute("data-x-4wb")},v=function(e){if(e.children.length>0)for(var t=0,n=e.children.length;t<n;t++){var a=e.children[t];if("video"===a.tagName.toLowerCase()&&g(a))return!0}return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=m(n(28)),r=m(n(38)),i=m(n(2)),o=m(n(0)),s=m(n(1)),u=m(n(3)),l=m(n(4)),c=m(n(7)),d=m(n(115)),p=m(n(14)),h=m(n(505)),f=n(151),g=n(150),v=m(n(512)),y=m(n(473));function m(e){return e&&e.__esModule?e:{default:e}}var M=function(e,t,n,a){return new(n||(n=p.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},x=function(e){if(!d.default.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[d.default.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):(0,c.default)(e),t={},a("next"),a("throw"),a("return"),t[d.default.asyncIterator]=function(){return this},t);function a(n){t[n]=e[n]&&function(t){return new p.default((function(a,r){(function(e,t,n,a){p.default.resolve(a).then((function(t){e({value:t,done:n})}),t)})(a,r,(t=e[n](t)).done,t.value)}))}}},w=function(e){function t(e,n){(0,o.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return a.params=e,a.drawManager=null,a.records=[],a}return(0,l.default)(t,e),(0,s.default)(t,[{key:"init",value:function(){return M(this,void 0,void 0,a.default.mark((function e(){var t,n,i,o,s,u=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchData();case 2:if(t=e.sent,n=(0,r.default)(t,2),i=n[0],o=n[1],console.log("init ",i,o),"error"!==i){e.next=12;break}return this.state="error",e.abrupt("return","error");case 12:return s=[],this.isCompatible&&(s.push(new h.default(10,'16:{"mode"¦"draw"，"tool"¦"flag"，"size"¦1，"color"¦"#000000"，"fontsize"¦24};',!1)),s.push(new h.default(20,'16:{"color"¦"#000"};16:{"size"¦1};',!1)),s.push(new h.default(30,'16:{"ownerCanvasHeight"¦1000，"ownerCanvasWidth"¦1300};',!1))),o.forEach((function(e){s.push(new h.default(e.time,e.str,u.isCompatible))})),this.isCompatible&&s.length&&I(s),this.records=s,this.state="ready",e.abrupt("return","ready");case 19:case"end":return e.stop()}}),e,this)})))}},{key:"doSetTrack",value:function(e,t,n){return M(this,void 0,void 0,a.default.mark((function r(){var i,o,s,u,l,c;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0===(i=t?this.nextRecordIndex:0)&&console.warn("seek back",e,n,i),!this.records.length||!this.drawManager){a.next=14;break}if(o=!1,s=b(this.records,e,this.offsetBegin,i),u=this.records.slice(i,s),this.nextRecordIndex=s,n&&(l=k(u),u=l.recordsToExecute,o=l.needSkipFirstCleanFrame),u.length&&(0===i&&(c=this.params.account,this.drawManager.clear(c),this.drawManager.clearImage(),this.drawManager.clearHtmlFile(),this.drawManager.resetState()),T(u,o,this.drawManager,this.params.account)),this.nextRecordIndex!==this.records.length){a.next=12;break}return a.next=12,this.hideTrack();case 12:a.next=16;break;case 14:return a.next=16,this.hideTrack();case 16:case"end":return a.stop()}}),r,this)})))}},{key:"showTrackCb",value:function(e){e&&!this.drawManager&&(this.drawManager=new v.default(e))}},{key:"isCompatible",get:function(){return"1.0"===this.opt.version}}]),t}(y.default);function I(e){if(!e)return[];if(0===e.length)return e;for(var t=void 0,n="flag",a=0,r=e.length;a<r;a++)for(var i=e[a].actions,o=0;o<i.length;){var s=i[o];switch(s.TYPE){case g.WActions.CALIBRATE:var u=s.color;if(u){if(u===t){i.splice(o,1);continue}t=u}o++;continue;case g.WActions.START:"flag"===n&&(n="free",console.log("deleted"),i.splice(o,0,new f.CalibrateAction({tool:"free"})),++o),++o;continue;case g.WActions.LASER_PEN:"free"===n&&(n="flag",console.log("insert flage"),i.splice(o,0,new f.CalibrateAction({tool:"flag"})),++o),++o;continue;case g.WActions.LASER_PEN_END:++o;default:++o}}e.forEach((function(e){return e.updateIndex()}))}function b(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=a;r<e.length;r++){var i=e[r];if(i.time+n>t)return r}return r}function k(e){for(var t=!1,n=e.length;n--;){if(e[n].isClearFrame)break}if(-1!==n){for(var a=0;a<n;a++){var r=e[a];e[a]=r.toStateRelatedRecord()}t=!0,e=e.filter((function(e){return 0!==e.actions.length}))}return{needSkipFirstCleanFrame:t,recordsToExecute:e}}function T(e,t,n,r){var i,o,s,u;return M(this,void 0,void 0,a.default.mark((function l(){var c,d,p;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,a.prev=1,i=x(e);case 3:return a.next=5,i.next();case 5:if((o=a.sent).done){a.next=19;break}if(!(c=o.value).isClearFrame||!t){a.next=15;break}return d=c.actions,p=c.clearIndex,a.next=12,n.executeActions(r,d.slice(p[0]));case 12:t=!1,a.next=17;break;case 15:return a.next=17,n.executeActions(r,c.actions);case 17:a.next=3;break;case 19:a.next=24;break;case 21:a.prev=21,a.t0=a.catch(1),s={error:a.t0};case 24:if(a.prev=24,a.prev=25,!o||o.done||!(u=i.return)){a.next=29;break}return a.next=29,u.call(i);case 29:if(a.prev=29,!s){a.next=32;break}throw s.error;case 32:return a.finish(29);case 33:return a.finish(24);case 34:a.next=39;break;case 36:a.prev=36,a.t1=a.catch(0),console.error(a.t1);case 39:case"end":return a.stop()}}),l,this,[[0,36],[1,21,24,34],[25,,29,33]])})))}t.default=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(0)),r=l(n(1)),i=n(150),o=u(n(506)),s=u(n(263));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,n,r){(0,a.default)(this,e),this.time=t,this.isCompatible=r,"string"==typeof n?(this.data=n,this.actions=r?o.unpackBulk(n):s.unpackBulk(n)):(this.data="",this.actions=n),this.clearIndex=[],this.isClearFrame=!1,this.updateIndex()}return(0,r.default)(e,[{key:"updateIndex",value:function(){this.clearIndex=this.actions.reduce((function(e,t,n){return t.TYPE===i.WActions.CLEAR&&e.push(n),e}),[]),this.isClearFrame=0!==this.clearIndex.length}},{key:"getStateRelatedActions",value:function(){return this.actions.filter((function(e){return i.StateRelatedActions.indexOf(e.TYPE)>-1}))}},{key:"toStateRelatedRecord",value:function(){return new e(this.time,this.getStateRelatedActions(),this.isCompatible)}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.packBulk=function(e){var t=e.map((function(e){return s(e)})).join(";")+";";return i.default.m.syncmanager("packBulk anyAction",t),t},t.pack=s,t.unpackBulk=function(e){var t=[];return e.split(";").forEach((function(e){var n=u(e);if(n)if(Array.isArray(n))for(;n.length;){var a=n.shift();a&&t.push(a)}else t.push(n)})),t},t.unpack=u,t.formatColor=l,t.hex2rgb=c;var a,r=n(104),i=(a=r)&&a.__esModule?a:{default:a},o=n(151);function s(e,t){return i.default.m.syncmanager("pack anyAction",e),console.assert(void 0!==e.action,"ooops"),e.action.toString()}function u(e){if(e){var t=e.indexOf(":");i.default.m.syncmanager("unpack command ",e);var n=void 0,a=void 0;-1==t?(n=+e,a=""):(n=+e.slice(0,t),a=e.slice(t+1,e.length));var r=a.length>1?a.split(","):[];switch(i.default.command("unpack",e),n){case 1:var s=[new o.StartAction(+r[0],+r[1])];return r[2]&&s.unshift(new o.CalibrateAction({color:l(r[2])})),s;case 2:var u=[new o.MoveAction(+r[0],+r[1])];return r[2]&&u.unshift(new o.CalibrateAction({color:l(r[2])})),u;case 3:var c=[new o.EndAction(+r[0],+r[1])];return r[2]&&c.unshift(new o.CalibrateAction({color:l(r[2])})),c;case 12:return new o.LaserPenAction(+r[0],+r[1]);case 13:return new o.LaserPenEndAction;case 4:return new o.RevokeAction;case 5:return new o.SerialAction;case 6:return new o.ClearAction;case 7:return new o.ClearAckAction;case 8:return new o.SyncRequestAction;case 9:return void console.warn("收到了同步指令，未做兼容，请联系云信技术支持");case 10:return new o.SyncPrepareAction;case 11:return new o.SyncPrepareAckAction;case 14:return new o.FileAction({docId:r[0],currentPage:+r[1],pageCount:+r[2],type:"0"==r[2]?"clear":"img"});default:}}}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;if(!e)return-1;var n="";return 16===t?(e=+e)<0?(n=c(e),console.log("hex2rgb",e,n),n):((n=e.toString(16)).length<3&&(n=("000"+n).slice(-3)),n.length>3&&n.length<6&&(n=("000"+n).slice(-6)),n="#"+n):10===t?(n=e.replace(/#/gi,""),n=parseInt("0x"+n),isNaN(n)?-1:n):void 0}function c(e){var t=e>>16&255,n=e>>8&255,a=255&e;return t=t.toString(16),n=n.toString(16),a=a.toString(16),console.log("rgb",t,n,a),"#"+("0"+t).slice(-2)+("0"+n).slice(-2)+("0"+a).slice(-2)}},function(e,t,n){(function(a){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let a=0,r=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(a++,"%c"===e&&(r=a))}),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==a&&"env"in a&&(e=a.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(470)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(155))},function(e,t){var n=1e3,a=6e4,r=60*a,i=24*r;function o(e,t,n,a){var r=t>=1.5*n;return Math.round(e/n)+" "+a+(r?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*a;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return o(e,t,i,"day");if(t>=r)return o(e,t,r,"hour");if(t>=a)return o(e,t,a,"minute");if(t>=n)return o(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=r)return Math.round(e/r)+"h";if(t>=a)return Math.round(e/a)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){(function(a){const r=n(510),i=n(259);t.init=function(e){e.inspectOpts={};const n=Object.keys(t.inspectOpts);for(let a=0;a<n.length;a++)e.inspectOpts[n[a]]=t.inspectOpts[n[a]]},t.log=function(...e){return a.stderr.write(i.format(...e)+"\n")},t.formatArgs=function(n){const{namespace:a,useColors:r}=this;if(r){const t=this.color,r="[3"+(t<8?t:"8;5;"+t),i=`  ${r};1m${a} [0m`;n[0]=i+n[0].split("\n").join("\n"+i),n.push(r+"m+"+e.exports.humanize(this.diff)+"[0m")}else n[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+a+" "+n[0]},t.save=function(e){e?a.env.DEBUG=e:delete a.env.DEBUG},t.load=function(){return a.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):r.isatty(a.stderr.fd)},t.colors=[6,2,3,4,5,1];try{const e=n(511);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(a.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let r=a.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e},{}),e.exports=n(470)(t);const{formatters:o}=e.exports;o.o=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts).replace(/\s*\n\s*/g," ")},o.O=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts)}}).call(this,n(155))},function(e,t){t.isatty=function(){return!1},t.ReadStream=function(){throw new Error("tty.ReadStream is not implemented")},t.WriteStream=function(){throw new Error("tty.ReadStream is not implemented")}},function(e,t,n){"use strict";e.exports={stdout:!1,stderr:!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=A(n(28)),r=A(n(22)),i=A(n(38)),o=A(n(5)),s=A(n(2)),u=A(n(0)),l=A(n(1)),c=A(n(3)),d=A(n(4)),p=A(n(7)),h=A(n(115)),f=A(n(14)),g=A(n(262)),v=A(n(47)),y=A(n(460)),m=A(n(104)),M=A(n(513)),x=A(n(514)),w=n(151),I=N(n(263)),b=A(n(515)),k=n(150),T=A(n(256)),_=n(159),C=N(_);function N(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function A(e){return e&&e.__esModule?e:{default:e}}var P=function(e,t,n,a){return new(n||(n=f.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},O=function(e){if(!h.default.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[h.default.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):(0,p.default)(e),t={},a("next"),a("throw"),a("return"),t[h.default.asyncIterator]=function(){return this},t);function a(n){t[n]=e[n]&&function(t){return new f.default((function(a,r){(function(e,t,n,a){f.default.resolve(a).then((function(t){e({value:t,done:n})}),t)})(a,r,(t=e[n](t)).done,t.value)}))}}},D=function(e){return this instanceof D?(this.v=e,this):new D(e)},S=function(e,t,n){if(!h.default.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,r=n.apply(e,t||[]),i=[];return a={},o("next"),o("throw"),o("return"),a[h.default.asyncIterator]=function(){return this},a;function o(e){r[e]&&(a[e]=function(t){return new f.default((function(n,a){i.push([e,t,n,a])>1||s(e,t)}))})}function s(e,t){try{(n=r[e](t)).value instanceof D?f.default.resolve(n.value.v).then(u,l):c(i[0][2],n)}catch(e){c(i[0][3],e)}var n}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}},E=((0,g.default)("data"),function(e){return(0,_.getKiloBytes)(e).toFixed(2)+"KB"}),j=function(e){var t=e.length,n=y.default.ungzip(e,{to:"string"});return console.debug("GZIP数据大小:"+E(t)+",原始数据大小："+E(n)+"，压缩比率为 "+(100*t/n.length).toFixed(2)+"%"),n},L=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,u.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return a.afterInit=function(){a.state="inited",a.syncManager.send({toAccount:0,actions:[{action:new w.VersionAction({ver:1,account:a.account,gzip:!0})}]}),a.emit("inited")},a.afterSync=function(e){a.syncState="done",a.flushInCommingQueue(),a.emit("afterSync",e)},a.readyToSyncData=function(){"owner"===a.identity&&(a.syncState="begin",a.syncBegin()),"normal"===a.identity&&(a.syncState="waiting",a.syncRequest(a.ownerAccount))},a.onIframeMessage=function(e){m.default.h5("onIframeMessage",e.data);var t=e.data||{};if("to_yunxin_wb"===t.identity){var n=a.syncManager.fileData;if(n){var r=(0,o.default)({},n),i=t.page,s=t.anim,u=t.trigger,l=(t.time,[i,s,u,t.isBack?"1":"0","0"].join("&"));if(console.warn("onIframeMessage"),console.warn(l,r.h5Cmd),0===parseInt(i))return;r.h5Cmd===l&&console.warn("the same cmd"),r.currentPage!=i&&a.drawAdapter.clear(),r.currentPage=parseInt(i),r.h5Cmd=l,m.default.h5("onIframeMessage->emit action",e.data),a.drawAdapter.worker.emitAction({account:a.account,action:new w.FileAction(r)})}}},a.simulator=new M.default(a),a.container=e,a.opt=n,a.account=n.account,a.nim=n.nim,a.identity=n.identity,a.ownerAccount=n.ownerAccount,a.connector=n.whiteboard,a.incommingQueue=[],a.actionProcessing=!1,console.log("init wb adapter"),a.syncManager=new x.default(a.account),a.syncManager.on("flush",(function(e){a.connector&&a.connector.sendData&&a.connector.sendData(e)})),a.fileMap={},a.eventHub=T.default,a.state="created",a.syncState="inited",a.drawAdapter=new b.default(e,a.opt),a.drawAdapter.on("inited",a.afterInit),a.drawAdapter.on("action",(function(e){console.log("syncState",a.syncState),"waiting"!==a.syncState&&a.syncManager.broadcastAction(e)})),a.drawAdapter.on("instantAction",(function(e){console.warn("instant action",a.syncState),"waiting"!==a.syncState&&setTimeout((function(){a.syncManager.send({toAccount:0,actions:[e]},1)}))})),a.connectorStatus="off",a.connector&&(a.connector.on("data",(function(e){a.execute(e)})),a.connector.on("joinChannel",(function(e){console.log("join channel ",e),e.account===a.opt.ownerAccount&&"waiting"===a.syncState&&(a.syncState="done",a.flushInCommingQueue())}))),a.timmer=setInterval((function(){}),100),a}return(0,d.default)(t,e),(0,l.default)(t,[{key:"execute",value:function(e){var t=e.account,n=e.data;if(t&&n&&t!==this.account){var a=void 0,r=void 0,o=void 0,s=!1;if("number"==typeof n&&(n=""+n),"GZIP"===n.substr(0,4)){var u=n.substr(5,150),l=x.default.GZIP_TESTER_1.exec(u);if(!l)return void console.error("未匹配到GZIP压缩格式",n);u="";var c=(0,i.default)(l,4),d=c[0],p=c[1],h=c[2],f=c[3];r=p,o="gzip";var g=n.substr(5+d.length);if("1"===h)n=j(g),a=I.unpackBulk(n);else{var v=this.incommingQueue.find((function(e){return e.id===p}));if(!v){var y=new Array(+h);return y[+f]=g,v={account:t,type:o,id:r,total:+h,curLen:1,data:y,result:[new w.SerialAction]},void this.incommingQueue.push(v)}if(v.curLen++,v.data[+f]=g,v.total!==v.curLen)return;var M=j(v.data.join(""));a=I.unpackBulk(M),v.result=a,s=!0}}else a=I.unpackBulk(n),r=""+Date.now()+Math.random(),o="text";var b=s?this.incommingQueue.findIndex((function(e){return e.id===r})):-1,T=a.findIndex((function(e){return e.TYPE===k.WActions.SYNC||e.TYPE===k.WActions.SYNC_PREPARE}));if(T>-1){var _=a[T];_.TYPE===k.WActions.SYNC?this.handleSyncAction(_):this.executeActions(t,a)}else"waiting"===this.syncState||this.actionProcessing?s||this.incommingQueue.push({account:t,type:o,id:r,total:1,curLen:1,data:[],result:a}):0==this.incommingQueue.length?(m.default.m.worker("execute:",t,a),this.executeActions(t,a)):0===b?this.flushInCommingQueue():s||this.incommingQueue.push({account:t,type:o,id:r,total:1,curLen:1,data:[],result:a})}}},{key:"executeActions",value:function(e,t){var n,s,u,l;return P(this,void 0,void 0,a.default.mark((function c(){var d,p,h,f,g,v,y,M,x,I,b;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:d=this.drawAdapter,a.prev=1,n=O(t);case 3:return a.next=5,n.next();case 5:if((s=a.sent).done){a.next=69;break}p=s.value,a.t0=p.TYPE,a.next=a.t0===k.WActions.REVOKE||a.t0===k.WActions.REDO||a.t0===k.WActions.CALIBRATE||a.t0===k.WActions.TEXT||a.t0===k.WActions.START||a.t0===k.WActions.MOVE||a.t0===k.WActions.END||a.t0===k.WActions.LASER_PEN||a.t0===k.WActions.LASER_PEN_END?11:a.t0===k.WActions.SERIAL?13:a.t0===k.WActions.CLEAR?15:a.t0===k.WActions.CLEAR_ACK?19:a.t0===k.WActions.SYNC_REQUEST?21:a.t0===k.WActions.SYNC?25:a.t0===k.WActions.SYNC_PREPARE?30:a.t0===k.WActions.SYNC_PREPARE_ACK?33:a.t0===k.WActions.FILE?35:a.t0===k.WActions.VERSION?64:66;break;case 11:return d.act(e,p),a.abrupt("break",67);case 13:return console.log("serial:",p),a.abrupt("break",67);case 15:return this.syncManager.clear(),this.syncManager.makeClearAck(e),d.clear(p.accounts,e,{force:this.ownerAccount===e,quiet:!0}),a.abrupt("break",67);case 19:return d.act(e,p),a.abrupt("break",67);case 21:return console.warn("recive sync request from ",e),h=this.drawAdapter.worker.getSnapshot(),this.syncManager.syncTo(e,h),a.abrupt("break",67);case 25:return console.warn("recive sync from ",e),f=p,a.next=29,this.handleSyncAction(f);case 29:return a.abrupt("break",67);case 30:return console.warn("recive sync prepare from ",e),this.syncResponse(e),a.abrupt("break",67);case 33:return console.warn("recive sync prepare ack from ",e),a.abrupt("break",67);case 35:if(p.TYPE!==k.WActions.FILE){a.next=64;break}if(g=p.file,m.default.h5("recive h5 FileAction",g),v=this.syncManager.fileData,y=v&&(0,o.default)({},v),(0,r.default)(v)!==(0,r.default)(g)){a.next=42;break}return a.abrupt("return",console.warn("same file data"));case 42:if("img"!==g.type){a.next=62;break}if(!y){a.next=50;break}"h5"===y.type&&this.clearHtmlFile(),g.docId&&g.docId==y.docId&&(y.currentPage=parseInt(""+(g.currentPage||1)),y.url=y.urlStr.replace("{index}",""+g.currentPage),this.image(y,e)),M=w.FileAction.immuteUpdate(y,g),x=(0,i.default)(M,1),I=x[0],this.syncManager.setFileData(I),a.next=60;break;case 50:if(b=void 0,!this.opt.handleFile){a.next=57;break}return a.next=54,this.opt.handleFile(g.type,g);case 54:b=a.sent,a.next=58;break;case 57:b=g;case 58:this.syncManager.setFileData(b),this.image(g,e);case 60:a.next=63;break;case 62:"h5"===g.type?(m.default.h5("current file",y),y?("img"==y.type&&this.clearImage(e),g.docId&&g.docId==y.docId?(m.default.h5("current file h5 cmd is ",y.h5Cmd),m.default.h5("file h5 cmd is ",g.h5Cmd),y.h5Cmd!==g.h5Cmd&&this.pagedHtmlFile(g.h5Cmd.split("&"))):(this.syncManager.setFileData(g),this.setHtmlFile(g,e),g.h5Cmd&&setTimeout(this.pagedHtmlFile.bind(this,g.h5Cmd.split("&")),3e3))):(this.syncManager.setFileData(g),this.setHtmlFile(g,e),g.h5Cmd&&setTimeout(this.pagedHtmlFile.bind(this,g.h5Cmd.split("&")),3e3))):(m.default.h5("delete file",y),this.syncManager.setFileData(void 0),y&&("img"===y.type?this.clearImage(e):"h5"===y.type&&this.clearHtmlFile()));case 63:return a.abrupt("break",67);case 64:if(p.TYPE!==k.WActions.VERSION){a.next=66;break}return a.abrupt("break",67);case 66:p.TYPE;case 67:a.next=3;break;case 69:a.next=74;break;case 71:a.prev=71,a.t1=a.catch(1),u={error:a.t1};case 74:if(a.prev=74,a.prev=75,!s||s.done||!(l=n.return)){a.next=79;break}return a.next=79,l.call(n);case 79:if(a.prev=79,!u){a.next=82;break}throw u.error;case 82:return a.finish(79);case 83:return a.finish(74);case 84:case"end":return a.stop()}}),c,this,[[1,71,74,84],[75,,79,83]])})))}},{key:"flushInCommingQueue",value:function(){var e,t;return P(this,void 0,void 0,a.default.mark((function n(){var r,i,o,s,u,l,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("waiting"!==this.syncState){n.next=2;break}return n.abrupt("return");case 2:r=this.incommingQueue.length;case 3:if(!r){n.next=63;break}this.actionProcessing=!0,i=this.incommingQueue.slice(),o=0,s=!1,n.prev=8,n.prev=9,e=void 0,u=O(i);case 11:return n.next=13,u.next();case 13:if((l=n.sent).done){n.next=33;break}c=l.value,n.t0=c.type,n.next="text"===n.t0||"gzip"===n.t0?19:"function"===n.t0?29:30;break;case 19:if(c.total!==c.curLen){n.next=26;break}if(o++,c.dirty){n.next=24;break}return n.next=24,this.executeActions(c.account,c.result);case 24:n.next=28;break;case 26:throw s=!0,new Error("message need waiting!");case 28:case 29:return n.abrupt("break",31);case 30:c.type;case 31:n.next=11;break;case 33:n.next=38;break;case 35:n.prev=35,n.t1=n.catch(9),e={error:n.t1};case 38:if(n.prev=38,n.prev=39,!l||l.done||!(t=u.return)){n.next=43;break}return n.next=43,t.call(u);case 43:if(n.prev=43,!e){n.next=46;break}throw e.error;case 46:return n.finish(43);case 47:return n.finish(38);case 48:n.next=53;break;case 50:n.prev=50,n.t2=n.catch(8),console.error(n.t2);case 53:return n.prev=53,this.incommingQueue=this.incommingQueue.slice(o,this.incommingQueue.length),n.finish(53);case 56:if(!s){n.next=60;break}return n.abrupt("break",63);case 60:r=this.incommingQueue.length;case 61:n.next=3;break;case 63:this.actionProcessing=!1;case 64:case"end":return n.stop()}}),n,this,[[8,50,53,56],[9,35,38,48],[39,,43,47]])})))}},{key:"destroy",value:function(){this.drawAdapter&&this.drawAdapter.destroy(),this.syncManager&&this.syncManager.destroy(),this.eventHub.removeAllListeners(),this.removeAllListeners()}},{key:"enableDraw",value:function(e){"inited"===this.state?this.drawAdapter&&this.drawAdapter.enableDraw(e):console.warn("inited")}},{key:"handleSyncAction",value:function(e){var t,n,r,i,o,s;return P(this,void 0,void 0,a.default.mark((function u(){var l,c,d,p,h,f,g,v,y,m,M,x,b,k,T,C,N,A,P,E,j,L,z,R,B,F=this;return a.default.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:console.log(e),l=void 0,c=void 0,d=e.sync,p=d.shapes,h=d.users,f=d.transhShapes,g=d.file,v=d.canvasRatio,y=d.canvasHeight,d.canvasWidth,m=d.ownerWidth,d.ownerHeight,M=p.slice(),x=function(){return S(this,arguments,a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!M.length){e.next=7;break}return e.next=3,D(M.shift());case 3:return e.next=5,e.sent;case 5:e.next=0;break;case 7:case"end":return e.stop()}}),e,this)})))},(b=this.drawAdapter.worker.container).canvasRatio=v,b.resize(),b.updateCanvasPropSize(m,y),k=Date.now(),T=this.drawAdapter.worker.localUser.getCalibrateAction(),C=this.actionProcessing,this.actionProcessing=!0,g&&this.executeActions(this.ownerAccount,[new w.FileAction(g)]),u.prev=15,N=O(x());case 17:return u.next=19,N.next();case 19:if((A=u.sent).done){u.next=39;break}if(P=A.value){u.next=24;break}return u.abrupt("continue",37);case 24:return u.prev=24,u.next=27,this.drawAdapter.worker.restoreShape(P,!1);case 27:u.next=32;break;case 29:u.prev=29,u.t0=u.catch(24),console.error(u.t0);case 32:if(!(Date.now()-k>200)){u.next=37;break}return u.next=36,(0,_.sleep)(30);case 36:k=Date.now();case 37:u.next=17;break;case 39:u.next=44;break;case 41:u.prev=41,u.t1=u.catch(15),t={error:u.t1};case 44:if(u.prev=44,u.prev=45,!A||A.done||!(n=N.return)){u.next=49;break}return u.next=49,n.call(N);case 49:if(u.prev=49,!t){u.next=52;break}throw t.error;case 52:return u.finish(49);case 53:return u.finish(44);case 54:this.drawAdapter.worker.container.fullRender(),u.prev=55,E=O(h);case 57:return u.next=59,E.next();case 59:if((j=u.sent).done){u.next=102;break}if(!(L=j.value).recycle||!L.recycle.length){u.next=100;break}u.prev=63,o=void 0,z=O(L.recycle);case 65:return u.next=67,z.next();case 67:if((R=u.sent).done){u.next=85;break}return B=R.value,u.prev=70,u.next=73,this.drawAdapter.worker.restoreShape(B,!0);case 73:u.next=78;break;case 75:u.prev=75,u.t2=u.catch(70),console.error(u.t2);case 78:if(!(Date.now()-k>200)){u.next=83;break}return u.next=82,(0,_.sleep)(30);case 82:k=Date.now();case 83:u.next=65;break;case 85:u.next=90;break;case 87:u.prev=87,u.t3=u.catch(63),o={error:u.t3};case 90:if(u.prev=90,u.prev=91,!R||R.done||!(s=z.return)){u.next=95;break}return u.next=95,s.call(z);case 95:if(u.prev=95,!o){u.next=98;break}throw o.error;case 98:return u.finish(95);case 99:return u.finish(90);case 100:u.next=57;break;case 102:u.next=107;break;case 104:u.prev=104,u.t4=u.catch(55),r={error:u.t4};case 107:if(u.prev=107,u.prev=108,!j||j.done||!(i=E.return)){u.next=112;break}return u.next=112,i.call(E);case 112:if(u.prev=112,!r){u.next=115;break}throw r.error;case 115:return u.finish(112);case 116:return u.finish(107);case 117:this.drawAdapter.worker.users.all.forEach((function(e){e.guessMyUndoCount(),e.emitUserShape()})),c=h.map((function(e){var t=e.account,n=e.calibrate,a=I.unpack(n.toString()),r=t!==F.drawAdapter.worker.account;return r&&a&&F.drawAdapter.act(t,a),!r&&a&&(T=a),{account:t,calibrate:a}})),this.drawAdapter.act(this.account,T),this.declareCalibrate(T),l={users:c,shapes:p,transhShapes:f},this.actionProcessing=C,this.afterSync(l);case 124:case"end":return u.stop()}}),u,this,[[15,41,44,54],[24,29],[45,,49,53],[55,104,107,117],[63,87,90,100],[70,75],[91,,95,99],[108,,112,116]])})))}},{key:"setSize",value:function(e,t){this.syncManager.pushQueue(0,{action:new w.CalibrateAction({size:e})}),this.drawAdapter.setSize(e,t)}},{key:"setFontsize",value:function(e,t){this.drawAdapter.setFontsize(e,t)}},{key:"setColor",value:function(e,t){this.drawAdapter.setColor(e,t)}},{key:"undo",value:function(){return this.drawAdapter.undo()}},{key:"redo",value:function(){return this.drawAdapter.redo()}},{key:"clear",value:function(e,t,n){this.drawAdapter.clear(e,t,n)}},{key:"image",value:function(e,t){this.drawAdapter.image(e,t)}},{key:"clearImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account;this.clear(),this.drawAdapter.clearImage(e)}},{key:"setHtmlFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account;m.default.h5("setHtmlFile",e);var n=this.drawAdapter.worker.container,a=n.paddingLeft,r=n.paddingTop,i=n.canvasHeight,o=n.canvasWidth;if(this.iframe)console.warn("已经有iframe了");else{var s=document.createElement("iframe");s.src=e.url,s.scrolling="no",s.name="nimHtmlFile",s.frameBorder="0",s.style.position="absolute",s.style.top=r+"px",s.style.left=a+"px",s.style.zIndex="1",s.style.width=o+"px",s.style.height=i+"px",s.width=""+o,s.height=""+i,this.container.insertBefore(s,this.container.children[0]),this.drawAdapter.worker.container.displayCanvas.style.backgroundColor="transparent",this.iframe=s,window.addEventListener("message",this.onIframeMessage,!1),this.drawAdapter.worker.emitAction({account:t,action:new w.FileAction(e)}),this.syncManager.setFileData(e)}}},{key:"pagedHtmlFile",value:function(e){m.default.h5("pagedHtmlFile",e);var t=this.iframe;if(t){try{if(!t.contentWindow||t.contentDocument&&"complete"!==t.contentDocument.readyState)return void setTimeout(this.pagedHtmlFile.bind(this,e),800)}catch(e){return console.error(e),!1}var n={identity:"from_yunxin_wb",page:parseInt(e[0]),anim:parseInt(e[1]),trigger:parseInt(e[2]),isBack:"1"==e[3],time:0};t.currentPage=parseInt(n.page);var a=[n.page,n.anim,n.trigger,n.isBack,n.time].join("&");console.warn("toPage"),console.warn(a,this.syncManager.fileData&&this.syncManager.fileData.h5Cmd),m.default.h5("toHtmlPage",n),t.contentWindow.postMessage(n,"*")}}},{key:"toPageHtmlFile",value:function(e,t,n){var a=this.iframe;if(m.default.h5("toPageHtmlFile",e,t,n),a){try{if(!a.contentWindow||a.contentDocument&&"complete"!==a.contentDocument.readyState)return!1}catch(e){return!1}var r=void 0;switch(e){case"leftEnd":r={page:0,anim:-1,trigger:-1,isBack:!1};break;case"left":r={page:t-1,anim:-1,trigger:-1,isBack:!1};break;case"up":r={which:37};break;case"down":r={which:39};break;case"right":r={page:t,anim:-1,trigger:-1,isBack:!1};break;case"rightEnd":r={page:n-1,anim:-1,trigger:-1,isBack:!1};break;default:console.warn("")}return void 0!==r&&(r.identity="from_yunxin_wb",m.default.h5("current file h5 cmd is ",this.syncManager.fileData&&this.syncManager.fileData.h5Cmd),m.default.h5("toPageHtmlFile->post",r),a.contentWindow.postMessage(r,"*"),a.currentPage=parseInt(r.page),a.pageNum=n),!0}}},{key:"clearHtmlFile",value:function(){this.clear(),m.default.h5("clearHtmlFile"),!this.iframe||!this.container||this.iframe&&this.iframe.parentNode!==this.container||(this.syncManager.setFileData(void 0),window.removeEventListener("message",this.onIframeMessage,!1),this.container.removeChild(this.iframe),this.drawAdapter.worker.container.displayCanvas.style.backgroundColor="#ffffff")}},{key:"_image",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account;console.log("_image",e);var n=e.docId,a=e.currentPage;if(n&&a-0!=0){var r=this.nim,i=this.fileMap[n];if(i||r)if(console.log("file!!!",i),i)i.prefix,i.type,i.transType;else{var o=this;r?r.getFile({docId:n,success:function(a){o.fileMap[n]=a,o._image(e,t)},error:function(e){console.error("getFile error",e)}}):console.warn("缺少nim实例，无法拉取文件")}}else this.clearImage(t)}},{key:"setContainer",value:function(e,t){this.drawAdapter.setContainer(e,t)}},{key:"removeUser",value:function(e){e&&this.drawAdapter.removeUser(e)}},{key:"resize",value:function(){this.drawAdapter.resize()}},{key:"useTool",value:function(e,t){this.drawAdapter.useTool(e,t)}},{key:"syncBegin",value:function(){m.default.m.worker("owner sync begin"),this.syncManager.clear(),this.syncManager.makeSyncPrepare(),this.clear(),this.clearImage(),this.syncState="done",this.declareCalibrate(),this.afterSync()}},{key:"syncRequest",value:function(e){this.syncState="waiting",m.default.m.worker("sync request->",e),this.syncManager.makeSyncRequest(e)}},{key:"syncResponse",value:function(e){m.default.m.worker("sync response->",e),this.clear(void 0,e,{force:!0}),this.clearHtmlFile(),this.clearImage(e),this.syncManager.clear(),this.syncManager.makeSyncPrepareAck(e),this.declareCalibrate()}},{key:"declareCalibrate",value:function(e){if(!e){var t=this.drawAdapter.worker.getSelfCalibrate();t&&(e=t)}e?(m.default.m.worker("sync response calibrate->",e),this.syncManager.send({toAccount:0,actions:[{action:e}]})):console.warn("no self calibrate action")}},{key:"changeRoleToPlayer",value:function(){return 0===this.role||(this.enableDraw(!0),this.role=0),f.default.resolve({role:"player"})}},{key:"changeRoleToAudience",value:function(){var e=this;return 1===this.role?f.default.resolve({role:"audience"}):(this.enableDraw(!1),new f.default((function(t,n){setTimeout((function(){e.role=1,t({role:"audience"})}),1e3)})))}},{key:"resetState",value:function(){this.syncManager.clear();var e=this.drawAdapter.worker,t=e.users,n=(e.container,e.shapes);t.all.forEach((function(e){e.clearShapes()})),n.clear(),this.drawAdapter.worker.updateCursor(),t.removeOtherUsers()}}]),t}(v.default);t.default=L,L.util=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(0)),r=o(n(1)),i=o(n(264));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this.app=t}return(0,r.default)(e,[{key:"freeDraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e-4;this.app.useTool("free",this.app.account);for(var n=0;n<e;n++){var a=Math.random(),r=Math.random(),o=Math.random()*t,s=Math.random()*t;this.app.drawAdapter.worker.mousedown(new i.default(a,r),this.app.account),this.app.drawAdapter.worker.mousemove(new i.default(a+o,r+s),this.app.account),this.app.drawAdapter.worker.mouseup(new i.default(a+o,r+s),this.app.account)}}},{key:"rectDraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e-4;this.app.useTool("rect",this.app.account);for(var n=0;n<e;n++){var a=Math.random(),r=Math.random(),o=Math.random()*t,s=Math.random()*t;this.app.drawAdapter.worker.mousedown(new i.default(a,r),this.app.account),this.app.drawAdapter.worker.mousemove(new i.default(a+o,r+s),this.app.account),this.app.drawAdapter.worker.mouseup(new i.default(a+o,r+s),this.app.account)}}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=m(n(18)),r=m(n(22)),i=m(n(2)),o=m(n(0)),s=m(n(1)),u=m(n(3)),l=m(n(4)),c=n(150),d=n(151),p=m(n(104)),h=m(n(47)),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(263)),g=n(159),v=m(n(460)),y=m(n(256));function m(e){return e&&e.__esModule?e:{default:e}}window.pako=v.default;var M=function(e){function t(e){(0,o.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.broadcastAction=function(e){var t=e.action;if(t.TYPE===c.WActions.FILE){var a=t.file;console.log(a);n.fileData&&a.docId&&(a.docId,n.fileData.docId);if(n.fileData&&(0,r.default)(a)===(0,r.default)(n.fileData))return;"clear"===a.type?n.setFileData(void 0):n.setFileData(a)}n.pushQueue(0,e)},n.account=e,n.dataQue={},n.lastDataMap={},n.shadowUsers={},n.doNotSendBefore=Date.now(),n.startLoop(),n}return(0,l.default)(t,e),(0,s.default)(t,[{key:"pushQueue",value:function(e,t){if(p.default.m.syncmanager("pushQueue",e,t),void 0===t.action){var n=new Error("ss");console.log(n.stack)}this.dataQue[e]=this.dataQue[e]||[],this.dataQue[e].push(t)}},{key:"send",value:function(e,t){var n=this,a=e.toAccount,r=e.actions;if(r&&!(r.length<1)){var i=f.packBulk(r.filter((function(e){return!!e})));if(console.log("send",i),i.length>10&&""+a!="0"){this.gzipStr(i).forEach((function(e,r){n.flush({toAccount:a,data:e},r,t)}))}else{var o={toAccount:a,data:i};this.flush(o,0,t),p.default.m.syncmanager("sendRaw:\n",o)}}}},{key:"flush",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;setTimeout((function(){t.emit("flush",e)}),a*n)}},{key:"makeClearAck",value:function(e){this.send({toAccount:e,actions:[{action:new d.ClearAckAction}]})}},{key:"makeSyncPrepare",value:function(){this.send({toAccount:0,actions:[{action:new d.SyncPrepareAction}]})}},{key:"makeSyncPrepareAck",value:function(e){this.send({toAccount:0,actions:[{action:new d.SyncPrepareAckAction}]})}},{key:"gzipStr",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("gzip stirng:",e);var n=v.default.gzip(e,{to:"string"});console.log("gzip stirng:",v.default.gzip(e));var a=(0,g.getKiloBytes)(n),r=[];if(a>49)for(var i=n.length,o=0;o<i;)r.push(n.substr(o,25088)),o+=25088;else r.push(n);if(t){var s=1,u=r,l=u.length,c=Date.now()+"."+Math.floor(1e3*Math.random())+Math.floor(1e3*Math.random())+Math.floor(1e3*Math.random());r=r.map((function(e,t){return"GZIP:"+s+"|"+c+"|"+l+"|"+t+"|=||=|"+e}))}return r}},{key:"makeSyncRequest",value:function(e){this.send({toAccount:e,actions:[{action:new d.SyncRequestAction}]})}},{key:"syncTo",value:function(e,t){this.fileData&&(t.file=this.fileData);var n=new d.SyncAction(t);this.send({toAccount:e,actions:[{action:n}]})}},{key:"clear",value:function(){console.warn("clear sync manager"),this.dataQue={}}},{key:"delayMS",value:function(e){this.doNotSendBefore=Date.now()+e}},{key:"startLoop",value:function(){var e=this;this.timer=setInterval((function(){if(!(Date.now()<e.doNotSendBefore)){var t=e.dataQue;(0,a.default)(t).forEach((function(n){!t[n]||t[n].length<1||e.send&&(e.send({toAccount:n,actions:t[n]}),t[n].length=0)}))}}),100)}},{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.timer=void 0,this.dataQue={}}},{key:"setFileData",value:function(e){this.fileData=e,y.default.emit("globalFile",this.fileData)}}]),t}(h.default);t.default=M,M.GZIP_TESTER_1=/1\|([\d.]+)\|(\d+)\|(\d+)\|=\|\|=\|/},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(2)),r=f(n(0)),i=f(n(1)),o=f(n(3)),s=f(n(4)),u=f(n(516)),l=f(n(47)),c=n(159),d=f(n(262)),p=f(n(104)),h=n(472);function f(e){return e&&e.__esModule?e:{default:e}}(0,d.default)("AdapterDraw");var g=function(e){function t(e,n){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.onInited=function(){i.emit("inited")},i.worker=new u.default(e,n),i.worker.on("action",i.onAction.bind(i)),i.worker.on("instantAction",i.onInstantAction.bind(i)),i.worker.on("inited",i.onInited),i}return(0,s.default)(t,e),(0,i.default)(t,[{key:"act",value:function(e,t){if(t){var n={account:e,action:t};p.default.m.adapter("act->",t,e),this.worker.act(n)}}},{key:"onAction",value:function(e){e.account===this.worker.account&&this.worker.isEnable&&(p.default.m.adapter("onAction",e),e&&this.emit("action",e))}},{key:"onInstantAction",value:function(e){p.default.m.adapter("onInstantAction",e),e&&this.emit("instantAction",e)}},{key:"enableDraw",value:function(e){return this.worker.enableDraw(e)}},{key:"destroy",value:function(){this.worker.destroy(),this.removeAllListeners()}},{key:"useTool",value:function(e,t){p.default.m.adapter(e,t),(0,h.isValidTool)(e)?this.worker.useTool(e,t):console.warn("画笔工具不正确!->",e)}},{key:"resize",value:function(){return this.worker.resize()}},{key:"removeUser",value:function(e){return this.worker.removeUser(e)}},{key:"setContainer",value:function(e,t){return this.worker.setContainer(e,t)}},{key:"image",value:function(e,t){return this.worker.image(e,t)}},{key:"clearImage",value:function(e){return this.worker.clearImage(e)}},{key:"undo",value:function(e){return this.worker.undo(e)}},{key:"redo",value:function(e){return this.worker.redo(e)}},{key:"clear",value:function(e,t,n){return this.worker.clear(e,t,n)}},{key:"setColor",value:function(e,t){e&&((0,c.formatColor)(e,10)===c.formatColor.INVALID?console.error("whiteboard::setColor:设置颜色失败:不合法的色值"):(console.log("adapterDraw::setColor",e),this.worker.setColor(e,t)))}},{key:"setSize",value:function(e,t){e&&(/^[\d]+$/.test(""+e)?(console.log("adapterDraw::setSize",e),this.worker.setSize(e,t)):console.error("whiteboard::setSize:设置画笔粗细失败:不合法的数值:",e))}},{key:"setFontsize",value:function(e,t){e&&(/^[\d]+$/.test(""+e)?(console.log("adapterDraw::setFontsize",e),this.worker.setFontsize(e,t)):console.error("whiteboard::setFontsize:设置文字大小失败:不合法的数值:",e))}}]),t}(l.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=A(n(28)),r=A(n(38)),i=A(n(7)),o=A(n(18)),s=A(n(2)),u=A(n(0)),l=A(n(1)),c=A(n(3)),d=A(n(4)),p=A(n(14)),h=A(n(47)),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(257)),g=n(264),v=A(g),y=A(n(517)),m=A(n(104)),M=n(471),x=A(n(519)),w=n(520),I=A(w),b=n(150),k=n(472),T=n(151),_=n(263),C=n(159),N=A(n(256));function A(e){return e&&e.__esModule?e:{default:e}}var P=function(e,t,n,a){return new(n||(n=p.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},O="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAAANACwAAAAAEAAQAAAEPbDJSau9OOvNew0AEHDA8wCkiW6g6AXHMU4LgizUYRgEZdsUggFAQCgUP+AERggcFYHaDaMgEBQchBNhiQAAIfkECQAADQAsAAAAABAAEAAABDuwyUmrvTYAEDAFzwN4EyiSksaRyHF06GEYBNoQ82EHBwHbCIUCYRMKiwSCYoFALDCIwLDZBFJtTKclAgAh+QQJAAANACwAAAAAEAAQAAAEPrDJGQAIM2vwHtAUcVTdBzaHYRCKip2EepxacBAvjSgKQmc83m+iILCGEkSgh5wsEIhFEwqdUpvPaHPLnUQAACH5BAkAAA0ALAAAAAAQABAAAAQ+sMkZyAkz62MM0ROiKAjRXQCATeOIHEQAPA+QKQShZHOdIQFSRqaSLBCIBQiERC41TcQzc0xOr9isdsvtPiMAIfkECQAADQAsAAAAABAAEAAABD2wyYmUQjNra/VcCLIoBKEExBFkYRtcBGAQbJsdhnFkoMimGI8wAACshBnA4wFAJpdNp4RolFqv2Kx2q4kAACH5BAkAAA0ALAAAAAAQABAAAAQ9sMm5EFoza2u1b5ylKMjXVFdAjGamrEo7IWMpz8QR3A0BGATewWA48BA5mykAAOxugMcDwItOeUwnb9uKAAAh+QQJAAANACwAAAAAEAAQAAAEO7DJSau92C6EVp4c90khMjZbd5KKYo4B0Z4KIZ9I4H7IQQSng8FwwAQAgJgBQMAAHo+kD3h5Rk/HpCUCACH5BAkAAA0ALAAAAAAQABAAAAQ8sMlJq7046827nwuCLJwoliYXjlIAAAGFKApCAc8DULQSTzgd4kCYEQgKigt2MBgOC5rtQnAeOAHilBIBADs=",D=function(e){function t(e,n){(0,u.default)(this,t);var a,r=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this));if(r.handleInputDomBlur=function(){console.log("blur");var e=r.container.inputDom,t=r.account;if(r.localUser){var n=e.getAttribute("data-point");if(n){var a=r.container,i=a.ownerCanvasHeight,o=a.ownerCanvasWidth,s=v.default.fromString(n);e.style.display="none";var u=(e.value||"").trim();if(e.value="",i&&o&&u){var l=new T.TextAction(s.x,s.y,u);r.renderText(l,t),r.emitAction({account:t,action:l})}}}},r.dispatcher=function(e){if("keydown"!==e.type&&"keyup"!==e.type&&e.preventDefault(),e=e.originalEvent?e.originalEvent:e,r.container.displayCtx){var t=r.container.displayCtx.canvas.getBoundingClientRect(),n=void 0,a=void 0;e.touches&&1===e.touches.length?(n=e.touches[0].clientX,a=e.touches[0].clientY):e.changedTouches&&1===e.changedTouches.length?(n=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY):(n=e.clientX,a=e.clientY);var i=e,o=i.ctrlKey,s=i.shiftKey,u=i.altKey,l=i.which;n||0===n||(n=0),a||0===a||(a=0);var c=Math.round(n-t.left),d=Math.round(a-t.top),p=r.container,h=p.ownerCanvasHeight,f=p.ownerCanvasWidth,g=p.canvasWidth,y=p.canvasHeight;if(h&&f&&g&&y){var m=new v.default(+(c/g).toFixed(4),+(d/y).toFixed(4)),M=e.type;"touchstart"===M&&(M="mousedown"),"touchmove"===M&&(M="mousemove"),"touchend"===M&&(M="mouseup"),2!==l&&3!==l&&r[M](m,r.account,{ctrlKey:o,shiftKey:s,altKey:u,which:l})}}},void 0===n)throw new Error("Option is Undefined!");return r.state="created",r.opt=n,r.account=n.account||0,r.users=new M.UserManager(n),r.shapes=new x.default,r.shapes.wrap(r.users),r.container=new I.default(e,n),r.container.on("init-canvas",(function(){m.default.m.worker("init-canvas event");var e=r.addUser(r.account);r.localUser=e,r.state="inited",r.afterInit()})),r.container.on("ownerCanavasUpdate",(a=void 0,function(e,t){console.log("ownerCanavasUpdate timmer"),clearTimeout(a),a=setTimeout((function(){console.log("ownerCanavasUpdate timmer"),r.emit("instantAction",{account:r.account,action:new T.CalibrateAction({ownerCanvasHeight:t,ownerCanvasWidth:e})})}),200)})),r.container.wrap(r.shapes,r.users),r.container.inputDom.addEventListener("blur",r.handleInputDomBlur),r.isEnable=!1,r}return(0,d.default)(t,e),(0,l.default)(t,[{key:"setContainer",value:function(e,t){m.default.m.worker("setContainer"),this.container.setContainer(e,t)}},{key:"isDrawEnable",value:function(){return this.isEnable}},{key:"enableDraw",value:function(e){if(m.default.m.worker("enableDraw",e),this.isEnable=!!e,N.default.emit("canDraw",this.isEnable),this.switchEventListener(!!e),this.localUser){var t=this.localUser.tool;if(e){var n=void 0;n="flag"===t?"flag":"crosshair",this.setCursor(n)}else/flag/.test(this.localUser.tool)&&(this.clearFlag(),this.emitAction({account:this.account,action:new T.LaserPenEndAction})),this.setCursor("not-allowed")}}},{key:"updateCursor",value:function(){if(this.localUser){var e=this.localUser.tool;if(this.isEnable){var t=void 0;t="flag"===e?"flag":"crosshair",this.setCursor(t)}else/flag/.test(this.localUser.tool)&&(this.clearFlag(),this.emitAction({account:this.account,action:new T.LaserPenEndAction})),this.setCursor("not-allowed")}}},{key:"switchEventListener",value:function(e){var t=this,n=e?"add":"remove",a=[this.container.maskCanvas],r=this.dispatcher;a.forEach((function(e){["mouseleave","mousedown","mousemove","touchmove","touchstart"].forEach((function(t){e[n+"EventListener"](t,r)}))})),["mouseup","touchend"].forEach((function(e){var a=n+"EventListener";t.container.container[a](e,r)})),["keydown","keyup"].forEach((function(e){var t=n+"EventListener";document.documentElement[t](e,r)}))}},{key:"setCursor",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not-allowed";m.default.m.worker("setCursor",t);var n=[this.container.maskCanvas];t=/(flag|crosshair|not-allowed)/.test(t)?t:"crosshair",this.cursor=t||this.cursor,"flag"===this.cursor&&(this.cursor="none"),n.forEach((function(t){t.style.cursor=e.cursor}))}},{key:"afterInit",value:function(){this.emit("inited")}},{key:"emitAction",value:function(e){this.emit("action",e)}},{key:"useTool",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account;if(m.default.m.worker("use tool:",e,t),"created"!=this.state){var n=(0,k.isValidTool)(e);if(n){var a=this.getUser(t);if(!e)return a.tool;if(a||(a=this.addUser(t)),m.default.m.worker("use tool:",a),a.tool!==e){var r={tool:e};a.update(r),"flag"===e?a.ctx.canvas.style.visibility="visible":this.clearFlag(t),m.default.m.worker("useTool check account",t),t===this.account&&("text"!==a.tool&&(this.container.inputDom.style.display="none"),this.setCursor(a.tool),m.default.m.worker("useTool check account",t),this.dispatchCalibrateAction(r))}}else console.error("useTool 参数不正确！",e)}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"clearFlag",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account,t=this.getUser(e);t&&(t.flagPos=new v.default(3,3).toString(),this.renderFlag(),this.emitAction({account:e,action:new T.LaserPenEndAction}))}},{key:"setSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);if(m.default.m.worker("setSize",e,t,n),"created"!=this.state){if(n||(n=this.addUser(t)),!e)return n.size;if("number"!=typeof+e)throw new Error("Type Error: size");var a={size:+e};n.update(a),this.dispatchCalibrateAction(a)}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"getSelfCalibrate",value:function(){return this.localUser?this.localUser.getCalibrateAction():null}},{key:"setColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);if("created"!=this.state){if(n||(n=this.addUser(t)),!e)return n.color;var a={color:e.toLowerCase()};this.dispatchCalibrateAction(a),n.update(a)}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"setFontsize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);if(m.default.m.worker("set font size",e,t,n),"created"!=this.state){if(n||(n=this.addUser(t)),!e)return n.fontsize;if("number"!=typeof+e)throw new Error("Type Error: fontsize");var a={fontsize:+e};n.update(a),this.dispatchCalibrateAction(a),this.container.inputDom.style.fontSize=e+"px"}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"keydown",value:function(e,t,n){var a=this.users.getUser(t);a||(a=this.addUser(t));var r=n.ctrlKey,i=n.shiftKey,o=n.altKey,s=n.which;if([16,17,18].indexOf(s)>-1){var u=a.keyDown,l={keyDown:{ctrlKey:r,altKey:o,shiftKey:i,which:null===u?-1:u.which}};a.update(l),this.dispatchCalibrateAction(l),this._afterKeyChange(a,t,n)}}},{key:"keyup",value:function(e,t,n){var a=n.ctrlKey,r=n.shiftKey,i=n.altKey,o=n.which,s=this.users.getUser(t);if(s||(s=this.addUser(t)),[16,17,18].indexOf(o)>-1){var u=s.keyDown,l=null===u?-1:u.which;o===l&&(l=-1);var c={keyDown:{altKey:i,shiftKey:r,ctrlKey:a,which:o}};s.update(c),this.dispatchCalibrateAction(c),this._afterKeyChange(s,t,n)}}},{key:"_afterKeyChange",value:function(e,t,n){e.isMouseDown&&"flag"!==e.tool&&"free"!==e.tool&&"erase"!==e.tool&&this.mousemove(e.end,t,n)}},{key:"mousedown",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=void 0,a=this.getUser(t),r=a.mode,i=a.tool,o=a.color,s=a.size,u=a.fontsize,l=(a.keyDown,a.ctx),c=this.container.displayCtx;if((!a.isFlag||i&&"flag"!==i)&&"text"!==i&&("erase"!==i||0!==this.shapes.visibles.length)){a.whenMouseDown(v.default.clone(e));var d=a.end;a.isMouseDown&&(m.default.mouse("user.isMouseDown->true"),this.mouseup(d,t)),"free"===i||"erase"===i?(l.canvas.style.visibility="hidden",l.beginPath()):l.canvas.style.visibility="visible",m.default.m.worker("switch mode = ",r,i),this.lastStateAccount=a.account,(0,w.applyState)(l,a),(0,w.applyState)(c,a);var p=this.container,h=p.ownerCanvasHeight,f=p.ownerCanvasWidth,g=void 0;switch(h&&f&&(g=new T.StartAction(e.x,e.y)),r){case"draw":switch(a.isMouseDown=!0,m.default.log("user is mouseDown",a.isMouseDown,a),n=new y.default({user:a,mode:r,tool:i,size:s,color:o,fontsize:u,start:v.default.clone(e),actions:g,keyDown:a.keyDown}),a.pushShape(n),this.shapes.push(n),i){case"circle":case"ellipse":case"line":case"rect":case"roundRect":case"solidCircle":case"solidEllipse":case"solidRoundRect":case"solidRect":case"erase":case"free":case"flag":break;case"fill":this.lastStateAccount=a.account,(0,w.applyState)(n.ctx,a),(0,w.applyState)(c,a),n.draw(c),a.isMouseDown=!1;break;default:}}m.default.m.worker("emit on mousedown"),f&&h&&this.emitAction({account:t,action:g})}}},{key:"mousemove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=arguments[2],a=this.getUser(t);if(m.default.mouse("mousemove",a,!a.isMouseDown&&!a.isFlag),a.isFlag||a.isMouseDown){a.whenMouseMove(v.default.clone(e));var r=a.mode,i=a.tool,s=a.keyDown,u=a.end;if("erase"!==i||0!==this.shapes.visibles.length){var l=a.ctx,c=this.container.displayCtx;m.default.mouse("mousemove",e,a);var d=a.activeShape,p=new T.MoveAction(e.x,e.y);switch(n&&(0,o.default)(s).some((function(e){return n[e]!==s[e]}))&&a.update({keyDown:n}),"flag"!==i&&this.shiftKeyTool(a,d,(function(e){i=e})),a.account!==this.lastStateAccount&&"flag"!==i&&(this.lastStateAccount=a.account,(0,w.applyState)(l,a),(0,w.applyState)(c,a)),r){case"draw":switch(i){case"flag":a.flagPos=v.default.clone(e).toString(),this.renderFlag();break;case"erase":case"free":d&&(d.updateCorner(u),d.actions.push(p),d.freeMove(l),d.freeMove(c));break;case"line":f.clearCtx(l),d.updateCorner(u),d.draw(l);break;case"rect":case"solidRect":d&&(f.clearCtx(l),d.updateCorner(u),d.draw(l));break;case"roundRect":case"solidRoundRect":f.clearCtx(l),d&&(d.updateCorner(u),d.draw(l));break;case"circle":case"solidCircle":f.clearCtx(l),d&&(d.updateCorner(u),d.draw(l));break;case"ellipse":case"solidEllipse":f.clearCtx(l),d&&(d.updateCorner(u),d.draw(l));break;case"fill":case"text":p=null;break;default:}}p&&this.emitAction({account:t,action:p})}}else console.log("pre return when mouse down is false")}},{key:"shiftKeyTool",value:function(e,t,n){if(e.keyDown.shiftKey){var a=e.tool;"ellipse"===a?(a="circle",t&&(t.tool=a),n(a)):"circle"===a&&(a="ellipse",t&&(t.tool=a),n(a))}else t&&t.tool!==e.tool&&(t.tool=e.tool)}},{key:"mouseup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);e.text;console.warn("mouse up"),m.default.m.worker("mouse up",t);var a=n.mode,r=n.tool,i=n.color,o=(n.size,n.fontsize),s=(n.start,n.oldMid),u=n.end;if("erase"!==r||0!==this.shapes.visibles.length){var l=v.default.middle(u,e);s.clone(),u.clone();if(s.copy(l),u.copy(e),n.oldMid=s.clone(),n.end=u.clone(),n.isFlag)return this.clearFlag(),void this.emitAction({account:t,action:new T.LaserPenEndAction});if(n.isMouseDown||"text"===r){n.isMouseDown=!1,console.warn("turn use mouse down to false",n.isMouseDown,n.account);var c=n.ctx,d=this.container.displayCtx,p=n.activeShape,h=p&&p.ctx;if("text"!==r){if(p&&h){var g=!0;c.canvas.style.visibility="visible",p.updateCorner(u);var y=new T.EndAction(u.x,u.y);switch("flag"!==r&&(this.shiftKeyTool(n,p,(function(e){r=e})),this.lastStateAccount=n.account,(0,w.applyState)(c,n),(0,w.applyState)(d,n)),a){case"draw":switch(r){case"erase":case"free":p.expandCorner(),p.freeEnd(c),p.freeEnd(d);break;case"line":f.clearCtx(c),p.draw(c);break;case"rect":case"solidRect":f.clearCtx(c),p.draw(c);break;case"roundRect":case"solidRoundRect":f.clearCtx(c),p.draw(c);break;case"circle":case"solidCircle":f.clearCtx(c),p.draw(c);break;case"ellipse":case"solidEllipse":f.clearCtx(c),p.draw(c);break;case"flag":case"fill":y=null,g=!1;break;default:}g&&this.moveUserShapeToDisplay(n)}p.keyDown=n.keyDown,y&&(p.actions.push(y),this.emitAction({account:t,action:y}))}}else{var M=this.getCanvasCoord(u),x=this.container,I=x.canvasWidth,b=x.canvasHeight,k=x.inputDom,_=k.style,C=_.display;if(M.x<0||M.x>I||M.y<0||M.y>b)return;if("none"===C){var N=I-M.x-10;M.y;_.width=10*o>N?(N>0?N:0)+"px":N+"px",_.padding="1px 0",_.verticalAlign="top",_.lineHeight=o+"px",_.top=M.y+this.container.paddingTop+"px",_.left=M.x+this.container.paddingLeft+"px",_.fontSize=o+"px",_.display="block",_.color=i,k.setAttribute("data-point",u.toString()),k.focus(),n.end.copy(u)}else k.blur()}}}}},{key:"mouseleave",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=arguments[2];if(console.log("mouse leave"),t===this.account){var a=this.getUser(t);switch(a.tool){case"flag":this.clearFlag(t),this.emitAction({account:t,action:new T.LaserPenEndAction});break;case"text":break;default:this.mouseup(e,t,n)}}}},{key:"renderText",value:function(e,t){var n,a;a=e;var r=new v.default(e.x,e.y),i=this.getOwnerCoord(r);if((n=(e.text||"").trim())&&t){var o=this.getUser(t);o||(o=this.addUser(t));var s=o,u=s.tool,l=s.mode,c=s.size,d=s.color,p=s.fontsize,h=this.container.displayCtx,g=new y.default({user:o,mode:l,tool:u,size:c,color:d,fontsize:p,start:v.default.clone(r),actions:a,keyDown:o.keyDown});this.shapes.push(g),o.pushShape(g);var m=o.ctx;this.lastStateAccount=o.account,(0,w.applyState)(m,o),(0,w.applyState)(h,o),f.text(m,i,n,p,!0,d);var M=o.activeShape.corner;M[0].x=i.x-c,M[0].y=i.y-20,M[1].x=i.x+p*n.length,M[1].y=i.y+p+20,this.moveUserShapeToDisplay(o)}}},{key:"clearTransparentPix",value:function(e){for(var t=e.length,n=e,a=0;a<t;a+=4){n[3+a]<243&&(n[0+a]=0,n[1+a]=0,n[2+a]=0,n[3+a]=0)}}},{key:"moveUserShapeToDisplay",value:function(e,t){var n=e.activeShape,a=e.ctx,r=this.container.displayCtx;if(n&&r){var i=n.tool,o=n.ctx,s=(n.color,n.corner);m.default.log("corner",s);var u=Math.ceil(s[1].x-s[0].x),l=Math.ceil(s[1].y-s[0].y);if(0===u||0===l)return m.default.m.worker("mouseup shape is zero size"),void console.error("mouseup shape is zero size");m.default.m.worker("mouseup going to anti shape",e.account);var c=a.getImageData(s[0].x,s[0].y,u,l);"erase"===i&&m.default.image(a.canvas.toDataURL(),"erase"),this.opt.clearTransparentPix&&(-1===["text"].indexOf(i)||t)&&this.clearTransparentPix(c.data),o.canvas.width=u,o.canvas.height=l,f.setpixelated(o),f.setLineStyle(o),o.putImageData(c,0,0),r.imageSmoothingEnabled=!1,"free"!==i&&r.drawImage(o.canvas,Math.round(s[0].x),Math.round(s[0].y)),f.clearCtx(a)}else console.error("activeShape is ",n,"displayCtx is ",r)}},{key:"renderFlag",value:function(){var e=this,t=this.container.maskCtx;if(t){f.clearCtx(t);var n=this.container,a=n.ownerCanvasWidth,r=n.ownerCanvasHeight;this.users.all.forEach((function(n){var i=n.mode,o=n.tool,s=(n.color,n.flagPos);if("draw"==i&&"flag"===o&&a&&r){var u=v.default.fromString(s),l=e.getOwnerCoord(u);console.log("render flag",u,s,n.account),f.circle(t,l,5,!1,"#ff0000"),f.circle(t,l,4,!0,"#ff0000")}}))}}},{key:"getCanvasCoord",value:function(e){var t=this.container,n=t.canvasHeight,a=t.canvasWidth;return n&&a?new g.Coord(e.x*a,e.y*n):new g.Coord(0,0)}},{key:"getOwnerCoord",value:function(e){var t=this.container,n=t.ownerCanvasHeight,a=t.ownerCanvasWidth;return n&&a?new g.Coord(e.x*a,e.y*n):new g.Coord(0,0)}},{key:"undo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account,t=this.getUser(e);if(t&&0!==t.shapes.length){var n=t.undo();return this.emitAction({account:e,action:new T.RevokeAction}),n}}},{key:"redo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account,t=this.getUser(e);if(t&&0!==t.recycle.length){var n=t.redo();return this.emitAction({account:e,action:new T.RedoAction}),n}}},{key:"image",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,a=e.url,r=void 0===a?"":a,i=e.docId,o=void 0===i?"":i,s=e.currentPage,u=void 0===s?0:s,l=e.pageCount,c=void 0===l?0:l,d=e.type,p=void 0===d?"clear":d,h=e.urlStr,f=void 0===h?"":h,g=e.h5Cmd,v=void 0===g?"":g;if(r){if(this.container&&this.container.displayCtx){var y=this.container.displayCtx.canvas,m=new Image,M=void 0===this.opt.backgroundUrl?O:this.opt.backgroundUrl;m.onload=function(){t.container.container.classList.remove("canvas-loading"),y.style.backgroundSize="contain",y.style.backgroundImage="url("+r+")"},this.container.container.classList.add("canvas-loading"),y.style.backgroundSize="auto",y.style.backgroundImage="url("+M+")",m.src=r}this.emitAction({account:n,action:new T.FileAction({url:r,docId:o,currentPage:u,pageCount:c,type:p,urlStr:f,h5Cmd:v})})}}},{key:"clearImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account;this.container.displayCtx&&(this.container.displayCtx.canvas.style.backgroundImage=""),this.emitAction({account:e,action:new T.FileAction({docId:"",type:"clear"})})}},{key:"clear",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,a=arguments[2],r=a&&a.force,o=a&&a.quiet;if(this.container.displayCtx){f.clearCtx(this.container.displayCtx);var s=!0,u=!1,l=void 0;try{for(var c,d=(0,i.default)(this.users.all);!(s=(c=d.next()).done);s=!0){var p=c.value;p.isMouseDown&&!r?(m.default.m.worker("user.isMouseDown = true"),this.container.displayCtx.drawImage(p.ctx.canvas,0,0)):p.ctx&&f.clearCtx(p.ctx)}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}}var h=void 0;if(e&&(Array.isArray(e)||(e=[e]),0!=e.length&&(h=e)),h)h.forEach((function(e){var n=t.getUser(e);n&&(n.shapes.forEach((function(e){t.shapes.remove(e)})),n.clearShapes())})),this.container.displayCtx&&this.container.fullRender();else{this.shapes.clear();var g=!0,v=!1,y=void 0;try{for(var M,x=(0,i.default)(this.users.all);!(g=(M=x.next()).done);g=!0){var w=M.value;w.clearShapes()}}catch(e){v=!0,y=e}finally{try{!g&&x.return&&x.return()}finally{if(v)throw y}}}o||this.emitAction({account:n,action:new T.ClearAction(h)})}},{key:"act",value:function(e){m.default.m.worker("act->",e);var t=e.account;e.action;t&&!this.users.hasUser(t)&&this.addUser(t);var n=e.action;switch(n.TYPE){case b.WActions.START:this.mousedown(n,t);break;case b.WActions.MOVE:case b.WActions.LASER_PEN:this.mousemove(n,t);break;case b.WActions.TEXT:this.renderText(n,t);break;case b.WActions.END:this.mouseup(n,t);break;case b.WActions.LASER_PEN_END:this.clearFlag(t);break;case b.WActions.REDO:this.redo(t);break;case b.WActions.REVOKE:this.undo(t);break;case b.WActions.CLEAR:break;case b.WActions.CALIBRATE:this.calibrate(t,n);break;case b.WActions.SYNC_PREPARE_ACK:case b.WActions.SERIAL:break;case b.WActions.CLEAR_ACK:this.clear(t,t,{quiet:!0,force:!0});break;case b.WActions.SYNC_REQUEST:case b.WActions.FILE:case b.WActions.SYNC:case b.WActions.SYNC_PREPARE:case b.WActions.VERSION:break;default:}}},{key:"resize",value:function(){this.container.resize()}},{key:"dispatchCalibrateAction",value:function(e){this.emit("action",{account:this.account,action:new T.CalibrateAction(e)})}},{key:"calibrate",value:function(e,t){if(e){var n=t.ownerCanvasHeight,a=t.ownerCanvasWidth;n&&a&&(console.warn("update owner canvas"),this.container.canvasRatio=a/n,this.container.resize(),this.container.updateCanvasPropSize(a,n));var r=T.CalibrateAction.USER_PROPS.reduce((function(e,n){return n in t&&(e[n]=t[n]),e}),{}),i=this.getUser(e);i&&i.update(r)}}},{key:"addUser",value:function(e){if(m.default.m.worker("addUser",e),this.users.hasUser(e))return this.getUser(e);var t=this.users.addUser(e);return this.container.addUser(this.account,t),this.users.all.sort((function(e,t){return e.account>t.account?1:-1})).forEach((function(e,t){e.ctx.canvas.style.zIndex=""+(10+t)})),m.default.m.worker("create User ->",t),t}},{key:"getUser",value:function(e){return e==this.account&&this.localUser?this.localUser:this.users.getUser(e)}},{key:"removeUser",value:function(e){e&&this.clearFlag(e)&&this._removeUser(e)}},{key:"_removeUser",value:function(e){var t=this.getUser(e);if(t){try{this.container.container.removeChild(t.ctx.canvas)}catch(e){}this.users.remove(e)}}},{key:"destroy",value:function(){var e=this;this.container.inputDom.removeEventListener("blur",this.handleInputDomBlur),this.users.destroy(),this.switchEventListener(!1),this.users.uids.map((function(t){e._removeUser(t)})),this.shapes.destroy(),this.container.destroy(),this.removeAllListeners()}},{key:"getSnapshot",value:function(){var e=this.shapes,t=e.transh,n=e.visibles,a=this.container,r=a.canvasWidth,i=a.canvasHeight,o=a.ownerCanvasHeight,s=a.ownerCanvasWidth,u={width:r,height:i};return{users:this.users.toSnapshot(u),ownerWidth:s,ownerHeight:o,canvasWidth:r,canvasHeight:i,canvasRatio:r/(0===i?1e-6:i),transhShapes:t.map((function(e){return e.toSnapshot(u)})),shapes:n.map((function(e){return e.toSnapshot(u)}))}}},{key:"restoreShape",value:function(e,t){return P(this,void 0,void 0,a.default.mark((function n(){var i,o,s,u,l,c,d,h,m,M,x,I,b,k,T,N,A,P,O,D,S,E,j,L,z,R,B,F,Y,U,W,H,Q,Z,G,V,X,J,K,q,$,ee,te,ne,ae,re,ie,oe,se,ue,le,ce,de,pe,he,fe,ge,ve,ye,me,Me,xe,we,Ie,be,ke,Te,_e,Ce,Ne,Ae,Pe,Oe,De,Se,Ee,je,Le,ze,Re,Be,Fe,Ye,Ue,We=this;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=e.id,o=e.start,s=e.user,u=e.color,l=e.fontsize,c=e.size,d=e.mode,h=e.actions,m=e.optimized,M=e.imageData,x=e.corner,I=e.keyDown,b=e.tool,k=(0,_.unpackBulk)(h),T=k.length,(N=this.users.getUser(s))||(N=this.addUser(s)),A=this.container,P=A.ownerCanvasWidth,O=A.ownerCanvasHeight,(D=new y.default({user:N,mode:d,tool:b,size:c,color:u,fontsize:l,start:v.default.fromString(o),actions:k,keyDown:I})).id=i,D.optimized=m,S=x.map((function(e){return v.default.fromString(e).toCoord(P,O)})),E=(0,r.default)(S,2),j=E[0],L=E[1],z=j,R=g.Coord.areaSize(j,L),B=R.width,F=R.height,Y=D.ctx,f.setCanvasPropSize(Y,{width:B,height:F}),D.corner=[j,L],(0,w.applyState)(Y,{ctx:Y,color:u,size:c,tool:b}),console.assert(Y.lineWidth===c,"shape line width is not the same",c,Y.lineWidth),t?N.recycle.push(D):(N.shapes.push(D),this.shapes.push(D)),U=function(e){var t=k[0],n=k[T-1],a=We.getOwnerCoord(t),r=We.getOwnerCoord(n);return e?[a.minus(e),r.minus(e)]:[a,r]},W=!0,n.t0=b,n.next="free"===n.t0||"erase"===n.t0?24:"line"===n.t0?26:"circle"===n.t0||"solidCircle"===n.t0?29:"ellipse"===n.t0||"solidEllipse"===n.t0?33:"rect"===n.t0||"solidRect"===n.t0?37:"roundRect"===n.t0||"solidRoundRect"===n.t0?44:"text"===n.t0?52:"fill"===n.t0?58:"flag"===n.t0?64:66;break;case 24:if(T>=2)if(H=U(z),Q=(0,r.default)(H,2),Z=Q[0],G=Q[1],V=Z.clone(),X=Z.clone(),J=Z.clone(),2===T)f.line(Y,V,J,u);else{for(K=1,q=T-1;K<q;K++)$=this.getOwnerCoord(k[K]).minus(z),ee=g.Coord.middle(J,$),te=X.clone(),ne=J.clone(),X.copy(ee),J.copy($),f.free(Y,te,ne,ee,u,c);ae=g.Coord.middle(J,G),re=X.clone(),J.clone(),f.free(Y,re,ae,G,u,c)}return n.abrupt("break",69);case 26:return ie=U(z),oe=(0,r.default)(ie,2),se=oe[0],ue=oe[1],f.line(Y,se,ue,u),n.abrupt("break",69);case 29:return le=U(z),ce=(0,r.default)(le,2),de=ce[0],pe=ce[1],he=y.default.calculateRadius(b,de,pe),fe=he.radius,f.circle(Y,de,fe,"solidCircle"===b,u),n.abrupt("break",69);case 33:return ge=U(z),ve=(0,r.default)(ge,2),ye=ve[0],me=ve[1],Me=y.default.calculateRadius(b,ye,me),Me.radius,xe=Me.xRadius,we=Me.yRadius,f.ellipse(Y,ye,xe,we,"solidEllipse"===b,u),n.abrupt("break",69);case 37:return Ie=U(z),be=(0,r.default)(Ie,2),ke=be[0],Te=be[1],_e=Te.x-ke.x,Ce=Te.y-ke.y,Ne=Math.min(Math.abs(_e),Math.abs(Ce)),I.shiftKey&&(_e=(0,C.sign)(_e)*Ne,Ce=(0,C.sign)(Ce)*Ne),f.rect(Y,ke,_e,Ce,"solidRect"===b,u),n.abrupt("break",69);case 44:return Ae=U(z),Pe=(0,r.default)(Ae,2),Oe=Pe[0],De=Pe[1],Se=De.x-Oe.x,Ee=De.y-Oe.y,je=Math.min(Math.abs(Se),Math.abs(Ee)),I.shiftKey&&(Se=(0,C.sign)(Se)*je,Ee=(0,C.sign)(Ee)*je),Le=je<c?2:.1*je,f.roundRect(Y,Oe,Se,Ee,Le,"solidRoundRect"===b,u),n.abrupt("break",69);case 52:return ze=k[0],Re=ze.text,Be=this.getOwnerCoord(ze).minus(z),f.text(Y,Be,Re,l,!0,u),W=!1,n.abrupt("break",69);case 58:return Fe=Math.abs(j.x-L.x),Ye=Math.abs(j.y-L.y),n.next=62,new p.default((function(e){var t=new Image;t.src=M,t.onerror=function(){return e()},t.onload=function(){console.log("fill"),Y.drawImage(t,0,0,Fe,Ye),e()}}));case 62:case 64:return W=!1,n.abrupt("break",69);case 66:W=!1,b,console.warn("尝试恢复未知的图形");case 69:if(this.opt.clearTransparentPix&&W)try{Ue=Y.getImageData(0,0,B,F),this.clearTransparentPix(Ue.data),Y.putImageData(Ue,B,F)}catch(e){console.error(e)}case 70:case"end":return n.stop()}}),n,this)})))}},{key:"mesure",value:function(e){var t=this;document.getElementById("worker-mesure-anim")||document.head.insertAdjacentHTML("beforeend","<style>@keyframes xxx-xxx{from{background:red;}to{background:green}}</style>"),Array.isArray(e)||(e=[e]),e.forEach((function(e){t.container.container.insertAdjacentHTML("afterbegin",'<div style="z-index:2222;display:inline-block;position:absolute;background:red;top:'+e.x+"px;left:"+e.y+'px;width:2px;height:2px;animation:xxx-xxx 1s infinite"></div>')}))}}]),t}(h.default);t.default=D},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(38)),r=l(n(0)),i=l(n(1)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(257)),s=l(n(104)),u=n(159);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=t.user,a=t.mode,i=t.tool,s=t.size,u=t.color,l=t.start,c=t.actions,d=t.fontsize,p=t.keyDown;(0,r.default)(this,e);var h=performance&&performance.timing&&performance.timing.navigationStart+performance.now();this.id=h||Date.now(),this.user=n,this.visible=!0,this.ctx=document.createElement("canvas").getContext("2d");var f=this.ctx.canvas,g=n.ctx.canvas;f.style.width=g.style.width,f.style.height=g.style.height,this.ctx.lineWidth=n.ctx.lineWidth,this.coordWidth=g.width,this.coordHeight=g.height,o.setCanvasPropSize(this.ctx,{width:this.coordWidth,height:this.coordHeight}),this.tool=i,this.mode=a,this.color=u,this.size=s,this.fontsize=d,Array.isArray(c)?this.actions=c:void 0===c?(console.warn("action undefined! create a shape"),this.actions=[]):this.actions=[c],this.keyDown=p,this.start=l.toCoord(this.coordWidth,this.coordHeight),this.corner=[this.start.clone(),this.start.clone()],this.transform=[],this.path=[],this.zIndex=1,this.detail=e.calculateRadius(this.tool,this.start,this.start)}return(0,i.default)(e,[{key:"updateCorner",value:function(t){var n=this.getCoord(t),r=this.start,i=this.size,o=(0,a.default)(this.corner,2),s=o[0],u=o[1],l=e.calculateRadius(this.tool,r,n);this.detail=l;var c=l.xRadius,d=l.yRadius,p=l.radius;l.width,l.height;switch(this.tool){case"solidCircle":case"circle":s.x=r.x-p-i,s.y=r.y-p-i,u.x=r.x+p+i,u.y=r.y+p+i;break;case"ellipse":case"solidEllipse":s.x=r.x-c-i,s.y=r.y-d-i,u.x=r.x+c+i,u.y=r.y+d+i;break;case"rect":case"roundRect":case"solidRect":case"solidRoundRect":case"line":s.copy(r.clone().topLeft(n)),u.copy(r.clone().bottomRight(n));break;case"text":case"free":case"erase":s.topLeft(n),u.bottomRight(n);break;case"flag":case"fill":break;default:this.tool}return"fill"!==this.tool&&"text"!==this.tool&&"free"!==this.tool&&"erase"!==this.tool&&(s.x-=i,s.y-=i,u.x+=i,u.y+=i),l}},{key:"expandCorner",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size,t=(0,a.default)(this.corner,2),n=t[0],r=t[1];n.x-=e,n.y-=e,r.x+=e,r.y+=e}},{key:"destroy",value:function(){s.default.shape("shape delete ctx",this.user,this.ctx,this.actions)}},{key:"toSnapshot",value:function(e){var t=e.width,n=e.height,a=this.id,r=this.mode,i=this.tool,o=this.size,s=this.fontsize,u=this.color,l=this.start,c=this.actions,d=this.keyDown;return"fill"===i?{id:a,user:this.user.account,mode:r,tool:i,size:o,fontsize:s,color:u,start:l.toPoint(t,n).toString(),optimized:!0,imageData:this.ctx.canvas.toDataURL(),keyDown:d,corner:this.corner.map((function(e){return e.toPoint(t,n).toString()})),actions:c.filter((function(e){return e})).map((function(e){return e.toString()})).join(";")+";"}:{id:a,user:this.user.account,mode:r,tool:i,size:o,fontsize:s,color:u,start:l.toPoint(t,n).toString(),optimized:!1,imageData:"",corner:this.corner.map((function(e){return e.toPoint(t,n).toString()})),keyDown:d,actions:c.filter((function(e){return e})).map((function(e){return e.toString()})).join(";")+";"}}},{key:"draw",value:function(e){var t=this.user.end.toCoord(this.coordWidth,this.coordHeight);switch(this.tool){case"fill":o.fill(e,t,this.color,this);break;case"erase":case"free":o.free(e,this.getCoord(this.user.prevOldMid),this.getCoord(this.user.prevEnd),this.getCoord(this.user.oldMid),this.color,this.size);break;case"line":o.line(e,this.getCoord(this.user.start),this.getCoord(this.user.end),this.color);break;case"rect":case"solidRect":var n=this.getCoord(this.user.end),a=this.getCoord(this.user.start),r=n.x-a.x,i=n.y-a.y,s=Math.min(Math.abs(r),Math.abs(i));this.user.keyDown.shiftKey&&(r=(0,u.sign)(r)*s,i=(0,u.sign)(i)*s),o.rect(e,a,r,i,"solidRect"===this.tool,this.color);break;case"roundRect":case"solidRoundRect":var l=this.getCoord(this.user.end),c=this.getCoord(this.user.start),d=l.x-c.x,p=l.y-c.y,h=Math.min(Math.abs(d),Math.abs(p)),f=h<this.size?2:.1*h;this.user.keyDown.shiftKey&&(d=(0,u.sign)(d)*h,p=(0,u.sign)(p)*h),o.roundRect(e,c,d,p,f,"solidRoundRect"===this.tool,this.color);break;case"circle":case"solidCircle":var g=this.detail.radius,v=this.getCoord(this.user.start);o.circle(e,v,g,"solidCircle"===this.tool,this.color);break;case"ellipse":case"solidEllipse":var y=this.getCoord(this.user.start),m=this.detail,M=m.xRadius,x=m.yRadius;o.ellipse(e,y,M,x,"solidEllipse"===this.tool,this.color)}}},{key:"freeMove",value:function(e){o.free(e,this.getCoord(this.user.prevOldMid),this.getCoord(this.user.prevEnd),this.getCoord(this.user.oldMid),this.color,this.size)}},{key:"freeEnd",value:function(e){o.free(e,this.getCoord(this.user.prevOldMid),this.getCoord(this.user.oldMid),this.getCoord(this.user.end),this.color,this.size)}},{key:"getCoord",value:function(e){return e.toCoord(this.coordWidth,this.coordHeight)}}],[{key:"calculateRadius",value:function(e,t,n){var a=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),i=void 0,o=void 0,s=void 0;switch(e){case"circle":case"solidCircle":case"ellipse":case"solidEllipse":i=(o=a)>(s=r)?o:s}return{xRadius:o,yRadius:s,radius:i,width:a,height:r}}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(2)),r=f(n(0)),i=f(n(1)),o=f(n(3)),s=f(n(4)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(257)),l=f(n(264)),c=n(47),d=f(n(104)),p=n(151),h=f(n(256));function f(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(e,n){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.undoCount=0,i.account=e,i.ctx=document.createElement("canvas").getContext("2d"),i.ctx.canvas.className="wb_-_-"+e,u.setpixelated(i.ctx),u.setLineStyle(i.ctx),i.shapes=[],i.recycle=[],i.mode="draw",i.tool="flag",i.flagPos=new l.default(99999,99999).toString(),i.size=4,i.color="#000000",i.fontsize=24,i.isMouseDown=!1,i.start=new l.default(0,0),i.oldMid=new l.default(0,0),i.prevOldMid=new l.default(0,0),i.end=new l.default(0,0),i.prevEnd=new l.default(0,0),i.keyDown={altKey:!1,ctrlKey:!1,shiftKey:!1,which:-1},h.default.emit("userUpdate",i.account,{tool:i.tool,size:i.size,color:i.color,fontsize:i.fontsize,mode:i.mode,keyDown:i.keyDown}),i.maxUserHistory=n,i._resetCalibrate=i.getCalibrateAction(),i}return(0,s.default)(t,e),(0,i.default)(t,[{key:"update",value:function(e){var n=this;t.PROPS.forEach((function(t){t in e&&(n[t]=e[t])})),this.emit("update",this.account,e),h.default.emit("userUpdate",this.account,e),d.default.user("update user ",this,"with ",e)}},{key:"pushShape",value:function(e){return this.recycle.length&&(this.recycle.forEach((function(e){return e.destroy()})),this.recycle.length=0),this.undoCount=0,this.shapes.push(e),this.configActiveShape(),this.emitUserShape(),e}},{key:"configActiveShape",value:function(){console.log("config active shape "),this.activeShape=this.shapes[this.shapes.length-1]}},{key:"undo",value:function(){if(this.undoCount>=this.maxUserHistory)return console.warn("reach maxUserHistory! abort undo"),this.shapes.length;this.undoCount++;var e=this.shapes.pop();return e&&(this.recycle.push(e),this.configActiveShape(),d.default.log("undo:",this),this.emit("undo",this),this.emitUserShape()),this.shapes.length}},{key:"redo",value:function(){if(0===this.undoCount)return this.recycle.length;this.undoCount--;var e=this.recycle.pop();return e&&(this.shapes.push(e),this.configActiveShape(),this.emit("redo",this),this.emitUserShape()),this.recycle.length}},{key:"getCalibrateAction",value:function(){var e=this.mode,t=this.tool,n=this.size,a=this.color,r=this.fontsize,i=this.isMouseDown,o=this.keyDown,s=this.flagPos;return new p.CalibrateAction({mode:e,tool:t,size:n,color:a,fontsize:r,isMouseDown:i,flagPos:s,keyDown:o})}},{key:"clearShapes",value:function(){d.default.user("user reset:",this),this.shapes.forEach((function(e){return e.destroy()})),this.shapes=[],this.recycle=[],this.undoCount=0,this.emitUserShape()}},{key:"emitUserShape",value:function(){var e=this.undoCount,t=(this.recycle.length,this.shapes.length),n=this.maxUserHistory-e;t<n&&(n=t),h.default.emit("userShapes",this.account,n,this.recycle.length)}},{key:"guessMyUndoCount",value:function(){this.undoCount=this.recycle.length}},{key:"whenMouseDown",value:function(e){this.prevOldMid=e.clone(),this.prevEnd=e.clone(),this.start=e.clone(),this.oldMid=e.clone(),this.end=e.clone()}},{key:"whenMouseMove",value:function(e){this.prevOldMid=this.oldMid.clone(),this.prevEnd=this.end.clone(),this.oldMid=l.default.middle(this.end,e),this.end=e.clone()}},{key:"whenMouseUp",value:function(e){this.prevOldMid=this.oldMid.clone(),this.prevEnd=this.end.clone(),this.oldMid=l.default.middle(this.end,e),this.end=e.clone()}},{key:"reset",value:function(){this.update(this._resetCalibrate),h.default.emit("userUpdate",this.account,this._resetCalibrate)}},{key:"destroy",value:function(){(this.shapes.length||this.recycle.length)&&this.clearShapes(),d.default.user("delete user ctx:",this)}},{key:"isFlag",get:function(){return"flag"===this.tool}}]),t}(c.EventEmitter);g.PROPS=["mode","tool","size","color","fontsize","isMouseDown","flagPos","keyDown"],t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(2)),r=p(n(0)),i=p(n(1)),o=p(n(3)),s=p(n(4)),u=n(47),l=n(471),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(257)),d=p(n(256));function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return e.onUndo=function(t){var n=t.recycle[t.recycle.length-1];e.remove(n),e.emit("undo",t)},e.onRedo=function(t){var n=t.shapes[t.shapes.length-1];e.push(n),e.emit("redo",t)},e.visibles=[],e.transh=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"push",value:function(e){this.visibles.push(e),this.visibles.sort((function(e,t){return e.id-t.id})),d.default.emit("globalShapes",this.visibles.length)}},{key:"remove",value:function(e){var t=this.visibles.indexOf(e);~t&&(this.visibles.splice(t,1),d.default.emit("globalShapes",this.visibles.length))}},{key:"wrap",value:function(e){e instanceof l.UserManager&&(this.clearListener(),this._usernameger=e,this._usernameger.on("undo",this.onUndo),this._usernameger.on("redo",this.onRedo))}},{key:"clear",value:function(){this.visibles.forEach((function(e){e.destroy()})),this.visibles.length=0,d.default.emit("globalShapes",this.visibles.length)}},{key:"destroy",value:function(){this.clearListener()}},{key:"clearListener",value:function(){this._usernameger&&(this._usernameger.removeAllListeners(),delete this._usernameger)}},{key:"resizeCanvas",value:function(e){var t=e.widthScale,n=e.heightScale;this.visibles.forEach((function(e){var a=e.ctx.canvas,r=a.width,i=a.height,o=r*t,s=i*n;c.setCanvasPropSize(e.ctx,{height:s,width:o}),e.corner[0].x*=t,e.corner[0].y*=n,e.corner[1].x*=t,e.corner[1].y*=n}))}}]),t}(u.EventEmitter);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n(5)),r=h(n(7)),i=h(n(2)),o=h(n(0)),s=h(n(1)),u=h(n(3)),l=h(n(4));t.applyState=g;var c=n(47),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(257)),p=h(n(104));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e,n){(0,o.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return a.paddingTop=0,a.paddingLeft=0,a.canvasRatio=null,a.onResize=function(){a.container&&(a.onResize.waiting||(a.onResize.waiting=!0,setTimeout((function(){a.onResize.waiting=!1,a.resize()}),300)))},a.resize=function(){var e=parseInt(""+a.container.clientWidth);if(isNaN(e)||e<=0)throw new Error("白板宽度应是大于0的数字");var t=parseInt(""+a.container.clientHeight);if(isNaN(t)||t<=0)throw new Error("白板高度应是大于0的数字");if(0!==e&&0!==t&&(a.containerWidth=e,a.containerHeight=t,null===a.canvasRatio?a.calcCanvasLayout(e/t):a.calcCanvasLayout(),a.updateCanvasStyleSize({paddingLeft:a.paddingLeft,paddingTop:a.paddingTop,canvasWidth:a.canvasWidth,canvasHeight:a.canvasHeight}),console.log("resize"),a.opt&&"owner"===a.opt.identity)){a.canvasWidth&&a.canvasHeight,a.emit("ownerCanavasUpdate",a.canvasWidth,a.canvasHeight);a.containerHeight,a.containerWidth,a.ownerCanvasHeight,a.ownerCanvasWidth;a.updateCanvasPropSize(a.canvasWidth,a.canvasHeight)}},a.onUndo=function(){if(a.displayCtx&&a.shapes&&a.users){a.fullRender();var e=!0,t=!1,n=void 0;try{for(var i,o=(0,r.default)(a.users.all);!(e=(i=o.next()).done);e=!0){var s=i.value;s.isMouseDown&&a.displayCtx.drawImage(s.ctx.canvas,0,0)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}},a.onRedo=function(){if(a.displayCtx&&a.shapes&&a.users){a.fullRender();var e=!0,t=!1,n=void 0;try{for(var i,o=(0,r.default)(a.users.all);!(e=(i=o.next()).done);e=!0){var s=i.value;s.isMouseDown&&a.displayCtx.drawImage(s.ctx.canvas,0,0)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}},a.inputDom=function(){var e=document.createElement("input");e.type="text",e.autofocus=!0,e.className="wb-canvas__input";var t=e.style;return t.position="absolute",t.display="none",t.padding="0px",t.zIndex="999",e}(),a.opt=n,a.inited=!1,e?(a.setContainer(e,n,!0),a):(0,u.default)(a)}return(0,l.default)(t,e),(0,s.default)(t,[{key:"wrap",value:function(e,t){this.clearListener(),this.shapes=e,this.users=t,this.shapes.on("undo",this.onUndo),this.shapes.on("redo",this.onRedo)}},{key:"clearListener",value:function(){this.shapes&&this.shapes.removeAllListeners()}},{key:"setContainer",value:function(e,t,n){if(p.default.m.containermanager("setContainer",e,t),!(e instanceof HTMLElement))throw new Error("画板容器不是HTMLElement实例");this.container&&(this.container.removeEventListener("resize",this.onResize),this.container.remove()),this.container=e,e.style.position="relative",t||(t=this.opt?this.opt:{}),this.containerHeight=e.clientHeight,this.containerWidth=e.clientWidth,console.warn("canvas height!",t,this.canvasRatio),null===this.canvasRatio&&(t.height&&t.width?(this.canvasHeight=t.height,this.canvasWidth=t.width,this.updateCanvasPropSize(this.canvasWidth,this.canvasHeight),this.canvasRatio=this.canvasWidth/this.canvasHeight):this.canvasRatio=this.containerWidth/this.containerHeight);var r=this.canvasRatio;null===r&&(r=this.containerWidth/this.containerHeight),"number"==typeof r&&this.calcCanvasLayout(r),this.opt=(0,a.default)(this.opt,t),this.inited||this.initEssential(),this.updateCanvasStyleSize({paddingLeft:this.paddingLeft,paddingTop:this.paddingTop,canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight}),n&&"owner"===this.opt.identity&&this.updateCanvasPropSize(this.canvasWidth,this.canvasHeight),p.default.m.containermanager("setContainer/appendChild",this.displayCanvas,this.inputDom),e.appendChild(this.displayCanvas),e.appendChild(this.maskCanvas),e.appendChild(this.inputDom),this.adjustSize=!1,window.addEventListener("resize",this.onResize),window.addEventListener("orientationchange",this.onResize,!1)}},{key:"calcCanvasLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvasRatio,t=this.containerWidth/this.containerHeight;t>e?(this.canvasHeight=Math.floor(this.containerHeight||0),this.canvasWidth=Math.floor(this.canvasHeight*e)):(this.canvasWidth=Math.floor(this.containerWidth||0),this.canvasHeight=Math.floor(this.canvasWidth/e));var n=this.containerHeight-this.canvasHeight,a=this.containerWidth-this.canvasWidth;this.paddingTop=Math.floor(n/2),this.paddingLeft=Math.floor(a/2)}},{key:"initEssential",value:function(){var e=this;if("number"!=typeof this.containerWidth)throw new Error("画板宽度不是数字");if("number"!=typeof this.containerHeight)throw new Error("画板高度不是数字");var t=document.createElement("canvas");this.displayCtx=t.getContext("2d"),d.setLineStyle(this.displayCtx),t.setAttribute("data-id","displayCanvas");var n=("\n    position: relative;\n    top: "+this.paddingTop+"px;\n    left: "+this.paddingLeft+"px;\n    box-sizing: content-box;\n    background-position: center;\n    background-repeat: no-repeat;\n    background-color: #ffffff;\n    background-size: contain;\n    z-index: 2;\n    ").trim().replace("\n","");t.style.cssText=n,this.displayCanvas=t;var a=document.createElement("canvas");this.maskCtx=a.getContext("2d"),d.setpixelated(this.maskCtx),d.setLineStyle(this.maskCtx),this.maskCtx.lineWidth=1,a.setAttribute("data-id","maskCanvas");var r=("\n    position: absolute;\n    top: "+this.paddingTop+";\n    left: "+this.paddingLeft+";\n    box-sizing: content-box;\n    transform: translate3d(0,0,0);\n    z-index: 500;\n    ").trim().replace("\n","");a.style.cssText=r,this.maskCanvas=a,this.inited=!0,p.default.m.containermanager("initCanvas"),setTimeout((function(){e.emit("init-canvas"),e.opt&&"owner"===e.opt.identity&&e.emit("ownerCanavasUpdate",e.canvasWidth,e.canvasHeight)}))}},{key:"updateCanvasStyleSize",value:function(e){var t=e.canvasWidth,n=e.canvasHeight;if(this.maskCtx&&this.maskCanvas&&(d.setCavansStyleSize(this.maskCtx,t,n),d.applyCanvasLayout(this.maskCanvas,e)),this.displayCtx&&this.displayCanvas&&(d.setCavansStyleSize(this.displayCtx,e.canvasWidth,e.canvasHeight),d.applyCanvasLayout(this.displayCanvas,e)),this.users){var a=!0,i=!1,o=void 0;try{for(var s,u=(0,r.default)(this.users.all);!(a=(s=u.next()).done);a=!0){var l=s.value;d.setCavansStyleSize(l.ctx,t,n),d.applyCanvasLayout(l.ctx.canvas,e)}}catch(e){i=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw o}}}}},{key:"updateCanvasPropSize",value:function(e,t){var n=this.ownerCanvasHeight,a=this.ownerCanvasWidth;this.ownerCanvasWidth=e||300,this.ownerCanvasHeight=t||300;var i={width:this.ownerCanvasWidth,height:this.ownerCanvasHeight};if(this.maskCtx&&d.setCanvasPropSize(this.maskCtx,i),this.displayCtx&&d.setCanvasPropSize(this.displayCtx,i),this.users){var o=!0,s=!1,u=void 0;try{for(var l,c=(0,r.default)(this.users.all);!(o=(l=c.next()).done);o=!0){var p=l.value;d.setCanvasPropSize(p.ctx,{width:e,height:t})}}catch(e){s=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}}this.shapes&&this.shapes.resizeCanvas({widthScale:e/a,heightScale:t/n}),this.fullRender()}},{key:"addUser",value:function(e,t){var n=t.ctx.canvas,a=t.account;this.displayCanvas;n.style.position="absolute",n.style.boxSizing="content-box",n.style.top=this.paddingTop+"px",n.style.left=this.paddingLeft+"px",n.style.width=this.canvasWidth+"px",n.style.height=this.canvasHeight+"px",n.width=this.ownerCanvasWidth,n.height=this.ownerCanvasHeight,p.default.m.containermanager("addUser",a,t),n.style.cursor=a===e?"not-allowed":"crosshair",this.container.appendChild(n),d.setpixelated(t.ctx),d.setLineStyle(t.ctx)}},{key:"destroy",value:function(){this.container.removeChild(this.maskCanvas),this.container.removeChild(this.displayCtx.canvas),this.removeAllListeners(),window.removeEventListener("resize",this.onResize),window.removeEventListener("orientationchange",this.onResize,!1)}},{key:"fullRender",value:function(){if(this.displayCtx){this.displayCtx.canvas;d.clearCtx(this.displayCtx),this.displayCtx.getImageData(0,0,1,1)}if(this.shapes&&this.displayCtx){var e=this.displayCtx,t=this.shapes.visibles;e.save(),p.default.log("displayCtx");for(var n=0,a=t.length;n<a;n++){var r=t[n];console.assert(void 0!==r.ctx,"shape ctx is ubdefined",r);var i=r.ctx&&(0===r.ctx.canvas.width||0===r.ctx.canvas.height);p.default.m.containermanager("render shape:",r,"skip",i),i||(g(e,r),"erase"===r.tool&&console.log(e.globalCompositeOperation),e.drawImage(r.ctx.canvas,r.corner[0].x,r.corner[0].y))}e.restore()}else p.default.m.containermanager("no render",this.shapes,this.displayCtx)}}]),t}(c.EventEmitter);function g(e,t){var n=t.ctx,a=t.size,r=t.color,i=t.tool;void 0!==e?(e.lineWidth=a,e.strokeStyle=r,e.fillStyle=r,"erase"===i&&e!==n?"destination-out"!==e.globalCompositeOperation&&(e.globalCompositeOperation="destination-out"):e.globalCompositeOperation="source-over"):console.warn("applyState上下文为空!")}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=M(n(28)),r=M(n(72)),i=M(n(7)),o=M(n(37)),s=M(n(38)),u=M(n(5)),l=M(n(2)),c=M(n(0)),d=M(n(1)),p=M(n(3)),h=M(n(4)),f=M(n(14)),g=M(n(473)),v=n(266),y=M(n(47)),m=M(n(457));function M(e){return e&&e.__esModule?e:{default:e}}var x=function(e,t,n,a){return new(n||(n=f.default))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function s(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},w=function(e){function t(e,n){(0,c.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e,n));a.records=[],a.connector=new I,Array.isArray(e)&&(a.params=e[0]);var r=a.params.container,i=a.params.drawPluginParams||{};return a.drawManager=new v.App((0,u.default)((0,u.default)({account:a.viewer,uid:123,container:r,connector:a.connector,isRecordPlayer:!0,platform:"web"},i),{appkey:"",nim:{},logger:new m.default(a.viewer),isG1:!0})),a.drawManager.setTool("pan"),window.drawPlugin=a.drawManager,a}return(0,h.default)(t,e),(0,d.default)(t,[{key:"init",value:function(){return x(this,void 0,void 0,a.default.mark((function e(){var t,n,l,c,d;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchMultiData();case 2:if(t=e.sent,n=(0,s.default)(t,2),l=n[0],c=n[1],"error"!==l){e.next=11;break}return this.state="error",e.abrupt("return","error");case 11:return this.records=c.map((function(e){return(0,u.default)((0,u.default)({},e),{records:e.records.map((function(e){return{record:JSON.parse(e.str),time:e.time}}))})})),d=new o.default,this.records.forEach((function(e){e.records.forEach((function(e){if("snapshot"===e.record.type&&(e.record.value.data.recordTime=e.time),"snapshotArr"===e.record.type&&Array.isArray(e.record.value)&&e.record.value.length>0){var t=!0,n=!1,a=void 0;try{for(var r,o=(0,i.default)(e.record.value);!(t=(r=o.next()).done);t=!0){r.value.data.recordTime=e.time}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}}"snapshot"===e.record.type&&e.record.value.uid&&d.add(e.record.value.uid),"snapshotArr"===e.record.type&&Array.isArray(e.record.value)&&e.record.value.length>0&&e.record.value[0].uid&&d.add(e.record.value[0].uid)}))})),console.log(this.records[0].records.map((function(e){return e.record.value}))),this.viewerArr=(0,r.default)(d),this.viewerArr.length>0&&this.setViewer(this.viewerArr[0]),this.state="ready",e.abrupt("return","ready");case 19:case"end":return e.stop()}}),e,this)})))}},{key:"setViewer",value:function(e){var t;this.viewer=e,null===(t=this.drawManager)||void 0===t||t.setViewer(e)}},{key:"doSetTrack",value:function(e,t,n){return x(this,void 0,void 0,a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._seekTo(e);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"play",value:function(){var e;null===(e=this.drawManager)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.drawManager)||void 0===e||e.pause()}},{key:"setPlaySpeed",value:function(e){var t;null===(t=this.drawManager)||void 0===t||t.setPlaySpeed(e)}},{key:"_seekTo",value:function(e){for(var t=void 0,n=0;n<this.records.length-1;n++)if(e<this.records[n+1].beginAt){t=this.records[n];break}void 0===t&&(t=this.records[this.records.length-1]),t.cid!==this.currCid&&this.drawManager.addRecordData(t.records),this.currCid=t.cid,this.drawManager.seekTo(e-t.beginAt)}},{key:"showTrackCb",value:function(e){}}]),t}(g.default);t.default=w;var I=function(e){function t(){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,d.default)(t,[{key:"sendData",value:function(){}},{key:"broadcastData",value:function(){}},{key:"sendSyncRequest",value:function(){}}]),t}(y.default)}]).default}));